{
    "title": "[PHP] Libvirt-Manager —— 几行代码就可以管理你的 KVM 虚拟机",
    "author": "Akkariin",
    "replyCount": 1,
    "timestamp": 1544139120,
    "txt_content": "\n\nLibvirt-Manager一个简单的 Libvirt 虚拟机管理器，使用 PHP 开发。\n\n它可以启动、关闭、强制结束或读取虚拟机信息，列出虚拟机列表等。\n这个项目是为了让开发者管理虚拟机更简单，更轻松。\n你需要安装 PHP_SSH2 模块来使用此管理器。\nGithub：https://github.com/kasuganosoras/Libvirt-Manager\n\n连接到服务器的示例代码\ninclude(\"libvirt/libvirt.php\");\n$Libvirt = new Libvirt();\n$Libvirt->setHost(\"192.168.3.181\", 22, \"/data/libvirt/\");\n$Libvirt->connect(\"root\", \"123456\");复制代码Libvirt Manager 需要通过 SSH 连接到服务器进行操作，请确认你的服务器已启用 sshd 服务。\n在示例代码中，192.168.3.181 是服务器地址，22 是服务器端口，/data/libvirt/ 是你希望 Libvirt 使用的数据储存目录。\n在登录时，请使用用户名和密码（目前暂不支持证书登录），示例代码中的用户名和密码分别是 root 和 123456\n\n创建虚拟机示例代码\n$Libvirt->createDisk(\"Test\", \"qcow2\", \"30G\");\n$Libvirt->createVMXML(\"Test\", 2, 2048576, \"/data/libvirt/images/Test/Test.qcow2\", \"/data/iso/CentOS-7-x86_64-Minimal-1804.iso\", \"cdrom\", \"network\", \"default\", $Libvirt->randomMac(), \"virbr0\", 0, 0, 5902);\n$Libvirt->define(\"/data/libvirt/Test.xml\");\n$Libvirt->setPermission(\"Test\");\n$Libvirt->start(\"Test\");复制代码\n创建一个虚拟磁盘\nString createDisk ( Name, Format, Size )复制代码\n创建一个虚拟机 XML 配置文件\ncreateVMXML 方法一共有 13 个参数\nvoid createVMXML ( Name, vCPU, Ram, Disk, ISO, Boot Device, Network type, Network name, MAC Address, Network bridge, Bandwidth in, Bandwidth out, VNC Port )复制代码\n将虚拟机 XML 配置文件注册到系统\nString define ( XML File Path )复制代码\n设置可执行权限\nvoid setPermission ( Name )复制代码\n启动虚拟机\nString start ( Name )复制代码\n正常停止虚拟机\nString shutdown ( Name )复制代码\n强制停止虚拟机\n如果你的虚拟机出现了问题导致不能使用 shutdown 方法停止时，可以使用此方法强制结束虚拟机，但是可能会丢失数据。\nString destroy ( Name )复制代码\n获得虚拟机列表\n你可以使用此方法获得所有已注册的虚拟机列表，它将会返回一个数组。\nString getList ()复制代码\n获得虚拟机信息\n你可以使用此方法获得任何已注册的虚拟机信息，它将会返回一个数组。\nString getInfo ( Name )复制代码\n导出虚拟机的 XML 配置文件\n此方法可以读取虚拟机的 XML 配置文件并返回\nString dumpxml ( Name )复制代码\n克隆现有的虚拟机\n你可以使用此方法复制一个现有的虚拟机\n此方法也许需要消耗很长时间，具体视磁盘性能而定，建议加一行代码 set_time_limit(120) 以防止脚本超时。\nString cloneVM ( Name, New name, New disk path )复制代码\n设置虚拟机网卡\n此方法可以设置虚拟机的网卡\n第三个参数是布尔型的，如果赋值是 true，将会启用网卡，如果赋值是 false，将会禁用网卡。\nString setNetwork ( Server, Network name, Status )复制代码\n你可以在 libvirt/libvirt.php 找到更多信息\n",
    "replies": [
        {
            "author": "davinc1",
            "timestamp": 1554567300,
            "txt_content": "为啥不直接用virsh来控制，感觉差不多呢"
        }
    ]
}