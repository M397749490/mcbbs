{
    "title": "[Flarum论坛] 魔改Flarum代码以兼容AuthMe、xAuth等奇怪的东西。",
    "author": "练习册",
    "replyCount": 0,
    "timestamp": 1488611940,
    "txt_content": "介绍\n  FlarumChina群有个人问了一下怎么让论坛使用他的MC服务器里的用户信息，我便反查Flarum的登录部分代码追踪到下面的内容。\n  感觉反查代码好刺激，要读懂其他人的代码然后再自己往上面添加奇奇怪怪的东西。不过Flarum的代码好好读，十分的简洁，而且函数名和他的功能相差无几，的确是个好论坛平台。\n\n正文\n路径 `vendor/illuminate/hashing/BcryptHasher.php`\nmake函数\n本函数用于生成密码的加密信息。比如说用于注册时，修改密码时的加密后的密码信息的生成。所以应当处理一下。\n\n    public function make($value, array $options = [])\n    {\n        //$cost = isset($options['rounds']) ? $options['rounds'] : $this->rounds;  //原代码中用来重复hash的次数，详细解释看php函数 password_hash 的说明。\n\n        //$hash = password_hash($value, PASSWORD_BCRYPT, ['cost' => $cost]);\n        //$hash = md5($value, false); //你可以魔改成md5格式\n        $hash = hash('sha256',$value); //或者是其他格式\n\n        if ($hash === false) {\n            throw new RuntimeException('Bcrypt hashing not supported.');\n        }\n\n        return $hash;\n    }\n复制代码\n\ncheck函数\n本函数用于校验密码是否正确。比如说用于登录的检测\n\n    public function check($value, $hashedValue, array $options = [])\n    {\n        if (strlen($hashedValue) === 0) {\n            return false;\n        }\n\n        //return password_verify($value, $hashedValue); //原代码\n        //return md5($value, false)===$hashedValue //魔改成md5？\n        return hash('sha256', $value)===$hashedValue; //sha256？\n    }\n复制代码\n\nneedsRehash函数\n本来用于是php中password_hash的信息刷新，既然你魔改成sha256或者是md5之类的了，这个函数也就没用了，于是直接返回false。\n\n    public function needsRehash($hashedValue, array $options = [])\n    {\n        //$cost = isset($options['rounds']) ? $options['rounds'] : $this->rounds;\n\n        //return password_needs_rehash($hashedValue, PASSWORD_BCRYPT, ['cost' => $cost]);\n        return false;\n    }\n复制代码\n\n\n\n真刺激。\n",
    "replies": []
}