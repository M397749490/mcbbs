{
    "title": "【mc官启】如何像Forge安装器一样利用bat/vbs/js 往launcher_profiles.json添加配置",
    "author": "Cao_Chao",
    "replyCount": 1,
    "timestamp": 1533551100,
    "txt_content": " 本帖最后由 Cao_Chao 于 2018-8-7 14:33 编辑 \n\n----本问题不涉及任何模组----\n如题\nForge安装器会自动在 launcher_profiles.json 中添加配置，打开启动器就能看见新增的配置\n如何用bat 批处理/vbs/js来做到这一点？（做整合包要用）\n由于 launcher_profiles.json 涉及账号密码，我就不截图了",
    "replies": [
        {
            "author": "。—。",
            "timestamp": 1534017600,
            "txt_content": "像forge安装器一样forge开源呀，直接借鉴（抄）一下就好啦4 HOURS LATERemmm毕竟没学过编程，完全靠eclipse的自动纠错功能一行一行把缺的部分补齐了，做出了一个勉强能用的demo……默认效果长这样\n\n\n\n\n无标题1.png (39.11 KB, 下载次数: 1)\n\n下载附件\n\n2018-8-12 03:58 上传\n\n\n\n\n\n嘛，当玩具玩玩就好，要认真上的话还是建议找个比这里靠谱一点的定制吧……\n使用方法：\n解压出install_profile.json文件\n下载一个notepad++之类的编辑器\n修改\"profileName\":后面的“名称”为想要的名称，例如“这是一个例子”\n修改\"target\":后面的“在versions里的版本名称”为versions里要启动的版本名称，例如“1.11.2-LiteLoader1.11.2-1.11.2-forge1.11.2-13.20.1.2386”\n把改好的文件塞回去，直接双击执行即可，有兴趣的话还可以写一个java -jar wenjianming.jar之类的bat伪装一下\n魔改自forge-1.11.2-13.20.1.2588-installer.jar以及https://github.com/MinecraftForge/Installer\n\n\n\n\n一个能往启动器添加配置信息的沙雕作品.jar\n(577.53 KB, 下载次数: 2)\n\n\n\n2018-8-12 03:48 上传\n点击文件名下载附件\n阅读权限: 20\n\n\n\n\npackage mcbbs812314;\n\nimport java.io.BufferedWriter;\nimport java.io.File;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\nimport java.util.HashMap;\nimport java.util.Locale;\n\nimport javax.swing.JOptionPane;\n\nimport com.google.common.base.Charsets;\nimport com.google.common.collect.Maps;\nimport com.google.common.io.Files;\n\nimport argo.format.PrettyJsonFormatter;\nimport argo.jdom.JdomParser;\nimport argo.jdom.JsonField;\nimport argo.jdom.JsonNode;\nimport argo.jdom.JsonNodeFactories;\nimport argo.jdom.JsonRootNode;\nimport argo.jdom.JsonStringNode;\nimport argo.saj.InvalidSyntaxException;\nimport net.minecraftforge.installer.VersionInfo;\n\npublic class Poweron {\n        public static void main(String[] args) {\n\n                // for targetDir\n                String userHomeDir = System.getProperty(\"user.home\", \".\");\n                String osType = System.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH);\n                File targetDir = null;\n                String mcDir = \".minecraft\";\n\n                {\n                        if (osType.contains(\"win\") && (System.getenv(\"APPDATA\") != null)) {\n                                targetDir = new File(System.getenv(\"APPDATA\"), mcDir);\n                        } else if (osType.contains(\"mac\")) {\n                                targetDir = new File(new File(new File(userHomeDir, \"Library\"), \"Application Support\"), \"minecraft\");\n                        } else {\n                                targetDir = new File(userHomeDir, mcDir);\n                        }\n                }\n                // end of targetDir\n\n                // for launcherProfiles\n                File launcherProfiles = new File(targetDir, \"launcher_profiles.json\");\n                System.out.println(launcherProfiles);\n                // end of launcherProfiles\n\n                // begin of main code\n                JdomParser parser = new JdomParser();\n                JsonRootNode jsonProfileData = null;\n                \n                {\n                        try {\n                                try {\n                                        jsonProfileData = parser.parse(Files.newReader(launcherProfiles, Charsets.UTF_8));\n                                } catch (FileNotFoundException e) {\n                                        // TODO Auto-generated catch block\n                                        e.printStackTrace();\n                                } catch (IOException e) {\n                                        // TODO Auto-generated catch block\n                                        e.printStackTrace();\n                                }\n                        } catch (InvalidSyntaxException e) {\n                                JOptionPane.showMessageDialog(null,\n                                                \"The launcher profile file is corrupted. Re-run the minecraft launcher to fix it!\", \"Error\",\n                                                JOptionPane.ERROR_MESSAGE);\n                        }\n                }\n\n                HashMap<JsonStringNode, JsonNode> profileCopy = Maps\n                                .newHashMap(jsonProfileData.getNode(\"profiles\").getFields());\n                HashMap<JsonStringNode, JsonNode> rootCopy = Maps.newHashMap(jsonProfileData.getFields());\n                {\n                        if (profileCopy.containsKey(JsonNodeFactories.string(VersionInfo.getProfileName()))) {\n                                HashMap<JsonStringNode, JsonNode> forgeProfileCopy = Maps.newHashMap(\n                                                profileCopy.get(JsonNodeFactories.string(VersionInfo.getProfileName())).getFields());\n                                forgeProfileCopy.put(JsonNodeFactories.string(\"name\"),\n                                                JsonNodeFactories.string(VersionInfo.getProfileName()));\n                                forgeProfileCopy.put(JsonNodeFactories.string(\"lastVersionId\"),\n                                                JsonNodeFactories.string(VersionInfo.getVersionTarget()));\n                        } else {\n                                JsonField[] fields = new JsonField[] {\n                                                JsonNodeFactories.field(\"name\", JsonNodeFactories.string(VersionInfo.getProfileName())),\n                                                JsonNodeFactories.field(\"lastVersionId\",\n                                                                JsonNodeFactories.string(VersionInfo.getVersionTarget())), };\n                                profileCopy.put(JsonNodeFactories.string(VersionInfo.getProfileName()),\n                                                JsonNodeFactories.object(fields));\n                        }\n                        JsonRootNode profileJsonCopy = JsonNodeFactories.object(profileCopy);\n                        rootCopy.put(JsonNodeFactories.string(\"profiles\"), profileJsonCopy);\n                }\n\n                {\n                        jsonProfileData = JsonNodeFactories.object(rootCopy);\n                        System.out.println(JsonNodeFactories.string(VersionInfo.getProfileName()));\n                        System.out.println(JsonNodeFactories.string(VersionInfo.getVersionTarget()));\n                }\n\n                {\n                        try {\n                                BufferedWriter newWriter = Files.newWriter(launcherProfiles, Charsets.UTF_8);\n                                PrettyJsonFormatter.fieldOrderPreservingPrettyJsonFormatter().format(jsonProfileData, newWriter);\n                                newWriter.close();\n                                System.out.println(\"writing suc?\");\n                        } catch (Exception e) {\n                                JOptionPane.showMessageDialog(null,\n                                                \"There was a problem writing the launch profile,  is it write protected?\", \"Error\",\n                                                JOptionPane.ERROR_MESSAGE);\n                                System.out.println(\"writing failed\");\n                        }\n                }\n                // main finished\n        }\n}复制代码\n\n\n\n\n\n\n\n\n一个能往启动器添加配置信息的沙雕作品.jar\n\n\n2018-8-12 03:49 上传\n点击文件名下载附件\n\n\n\n\n577.53 KB, 下载次数: 1\n\n\n\n\n\n\n"
        }
    ]
}