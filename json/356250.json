{
    "title": "manageryzy的mod教程-forge原理与EventHandler",
    "author": "manageryzy",
    "replyCount": 9,
    "timestamp": 1413989160,
    "txt_content": " 本帖最后由 manageryzy 于 2014-10-28 09:14 编辑 \n\n想了想，我的教程必须要和别人的不一样才有存在的意义。我在这里不会一上来就介绍那种添加方块添加物品之类的，而不把原理什么的讲出来。要成为一个mod制作高手必须要了解minecraft和forge的运行方式。很幸运我们现在看过的代码都是经过mcp反混淆的了，我们没有必要像黑客一样的处理那种混淆之后的代码，但是看minecraft和forge的代码还是必要的。\n在介绍forge的消息处理之前我们要先介绍一下forge是怎么运行的。我想相当多的mod制作者制作了低端mod好久却没有了解forge的运行原理。forge的运行原理就是在强奸字节码（比喻来自szszss的coremod教程）。要知道minecraft是基于java的，java的类加载器一旦加载了一个类到java虚拟机中，这个类就不可能被外部修改了，但是加载之前的类的字节码可不是这样被严格的保护的，那些字节码处于一种谁想强X就强X的程度。forge本身通过修改启动器的json（1.6以后是这样，而1.6之前是直接修改jar文件）而优先于minecraft加载，并且forge会在minecraft加载的时候调教那些正要被加载的字节码。\n经过forge的一翻调教，安装完forge的minecraft就会在适当的时候去调用forge了。当然如果只做到这样的话那么也就是一个普通的mod了，既然是mod加载器就要有加载器的样子。forge不光自己强奸那些字节码，而且还允许基于forge的mod一起来调教minecraft。如果一个mod只是在minecraft加载之后动一动minecraft提供的接口，那么这种mod就是普通mod。如果一个mod在minecraft加载的时候修改了minecraft本身的字节码被加载到jvm中那么这个mod就是所谓的coremod。简单的讲，coremod能够修改minecraft本身的类。当然了如果仅仅为了调用一些非公开的接口的话那么完全没有必要制作coremod，通过反射就可以的。我目前还不打算动coremod这种大坑。\n上面扯了这么长一大段有的没的估计人都吓跑了吧，下面来讲一讲一个普通的mod是怎么被加载的。forge会优先minecraft加载并且遍历mods文件夹中的压缩文件。forge会通过压缩文件里面的mcmod.info文件来判断mod的信息。如果符合mod加载条件的话forge就会加载整个mod的字节码到虚拟机里面。forge会通过asm来分析mod的字节码，如果发现mod的主类确实符合mod的要求，forge就会加载整个mod的类到jvm里面。forge在加载了mod之后forge就会根据mod的订阅消息情况适时的发送消息。也就是说mod也是消息驱动的程序。当然开始一个mod的编程就要从消息处理开始。\n\nforge提供了一个特殊的Annotation来订阅消息。这个Annotation 就是@EventHandler当Mod主类（就是附上了@Mod的类）中的某个只接受一个参数的方法添加了@EventHandler 那么就说明这个方法是一个消息处理方法。处理的消息类型和方法名无关，但是和这个方法的参数类型有关。\n下面给出了mod生命周期中可用的参数类型，通常来说你的mod将会按顺序被触发一下事件FMLPreInitializationEvent : 在所有事情之前运行。在这里读取配置文件、创建方块、创建物品等等。并且在这个通过GameRegistry注册它们。FMLInitializationEvent : 执行你的mod的设置。创建数据结构、注册合成、并且发送FMLInterModComms消息给其他mod。FMLPostInitializationEvent : 处理和其他mod的交互，并且完成你的mod的设置。\n下面是服务器生命周期中的可用参数类型.FMLServerAboutToStartEvent : 在服务器开始之前被调用。FMLServerStartingEvent : 设定服务器的时候使用。用来注册命令，调整服务器。FMLServerStartedEvent : 在开始服务器的时候被调用。FMLServerStoppingEvent :在停止服务器的时候被调用。FMLServerStoppedEvent : 在服务器停止之后被调用\n下面的两种用来接收特殊事件FMLFingerprintViolationEvent : 如果你的mod有问题的话，就会在FMLPreInitializationEvent之前被调用FMLInterModComms.IMCEvent : 在FMLInitializationEvent之后被触发如果你有来自其他mod的FMLInterModComms消息。\n\n写在后面：尝试着写一点别的mod教程没有的东西，大概也算是创新吧。就是不知道大家喜不喜欢，这种一整页都没有一张图片的东西……毕竟是尝试吧。如果有错误还希望大家指正。滚回间隙睡觉了wwww文章来源：我的博客教程索引",
    "replies": [
        {
            "author": "Wolverine",
            "timestamp": 1413997560,
            "txt_content": "写的太密密麻麻了，看得很不舒服{:10_494:}"
        },
        {
            "author": "manageryzy",
            "timestamp": 1414030500,
            "txt_content": "Wolverine 发表于 2014-10-23 01:06\n写的太密密麻麻了，看得很不舒服\n直接从我的博客复制过来就没有重新排版……"
        },
        {
            "author": "linnaea",
            "timestamp": 1414044300,
            "txt_content": "如果仅仅为了调用一些非公开的接口的话其实Forge提供了一个AccessTransformer，写一个配置文件就能把方法和成员变成public，反射都不用（趴"
        },
        {
            "author": "my5629001",
            "timestamp": 1414044420,
            "txt_content": "看的好费劲啊  差点就没坚持下去"
        },
        {
            "author": "manageryzy",
            "timestamp": 1414045080,
            "txt_content": "linnaea 发表于 2014-10-23 14:05\n如果仅仅为了调用一些非公开的接口的话其实Forge提供了一个AccessTransformer，写一个配置文件就能把方法和 ...\n这个我还真的不知道呢（汗\nforge的wiki里面说的是用反射呢。\n回去研究研究，以后看看出一篇这个的教程wwww"
        },
        {
            "author": "manageryzy",
            "timestamp": 1414045260,
            "txt_content": "my5629001 发表于 2014-10-23 14:07\n看的好费劲啊  差点就没坚持下去\n帖子排版什么的没怎么弄呢，抱歉。直接从我的博客复制过来的wwww。\n如果论坛上看的费劲就去我的博客上面看好了。"
        },
        {
            "author": "生化豆豆",
            "timestamp": 1436138940,
            "txt_content": "写的不错，我喜欢这种介绍底层原理的教程，有看头"
        },
        {
            "author": "manageryzy",
            "timestamp": 1436208660,
            "txt_content": "生化豆豆 发表于 2015-7-6 07:29\n写的不错，我喜欢这种介绍底层原理的教程，有看头\n怎么说呢，教程已经弃坑。欢迎通过我的mc开发维基去寻找其他教程。1.8适用的推荐szszss的教程以及darkyoooooo的教程"
        },
        {
            "author": "andylizi",
            "timestamp": 1436248800,
            "txt_content": "第3段笑喷了233333"
        }
    ]
}