{
    "title": "一个简单的插件开发实例",
    "author": "mewsf",
    "replyCount": 29,
    "timestamp": 1391831160,
    "txt_content": " 本帖最后由 mewsf 于 2014-2-8 12:02 编辑 \n\n（注：在学习编写插件之前请先熟练掌握Java知识。建议阅读本文之前先阅读http://www.mcbbs.net/thread-41414-1-1.html这个帖子）\n\n\n\n        嗯，我也刚刚开始学习编写插件的。虽然插件文档很多，但是有时候会觉得无从下手，相信很多人有跟我一样的困难，于是我现在就用我写的第一个插件作为例子说一下编写插件最基本的内容。\n\n\n       我的插件编写环境：JDK7（现在的Bukkit都是用Java7编译的，所以我们的开发环境也要一致）（过会不要问为什么我的是中文的）；IDE：Eclipse Kepler Service Release 1（上面提到的那个帖子中用的Netbeans，其实用这两个都很好，细节方面大同小异）；编码方式：UTF-8；（我用这个是兼容性强一点，特别在插件编写中如果出现中文，就不能用ANSI这样的单字节编码了，不然会乱码，GBK没试过不知道效果如何）BukkitAPI：bukkit-1.6.4-R2.0.jar.\n\n       本次编写插件的目的：通过一个可控的配置文件修改末影龙的攻击力，并且在攻击时能够附加一个反胃效果。\n\n       那么我们就开始了，Eclipse上来的一些准备工作，然后我们新建一个Java项目，名字随意，这里我用的是EnderdragonEX，JRE选择JavaSE-1.7；在下一步中记得在库(Libraries)中导入BukkitAPI文件。\n\n\n        然后我们先在/src/中建立一个包，这里我建的是.com.mewsf.enderex(注：必须全部小写，且不能包含org.bukkit等字样)；并新建插件的主类，这里我用的是EnderdragonEX.java(后面为了方便，我没有再给各个监听器单独建类，而是把他们都写到主类里了)\n\n       第二个重要部分是写plugin.yml，bukkit依赖这个识别插件，下面是我写的plugin.yml：（我就不详细说明各项作用了）name: EnderdragonEX\nmain: com.mewsf.enderex.EnderdragonEX\nversion: 1复制代码然后是插件的配置文件config.yml:（注：其实可以不用写，但是为了过会写插件图方便，我就先写好它。其实这样有一个缺陷，就是当文件被破坏时会报错）#末影龙伤害\nDamage: 10\n#是否开启反胃效果\nNausea: true\n#反胃效果持续时间(注:实际效果中的时间为{设置值/服务器TPS})\n#默认值约为1秒(服务器最大TPS为20)\nNauseaTimer: 20复制代码关于配置文件的简单教程见此：http://forums.bukkit.org/threads/tutorial-intermediate-configuration-yaml-make-configs.45383/（目前暂时无力汉化）\n\n\n        然后！就是代码了。package com.mewsf.enderex;\n\nimport java.io.File;\n\nimport org.bukkit.configuration.file.FileConfiguration;\nimport org.bukkit.entity.Entity;\nimport org.bukkit.entity.EntityType;\nimport org.bukkit.entity.LivingEntity;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.entity.EntityDamageByEntityEvent;\nimport org.bukkit.plugin.java.JavaPlugin;\nimport org.bukkit.potion.PotionEffect;\nimport org.bukkit.potion.PotionEffectType;\n\npublic class EnderdragonEX extends JavaPlugin{\n        @Override\n        public void onEnable(){\n            File configFile = new File(getDataFolder(), \"config.yml\");     //定义config.yml\n        if (!configFile.exists()) {            //此段代码用于config.yml不存在时生成此文件\n            saveDefaultConfig();\n        }\n    FileConfiguration config = getConfig();    //读取config.yml\n    final int nauseatime = config.getInt(\"NauseaTimer\");     //以下三个final都是把config.yml中的\n    final int damage = config.getInt(\"Damage\");              //数值转化为插件中的常量\n    final boolean nausea = config.getBoolean(\"Nausea\");\n\n    /*\n     *下面是更改末影龙伤害的监听器 \n     */\n        class DamageEventListener implements Listener  {\n        @EventHandler\n        public void onEntityDamagedByEntityEvent(EntityDamageByEntityEvent event) { //调用了实体被实体攻击时的事件\n        final Entity damager = event.getDamager();                 //获取攻击者\n           if (damager.getType() == EntityType.ENDER_DRAGON) {        //如果攻击者是末影龙\n    event.setDamage(damage);                                   //将伤害值改为已定义好的damage\n        }\n        }\n        }\n        class Nausea implements Listener {                          //反胃效果的监听器\n                @EventHandler\n                public void onEntityDamagedByEntityEvent(EntityDamageByEntityEvent event) {\n                        Entity damager = event.getDamager();\n                           if (damager.getType() == EntityType.ENDER_DRAGON) {\n                                   LivingEntity victim = (LivingEntity) event.getEntity();    //定义victim对象为被攻击者\n                        victim.addPotionEffect(new PotionEffect(PotionEffectType.CONFUSION, nauseatime, 1));\n                        //增加药水效果\n                           }\n                }\n        }\n    getServer().getPluginManager().registerEvents(new DamageEventListener(), this);  //注册更改末影龙伤害的监听器\n        /*\n         * 下面是根据配置文件决定是否开启反胃效果\n         */\n    if (nausea == true){\n            getServer().getPluginManager().registerEvents(new Nausea(), this);\n        }\n    getLogger().info(\"插件载入正常.\");\n        }\n        @Override\n        public void onDisable(){\n            getLogger().info(\"插件已被卸载.\");\n        }\n}\n复制代码全部完成之后，即可用文件-导出-导出JAR生成插件",
    "replies": [
        {
            "author": "liuyang28282",
            "timestamp": 1391841240,
            "txt_content": "哇塞。撸主好厉害，学习下，之后可能会用得着"
        },
        {
            "author": "wxr155",
            "timestamp": 1391842680,
            "txt_content": ":)不错 学习下."
        },
        {
            "author": "AG3",
            "timestamp": 1391917680,
            "txt_content": "赞一个！！"
        },
        {
            "author": "金苹果",
            "timestamp": 1394429640,
            "txt_content": "我想知道那些事件是怎么搞的听他们说时间可以自制"
        },
        {
            "author": "a360015305",
            "timestamp": 1394442180,
            "txt_content": "J2EE 后悔当年去学易 结果现在是英盲一个……"
        },
        {
            "author": "jinloveme",
            "timestamp": 1394869620,
            "txt_content": "正在学java."
        },
        {
            "author": "咸鱼气功王",
            "timestamp": 1395198300,
            "txt_content": "不错不错 学习了"
        },
        {
            "author": "SLCoder",
            "timestamp": 1398308100,
            "txt_content": "好样的，受教了"
        },
        {
            "author": "ab8568571",
            "timestamp": 1400590680,
            "txt_content": "请问你主类里面的启动函数main方法到哪里去了"
        },
        {
            "author": "mewsf",
            "timestamp": 1400597400,
            "txt_content": "ab8568571 发表于 2014-5-20 20:58\n请问你主类里面的启动函数main方法到哪里去了\n{:10_493:}这是bukkit插件又不是java应用程序"
        },
        {
            "author": "暗夜之猫",
            "timestamp": 1400635500,
            "txt_content": "ab8568571 发表于 2014-5-20 20:58\n请问你主类里面的启动函数main方法到哪里去了\n无需main函数，直接编译即可"
        },
        {
            "author": "shellljx",
            "timestamp": 1400779080,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "shellljx",
            "timestamp": 1401645660,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "太郎酱",
            "timestamp": 1401646200,
            "txt_content": "先留着，等啥时候开服不累了，看看"
        },
        {
            "author": "hyb518",
            "timestamp": 1401721440,
            "txt_content": "不错，学习了，正准备启动MC的插件开发学习之旅呢，谢谢了！"
        },
        {
            "author": "Min__",
            "timestamp": 1402113000,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "xingyu",
            "timestamp": 1402368420,
            "txt_content": "好评{:10_492:}"
        },
        {
            "author": "TravelingLight",
            "timestamp": 1402395600,
            "txt_content": "路过 围观楼主{:10_512:}"
        },
        {
            "author": "天空之夜丶",
            "timestamp": 1402668780,
            "txt_content": "你为什么不让 EnderdragonEX 类 实现Listener  接口， 然后使用getServer().getPluginManager().registerEvents(this, this);   注册事件呢， 而是写一个类中类\n只是建议~"
        },
        {
            "author": "mewsf",
            "timestamp": 1402731180,
            "txt_content": "天空之夜丶 发表于 2014-6-13 22:13\n你为什么不让 EnderdragonEX 类 实现Listener  接口， 然后使用getServer().getPluginManager().registerEv ...\n因为这只是个示例，并且功能很少，所以就这么写了,如果复杂了当然不会"
        },
        {
            "author": "youliao",
            "timestamp": 1402733280,
            "txt_content": "看不懂，可惜我不会JAVA和C语言"
        },
        {
            "author": "修改器很好玩",
            "timestamp": 1409969880,
            "txt_content": "ab8568571 发表于 2014-5-20 20:58\n请问你主类里面的启动函数main方法到哪里去了\n对呀，public static void main()是主方法，只有在应用程序才有，但是编写插件就不用了"
        },
        {
            "author": "凋零蛋",
            "timestamp": 1409976780,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "我不叫杨浩",
            "timestamp": 1410129480,
            "txt_content": "呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵"
        },
        {
            "author": "Lucky777777",
            "timestamp": 1414502940,
            "txt_content": "  受益颇多，感谢分享"
        },
        {
            "author": "kjkj2173135",
            "timestamp": 1455721320,
            "txt_content": "终于有个开发插件的实例了\n以前只有教程却没有实例"
        },
        {
            "author": "zsyminecraft",
            "timestamp": 1455732720,
            "txt_content": "ab8568571 发表于 2014-5-20 20:58\n请问你主类里面的启动函数main方法到哪里去了\n插件不需要的"
        },
        {
            "author": "kjkj2173135",
            "timestamp": 1455758760,
            "txt_content": "我不熟练java知识,几乎看不懂"
        },
        {
            "author": "wawk",
            "timestamp": 1457344560,
            "txt_content": "只是真诚的祝楼主事事顺心，能写出这样的东西造福新手"
        }
    ]
}