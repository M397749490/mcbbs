{
    "title": "服务器延迟高，打怪吃肉一卡一卡",
    "author": "1965404875",
    "replyCount": 13,
    "timestamp": 1585640400,
    "txt_content": "如题，一下我简单介绍给大佬，大佬看一看有啥问题\n我之前用的面板服开的空岛服务器spigot核心，人数越来越多也卡，换的vps8G4核然后用了几天也卡\n又换了16G8核出低价vps\nE5 2680 V2    2.8-3.6Ghz\n当时开服80个人降到60又到了40多个人。那时候tps4-6之间\n服务器卡的不行，延迟巨高，后来我的spigot端换成paper端，并且按paper优化帖子都优化了部分 \n视野距离调整为4之类的乱七八糟的。插件列表以及各种图片信息我放在下面了。\n真的头疼我也不知道该不该花钱再升级服务器了\n\n\n\n\n\nH10}}NXYOK6F]SCR[G[T9M4.png (122.65 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:35 上传\n\n\n\n\n\n\n\n\n1DW2DC{G~R627C2FNSU%}B2.png (135.91 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:35 上传\n\n\n\n\n\n\n\n\nDU87L5_ZY_J[4$QK}7B6%AM.png (40.72 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:33 上传\n\n\n\n\n\n\n\n\n558DAB681970D4C951C675EF326BF28B.png (60.19 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:33 上传\n\n\n\n\n\n\n\n\n2`H_OU03FJIZ]NW3NY@KWE6.png (28.35 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:33 上传\n\n\n\n\n\n\n\n\n]W2{LZJ{}58%{0V04UZYR4T - 副本.png (86.35 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:37 上传\n\n\n\n\n\n\n\n\n`NEH]U%`6OT`GBQ611H`S75 - 副本.png (83.41 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:37 上传\n\n\n\n\n\n\n\n\nWS~2]8SE8I_IUAMJN5HTE2Q - 副本.png (98.97 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:37 上传\n\n\n\n\n\n\n\n\nRI04}SKC4WBVT%JI`V9I9BX - 副本.png (66.92 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:37 上传\n\n\n\n\n\n\n\n之后我在服务器测了一下timings，检测地址：https://timings.aikar.co/?id=924221c24af2485ebdb187f45e56f90e\n我也看不懂。小白服主。\n\n\n\n\n\n4C8N8V8KQLCO~6G6ADOVM.png (133.79 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 15:39 上传\n\n\n\n\n\n求大佬帮忙解决，好几十口玩家等我养活\n\n",
    "replies": [
        {
            "author": "Salt_lovely",
            "timestamp": 1585640400,
            "txt_content": " 本帖最后由 Salt_lovely 于 2020-3-31 23:58 编辑 \n1965404875 发表于 2020-3-31 17:27\n现在市面上的MC服务端基本都是计算压主线程的，你就算有128个逻辑处理器，主频一致，那服务器TPS也和两个差别不大。\n\n-3072,2560 (Area Seen 3 times)\nTotals: 652 Entities - 2663 — Tile Entities - Summary:\nHOPPER: 1042Minecraft::tickTileEntity - nms.TileEntityPistoncount(4957780)  total(8.52% 120.236s, 18.16% of tick)\nMinecraft::tickTileEntity - nms.TileEntityHoppercount(25764504)  total(3.82% 53.924s, 8.15% of tick)\n1000+个漏斗？消耗资源占比8%的活塞？\n\nMinecraft::Scheduled Block: Redstone Repeatercount(319652)  total(27.07% 382.101s, 57.72% of tick)\nMinecraft::Scheduled Block: Observercount(270483)  total(5.69% 80.344s, 12.14% of tick)\n消耗资源占比27%的中继器和5%的侦测器？\n（相对服务器总负载能力的占比是57%和12%）\n你的玩家在玩什么奇怪的东西？\n\n结论：如果是你的玩家人数太多而不是有人在玩高频/大规模红石的话，你的服务器卡顿是因为CPU不行\n\n\n\n编辑内容：\nmax-tick-time:\n  tile: 10\n  entity: 20复制代码\n你的服务器过载程度比你想象中的更加严重。\n你用这两个设置强行减少了tiles和实体的占用，所以会出现生物一卡一卡的情况（具体原理说起来有些复杂）。\n换句话说，如果没有这两个限制，服务器里面的漏斗、各类怪物等等会将你的服务器TPS压得更低。\n该换CPU了。\n\nspawn-limits:\n  monsters: 70复制代码\nbukkit.yml中得选项，这个70得意思是刷怪上限是70x玩家人数，你的玩家人数有20人，那么服务器最多会有1400只怪物的上限（实际计算有些复杂，你这个公式可以作估算）。。。\n请改成25上下"
        },
        {
            "author": "结城希亚",
            "timestamp": 1585640700,
            "txt_content": "主要是机器的CPU不行，优化没什么用\n\n建议换有4GHz稳定频率的CPU，高版本都很吃CPU的（跟模组服一样）"
        },
        {
            "author": "少禹呀",
            "timestamp": 1585640880,
            "txt_content": "卡的时候输入/tps看看tps值、要是低可能会是服务商问题"
        },
        {
            "author": "ly19931113",
            "timestamp": 1585641240,
            "txt_content": "提高内存，优化网络，增强CPU，总的来说，就是要找服务商加钱。。。。。。或者你做单纯的纯净服"
        },
        {
            "author": "2550526349",
            "timestamp": 1585641420,
            "txt_content": "您好，请查看您的私聊，我这边帮你优化一下？"
        },
        {
            "author": "1965404875",
            "timestamp": 1585645020,
            "txt_content": "ly19931113 发表于 2020-3-31 15:54\n提高内存，优化网络，增强CPU，总的来说，就是要找服务商加钱。。。。。。或者你做单纯的纯净服 ...\n内存空余很多十多个G 我这个纯净空岛"
        },
        {
            "author": "1965404875",
            "timestamp": 1585645260,
            "txt_content": "结城希亚 发表于 2020-3-31 15:45\n主要是机器的CPU不行，优化没什么用\n\n建议换有4GHz稳定频率的CPU，高版本都很吃CPU的（跟模组服一样）\n后台cpu利用率是19％  服务商说给了大概28GHz的运算频率应该还是够了。"
        },
        {
            "author": "结城希亚",
            "timestamp": 1585645380,
            "txt_content": " 本帖最后由 结城希亚 于 2020-3-31 17:04 编辑 \n1965404875 发表于 2020-3-31 17:01\n后台cpu利用率是19％  服务商说给了大概28GHz的运算频率应该还是够了。\n看利用率没用，还是得看你频率\n28GHz是什么神仙CPU？\n9900k超频也才5GHz，忽悠你不懂CPU\n象棋大师跑一下就知道了"
        },
        {
            "author": "利姆露酱",
            "timestamp": 1585646460,
            "txt_content": "2.8ghz的服务器。。\n这么多插件肯定吃不消的"
        },
        {
            "author": "1965404875",
            "timestamp": 1585646820,
            "txt_content": "结城希亚 发表于 2020-3-31 17:03\n看利用率没用，还是得看你频率\n28GHz是什么神仙CPU？\n9900k超频也才5GHz，忽悠你不懂CPU\n\n\n\n\nR@DKVU~B_L0CXT_AB_H}9}I.png (121.53 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 17:28 上传\n\n\n\n\n\n\n\n\nQ$AOOQIQ8S[`M3SC[@DCIBF.png (17.93 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 17:28 上传\n\n\n\n\n"
        },
        {
            "author": "结城希亚",
            "timestamp": 1585649280,
            "txt_content": "1965404875 发表于 2020-3-31 17:27\n频率不行，像我这种9900k能很轻松的带起大型模组服（bushi\n不过虚拟机不显示睿频，所以只能看到3.6GHz，实际上大概有4.8GHz左右的频率\n\n核心数可以不追求，但主频一定要高\n\n\n\n\n1.png (159.23 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-31 18:08 上传\n\n\n\n\n\n\n"
        },
        {
            "author": "1965404875",
            "timestamp": 1585740660,
            "txt_content": "Salt_lovely 发表于 2020-3-31 23:52\n现在市面上的MC服务端基本都是计算压主线程的，你就算有128个逻辑处理器，主频一致，那服务器TPS也和两个 ...\n活塞有人一大片的弄，我用了红石检测，但是没办法检测到漏斗比较器和活塞，这三个组合起来高频都没办法"
        },
        {
            "author": "Salt_lovely",
            "timestamp": 1585742400,
            "txt_content": " 本帖最后由 Salt_lovely 于 2020-4-1 20:02 编辑 \n1965404875 发表于 2020-4-1 19:31\n活塞有人一大片的弄，我用了红石检测，但是没办法检测到漏斗比较器和活塞，这三个组合起来高频都没办法 ...\n1.12的paper没有快速红石选项....\n\n不过漏斗的优化还是有方案的\nspigot.yml中：\nticks-per:\n  hopper-transfer: 8 #漏斗每隔多少tick传输一次\n  hopper-check: 1 #漏斗每隔多少tick检查一次\nhopper-amount: 1 #漏斗每次传输多少物品复制代码\n将漏斗传输间隔和传输数量等比例增大（比如从 8，1改为24，3）\n增大漏斗检查间隔\n像是这样：\nticks-per:\n  hopper-transfer: 24 #漏斗每隔24tick传输一次\n  hopper-check: 10 #漏斗每隔10tick检查一次\nhopper-amount: 3 #漏斗每次传输3个物品复制代码\n\n当然副作用是有的，这会导致漏斗时钟误差增大，会导致漏斗精准计时的机器失效（不过应该没人会在生存里建这种机器吧）"
        }
    ]
}