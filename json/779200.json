{
    "title": "[已解决]如何获取玩家前方是否有方块或者p.getEyeLocation问题",
    "author": "帅比小樊",
    "replyCount": 1,
    "timestamp": 1517748780,
    "txt_content": " 本帖最后由 帅比小樊 于 2018-2-5 14:12 编辑 \n\n我想获取玩家指针所指的实体,之间是否有方块阻挡\n用p.getEyeLocation,说是获取玩家看到的Location,但是我测试发现是玩家眼睛位置的Location CraftBukkit.1.7.10核心\n如果有更好的获取办法,赐教\n如果我对这个方法理解错误,赐教\n已解决,见一楼",
    "replies": [
        {
            "author": "ddyy163",
            "timestamp": 1517802000,
            "txt_content": " 本帖最后由 ddyy163 于 2018-2-5 11:54 编辑 \n\n代码:\ndistance填距离,delta填坐标误差允许的范围\npublic static Entity getTargetEntity(Player player, double distance, double delta) {\n    for (Entity entity : player.getNearbyEntities(distance, distance, distance)) {\n        double d = entity.getLocation().distance(player.getLocation());\n        if (d > distance) {\n            continue;\n        }\n        Location eye = player.getEyeLocation();\n        Vector direction = eye.getDirection();\n        double a = direction.getX();\n        double b = direction.getY();\n        double c = direction.getZ();\n        double s = Math.sqrt(a * a + b * b + c * c);\n        Location entityLoc = entity.getLocation();\n        if (Math.abs((entityLoc.getX() - eye.getX()) - (a / s * d)) < delta\n                && Math.abs((entityLoc.getY() - eye.getY()) - (b / s * d)) < delta\n                && Math.abs((entityLoc.getZ() - eye.getZ()) - (c / s * d)) < delta) {\n            if (player.hasLineOfSight(entity)) {\n                return entity;\n            }\n        }\n    }\n    return null;\n}复制代码\n\n代码调用:\n\n\n\n\n111.jpg (30.41 KB, 下载次数: 5)\n\n下载附件\n\n2018-2-5 11:36 上传\n\n\n\n\n\n\n效果:\n无遮挡\n\n\n\n\n2.jpg (57.89 KB, 下载次数: 1)\n\n下载附件\n\n2018-2-5 11:42 上传\n\n\n\n\n\n有遮挡\n\n\n\n\n333.jpg (62.27 KB, 下载次数: 0)\n\n下载附件\n\n2018-2-5 11:43 上传\n\n\n\n\n\n\n误差0.5的时候基本还是要点怪物的脚才能获取成功\n\n"
        }
    ]
}