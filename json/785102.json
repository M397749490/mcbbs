{
    "title": "关于custom npcs做延时触发脚本的技巧",
    "author": "iverson119",
    "replyCount": 10,
    "timestamp": 1519812720,
    "txt_content": " 本帖最后由 iverson119 于 2018-2-28 18:22 编辑 \n\n大家好，\n今天为大家带来关于1.7.10d版本custom npcs做延时触发脚本的技巧\n\n(适合有一点制作npc脚本经验的朋友)\n\n\n        其实本人并不会编程，不过一直是npcmod的爱好者。最近学者做npc脚本，经过搜索论坛，好像没看到有关于做延时触发脚本的。之前看到@平凡的行者 这位大神的思路，是给npc脚本做一个触发的setblock脚本，触发后，脚本会在指定坐标放一个红石火把，然后延时的效果就用红石和命令方块来实现。这是一个很好的方法。\n\n        然后我查了一下，在JS里，实现延时的是一个叫setTimeout的语句。但是实际上npcmod用的脚本是nashorn，和JS有一点点不同，这个setTimeout的语句没有了。\n\n\n\n\n\n\naa.png (48.03 KB, 下载次数: 1)\n\n下载附件\n\n2018-2-28 18:13 上传\n\n\n\n\n\n\n如果我这样写，他会觉得setTimeout没被定义\n\n\n\n\n\n\nbb.png (42.21 KB, 下载次数: 0)\n\n下载附件\n\n2018-2-28 18:13 上传\n\n\n\n\n\n\n        那怎么办呢？于是我在网上查了一下，找到了一个可以用nashorn去定义JS里的setTimeout的方法。只需要在脚本的前面加上这段定义的语句:\n\n\nvar Timer = Java.type('java.util.Timer');var Phaser = Java.type('java.util.concurrent.Phaser');var timer = new Timer('jsEventLoop', false);var phaser = new Phaser();var onTaskFinished = function() {phaser.arriveAndDeregister();};function setTimeout(fn, millis /* [, args...] */) {var args = [].slice.call(arguments, 2, arguments.length);var phase = phaser.register();var canceled = false;timer.schedule(function() {if (canceled) {return;}try {fn.apply(context, args);} catch (e) {print(e);} finally {onTaskFinished();}}, millis);return function() {onTaskFinished();canceled = true;};};\n\n\n\n\n\n\n\ndd.png (81.19 KB, 下载次数: 0)\n\n下载附件\n\n2018-2-28 18:13 上传\n\n\n\n\n\n\n        这就是把setTimeout定义出来了，大家以后也可以直接复制这段东西。然后用funtion定义要执行的指令为函数，再用setTimeout(函数名,时间)这样的表达式，就可以做出延时的效果。注意时间是1000为一秒。我现在做的这个效果就是，右键npc，5秒后他会说“5秒后说hi”，我们一起来试试看。\n\n\n\n\n\n\nee.png (385.7 KB, 下载次数: 0)\n\n下载附件\n\n2018-2-28 18:13 上传\n\n\n\n\n\n\n        看到了，之前的是没有生效的Hello Fankie，后面的是成功触发5秒后说的话。\n\n        那这个效果能做什么呢？我觉得这个延时效果的拓展性非常强。我自己就用来做了个生成后1分钟会自动消失的npc，是作为一个召唤物出现的。\n\n\n\n\n\n\nff.png (103.46 KB, 下载次数: 1)\n\n下载附件\n\n2018-2-28 18:13 上传\n\n\n\n\n\n\n        我们一起来看看效果！\n\n        生成的1分钟后...\n\n\n\n\n\ngg.png (281.22 KB, 下载次数: 0)\n\n下载附件\n\n2018-2-28 18:12 上传\n\n\n\n\n\n        他就自己消失了...想必充满创意的大家肯定能创造出更好好玩的玩法！这次就先说到这里，萌新第一次发帖，请大家给点人气支持支持，我一定会把更多好玩的技巧分享给大家！\n\n最后，感谢论坛里的大神@平凡的行者，一直不吝赐教，令我收获良多！\n\n\n\n\n\ncc.png\n(79.17 KB, 下载次数: 4)\n\n\n\n\n下载附件\n\n\n2018-2-28 18:13 上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "iverson119",
            "timestamp": 1519813020,
            "txt_content": "咦后面怎么多贴了个图..还编辑删不掉...大家请无视最后一个图！！"
        },
        {
            "author": "秦羽",
            "timestamp": 1519813200,
            "txt_content": "棒~让npc的很多机制有了新的方法去实现"
        },
        {
            "author": "iverson119",
            "timestamp": 1520008860,
            "txt_content": "啊..大家请看过来,这个代码很实用的"
        },
        {
            "author": "Purest",
            "timestamp": 1520588280,
            "txt_content": "超级棒！！！！！！！！！"
        },
        {
            "author": "iverson119",
            "timestamp": 1520590320,
            "txt_content": "Purest 发表于 2018-3-9 17:38\n超级棒！！！！！！！！！\n谢谢谢谢！"
        },
        {
            "author": "粘兽",
            "timestamp": 1529180460,
            "txt_content": "这串定义有点长，感觉不太好看呢。"
        },
        {
            "author": "iverson119",
            "timestamp": 1529680620,
            "txt_content": "粘兽sama 发表于 2018-6-17 04:21\n这串定义有点长，感觉不太好看呢。\n只要直接复制就行了..."
        },
        {
            "author": "猫猫惹",
            "timestamp": 1530768420,
            "txt_content": "虽然这串有点...但是很实用感谢楼主分享QWQ"
        },
        {
            "author": "iverson119",
            "timestamp": 1530776400,
            "txt_content": "1073220200 发表于 2018-7-5 13:27\n虽然这串有点...但是很实用感谢楼主分享QWQ\n不用客气，我也是抛砖引玉哈哈"
        },
        {
            "author": "Hueihuea",
            "timestamp": 1535175660,
            "txt_content": "var Timer = Java.type('java.util.Timer');\nvar Phaser = Java.type('java.util.concurrent.Phaser');\n\nvar timer = new Timer('jsEventLoop', false);\nvar phaser = new Phaser();\n\nvar onTaskFinished = function() {\nphaser.arriveAndDeregister();\n};\n\nfunction setTimeout(fn, millis /* [, args...] */) {\nvar args = [].slice.call(arguments, 2, arguments.length);\n\nvar phase = phaser.register();\nvar canceled = false;\ntimer.schedule(function() {\nif (canceled) {\nreturn;\n}\n\ntry {\nfn.apply(context, args);\n} catch (e) {\nprint(e);\n} finally {\nonTaskFinished();\n}\n}, millis);\n\n\nreturn function() {\nonTaskFinished();\ncanceled = true;\n};\n};\n整理好的qwq\n从贴吧转载来的\n话说你知道这个代码的原贴吗"
        }
    ]
}