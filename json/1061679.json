{
    "title": "使用 Scorge 编写基于 Scala 的 Mod",
    "author": "土球球",
    "replyCount": 1,
    "timestamp": 1592103900,
    "txt_content": "引言\n\n从 Minecraft 1.13 开始，Forge 不再自带 Scala 标准库作为依赖（作为一个 Scala 吹，这让我很不爽），但 Forge 也为 Scala 提供了一个名为 Scorge 的解决方案。\n\nScorge 这个项目相当低调，虽然我很快就从 GitHub 上找到了 Scorge 的源代码，但我翻遍了 CurseForge 都没有找到 Scorge 这个 Mod 本身的下载链接，最后通过对 URL 的连蒙带猜从 Forge 官网上找到了下载地址（目前的最新版本是 3.0.6）：http://files.minecraftforge.net/maven/net/minecraftforge/Scorge\n\n虽然说他们的代码仍然是基于 1.14 的，但事实上 1.15 也能用，本文将基于 Minecraft 1.15.2 和 Forge 31.2.0，使用的 Gradle 版本是 5.6.4。\n\n构建文件\n\n让我们先从 build.gradle 开始：\n\nbuildscript {\n    repositories {\n        maven {\n            url = 'https://files.minecraftforge.net/maven'\n        }\n        jcenter()\n        mavenCentral()\n    }\n    dependencies {\n        classpath group: 'net.minecraftforge.gradle', name: 'ForgeGradle', version: '3.+', changing: true\n    }\n}\n\napply plugin: 'scala'\napply plugin: 'net.minecraftforge.gradle'\n\nversion = '1.0.0'\ngroup = 'com.github.ustc-zzzz'\narchivesBaseName = 'ScorgeExampleMod'\n\nsourceCompatibility = targetCompatibility = '1.8'\n\nminecraft {\n    mappings channel: 'snapshot', version: '20200514-1.15.1'\n    runs {\n        client {\n            properties 'forge.logging.markers': 'SCAN,REGISTRIES,REGISTRYDUMP'\n            properties 'forge.logging.console.level': 'debug'\n            workingDirectory project.file('run')\n            source sourceSets.main\n        }\n        server {\n            properties 'forge.logging.markers': 'SCAN,REGISTRIES,REGISTRYDUMP,CLASSLOADING'\n            properties 'forge.logging.console.level': 'debug,trace'\n            workingDirectory project.file('run')\n            source sourceSets.main\n        }\n    }\n}\n\ndependencies {\n    minecraft 'net.minecraftforge:forge:1.15.2-31.2.0'\n    compile 'org.scala-lang:scala-library:2.13.1'\n    compile 'net.minecraftforge:Scorge:3.0.6'\n}\n\njar {\n    manifest.attributes([\n        \"Specification-Title\"     : \"scorgeexamplemod\",\n        \"Specification-Vendor\"    : \"scorgeexamplemodsareus\",\n        \"Specification-Version\"   : \"1\", // We are version 1 of ourselves\n        \"Implementation-Title\"    : project.name,\n        \"Implementation-Version\"  : project.version,\n        \"Implementation-Vendor\"   : \"scorgeexamplemodsareus\",\n        \"Implementation-Timestamp\": new Date().format(\"yyyy-MM-dd'T'HH:mm:ssZ\")\n    ])\n}复制代码\n一方面，和基于 Java 的项目相比，基于 Scala 的项目需要 apply plugin: 'scala' 才行。\n\n另一方面，我们需要留意 dependency 块的变化：\n\ndependencies {\n    minecraft 'net.minecraftforge:forge:1.15.2-31.2.0'\n    compile 'org.scala-lang:scala-library:2.13.1'\n    compile 'net.minecraftforge:Scorge:3.0.6'\n}复制代码\n我们不仅要引入 Scorge 的依赖，还需要引入 Scala 标准库的依赖（请保证 Scala 标准库版本和 Scorge 所使用的版本一致，这里是 2.13.1）。\n\n主类\n\n然后我们随便写一个主类：\n\npackage com.github.ustc_zzzz\n\nimport net.minecraftforge.fml.event.lifecycle.FMLCommonSetupEvent\nimport net.minecraftforge.scorge.lang.ScorgeModLoadingContext\nimport org.apache.logging.log4j.LogManager\n\nclass ScorgeExampleMod {\n  ScorgeModLoadingContext.get.getModEventBus.addListener { _: FMLCommonSetupEvent =>\n    LogManager.getLogger(classOf[ScorgeExampleMod]).info(\"Hello Scorge Example Mod!\")\n  }\n}复制代码\n这里有三点需要注意：\n\n我们不需要为主类添加 @Mod 注解。和 1.12 或更低版本不同，Scorge 要求主类是 class 而不是 object。需要使用 ScorgeModLoadingContext 而非 FMLJavaModLoadingContext 获取事件总线。\n得益于 Scala 编译器从 2.12 开始能够将相关代码编译到 Lambda 表达式，我们可以直接使用 Lambda 表达式块的格式向事件总线注册监听器（1.12 或更低不行，因为使用的是 Scala 2.11）。\n\n因为主类没有 @Mod 注解，所以如果想要在游戏启动的时候看到这句话，我们还需要修改 META_INF 目录下的 mods.toml。\n\nMod 描述文件\n\n只有我们在 mods.toml 中指定了主类名，我们才能让 Scorge 加载我们的 Mod 主类：\n\nmodLoader=\"scorge\"\nloaderVersion=\"[3,)\"\n\n[[mods]]\nversion=\"1.0.0\"\nauthors=\"ustc-zzzz\"\nmodId=\"scorgeexamplemod\"\ndisplayName=\"Scorge Example Mod\"\ndescription=\"Scorge Example Mod\"\nentryClass=\"com.github.ustc_zzzz.ScorgeExampleMod\"\n\n[[dependencies.watersprayer]]\nmodId=\"forge\"\nmandatory=true\nversionRange=\"[31,)\"\nordering=\"NONE\"\nside=\"BOTH\"\n\n[[dependencies.watersprayer]]\nmodId=\"minecraft\"\nmandatory=true\nversionRange=\"[1.15.2]\"\nordering=\"NONE\"\nside=\"BOTH\"复制代码\n注意以下两点：\n\nmodLoader 应取为 scorge，而 loaderVersion 应使用 Scorge 版本。和基于 Java 的 Mod 相比，我们还需要额外指定一个 entryClass 描述主类的位置。\n现在打开游戏就可以看到这句话了（别忘了把 Scorge 本体放进 mods 目录）：\n\n",
    "replies": [
        {
            "author": "541688",
            "timestamp": 1593232740,
            "txt_content": "        MCBBS有你更精彩~"
        }
    ]
}