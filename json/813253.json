{
    "title": "20180810评分功能的修正猜想",
    "author": "。—。",
    "replyCount": 18,
    "timestamp": 1533881940,
    "txt_content": " 本帖最后由 a6809936 于 2018-12-17 23:46 编辑 \n20181217: 试了一下开电脑签到，暂时没遇到问题，话说到中午1点了才8个人签到成功么……\n这次防火墙级别有点高，上次最多闪5下，这次闪**下之后甚至还会无响应，如果发现框框不闪了或者页面超过3秒没动的话只能手动刷新了……20181216: 请不要乱复制东西进控制台，也不要在不理解内容的情况下碰这里的书签，这边要准备考期末也不知道什么时候能更新，导致重复评分的bug还没修！\n\n20180813：如果今天有时间的话咱打算把剩下的功能补一下……如果有时间的话……\n\n\n\n\n\n屏幕截图(1594).png.gif (350 KB, 下载次数: 0)\n\n下载附件\n\n2018-8-13 13:58 上传\n\n\n\n\n\n嗯，完美！steam，启动！\n工作原理是给_ajaxget()加上遇到ccdefend修改cookie时用eval()代替evalscript()并重新装填请求。\n存在并且不准备修复的问题重载窗体时会有表单重复提交的警告会重载许多次模拟真实浏览器所以没限制请求频率，有概率被服务器认为是doss和docc攻击这边并不清楚悬浮的回复窗口需要重新获取哪些关键字，并未修复，需要回复指定楼层依旧推荐右键在新标签页打开这段改动对其他功能的附带影响都属于意外，这段脚本只修评分的功能……附件预览图没修复，因为这不是这段脚本需要完成的任务\n\n使用的时机如果不准备评分则什么也不用做评分前点一下存好的书签书签的使用方法可以参考http://www.mcbbs.net/thread-812336-1-1.html平常怎么评分就怎么评分即可firefox出现表单重复提交的警告直接确认\n\n源代码// {\n//        \"date\": \"2018-08-10-v1\",\n//        \"desc\": \"往_ajaxget函数多塞了一段判断ccdefend出现时的处理逻辑，改动过的地方应该都加上了注释，原始的_ajaxget代码来自discuz\"\n// }\n\nfunction _ajaxget(url, showid, waitid, loading, display, recall) {\n        waitid = typeof waitid == 'undefined' || waitid === null ? showid : waitid;\n        var x = new Ajax();\n        x.setLoading(loading);\n        x.setWaitId(waitid);\n        x.display = typeof display == 'undefined' || display == null ? '' : display;\n        x.showId = $(showid);\n        if (url.substr(strlen(url) - 1) == '#') {\n                url = url.substr(0, strlen(url) - 1);\n                x.autogoto = 1;\n        }\n        var __url = url; // save original url\n        var url = url + '&inajax=1&ajaxtarget=' + showid;\n        x.get(url, function(s, x) {\n                var evaled = false;\n                if (s.indexOf('; document.cookie=\\'ccdefend=\\'+v+\\'; path=/\\'; window.location.reload();') != -1) {\n                        s = s.replace(' window.location.reload();',''); // prevent redirecting\n                        // console.log(s); // debug only\n                        eval(s); // to be optimized\n                        _ajaxget(__url, showid, waitid, loading, display, recall); // reload window\n                }\n                if (s.indexOf('ajaxerror') != -1) {\n                        evalscript(s);\n                        evaled = true;\n                }\n                if (!evaled && (typeof ajaxerror == 'undefined' || !ajaxerror)) {\n                        if (x.showId) {\n                                x.showId.style.display = x.display;\n                                ajaxinnerhtml(x.showId, s);\n                                ajaxupdateevents(x.showId);\n                                if (x.autogoto) scroll(0, x.showId.offsetTop);\n                        }\n                }\n                ajaxerror = null;\n                if (recall && typeof recall == 'function') {\n                        recall();\n                } else if (recall) {\n                        eval(recall);\n                }\n                if (!evaled) evalscript(s);\n        });\n}\n\nfunction checkpostrule(showid, extra) {\n        var x = new Ajax();\n        x.get('forum.php?mod=ajax&action=checkpostrule&inajax=yes&' + extra, function(s) {\n                if (s.indexOf('; document.cookie=\\'ccdefend=\\'+v+\\'; path=/\\'; window.location.reload();') != -1) {\n                        s = s.replace(' window.location.reload();', ''); // prevent redirecting\n                        eval(s); // to be optimized\n                        checkpostrule(showid, extra); // reload window\n                }\n                ajaxinnerhtml($(showid), s);\n                evalscript(s);\n        });\n}\n\nfunction checkpostrule_post(theform) {\n  if (!seccodecheck && !secqaacheck && !theform.sechash) {\n    var x = new Ajax();\n    x.get('forum.php?mod=ajax&action=checkpostrule&ac=' + postaction + '&inajax=yes', function (s) {\n      if (s) {\n              if (s.indexOf('; document.cookie=\\'ccdefend=\\'+v+\\'; path=/\\'; window.location.reload();') != -1) {\n                        s = s.replace(' window.location.reload();', ''); // prevent redirecting\n                        eval(s); // to be optimized\n                        checkpostrule_post(theform); // reload window\n                }\n        ajaxinnerhtml($('seccheck'), s);\n        evalscript(s);\n        seccodecheck = true;\n      } else {\n        postsubmit(theform);\n      }\n    });\n  } else {\n    postsubmit(theform);\n  }\n}复制代码压缩过的书签javascript:function _ajaxget(url,showid,waitid,loading,display,recall){waitid=typeof waitid=='undefined'||waitid===null?showid:waitid;var x=new Ajax();x.setLoading(loading);x.setWaitId(waitid);x.display=typeof display=='undefined'||display==null?'':display;x.showId=$(showid);if(url.substr(strlen(url)-1)=='#'){url=url.substr(0,strlen(url)-1);x.autogoto=1}var __url=url;var url=url+'&inajax=1&ajaxtarget='+showid;x.get(url,function(s,x){var evaled=false;if(s.indexOf('; document.cookie=\\'ccdefend=\\'+v+\\'; path=/\\'; window.location.reload();')!=-1){s=s.replace(' window.location.reload();','');eval(s);_ajaxget(__url,showid,waitid,loading,display,recall)}if(s.indexOf('ajaxerror')!=-1){evalscript(s);evaled=true}if(!evaled&&(typeof ajaxerror=='undefined'||!ajaxerror)){if(x.showId){x.showId.style.display=x.display;ajaxinnerhtml(x.showId,s);ajaxupdateevents(x.showId);if(x.autogoto)scroll(0,x.showId.offsetTop)}}ajaxerror=null;if(recall&&typeof recall=='function'){recall()}else if(recall){eval(recall)}if(!evaled)evalscript(s)})}复制代码",
    "replies": [
        {
            "author": "xmdhs",
            "timestamp": 1533885300,
            "txt_content": "论坛的时间似乎也出现了问题，卡楼主bug更频繁了。\n"
        },
        {
            "author": "。—。",
            "timestamp": 1533886560,
            "txt_content": "xmdhs 发表于 2018-8-10 15:15\n论坛的时间似乎也出现了问题，卡楼主bug更频繁了。\n表示好羡慕，这边已经被ccdefend烦到要自己写一个脚本来修复的地步了……"
        },
        {
            "author": "星耀幻影",
            "timestamp": 1533886680,
            "txt_content": "为什么听不懂啊？？"
        },
        {
            "author": "。—。",
            "timestamp": 1533898980,
            "txt_content": "星耀幻影 发表于 2018-8-10 15:38\n为什么听不懂啊？？\n那我翻译一下吧\n趁论坛bug没完全修好我趁机水一贴应该没人发现吧【滑稽"
        },
        {
            "author": "AzureZeng",
            "timestamp": 1533915600,
            "txt_content": "有概率被服务器认为是doss和docc攻击docc?可以啊 新梗"
        },
        {
            "author": "有毒○贰比",
            "timestamp": 1533948180,
            "txt_content": "原来听不懂，看LZ翻译了下，一幅原来如此的表情"
        },
        {
            "author": "zjxx",
            "timestamp": 1533958080,
            "txt_content": "楼主的脚本好像还可以修复回复bug...."
        },
        {
            "author": "夕离丶",
            "timestamp": 1533962400,
            "txt_content": "其实是有点bug的"
        },
        {
            "author": "。—。",
            "timestamp": 1533966720,
            "txt_content": "zjxx 发表于 2018-8-11 11:28\n楼主的脚本好像还可以修复回复bug....\n对，一开始是想把论坛恢复之前的模样，上边源代码那段比懒人书签多出来的部分就是分别hook掉悬浮回帖框和高级模式获取验证码token的逻辑，但是已经离原本只想修评分的愿望越来越偏了……反正论坛会修的吧……"
        },
        {
            "author": "MC小白桑",
            "timestamp": 1533993000,
            "txt_content": "但是这个不适用于编辑的bug"
        },
        {
            "author": "。—。",
            "timestamp": 1533999180,
            "txt_content": " 本帖最后由 a6809936 于 2018-8-11 23:15 编辑 \nMC小白桑 发表于 2018-8-11 21:10\n但是这个不适用于编辑的bug\n毕竟本来也没打算做到那种程度的……说……\n反正论坛不可能不去修复这些问题，要是真有需求的话可以试试源代码那段，之前为了修复附件的上传插入删除多写了一些，编辑帖子和悬浮回帖框目前只有chrome测试通过了，firefox只做到了评分的部分，事实是这个想法我已经懒得去弄了（咕咕咕\nedit: 编辑修复的功能只在chrome实现，firefox会陷入死循环貌似……使用方法同评分，设计上是在鼠标移动到保存按钮前点一下书签即可，不过实验中即使点过保存了再点书签也能重载的样子……"
        },
        {
            "author": "MYMY4",
            "timestamp": 1534000680,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "星耀幻影",
            "timestamp": 1534003560,
            "txt_content": "厉害厉害，我完全听不懂"
        },
        {
            "author": "。—。",
            "timestamp": 1534003860,
            "txt_content": "星耀幻影 发表于 2018-8-12 00:16\n这个翻译正有技术含量真有技术含量。。。\n嘛，好不容易想生产一点水贴，结果太久没水了，好像都对水贴的概念模糊掉了……\n要多多灌水的话，论坛也许就能像以前那样，活跃起来了吧……"
        },
        {
            "author": "星耀幻影",
            "timestamp": 1534003980,
            "txt_content": "a6809936 发表于 2018-8-12 00:11\n嘛，好不容易想生产一点水贴，结果太久没水了，好像都对水贴的概念模糊掉了……\n要多多灌水的话，论坛也 ...\n多练练 * 帖的技术就好"
        },
        {
            "author": "星耀幻影",
            "timestamp": 1534004160,
            "txt_content": "这个翻译正有技术含量真有技术含量。。。"
        },
        {
            "author": "当你老爹",
            "timestamp": 1534313940,
            "txt_content": "希望不会再出现这种情况"
        },
        {
            "author": "YY-HeiDaDa",
            "timestamp": 1546320780,
            "txt_content": "看这参与人数能评分的大佬们甚是兴奋...！"
        }
    ]
}