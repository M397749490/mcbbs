{
    "title": "用EventLib简化fabric mod开发",
    "author": "森林蝙蝠",
    "replyCount": 2,
    "timestamp": 1587893460,
    "txt_content": " 本帖最后由 森林蝙蝠 于 2020-4-26 17:36 编辑 \n\nEventLib是一个基于fabric开发的小型mod，用于给fabric添加更多常见事件——这是它比起forge的一个重大缺陷。\n\nClientStartCallback：监听客户端启动的事件。\nClientStartCallback.EVENT.register(client -> LOGGER.warn(\"Client Started!\"));复制代码\nClientStartCallback：监听客户端关闭的事件。\nClientStopCallback.EVENT.register(client -> LOGGER.warn(\"Client Stopped!\"));复制代码PlayerSleepCallback：监听玩家右键准备上床睡觉事件。PlayerSleepCallback.PLAYER_SLEEP_CALLBACK_EVENT.register((player,bedPos,time)->{\n                        if(player.inventory.isInvEmpty()) {\n                                Entity entity=new SheepEntity(EntityType.SHEEP,player.world);\n                                entity.setPosition(player.getBlockPos().getX(),player.getBlockPos().getY()+1,player.getBlockPos().getZ());\n                                player.world.spawnEntity(entity);\n                        }\n                        return ActionResult.PASS;\n                });复制代码EnchantmentCallback：监听玩家点击附魔事件。\nEnchantmentCallback.ENCHANTMENT_CALLBACK_EVENT.register(((playerEntity,itemStack,level) -> {\n                        if(itemStack.getTranslationKey().contains(\"gold\"))\n                                itemStack.setDamage(itemStack.getMaxDamage()/2);  //将被附魔物品耐久减半\n                        return ActionResult.PASS;\n                }));复制代码PlayerLevelupCallback：玩家升级事件。\nPlayerLevelupCallback.PLAYER_LEVELUP_CALLBACK_EVENT.register((player,level)->{\n                        if(player.experienceLevel>30)\n                                player.addPotionEffect(new StatusEffectInstance(StatusEffects.BLINDNESS,30,1));\n                        return ActionResult.PASS;\n                });复制代码CommandStartCallback：命令得以执行事件。\nCommandStartCallback.COMMAND_START_CALLBACK_EVENT.register((source,command)->{\n                        if(source.getEntityOrThrow()!=null) {\n                                Entity entity=source.getEntity();\n                                if (command.contains(\"give\") && entity instanceof PlayerEntity)\n                                        entity.kill();\n                                return ActionResult.PASS;\n                        }\n                        return ActionResult.PASS;\n                });复制代码\nBlockEntityConstructedCallback：世界中有BlockEntity生成事件。\nBlockEntityConstructCallback.BLOCK_ENTITY_CONSTRUCT_CALLBACK_EVENT.register((blockEntity,pos,world)->{\n                        if(blockEntity instanceof FurnaceBlockEntity && world!=null) {\n                                world.getLevelProperties().setClearWeatherTime(0);\n                                world.getLevelProperties().setRaining(true);\n                        }\n                        return ActionResult.PASS;\n                });复制代码FishingCallback：钓鱼事件。\nFishingCallback.FISHING_CALLBACK_EVENT.register(((world, player) -> {\n                        if(world.getLevelProperties().isRaining())\n                                player.dropItem(new ItemStack(Items.DIAMOND),false);\n                        return new TypedActionResult<>(ActionResult.PASS, LootContextTypes.CHEST);\n                }));复制代码AdvancementCallback：成就完成事件（客户端）。AdvancementCallback.ADVANCEMENT_CALLBACK_EVENT.register(((playerEntity, world, advancementPacket) -> {\n                        advancementPacket.getAdvancementsToProgress().forEach(((identifier, advancementProgress) -> {\n                                if(identifier.toString().equals(\"minecraft:story/mine_diamond\"))\n                                        playerEntity.dropItem(Items.EMERALD_BLOCK);\n                        }));\n                        return ActionResult.PASS;\n                }));复制代码ChunkLoadCallback：区块加载事件（客户端）。\nChunkLoadCallback.CHUNK_LOAD_CALLBACK_EVENT.register((chunk -> {\n                        if(chunk!=null && chunk.getBiome(new BlockPos(200,80,200))== Biomes.SWAMP) {\n                                Entity entity=new EnderDragonEntity(EntityType.ENDER_DRAGON,chunk.getWorld());\n                                entity.setPosition(200,80,200);\n                                chunk.addEntity(entity);\n                        }\n                        return ActionResult.PASS;\n                }));复制代码DayNightCallback：昼夜交替事件。DayNightCallback.DAY_NIGHT_CALLBACK_EVENT.register(((world, player) -> {\n                        if(world.isThundering())\n                                player.addPotionEffect(new StatusEffectInstance(StatusEffects.FIRE_RESISTANCE));\n                }));复制代码EnterDimensionCallback：实体进入某个维度事件。\nEnterDimensionCallback.ENTER_DIMENSION_CALLBACK_EVENT.register(((dimension,entity, world, dimensionType) -> {\n                        if(!world.isClient && dimensionType.equals(DimensionType.THE_END) && entity instanceof LivingEntity)\n                                entity.dropItem(Items.DIAMOND);\n                        return ActionResult.PASS;\n                }));复制代码EntityDeathCallback：实体死亡事件。EntityDeathCallback.ENTITY_DEATH_CALLBACK_EVENT.register(((world, entity, playerEntity, pos) -> {\n                        if(entity instanceof WitherSkeletonEntity)\n                                entity.dropItem(Items.ACACIA_BOAT);\n                        return ActionResult.PASS;\n                }));复制代码EntityHealCallback：实体治愈事件。EntityHealCallback.ENTITY_HEAL_CALLBACK_EVENT.register(((entity, world, health) -> {\n                        if(entity instanceof CreeperEntity)\n                                entity.setHealth(entity.getMaxBreath());\n                        return ActionResult.PASS;\n                }));复制代码EntityMoveCallback：实体移动事件。\nEntityMoveCallback.ENTITY_MOVE_CALLBACK_EVENT.register(((world, self, direction) -> {\n                        if(self instanceof LivingEntity && direction.x>0 && direction.z>0 && direction.x<0.5 && direction.z<0.5)\n                                self.dropItem(Items.ANVIL);\n                        return ActionResult.PASS;\n                }复制代码EntitySpawnCallback：实体生成事件。\nEntitySpawnCallback.EVENT_SPAWN_CALLBACK.register(((world, player, self, pos) -> {\n                        if(self instanceof PigEntity)\n                                self.dropItem(Items.BONE_MEAL);\n                        return ActionResult.PASS;\n                }));复制代码ExplosionCallback：爆炸事件。\nExplosionCallback.EXPLOSION_CALLBACK_EVENT.register(((world, pos) -> {\n                        if(pos.getY()>64)\n                                world.getPlayers().forEach(player->{\n                                        if(!player.world.isClient)\n                                        player.sendMessage(new LiteralText(\"wo cao ni ma!\"));\n                                });\n                        return ActionResult.PASS;\n                }));复制代码EntityTeleportCallback：实体传送事件。EntityTeleportCallback.ENTITY_TELEPORT_CALLBACK_EVENT.register(((entity, startPos, destPos) -> {\n                        if(entity instanceof EndermanEntity && startPos.getY()>40) {\n                                Entity tnt=new TntEntity(entity.world,startPos.getX(),startPos.getY(),startPos.getZ(),null);\n                                entity.world.createExplosion(tnt,startPos.getX(),startPos.getY(),startPos.getZ(),7, Explosion.DestructionType.DESTROY);\n                        }\n                        return ActionResult.PASS;\n                }));复制代码FireworkCallback：焰火使用事件。\nFireworkCallback.FIREWORK_CALLBACK_EVENT.register((world,player,firework)->{\n                        if(world.getBiome(player.getBlockPos())==Biomes.MOUNTAINS && !world.isClient)\n                                player.sendMessage(new LiteralText(\"ni ma zha le\"));\n                        return ActionResult.PASS;\n                });复制代码GuiScreenCallback：Gui事件，很明显，只属于客户端。\nGuiScreenCallback.GUI_SCREEN_CALLBACK_EVENT.register(screen -> {\n                        if(screen.isPauseScreen()) {\n                                LOGGER.warn(\"PAUSED!\");\n                        }\n                        return ActionResult.PASS;\n                });复制代码MobSpawnerCallback：刷怪笼工作事件（客户端）。MobSpawnerCallback.MOB_SPAWNER_CALLBACK_EVENT.register((world, playerEntity, mobEntity) -> {\n                        if(world.isClient && mobEntity!=null&&mobEntity.getType()==EntityType.PIG)\n                                playerEntity.sendMessage(new LiteralText(\"这不**\"));\n                        return ActionResult.PASS;\n                });复制代码OpenContainerCallback：玩家打开容器事件。OpenContainerCallback.OPEN_CONTAINER_CALLBACK_EVENT.register(playerEntity -> {\n                        if(!playerEntity.inventory.isInvEmpty())\n                                playerEntity.getArmorItems().forEach(itemStack ->\n                                        itemStack.setDamage(itemStack.getMaxDamage()/2));\n                        return ActionResult.PASS;\n                });复制代码PlayerChatCallback：聊天事件。PlayerChatCallback.PLAYER_CHAT_CALLBACK_EVENT.register((player, text) -> {\n                        if(text.asString().contains(\"nmsl\"))\n                                player.kill();\n                        return new TypedActionResult<>(ActionResult.PASS,text);\n                });复制代码PlaySoundCallback：声音播放事件（客户端）。PlaySoundCallback.PLAY_SOUND_CALLBACK_EVENT.register((world, player, pos, event, category) -> {\n                        if(category.equals(SoundCategory.WEATHER)){\n                                Entity entity=new LightningEntity(world,player.getBlockPos().getX()+0.5,player.getBlockPos().getY(),\n                                                player.getBlockPos().getZ()+0.5,false);\n                                world.spawnEntity(entity);\n                        }\n                        return ActionResult.PASS;\n                });复制代码PortalSpawnCallback：传送门生成事件。PortalSpawnCallback.PORTAL_SPAWN_CALLBACK_EVENT.register((playerEntity, world) -> {\n                                if(playerEntity.getMainHandStack().getItem()==Items.FLINT_AND_STEEL)\n                                        world.createExplosion(new TntEntity(EntityType.TNT,world),playerEntity.getBlockPos().getX(),\n                                                        playerEntity.getBlockPos().getY(),\n                                                        playerEntity.getBlockPos().getZ(),7,true, Explosion.DestructionType.DESTROY);\n                                return ActionResult.PASS;\n                        });复制代码PreLoginCallback：准备登入事件。PreLoginCallback.PRE_LOGIN_CALLBACK_EVENT.register(((server, key, entity) -> {\n                        LOGGER.warn(server.getMaxPlayerCount());\n                        return ActionResult.PASS;\n                }));复制代码RaidCallback：村庄侵袭开始事件。RaidCallback.RAID_CALLBACK_EVENT.register((raid, player) -> {\n                        if(raid.hasStarted())\n                                player.inventory.armor.forEach(itemStack -> {\n                                        itemStack.addEnchantment(Enchantments.PROTECTION,4);\n                                        itemStack.addEnchantment(Enchantments.UNBREAKING,3);\n                                });\n                        return ActionResult.PASS;\n                });复制代码RidingCallback：玩家骑乘实体事件。RidingCallback.RIDING_CALLBACK_EVENT.register((player, horse) -> {\n                        if(horse.getDisplayName().toString().contains(\"nmsl\"))\n                                horse.kill();\n                        return ActionResult.PASS;\n                });复制代码ShootingCallback：弹射物生成事件，由于拦截的是实体构造器，所以其实无法取消。\nShootingCallback.SHOOTING_CALLBACK_EVENT.register((player,world,projectileEntity) -> {\n                        if(player instanceof PlayerEntity && world.isThundering()) {\n                                projectileEntity.remove();\n                                return ActionResult.FAIL;\n                        }\n                        return ActionResult.PASS;\n                });复制代码TamedEntityCallback：有实体被驯服事件。TamedEntityCallback.TAMED_ENTITY_CALLBACK_EVENT.register((world, playerEntity, entity) -> {\n                        if(!entity.isFireImmune()) {\n                                entity.setOnFireFor(8);\n                                entity.addPotionEffect(new StatusEffectInstance(StatusEffects.HEALTH_BOOST));\n                        }\n                        return ActionResult.PASS;\n                });复制代码\n使用方法：从这里（提取码yinm）下载dev版的eventlib，放入任意文件夹，然后在build.gradle的dependencies区域输入\nfileTree \"你的保存位置\\\\eventlib-1.0.0-dev.jar\"\n复制代码即可完成依赖项导入。\n目前适用于Java8/11，1.14.4版本，准备向1.15迁移。\n源码地址：https://github.com/forestbat/EventLib\n\n\n\n",
    "replies": [
        {
            "author": "ZX夏夜之风",
            "timestamp": 1591852980,
            "txt_content": "PlayerChatCallback.PLAYER_CHAT_CALLBACK_EVENT.register((player, text) -> {\n                        if(text.asString().contains(\"nmsl\"))\n                                player.kill();\n                        return new TypedActionResult<>(ActionResult.PASS,text);\n                });\n复制代码\nnmsl瞩目\n（害怕）"
        },
        {
            "author": "qimingkun",
            "timestamp": 1591941720,
            "txt_content": "我他喵研究了半天发送指令的Mixin事件触发，没想到这里居然找到了现成的，感谢鸭！！！"
        }
    ]
}