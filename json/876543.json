{
    "title": "命令/命令方块移动箱内物品",
    "author": "pdj686",
    "replyCount": 5,
    "timestamp": 1561300020,
    "txt_content": "（版本1.14+）\n用命令检测一个箱子/木桶内特定位置的物品，然后视情况放到另一个箱子的空位中\n\n举个例子，在坐标 ~ ~ ~处存在一个木桶，在木桶的Slot:8b有一张名字叫StoneSword的纸（纸的名字不重要），Slot:9b位置存在若干输入物品。\n现在希望实现如下功能：\n\n若Slot:9b位置上的物品是石剑（不管它是什么附魔/耐久），\n则检测坐标~ ~ ~-1位置是否是有至少一个空位的箱子\n（比如使用\nexecute store result score @s isempty run data get block ~ ~ ~-1 Items\nexecute unless block ~ ~ ~-1 minecraft:chest run scoreboard players set @s isempty 27\n这样的指令）\n同样检测~ ~ ~1位置。\n\n如果任一输出箱子没有空位，则不进行放置操作；\n如果是石剑，则将其放入~ ~ ~-1位置的箱子的空位中；\n否则，将其放入~ ~ ~1位置的箱子的空位中。\n",
    "replies": [
        {
            "author": "ruhuasiyu",
            "timestamp": 1561300020,
            "txt_content": "# 添加记分板\nscoreboard objectives add value dummy复制代码# 如果 Slot:8b 是指定的纸且 Slot:9b 放有物品，执行 test:check 函数\nexecute if block ~ ~ ~ barrel{Items:[{Slot:8b,id:\"minecraft:paper\",tag:{display:{Name:'{\"text\":\"StoneSword\"}'}}},{Slot:9b}]} run function test:checkfull复制代码# test:checkfull 函数，检查两个箱子是否满\nscoreboard players set #temp1 value 27\nexecute if block ~ ~ ~-1 chest store result score #temp1 value run data get block ~ ~ ~-1 Items\nscoreboard players set #temp2 value 27\nexecute if block ~ ~ ~1 chest store result score #temp2 value run data get block ~ ~ ~1 Items\nexecute if score #temp1 value matches ..26 if score #temp2 value matches ..26 run function test:type复制代码# test:type 函数，将物品信息复制到实体中，然后视情形选择放入的箱子位置\nsummon item ~ ~ ~ {Item:{id:\"minecraft:stone\",Count:1b,tag:{store:{Slot:0b}}},Tags:[\"temp_item\"]}\ndata modify entity @e[type=item,distance=..1,tag=temp_item,limit=1,sort=nearest] Item.tag.store.id set from block ~ ~ ~ Items[{Slot:9b}].id\ndata modify entity @e[type=item,distance=..1,tag=temp_item,limit=1,sort=nearest] Item.tag.store.Count set from block ~ ~ ~ Items[{Slot:9b}].Count\ndata modify entity @e[type=item,distance=..1,tag=temp_item,limit=1,sort=nearest] Item.tag.store.tag set from block ~ ~ ~ Items[{Slot:9b}].tag\nexecute if block ~ ~ ~ barrel{Items:[{Slot:9b,id:\"minecraft:stone_sword\"}]} positioned ~ ~ ~-1 run function test:put\nexecute unless block ~ ~ ~ barrel{Items:[{Slot:9b,id:\"minecraft:stone_sword\"}]} positioned ~ ~ ~1 run function test:put\nkill @e[type=item,distance=..1,tag=temp_item,limit=1,sort=nearest]\ndata remove block ~ ~ ~ Items[{Slot:9b}]复制代码\n\n# test:put 函数，穷举空槽位，确定槽位，然后复制信息进去\nexecute unless block ~ ~ ~ chest{Items:[{Slot:0b}]} run scoreboard players set #emptyslot value 0\nexecute unless block ~ ~ ~ chest{Items:[{Slot:1b}]} run scoreboard players set #emptyslot value 1\nexecute unless block ~ ~ ~ chest{Items:[{Slot:2b}]} run scoreboard players set #emptyslot value 2\nexecute unless block ~ ~ ~ chest{Items:[{Slot:3b}]} run scoreboard players set #emptyslot value 3\nexecute unless block ~ ~ ~ chest{Items:[{Slot:4b}]} run scoreboard players set #emptyslot value 4\nexecute unless block ~ ~ ~ chest{Items:[{Slot:5b}]} run scoreboard players set #emptyslot value 5\nexecute unless block ~ ~ ~ chest{Items:[{Slot:6b}]} run scoreboard players set #emptyslot value 6\nexecute unless block ~ ~ ~ chest{Items:[{Slot:7b}]} run scoreboard players set #emptyslot value 7\nexecute unless block ~ ~ ~ chest{Items:[{Slot:8b}]} run scoreboard players set #emptyslot value 8\nexecute unless block ~ ~ ~ chest{Items:[{Slot:9b}]} run scoreboard players set #emptyslot value 9\nexecute unless block ~ ~ ~ chest{Items:[{Slot:10b}]} run scoreboard players set #emptyslot value 10\nexecute unless block ~ ~ ~ chest{Items:[{Slot:11b}]} run scoreboard players set #emptyslot value 11\nexecute unless block ~ ~ ~ chest{Items:[{Slot:12b}]} run scoreboard players set #emptyslot value 12\nexecute unless block ~ ~ ~ chest{Items:[{Slot:13b}]} run scoreboard players set #emptyslot value 13\nexecute unless block ~ ~ ~ chest{Items:[{Slot:14b}]} run scoreboard players set #emptyslot value 14\nexecute unless block ~ ~ ~ chest{Items:[{Slot:15b}]} run scoreboard players set #emptyslot value 15\nexecute unless block ~ ~ ~ chest{Items:[{Slot:16b}]} run scoreboard players set #emptyslot value 16\nexecute unless block ~ ~ ~ chest{Items:[{Slot:17b}]} run scoreboard players set #emptyslot value 17\nexecute unless block ~ ~ ~ chest{Items:[{Slot:18b}]} run scoreboard players set #emptyslot value 18\nexecute unless block ~ ~ ~ chest{Items:[{Slot:19b}]} run scoreboard players set #emptyslot value 19\nexecute unless block ~ ~ ~ chest{Items:[{Slot:20b}]} run scoreboard players set #emptyslot value 20\nexecute unless block ~ ~ ~ chest{Items:[{Slot:21b}]} run scoreboard players set #emptyslot value 21\nexecute unless block ~ ~ ~ chest{Items:[{Slot:22b}]} run scoreboard players set #emptyslot value 22\nexecute unless block ~ ~ ~ chest{Items:[{Slot:23b}]} run scoreboard players set #emptyslot value 23\nexecute unless block ~ ~ ~ chest{Items:[{Slot:24b}]} run scoreboard players set #emptyslot value 24\nexecute unless block ~ ~ ~ chest{Items:[{Slot:25b}]} run scoreboard players set #emptyslot value 25\nexecute unless block ~ ~ ~ chest{Items:[{Slot:26b}]} run scoreboard players set #emptyslot value 26\nexecute store result entity @e[type=item,distance=..2,tag=temp_item,limit=1,sort=nearest] Item.tag.store.tag.Slot byte 1 run scoreboard players get #emptyslot value\ndata modify block ~ ~ ~ Items append from entity @e[type=item,distance=..2,tag=temp_item,limit=1,sort=nearest] Item.tag.store复制代码"
        },
        {
            "author": "SPGoding",
            "timestamp": 1561300500,
            "txt_content": " 本帖最后由 SPGoding 于 2019-6-23 22:47 编辑 \n# 如果 Slot:8b 是指定的纸且 Slot:9b 放有物品，执行 spgoding:foo 函数\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:8b,id:\"minecraft:paper\",tag:{display:{Name:'{\"text\":\"StoneSword\"}'}}},{Slot:9b}]} run function spgoding:foo复制代码\n\nspgoding:foo 函数内容如下\n# spgoding:foo\n# 获取 ~ ~ ~-1 的占用格数 $occupied-1 tmp\nexecute if block ~ ~ ~-1 minecraft:chest store result score $occupied-1 tmp run data get block ~ ~ ~-1 Items\nexecute unless block ~ ~ ~-1 minecraft:chest run scoreboard players set $occupied-1 tmp 27\n\n# 获取 ~ ~ ~1 的占用格数 $occupied1 tmp\nexecute if block ~ ~ ~1 minecraft:chest store result score $occupied1 tmp run data get block ~ ~ ~-1 Items\nexecute unless block ~ ~ ~1 minecraft:chest run scoreboard players set $occupied1 tmp 27\n\n# 当均有剩余格数，即占用格数小于等于 26 时\n# 执行函数 spgoding:bar\nexecute if score $occupied1 tmp matches ..26 if score $occupied-1 tmp matches ..26 run function spgoding:bar复制代码\n\nspgoding:bar 函数内容如下\n# spgoding:bar\n# 如果是石剑，放到 ~ ~ ~-1\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:9b,id:\"minecraft:stone_sword\"}]} run data modify block ~ ~ ~-1 Items append from block ~ ~ ~ Items[{Slot:9b}]\n# 否则，放到 ~ ~ ~1\nexecute unless block ~ ~ ~ minecraft:barrel{Items:[{Slot:9b,id:\"minecraft:stone_sword\"}]} run data modify block ~ ~ ~1 Items append from block ~ ~ ~ Items[{Slot:9b}]复制代码\n\n\n本回答以 WTFPL 协议发布。"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1561301220,
            "txt_content": "SPGoding 发表于 2019-6-23 22:35\nspgoding:foo 函数内容如下\n如果箱子已经有slot9b你这样会导致原有物品消失的……"
        },
        {
            "author": "pdj686",
            "timestamp": 1561428840,
            "txt_content": "ruhuasiyu 发表于 2019-6-23 22:47\n如果箱子已经有slot9b你这样会导致原有物品消失的……\n所以他后面那个算是fix了吗？\n以及你的回答里为啥要一个一个格子枚举。。没有直接追加在原输出箱子后面的方法吗？\n（以及对于你的回答，万一进来的是一个可堆叠物品，且原输出箱里本来就有这个可堆叠物品，那不就不堆叠了么）"
        },
        {
            "author": "朱星宇",
            "timestamp": 1561462080,
            "txt_content": "#在这里快速回复#有2个指令可以做到： ①/replaceitem ②/blockdata 推荐replaceitem，适于将物品放入已有物品的箱子，blockdata会将箱子里的其他物品清空且较为复杂 /replaceitem block x y z 槽位 物品ID 数量 附加值 NBT 箱子的槽位为： slot.container.数字 从箱子左上角开始为0，向右1格为1，右上角为8，下一行第一格为9（从左到右，从上到下） 若指定槽位已有其他物品，会将该物品替换掉 指令举例：将箱子第二行中间格换为锋利1钻石剑 /replaceitem block x y z slot.container.13 diamond_sword 1 0 {ench:[{id:16,lvl:1}]} 注：实用时必须将xyz替换为对应坐标 /replaceitem是1.8的新增指令，1.7的话可以通过setblock，直接放置一个有东西的箱子 /setblock x y z chest 附加值 {Items:[{id,Damage,Count,tag,Slot}]} 箱子的附加值决定了箱子的朝向 id为物品ID，必填 Damage为物品附加值（可不填，默认为0 Count为物品数量（可不填，但默认为0 tag为物品的NBT标签，可不填 Slot为物品在箱子内的槽位，必填 若有多个物品，直接继续叠加就行了 /setblock x y z chest 附加值 {Items:[{id,Damage,Count,tag,Slot},{id,Damage,Count,tag,Slot},{id,Damage,Count,tag,Slot}]} 可能代码写错了不过是一个意思  "
        }
    ]
}