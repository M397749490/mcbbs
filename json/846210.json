{
    "title": "初步构想",
    "author": "Exzh_PMGI",
    "replyCount": 6,
    "timestamp": 1550500200,
    "txt_content": "上次我发在mcbbs的帖子很多人都说听不懂...... 那这次我就来发点实在的。\n\n\n\n\n我最近在构想着 Minecode Studio 的设计器，也就是整个 Exzh Minecode Studio 项目最核心的 UI 编辑器控件部分——说简单也不简单，说复杂又不比 3D 渲染的复杂。3D 的渲染需要借助 OpenGL 这类的库，而据说 OpenGL 的项目要被一种新的图形引擎 Vulkan 取代，多少有些不合适。而且已经有人实现了 Minecraft 的 3D 仿真，也没必要自己造轮子去写这 3D 出来。于是乎，我就转向 2D 来开发。而 2D 开发，除了地图编辑器以外，还要一个必不可少的控件——时间轴控件。不了解时间轴控件的，你可以去看看 Adobe 的 Premiere Pro 和 After Effects 实现，都是不错的。\n\nQt 原生没有时间轴控件，只能自己来绘制。本文主要讲述我的解决方案和想法，不提供具体的 C++ 代码实现！\n先来看看一个时间轴控件应该有哪些部分组成：\n首先是时间刻度线，这点想必我不用多说，一个优秀的动画制作软件必定需要它。\n第二，应该支持拖动和键盘控制，这样就可以省去很多的时间\n三，应该提供缩略图的预览，免去不知道帧的位置的尴尬\n四，应该提供可以拉伸的时间轴滚动条\n\n\n说完这些还是直接上图比较适合理解：\n\nQt的绘制一般都是在 paintEvent(QPaintEvent *event) 中进行的。\n拖动和键盘的控制可以通过 eventFilter 和 mousePressEvent / mouseMoveEvent / mouseReleaseEvent 来实现，通过获得鼠标键盘的键入信息做出相应的回应。缩略图的预览可以先把整个当前帧先绘制到一个 Pixmap 对象上，再将它绘制到控件上，待程序空闲的时候再继续进行剩余帧的绘制，并将它们存入哈希表里，如果有所改动，再将哈希表里面的数据进行修改，如果对象太多则保留离当前帧最近的几个帧，定期删除后几帧的 Pixmap 对象。因为考虑到这个控件的特殊性，那么系统的滚动条就没法用了，又只能自己来画——画好时间轴的背景以后，再画一个空白的区域，用来绘制滚动条的贴图。当滚动条拉动的时候就发出一个信号来使得其它类的槽函数来接受这个信号，并进行相对应的处理。时间轴的变换也是如此。如果时间轴太短的话就按照 AE 这样的样式来画，画完了以后定期重绘就可以达到目的了。\n\nvoid mousePressEvent(QMouseEvent *) {\n     _flag = true;\n}\n\nvoid mouseReleaseEvent(QMouseEvent *) {\n     if(_flag) this->setCurrentPos(this->pos()-_pos);\n     _flag = false;\n}\n复制代码基本的思路就是这些，至于最终怎么实现出来又是另一回事了，如果有什么更好的建议，欢迎留言",
    "replies": [
        {
            "author": "分享",
            "timestamp": 1550500260,
            "txt_content": "大佬大佬..我看不懂emm"
        },
        {
            "author": "Abraham511",
            "timestamp": 1550501640,
            "txt_content": "说实话...即使这个帖子...也没有太看懂..."
        },
        {
            "author": "鲸鱼不是鱼",
            "timestamp": 1550502360,
            "txt_content": "膜拜大佬"
        },
        {
            "author": "FASnight",
            "timestamp": 1550505240,
            "txt_content": "一遍看完，没了就\n跪拜大佬\n话说真不需要换个地方问？"
        },
        {
            "author": "一手汗",
            "timestamp": 1550507580,
            "txt_content": "你以为你发个实在的我就能看懂了吗233"
        },
        {
            "author": "夏夜的风w",
            "timestamp": 1550580120,
            "txt_content": "看不懂233"
        }
    ]
}