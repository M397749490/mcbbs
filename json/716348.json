{
    "title": "[Bukkit][未知之域] JAVA的机制-反射 反射在Bukkit插件编写中的运用",
    "author": "qianji20000420",
    "replyCount": 0,
    "timestamp": 1502006760,
    "txt_content": " 本帖最后由 qianji20000420 于 2017-8-6 16:23 编辑 \n\n导读NMS概述如何利用反射来使NMS兼容不同版本的服务端\n\n\nNMS什么是NMS呢？\nNMS即为服务端核心里的net.minecraft.XXX包  他是服务端核心的最底层\n\n\n\n使NMS兼容不同版本的服务端我们先看看不同版本的NMS包都是什么样的。\n这个是1.7.2的\n\n\n\n\n17202.png (1.68 KB, 下载次数: 14)\n\n下载附件\n\n2017-8-6 15:21 上传\n\n\n\n\n\n这个是1.7.10的\n\n\n\n\n171002.png (1.75 KB, 下载次数: 13)\n\n下载附件\n\n2017-8-6 15:21 上传\n\n\n\n\n\n这个是1.8.0的\n\n\n\n\n18002.png (2.19 KB, 下载次数: 31)\n\n下载附件\n\n2017-8-6 15:21 上传\n\n\n\n\n\n每个版本的nms包名都不一样。那我们要如果用到nms里的类，方法什么的   只能适用到一个版本的服务器。\n那我们如何来让一个插件能运用nms来适应不同版本的服务器呢？\n这就要用到反射的知识了。\n\n但是 这个包名又怎么获取呢？  看似有点规律，又没有规律\n所以通过询问UD的大佬们得到了这样一个代码String packet = Bukkit.getServer().getClass().getPackage().getName();\nString nmsversion = packet.substring(packet.lastIndexOf('.') + 1);复制代码我先解释以下这串代码,Bukkit.getServer().getClass()获取到的是CraftServer的Class对象\n为什么要获取这个对象呢？\n我们发现\n这个是1.7.2的\n\n\n\n\n17201.png (1.67 KB, 下载次数: 21)\n\n下载附件\n\n2017-8-6 15:26 上传\n\n\n\n\n\n这个是1.7.10的\n\n\n\n\n171001.png (1.75 KB, 下载次数: 21)\n\n下载附件\n\n2017-8-6 15:26 上传\n\n\n\n\n\n这个是1.8.0的\n\n\n\n\n18001.png (1.65 KB, 下载次数: 20)\n\n下载附件\n\n2017-8-6 15:26 上传\n\n\n\n\n\n！ 这命名方式不是一致的吗。\n\n获取完Class对象之后再getPackage().getName()获取包名\n在1.7.10服务端输出如下\n\n\n\n\n233.png (721 Bytes, 下载次数: 25)\n\n下载附件\n\n2017-8-6 15:30 上传\n\n\n\n\n\n第二行就是在第一行的基础上取最后一个“.”后面的内容了。\n那NMS的包名不就是？\nString NMSname = \"net.minecraft.server.\" + nmsversion;复制代码这样就获取到了NMS的包名。\n然后我们就可以利用反射。。  胡作非为了！\n比如我们要给一个物品添加 NBT数据，需要先获取到NMS对象\n常规的做法应该是\nnet.minecraft.server.v1_X_RX.ItemStack NMS = CraftItemStack.asNMSCopy(new ItemStack(Material.STONE));复制代码但是 那个X是多少 我们虽然知道 但是这块到底怎么写呢？\n所以利用反射(asNMSCopy是org.bukkit.craftbukkit.v1_7_R4.inventory.CraftItemStack类下的一个方法)\nClass<?> cisi;\nMethod asNMSCopy;\nClass<?> nmsi;\nObject item = null;\n       try {\n           cisi = Class.forName(packet + \".inventory.CraftItemStack\");\n           asNMSCopy = cisi.getMethod(\"asNMSCopy\", ItemStack.class);\n           item = asNMSCopy.invoke(item, new ItemStack(Material.STONE));\n        } catch (Exception e) {\n                e.printStackTrace();\n        }复制代码这里我们这个子类不能抛出异常所以就先用try catch 围上把\n这样就成功获取到了nms对象 - item是不是很神奇呢。\n接下来的步骤就得看你们自己的了。~\n推荐一个NBT教程：http://mcbbs.tvt.im/thread-697478-1-1.html(By:莫老) 讲的很详细啊\n\n\n下一篇没有了\n返回索引贴\n第一次做教程，如果教程中有遗漏的或说错的地方请及时指出哇。~\n\n[groupid=1181]Unknown Domain[/groupid]\n",
    "replies": []
}