{
    "title": "Forge编写新的GUI，其中添加容器后无法正常点击容器内物品",
    "author": "xiezhirouwoxifu",
    "replyCount": 0,
    "timestamp": 1585102020,
    "txt_content": " 本帖最后由 xiezhirouwoxifu 于 2020-4-13 19:49 编辑 \n\n最近在研究创建新GUI的时候发现\n如果我按照原版Player的IInventory添加slot和限制，就可以正常使用\n重写transferStackInSlot后shift点击可以正常使用\n但如果我重新添加Slot，并且只保留玩家36格的容器，就会出现背包内物品无法正常点击,无法拖动，也无法放入我新加的slot里的情况\n还请大佬们指点一二谢谢\nForge版本：1.12.2-14.23.5.2847\nEclipse\n\nGui类@SideOnly(Side.CLIENT)\npublic class GuiContainerDemo extends GuiContainer{\n    private static final String TEXTURE_PATH =\"test:textures/gui/container/ceshi.png\";\n    private static final ResourceLocation TEXTURE = new ResourceLocation(TEXTURE_PATH);\n        public GuiContainerDemo(ContainerDemo inventorySlotsIn) {\n                super(inventorySlotsIn);\n                this.xSize = 176;\n                this.ySize = 133;\n        }\n\n        @Override\n        protected void drawGuiContainerBackgroundLayer(float partialTicks, int mouseX, int mouseY) {\n                GlStateManager.color(1.0F, 1.0F, 1.0F);\n                this.mc.getTextureManager().bindTexture(TEXTURE);\n                int offsetX = (this.width - this.xSize) / 2, offsetY = (this.height - this.ySize) / 2;\n                this.drawTexturedModalRect(offsetX, offsetY, 0, 0, this.xSize, this.ySize);\n        }\n}复制代码\n\n容器类\npublic class ContainerDemo extends Container{\n    protected Slot goldSlot;\n    protected Slot diamondSlot;\n    protected Slot emeraldSlot;\n    protected Slot ironSlot;\n        private ItemStackHandler items = new ItemStackHandler(4);\n        public ContainerDemo(EntityPlayer player) {\n        super();\n        this.addSlotToContainer(this.goldSlot = new SlotItemHandler(items, 0, 38 + 0 * 32, 20)\n        {\n            @Override\n            public boolean isItemValid(ItemStack stack)\n            {\n                return stack != null && stack.getItem() == Items.GOLD_INGOT && super.isItemValid(stack);\n            }\n\n            @Override\n            public int getItemStackLimit(ItemStack stack)\n            {\n                return 16;\n            }\n        });\n\n        this.addSlotToContainer(this.diamondSlot = new SlotItemHandler(items, 1, 38 + 1 * 32, 20)\n        {\n            {\n                this.putStack(new ItemStack(Items.DIAMOND, 64));\n            }\n\n            @Override\n            public boolean canTakeStack(EntityPlayer playerIn)\n            {\n                return false;\n            }\n        });\n\n        this.addSlotToContainer(this.emeraldSlot = new SlotItemHandler(items, 2, 38 + 2 * 32, 20)\n        {\n            @Override\n            public boolean isItemValid(ItemStack stack)\n            {\n                return stack != null && stack.getItem() == Items.EMERALD && super.isItemValid(stack);\n            }\n        });\n\n        this.addSlotToContainer(this.ironSlot = new SlotItemHandler(items, 3, 38 + 3 * 32, 20)\n        {\n            {\n                this.putStack(new ItemStack(Items.IRON_INGOT, 64));\n            }\n\n            @Override\n            public boolean canTakeStack(EntityPlayer playerIn)\n            {\n                return false;\n            }\n        });\n\n        for (int i = 0; i < 3; ++i)\n        {\n            for (int j = 0; j < 9; ++j)\n            {\n                this.addSlotToContainer(new Slot(player.inventory, j + i * 9 + 9, 8 + j * 18, 51 + i * 18));\n            }\n        }\n\n        for (int i = 0; i < 9; ++i)\n        {\n            this.addSlotToContainer(new Slot(player.inventory, i, 8 + i * 18, 109));\n        }\n        }\n        \n        @Override\n        public boolean canInteractWith(EntityPlayer playerIn) {\n                return true;\n        }\n    @Override\n    public void onContainerClosed(EntityPlayer playerIn)\n    {\n        super.onContainerClosed(playerIn);\n\n        if (playerIn.isServerWorld())\n        {\n            ItemStack goldStack = this.goldSlot.getStack();\n            if (goldStack != null)\n            {\n                playerIn.dropItem(goldStack, false);\n                this.goldSlot.putStack(null);\n            }\n            ItemStack emeraldStack = this.emeraldSlot.getStack();\n            if (emeraldStack != null)\n            {\n                playerIn.dropItem(emeraldStack, false);\n                this.emeraldSlot.putStack(null);\n            }\n        }\n    }\n        @Override\n        public ItemStack transferStackInSlot(EntityPlayer playerIn, int index) {\n                Slot slot = inventorySlots.get(index);\n\n        if (slot == null || !slot.getHasStack()){\n            return null;\n        }\n\n        ItemStack newStack = slot.getStack(), oldStack = newStack.copy();\n\n        boolean isMerged = false;\n\n        if (index == 0 || index == 2){\n            isMerged = mergeItemStack(newStack, 4, 40, true);\n        }\n        else if (index >= 4 && index < 31){\n            isMerged = !goldSlot.getHasStack() && newStack.getMaxStackSize() <= 16 && mergeItemStack(newStack, 0, 1, false)\n                    || !emeraldSlot.getHasStack() && mergeItemStack(newStack, 2, 3, false)\n                    || mergeItemStack(newStack, 31, 40, false);\n        }\n        else if (index >= 31 && index < 40){\n            isMerged = !goldSlot.getHasStack() && newStack.getMaxStackSize() <= 16 && mergeItemStack(newStack, 0, 1, false)\n                    || !emeraldSlot.getHasStack() && mergeItemStack(newStack, 2, 3, false)\n                    || mergeItemStack(newStack, 4, 31, false);\n        }\n\n        if (!isMerged){\n            return null;\n        }\n\n        if (!isMerged){\n            return null;\n        }\n\n        if (newStack.getMaxStackSize() == 0){\n            slot.putStack(null);\n        }\n        else {\n            slot.onSlotChanged();\n        }\n        return oldStack;\n        }\n}复制代码\n\n\n\n\n",
    "replies": []
}