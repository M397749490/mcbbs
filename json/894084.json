{
    "title": "[娱乐|RPG]DarkItemPick —— 掇菁撷华地拾取物品[1.8-1.14]",
    "author": "我的锅",
    "replyCount": 2,
    "timestamp": 1564486920,
    "txt_content": " 本帖最后由 我的锅 于 2019-7-31 20:25 编辑 \n\n \n※DarkItemPick※\n\nMusic|背景音乐\n\nFeatures|插件特性\n\n⑴过滤捡起的物品,防止玩家背包被不想要的物品塞满\n⑵阻止玩家捡起原版物品(可配置)\n\n\nDescriptions|插件描述\n\n㈠在捡起通过过滤的物品时告知玩家(可配置)\n㈡本插件基于Spigot 1.11.2开发,理论支持全版本\n\n\nPictures|插件图片\n\n\n查看插件帮助\n\n地上的一些物品,其品质相差较大\n\n将自己过滤器的正则表达式设为.*奇异的.*\n\n靠近拾取,只拾取了正则表达式过滤后的物品\n\nPermissions|插件权限\n\nDarkItemPick.reload - 重载插件\nDarkItemPick.set - 设置正则表达式\nDarkItemPick.help\n\n\nSourceCode|插件源码\n\npackage net.Shwz.DarkItemPick;\nimport java.io.File;\nimport java.io.IOException;\nimport java.util.*;\nimport java.util.regex.Pattern;\n\nimport org.bukkit.command.Command;\nimport org.bukkit.command.CommandSender;\nimport org.bukkit.configuration.Configuration;\nimport org.bukkit.configuration.file.FileConfiguration;\nimport org.bukkit.configuration.file.YamlConfiguration;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.player.PlayerPickupItemEvent;\nimport org.bukkit.inventory.ItemStack;\nimport org.bukkit.plugin.java.JavaPlugin;\n\npublic class DarkItemPick extends JavaPlugin implements Listener{\n        public HashMap<String,String> data = new HashMap<String,String>();\n        public FileConfiguration dataConfig;\n        public static File dataFile;\n        public String getValue(String pname) {\n                return data.containsKey(pname)?data.get(pname):\".*\";\n        }\n        public void setValue(String pname,String value) {\n                if (value.equals(\".*\")) {\n                        data.remove(pname);\n                }else {\n                        data.put(pname,value);\n                        dataConfig.set(pname,value);\n                        try {\n                                dataConfig.save(dataFile);\n                        } catch (IOException err) {\n                                getLogger().info(\"保存数据文件失败:文件正在使用中\");\n                        }\n                }\n        }\n        private List<String> lang = new ArrayList<String>();\n        private boolean doSendMsgOnPick;\n        private boolean doPickUpCommonItems;\n        public void onEnable() {\n            loadConfig(null);\n            getServer().getPluginManager().registerEvents(this,this);\n        }\n        public void onDisable() {\n                super.onDisable();\n        }\n        private void loadConfig(CommandSender toucher) {\n                if (toucher != null) toucher.sendMessage(lang.get(2));\n                saveDefaultConfig();\n                dataFile = new File(getDataFolder(),\"data.yml\");\n                if (!dataFile.exists()) {\n                        saveResource(\"data.yml\", true);\n                }\n                try {\n                reloadConfig();\n                }catch (Exception err) {\n                        getLogger().info(\"配置文件无效.\"+\"\\n\"+\"建议到此网站对配置文件进行校验: http://www.bejson.com/validators/yaml_editor/\");\n                }\n                try {\n                Configuration config = getConfig();\n                dataConfig = YamlConfiguration.loadConfiguration(dataFile);\n                String LANG_PATH = \"lang\";\n                Set<String> dataChecker = dataConfig.getKeys(false);\n                dataChecker = dataChecker == null?new HashSet<String>():dataChecker;\n                for (String pname : dataChecker) data.put(pname,dataConfig.getString(pname));\n                for (String msgName : new String[]{\".gettingMessage\",\".settingMessage\",\".startingReloadingMessage\",\".finishingReloadingMessage\",\".hrMessage\"}) lang.add(config.getString(LANG_PATH+msgName).replace('&','§'));\n                doSendMsgOnPick = config.getBoolean(\"doSendMsgOnPick\");\n                doPickUpCommonItems = config.getBoolean(\"doPickUpCommonItems\");\n                }catch (Exception err) {\n                        getLogger().info(\"配置文件不正确或为空!请参阅默认配置文件.\");\n                        throw err;\n                }\n        }\n        private void sendHelpMsg(CommandSender p) {\n                if (p.hasPermission(\"DarkItemPick.getHelp\")) p.sendMessage(\"\\n\"+lang.get(4)+\"\\n\"+\"§f/dip help §7- 查看插件帮助(即本消息)\"+\"\\n\"+\"§f/dip reload §7- 重载插件\"+\"\\n\"+\"§f/dip set <正则表达式> [玩家名] §7- 设置过滤器(设为.*即关闭)\"+\"\\n\"+lang.get(4));\n        }\n        public boolean onCommand(CommandSender sender,Command cmd,String label,String[] args) {\n                if (!label.equalsIgnoreCase(\"dip\")) {\n                        return true;\n                }\n                if (args.length == 0) {\n                        sendHelpMsg(sender);\n                        return true;\n                }\n                if (args[0].equalsIgnoreCase(\"reload\") && sender.hasPermission(\"DarkItemPick.reload\")) {\n                        loadConfig(sender);\n                        sender.sendMessage(lang.get(3));\n                        return true;\n                }\n                if (args[0].equalsIgnoreCase(\"set\") && sender.hasPermission(\"DarkItemPick.set\") && args.length>1) {\n                        setValue(args.length>2?args[2]:sender.getName(),args[1]);\n                        sender.sendMessage(lang.get(1));\n                        return true;\n                }\n                sendHelpMsg(sender);\n                return true;\n        }\n        @EventHandler\n        public void onPick(PlayerPickupItemEvent e) {\n                Player p = e.getPlayer();\n                ItemStack i = e.getItem().getItemStack();\n                if (!i.hasItemMeta() || !i.getItemMeta().hasDisplayName()) {\n                        if (!doPickUpCommonItems && !p.hasPermission(\"DarkItemPick.pickCommonItemsBypass\")) {\n                          e.setCancelled(true);\n                        }\n                        return;\n                }\n                String value = getValue(p.getName());\n                try {\n                    Pattern.compile(value);\n                }catch (Exception err) {\n                        p.sendMessage(\"§8正则表达式设置错误.\"+\"(\"+value+\")\"+\"\\n\"+\"§8建议到此网站学习正则表达式语法: https://www.runoob.com/java/java-regular-expressions.html\");\n                }\n                if (!i.getItemMeta().getDisplayName().matches(value)) {\n                        e.setCancelled(true);\n                        return;\n                }\n                if (doSendMsgOnPick && !getValue(p.getName()).equals(\".*\")) {\n                    p.sendMessage(lang.get(0).replaceAll(\"\\\\[itemName\\\\]\",i.getItemMeta().getDisplayName()));\n                }\n        }\n}\n复制代码\n\n\nDownload|插件下载\n\n\n\n\nDarkItemPick.jar\n(5.53 KB, 下载次数: 34)\n\n\n\n2019-7-30 19:38 上传\n点击文件名下载附件\nGo and use it.\n\n\n\n\n\n\n本插件所用所有代码均为原创,不存在借用/抄袭等行为.前往 https://www.runoob.com/java/java-regular-expressions.html 学习正则表达式语法.\n",
    "replies": [
        {
            "author": "qwe131",
            "timestamp": 1564488540,
            "txt_content": "插件是挺不错的，就是可能需要出个正则式表达的小教程。"
        },
        {
            "author": "鬼川",
            "timestamp": 1573402380,
            "txt_content": "支持原创！"
        }
    ]
}