{
    "title": "[WIKI][CY]BossShopPro - 开发者工具|API",
    "author": "乔柚",
    "replyCount": 1,
    "timestamp": 1542124980,
    "txt_content": " 本帖最后由 longlongz 于 2018-11-20 04:13 编辑 \nBossShopProItem Comparison | 物品对比字数统计: 2744字\n\n如何接入API\n首先你需要添加BossShopPro.jar 到你的Libraries里. \n你可以使用下方方法来获取:\nimport org.black_ixx.bossshop.BossShop;\nimport org.black_ixx.bossshop.api.BossShopAPI;\nimport org.bukkit.Bukkit;\nimport org.bukkit.plugin.Plugin;\n \npublic class BSPHook {\n \n    private BossShop bs; //BossShopPro 插件实例\n \n    public BSPHook(){\n        Plugin plugin = Bukkit.getPluginManager().getPlugin(\"BossShopPro\"); //获取BossShopPro 插件\n \n       if(plugin==null){ //Not installed?\n           System.out.print(\"[BSP Hook] BossShopPro was not found... you can download it here: https://www.spigotmc.org/resources/25699/\");\n            return;\n        }\n \n        bs = (BossShop) plugin; //Success :)\n \n    }\n \n \n    public BossShopAPI getBSPAPI(){\n        return bs.getAPI(); //Returns BossShopPro API\n    }\n \n}复制代码\n\n打开一个商店\npublic boolean openShop(Player p, String shop_name){\n\n        BSShop shop = bs.getAPI().getShop(shop_name);\n       if(shop==null){\n           p.sendMessage(ChatColor.RED+\"Shop \"+shop_name+\" not found...\");\n            return false;\n        }\n\n       bs.getAPI().openShop(p, shop);\n\n        return true;\n    }\n复制代码\n检查一个物品是否属于BossShopPro\n   //例子:物品事件\n       if(bs.getAPI().isValidShop(event.getInventory())){\n            //商店物品动作\n        }else{\n            //其余\n        }\n复制代码\n将一个商店物品添加到商店中\n        //创建一个自定义BSBuy (商店物品)\n                BSBuy buy = bs.getAPI().createBSBuy(BSRewardType.Shop, BSPriceType.Nothing, \"item_shop\", null, null, 1, \"OpenShop.Item_Shop\");\n\n                //获取商店信息\n                BSShop shop = bs.getAPI().getShop(\"menu\");\n\n                //将物品添加到商店\n               ItemStack menu_item = [...]\n               bs.getAPI().addItemToShop(menu_item, buy, shop);\n复制代码\n注册一个自定义点数插件\n你的插件必须要在BossShopPro之前载入\nPlugin.yml\nloadbefore: [BossShop]复制代码\n拓展BSPointsPlugin class\n[暂无]复制代码\n然后onEnable，示例你的class，然后注册使用方法\nnew Points().register();复制代码\n如何创建一个附属插件\n首先添加BossShopPro.jar 到你的libraries里。正常来说Bukkit插件的main class需要拓展org.bukkit.plugin.java.JavaPlugin,然而当你创建一个BossShopPro 附属插件时你需要导入以下的拓展之一:\n· org.black_ixx.bossshop.api.BossShopAddon – 简易版附属\n· org.black_ixx.bossshop.api.BossShopAddonConfigurable – 提供额外的对config文件的帮助，会在\"plugins/BossShopPro/Addons/<名称>/\" 中创建文件\nimport org.black_ixx.bossshop.api.BSAddonStorage;\nimport org.black_ixx.bossshop.api.BossShopAddon;\nimport org.bukkit.command.CommandSender;\n\npublic class BSPAddon extends BossShopAddon{\n\n    @Override\n    public String getAddonName() {\n        return \"ExampleAddon\"; //在这里放你想要的附属插件名字\n    }\n    @Override\n    public String getRequiredBossShopVersion() {\n        return \"1.1.7\"; //这里放你的插件所支持的最老版本的BSP插件build版本(只需要数字和点；不需要\"v\"前缀)\n    }\n\n    @Override\n    public void enableAddon() {\n        //这个方法在附属插件加载后执行(会在BossShopPro被加载时执行；商店，商店物品，奖励类型等还暂时缺失)\n\n        //使用的方法：创建自定义储存文件到附属插件文件夹内\n        //这些储存文件类型暂时被限制到一组方法之中并无法直接获得Bukkit FileConfiguration 例子的权限,\n        //因为在未来会有其他新的储存类型可能会被告知\n        //下方的例子显示了你可以操作的部分。当然，储存class组不止是有下方例子的选项\n       BSAddonStorage storage = this.createStorage(this, \"StorageFileName\"); //创建并装载一个储存文件\n\n       storage.set(\"Number\", 2); //设置一个整数数值\n       storage.set(\"Text\", \"This is some text\"); //设置一个字符数值\n\n        int number = storage.getInt(\"Value\", -1); //读取数值(如果没有找到数值, 基础数值“-1”会被返回)\n        String text = storage.getString(\"Text\", null); //读取数值，自失败的情况下返回无数值\n\n        storage.save(); //储存文件\n       storage.saveAsync(); //异步存储文件\n    }\n\n    @Override\n    public void disableAddon() {\n        //当附加插件被禁用时执行\n    }\n\n    @Override\n    public void bossShopFinishedLoading() {\n        //当BSP被完全执行时执行(包括但不限于商店，商品和奖励类型)\n    }\n\n    @Override\n    public void bossShopReloaded(CommandSender sender) {\n        //当BSP被手动重新装载之后执行(\"/bossshop reload\")\n    }\n\n\n}复制代码import org.black_ixx.bossshop.api.BSAddonConfig;\nimport org.black_ixx.bossshop.api.BossShopAddonConfigurable;\nimport org.black_ixx.bossshop.managers.config.FileHandler;\nimport org.bukkit.command.CommandSender;\nimport org.bukkit.configuration.file.FileConfiguration;\n\npublic class BSPAddonConfigurable extends BossShopAddonConfigurable{\n\n    @Override\n    public String getAddonName() {\n        return \"ExampleAddonConfigurable\"; //在这里选择附加插件的名字\n    }\n    @Override\n    public String getRequiredBossShopVersion() {\n        return \"1.1.7\"; //在这里放入最老能支持附加插件的BSP版本(只有数字和小数点; 没有\"v\" 前缀)\n    }\n\n    @Override\n    public void enableAddon() {\n        //当附加插件被允许时执行 当BSP核心被装载时发生, 商品，奖励类型和更多都处于缺失状态)\n\n        //设置文件方法A:\n       if(!getAddonConfig().getFile().exists()){\n            new FileHandler().copyFromJar(this, \"config.yml\"); //这个文件处理器允许复制并完成addon.jar 文件里的设置文件\n        }\n\n        //设置文件方法B:\n        getConfig().options().copyDefaults(true);\n       getConfig().addDefault(\"PointsPlugin\", \"TokenEnchant\");\n       getConfig().addDefault(\"Message.NotEnoughPoints\", \"&cYou don't have enough Tokens!\");\n       getConfig().addDefault(\"Placeholder.DisplayPoints\", \"%points2% Tokens\");\n       getConfig().addDefault(\"PointsDisplay.Enabled\", false);\n        saveConfig(); //从v1.2.1. 开始运作，在使用\"getAddonConfig().save();\"之前\n\n\n        //你可以访问文件设置，并为所欲为:\n       FileConfiguration config = getConfig();\n\n        //或者你可以访问 BSAddonConfig, 以提供更多的方法\n        BSAddonConfig addonconfig = getAddonConfig();\n       addonconfig.saveAsync(); //Saves file asynchronously\n       addonconfig.deleteAll(\"Key\"); //删除全部\"Key.\"打头的设置访问记录\n\n    }\n\n    @Override\n    public void disableAddon() {\n        //当附加插件被禁用时执行\n    }\n\n    @Override\n    public void bossShopFinishedLoading() {\n        /当BSP被完全装载执行\n    }\n\n    @Override\n    public void bossShopReloaded(CommandSender sender) {\n        //当BSP被手动重新装载时执行(\"/bossshop reload\")\n    }\n\n    @Override\n    public boolean saveConfigOnDisable() {\n        return false; //如果设置为真，设置文件每次附加文件被禁用会重新保存    }\n\n\n}复制代码\n如何创建一个自定义奖励类型\n首先你需要创建一个奖励class\nimport java.util.List;\n\nimport org.black_ixx.bossshop.core.BSBuy;\nimport org.black_ixx.bossshop.core.rewards.BSRewardType;\nimport org.black_ixx.bossshop.managers.ClassManager;\nimport org.black_ixx.bossshop.managers.misc.InputReader;\nimport org.black_ixx.bossshop.managers.misc.StringManipulationLib;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.inventory.ClickType;\n\nimport net.milkbowl.vault.permission.Permission;\n\npublic class BSRewardTypePermission extends BSRewardType{\n\n\n    public Object createObject(Object o, boolean force_final_state){ //force_final_state 总会是真，除非用BossShopProConfigure 访问\n        return InputReader.readStringList(o); //你可以把设置文件里的物品变成任何物品. 物品会被返回到这里.在以后会有用\n    }\n\n    public boolean validityCheck(String item_name, Object o){ //当\"createObject\" 被召唤之后执行. 在这里你可以查看物品的真实性.\n        if(o!=null){\n            return true;\n        }\n        ClassManager.manager.getBugFinder().severe(\"Was not able to create ShopItem \"+item_name+\"! The reward object needs to be a list of permissions (text lines).\");\n        return false;\n    }\n\n    public void enableType(){ //如果你的奖励类型有任何特殊性质，在这里开启\n        ClassManager.manager.getSettings().setPermissionsEnabled(true);\n       ClassManager.manager.getSettings().setVaultEnabled(true);\n    }\n\n    @Override\npublic boolean canBuy(Player p, BSBuy buy, boolean message_if_no_success, Object reward, ClickType clickType) { //在这里同意、拒绝玩家购买商品\n        for (String s : (List<String>) reward){\n            if (!p.hasPermission(s)) {\n                return true; //玩家缺少权限？可以买！\n            }\n        }\n       if(message_if_no_success){\n           ClassManager.manager.getMessageHandler().sendMessage(\"Main.AlreadyBought\", p); //如果玩家有以下全部的权限可以禁止玩家购买\n        }\n        return false;\n    }\n\n    @Override\n    public void giveReward(Player p, BSBuy buy, Object reward, ClickType clickType) { //如果所有都成功玩家在这里拿到奖励\n       List<String> permissions = (List<String>) reward;\n\n        Permission per = ClassManager.manager.getVaultHandler().getPermission();\n        for (String s : permissions) {\n           per.playerAdd(p, s);\n        }\n    }\n\n    @Override\n    public String getDisplayReward(Player p, BSBuy buy, Object reward, ClickType clickType) { //在这里定义\"%reward%\" 定位符怎么展示        List<String> permissions = (List<String>) reward;\n        String permissions_formatted = StringManipulationLib.formatList(permissions);\n        return ClassManager.manager.getMessageHandler().get(\"Display.Permission\").replace(\"%permissions%\", permissions_formatted);\n    }\n\n    @Override\n    public String[] createNames() { //在这里定义引导奖励的所有名称, 第一个入口是主要名称.\n        return new String[]{\"permission\", \"permissions\"};\n    }\n\n    @Override\n    public boolean mightNeedShopUpdate() { //在这里决定物品被购买之后商店是否刷新\n        return true;\n    }\n\n    //以下是可选择的:\n\n    @Override\n    public boolean logTransaction(){\n        return false; //默认设置为真. 如果你不希望购买被记录，把这个设置为假\n    }\n\n\n}复制代码如果你的奖励是数字类型的然后你想要完全支持所有BossShopPro 的功能项\"ItemAll\" pricetype, 则拓展BSRewardTypeNumber\n\nimport org.black_ixx.bossshop.core.BSBuy;\nimport org.black_ixx.bossshop.core.rewards.BSRewardTypeNumber;\nimport org.black_ixx.bossshop.managers.ClassManager;\nimport org.black_ixx.bossshop.managers.misc.InputReader;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.inventory.ClickType;\n\n\npublic class BSRewardTypeExp extends BSRewardTypeNumber{\n\n\n    public Object createObject(Object o, boolean force_final_state){ //force_final_state 总会是真除非被BossShopProConfigure 工具访问\n        return InputReader.getInt(o, -1); //尝试读取设置内奖励的数字; 失败返回-1\n    }\n\n    public boolean validityCheck(String item_name, Object o){ //这个方法当\"createObject\" 被召唤时执行. 这里你可以查看物品真实性.\n       if((Integer)o!=-1){\n            return true;\n        }\n       ClassManager.manager.getBugFinder().severe(\"Was not able to create ShopItem \"+item_name+\"! The reward object needs to be a valid Integer number. Example: '7' or '12'.\");\n        return false;\n    }\n\n    public void enableType(){ //你过你的奖励类型有任何特殊性质，在这里开启\n    }\n\n    @Override\n    public boolean canBuy(Player p, BSBuy buy, boolean message_if_no_success, Object reward, ClickType clickType) { //这里你可以同意、拒绝玩家购买\n        return true;\n    }\n\n    @Override\n    public void giveReward(Player p, BSBuy buy, Object reward, ClickType clickType) { //如果全部过程顺利玩家在这里拿到奖励\n        int exp = (int) ClassManager.manager.getMultiplierHandler().calculateRewardWithMultiplier(p, buy, clickType, ((Integer) reward), false); //如果你想要倍数被兼容的话，请使用倍数处理程序.重要: 在这种情况下你的pricetype必须和rewardtype一样\n       p.setLevel(p.getLevel() + exp);\n    }\n\n    @Override\n    public String getDisplayReward(Player p, BSBuy buy, Object reward, ClickType clickType) { //这里你决定了\"%reward%\" 占位符怎么展示这种奖励\n        int exp = (int) ClassManager.manager.getMultiplierHandler().calculateRewardWithMultiplier(p, buy, clickType, ((Integer) reward), true);\n        return ClassManager.manager.getMessageHandler().get(\"Display.Exp\").replace(\"%levels%\", String.valueOf(exp));\n    }\n\n    @Override\n    public String[] createNames() { //这里你决定所有指向奖励的名称，第一个入口是主要名称.\n        return new String[]{\"exp\", \"xp\", \"level\", \"levels\"};\n    }\n\n\n    @Override\n    public boolean mightNeedShopUpdate() { //这里你决定在奖励被购买之后商店是否刷新\n        return true;\n    }\n\n    @Override\n    public boolean isIntegerValue() { //这里你决定奖励要么是integer价格要么是double价格\n        return true;\n    }\n\n\n}复制代码\n自定义价格类型例子\nimport org.black_ixx.bossshop.core.BSBuy;\nimport org.black_ixx.bossshop.core.prices.BSPriceTypeNumber;\nimport org.black_ixx.bossshop.managers.ClassManager;\nimport org.black_ixx.bossshop.managers.misc.InputReader;\nimport org.black_ixx.bossshop.misc.MathTools;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.inventory.ClickType;\n\npublic class BSPriceTypeThirdCurrencyVariable extends BSPriceTypeNumber{\n\n    private CustomPoints cp;\n\n    public BSPriceTypeThirdCurrencyVariable(CustomPoints points){\n        this.cp = points;\n        updateNames(); //更新进入商店设置需要的名称从而使用这种价格类型: 现在自定义点数被设置为点数的名称(看#createNames())\n    }\n\n\n    /从设置接受价格物品并把它变成以后会用得到的物品\n    public Object createObject(Object o, boolean force_final_state){\n        return InputReader.getDouble(o, -1);\n    }\n\n    public boolean validityCheck(String item_name, Object o){ //验证价格物品\n       if((Double)o!=-1){\n            return true;\n        }\n        ClassManager.manager.getBugFinder().severe(\"Was not able to create ShopItem \"+item_name+\"! The price object needs to be a valid number. Example: '7' or '12'.\"); \n        return false;\n    }\n\n    public void enableType(){ //当价格类型在商店被使用时当BSP开始时执行一次\n    //可以被用来注册Vault的文件 \n    }\n\n\n    @Override\n    public boolean hasPrice(Player p, BSBuy buy, Object price, ClickType clickType, int multiplier, boolean messageOnFailure) {\n        double points = ClassManager.manager.getMultiplierHandler().calculatePriceWithMultiplier(p, buy, clickType, (Double) price) * multiplier;\n        if (cp.getPointsManager().getPoints(p) < points) {\n            String message = cp.getMessageNotEnoughPoints();\n            if(message != null && messageOnFailure){\n               p.sendMessage(ClassManager.manager.getStringManager().transform(message, buy, buy.getShop(), null, p));\n            }\n            return false;\n        }\n        return true;\n    }\n\n    @Override\n    public String takePrice(Player p, BSBuy buy, Object price, ClickType clickType, int multiplier) {\n        double points = ClassManager.manager.getMultiplierHandler().calculatePriceWithMultiplier(p, buy, clickType, (Double) price) * multiplier;\n\n       cp.getPointsManager().takePoints(p, points);\n        return getDisplayBalance(p, buy, price, clickType);\n    }\n\n    @Override\n    public String getDisplayBalance(Player p, BSBuy buy, Object price, ClickType clickType) {\n        double balance_points = cp.getPointsManager().getPoints(p);\n        return cp.getPlaceholderPoints().replace(\"%\"+cp.getName()+\"%\", MathTools.displayNumber(balance_points, cp.getSpecialDisplayFormatting(), !cp.getPointsManager().usesDoubleValues()));\n    }\n\n    @Override\n    public String getDisplayPrice(Player p, BSBuy buy, Object price, ClickType clickType) {\n        return ClassManager.manager.getMultiplierHandler().calculatePriceDisplayWithMultiplier(p, buy, clickType, (Double) price, cp.getPlaceholderPoints().replace(\"%\"+cp.getName()+\"%\", \"%number%\"), cp.getSpecialDisplayFormatting(), true);\n    }\n\n\n    @Override\n    public String[] createNames() { //价格类型用户的名称可以被用于进入设置\n        if(cp == null){\n        return new String[]{\"thirdcurrency\", \"points2\", \"point2\"};\n        }else{\n            return new String[]{cp.getName()};\n        }\n    }\n\n    public boolean supportsMultipliers(){\n        return true; //makes RewardTypes like BuyAll possible\n    }\n\n    @Override\n    public boolean mightNeedShopUpdate() {\n        return true; //这个价格类型是否执行取决于是否更新(比如占位符的变化)\n    }\n\n    @Override\n    public boolean isIntegerValue() {\n        return false; //needs to be defined because the class extends BSPriceTypeNumber\n    }复制代码\n如何创建自己的物品数据(itemdata)部分\n\n1.    伸展BossShopPro class \"ItemDataPart\"\n2.    执行所有授予的方案all given methods\n3.    创建一个监听器来监听\"BSRegisterTypesEvent\" 然后创建一个你的自定义ItemDataPart 的例子. 另外使用\"register\" 方法注册例子.\n\nItemDataPart例子\npublic class ItemDataPartMaterial extends ItemDataPart{\n  public ItemStack transform(ItemStack item, String used_name, String argument)  {\n    short durability = 0;\n    Material m = Material.STONE;\n\n    if (argument.contains(\":\")) {\n      String[] parts = argument.split(\":\");\n      if (parts.length > 1) {\n        durability = (short)InputReader.getInt(parts[1].trim(), 0);\n      }\n      argument = parts[0].trim();\n    }\n\n    m = InputReader.readMaterial(argument);\n\n    if (m == null) {\n     ClassManager.manager.getBugFinder().severe(\"Mistake in Config: '\" + argument + \"' is not a valid '\" + used_name + \"'. Unable to find a fitting material.\");\n      return item;\n    }\n\n    item.setType(m);\n   item.setDurability(durability);\n    return item;\n  }\n\n  public int getPriority()  {\n    return PRIORITY_MOST_EARLY;\n  }\n\n  public boolean removeSpaces()  {\n    return true;\n  }\n\n  public String[] createNames()  {\n    return new String[] { \"type\", \"id\", \"material\" };\n  }\n\n  public List<String> read(ItemStack i, List<String> output)  {\n   output.add(\"type:\" + i.getType().name());\n    return output;\n  }\n\n  public boolean isSimilar(ItemStack shop_item, ItemStack player_item, BSBuy buy, Player p)  {\n    return shop_item.getType() == player_item.getType();\n  }\n}复制代码\n\n监听器例子\n  @EventHandler\n  public void onRegister(BSRegisterTypesEvent event)  {\n    new ItemDataPartMaterial().register();\n  }复制代码\n\n\n",
    "replies": [
        {
            "author": "117779284",
            "timestamp": 1542180840,
            "txt_content": "你有没有用这个API做什么有意思的事情呢··"
        }
    ]
}