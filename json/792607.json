{
    "title": "关于更多武器mod的攻击距离",
    "author": "阿飞很开心",
    "replyCount": 0,
    "timestamp": 1524984120,
    "txt_content": " 本帖最后由 阿飞很开心 于 2018-4-29 14:42 编辑 \n\n心血来潮，重新翻出了我的更多武器mod源码，想要修复一些匪夷所思的问题，比如攻击距离。因为之前我试着把武器的攻击距离加成改成-1、+10、+100结果发现无法达到预期的效果。我觉得可能是这两段代码有问题。请大佬们帮我看一下如何去解决。\n这是与攻击距离相关的部分，貌似是用来触发攻击实体，其中调用了下面的getMouseOver函数\n\n        public void onPlayerTick(TickEvent.PlayerTickEvent e)\n        {\n\n……………………………………\n                                                float reach = ieri.getExtendedReach(e.player.worldObj, e.player, itemstack);\n                                                MovingObjectPosition mov = ExtendedReachHelper.getMouseOver(0, reach, e.player);\n\n                                                if (mov != null && mov.entityHit != null && mov.entityHit != e.player && mov.entityHit.hurtResistantTime == 0)\n                                                {\n                                                        FMLClientHandler.instance().getClient().playerController.attackEntity(e.player, mov.entityHit);\n                                                }\n\n        }\n参数frame是0（不清楚作者的用意是什么），dist是武器的面板上攻击范围增加值\n        public static MovingObjectPosition getMouseOver(float frame, float dist)\n        {\n                MovingObjectPosition mop = null;\n                if (mc.renderViewEntity != null)\n                {\n                        if (mc.theWorld != null)\n                        {\n                                double var2 = dist;\n                                mop = mc.renderViewEntity.rayTrace(var2, frame);\n                                double calcdist = var2;\n                                Vec3 pos = mc.renderViewEntity.getPosition(frame);\n                                var2 = calcdist;\n                                if (mop != null)\n                                {\n                                        calcdist = mop.hitVec.distanceTo(pos);\n                                }\n                                \n                                Vec3 lookvec = mc.renderViewEntity.getLook(frame);\n                                Vec3 var8 = pos.addVector(lookvec.xCoord * var2, lookvec.yCoord * var2, lookvec.zCoord * var2);\n                                Entity pointedEntity = null;\n                                float var9 = 1.0F;\n                                @SuppressWarnings(\"unchecked\")\n                                List<Entity> list = mc.theWorld.getEntitiesWithinAABBExcludingEntity(mc.renderViewEntity, mc.renderViewEntity.boundingBox.addCoord(lookvec.xCoord * var2, lookvec.yCoord * var2, lookvec.zCoord * var2).expand(var9, var9, var9));\n                                double d = calcdist;\n                                \n                                for (Entity entity : list)\n                                {\n                                        if (entity.canBeCollidedWith())\n                                        {\n                                                float bordersize = entity.getCollisionBorderSize();\n                                                AxisAlignedBB aabb = entity.boundingBox.expand(bordersize, bordersize, bordersize);\n                                                MovingObjectPosition mop0 = aabb.calculateIntercept(pos, var8);\n                                                \n                                                if (aabb.isVecInside(pos))\n                                                {\n                                                        if (0.0D < d || d == 0.0D)\n                                                        {\n                                                                pointedEntity = entity;\n                                                                d = 0.0D;\n                                                        }\n                                                } else if (mop0 != null)\n                                                {\n                                                        double d1 = pos.distanceTo(mop0.hitVec);\n                                                        \n                                                        if (d1 < d || d == 0.0D)\n                                                        {\n                                                                pointedEntity = entity;\n                                                                d = d1;\n                                                        }\n                                                }\n                                        }\n                                }\n                                \n                                if (pointedEntity != null && (d < calcdist || mop == null))\n                                {\n                                        mop = new MovingObjectPosition(pointedEntity);\n                                }\n                        }\n                }\n                return mop;\n        }\n\n",
    "replies": []
}