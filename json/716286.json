{
    "title": "[Bukkit][未知之域] JAVA机制-反射 反射如何绕过泛型检查？",
    "author": "qianji20000420",
    "replyCount": 3,
    "timestamp": 1501997940,
    "txt_content": " 本帖最后由 qianji20000420 于 2017-8-6 16:33 编辑 \n\n 导读 如何利用反射绕过泛型检查\n\n泛型什么是泛型？\n泛型是程序设计语言的一种特性。允许程序员在强类型程序设计语言中编写代码时定义一些可变部分，那些部分在使用前必须作出指明。各种程序设计语言和其编译器、运行环境对泛型的支持均不一样。将类型参数化以达到代码复用提高软件开发工作效率的一种数据类型。泛型类是引用类型，是堆对象，主要是引入了类型参数这个概念。(来自度娘百科) 这节课不讲泛型，想知道泛型的翻翻本版的其他教程。\n如何利用反射绕过泛型检查我们先写一个这样的代码\npublic class Demo_01 {\n        public static void main(String[] args){\n                ArrayList<Integer> array = new ArrayList<Integer>();\n                array.add(3);\n                \n        }\n}复制代码这当然是能够正常运行了\n但是如果下面我又写一个这个呢？\narray.add(\"eee\");复制代码程序就无法正常的编译了。\n但是我们想，事实上泛型的在运行时全都是Object类型 那我们何尝不可以用Object类型来获取？\nClass<?> c = array.getClass();\nMethod m = c.getMethod(\"add\", Object.class);复制代码然后用m来调用invoke方法，然后输出array\nm.invoke(array, \"ccc\");\nSystem.out.println(array);复制代码\n\n\n\n\n发放大风06.png (15.92 KB, 下载次数: 3)\n\n下载附件\n\n2017-8-6 13:38 上传\n\n\n\n\n\n那在没学反射之前的你会想到Integer的ArrayList可以加入String的元素吗？\n\n下一篇反射在Bukkit插件编写中的运用\n返回索引贴\n第一次做教程，如果教程中有遗漏的或说错的地方请及时指出哇。~\n感谢 @splt 大佬指出的错误，原文有错误的地方已改正\n\n[groupid=1181]Unknown Domain[/groupid]",
    "replies": [
        {
            "author": "云闪",
            "timestamp": 1502005500,
            "txt_content": "但是我们想，集合里add方法的参数是一个泛型，而泛型默认为Object类型 那我们何尝不可以用Object类型来获取？\n虽然思考方向好像没问题，但是你得说法很容易让人误以为下面这样写是可以获取add(Integer)方法的\nMethod m = c.getMethod(\"add\", Integer.class);\n\n然后\n程序就无法正常的运行了。\n不严谨，事实上是无法编译而非无法运行编译时会进行泛型检查，而由于泛型擦除，运行的时候反而没有泛型检查\n\n\n\n然后...绕过泛型检查直接强转就好了\n\nArrayList<Integer> array = new ArrayList<Integer>();\narray.add(3);\n((ArrayList<String>)(Object)array).add(\"test\");\nSystem.out.println(array);\n复制代码\n事实上泛型的在运行时全都是Object类型，如果你从集合里get出来的话，它会执行checkcast指令(相当于代码中的强转)，然后后续使用泛型类的代码就能正常运行"
        },
        {
            "author": "qianji20000420",
            "timestamp": 1502006940,
            "txt_content": "splt 发表于 2017-8-6 15:45\n虽然思考方向好像没问题，但是你得说法很容易让人误以为下面这样写是可以获取add(Integer)方法的\nMethod m ...\n感谢dalao指教。"
        },
        {
            "author": "l89669",
            "timestamp": 1603081440,
            "txt_content": "然后其他所有遍历这个list的代码全部崩溃了\n崩服代码get"
        }
    ]
}