{
    "title": "插件getScheduler问题（已自行解决）",
    "author": "1374004609",
    "replyCount": 1,
    "timestamp": 1564204560,
    "txt_content": " 本帖最后由 1374004609 于 2019-7-27 15:23 编辑 \n\npublic static void runs(Player p) {\n                PlayerData.loadConfig();\n                PlayerData.data.set(\"Temp.\" + p.getName() + \".Pro\", 1);\n                PlayerData.saveConfig();\n                taskId1 = Bukkit.getScheduler().scheduleSyncRepeatingTask(plugin, new Runnable() {\n                        private int time1 = Main.config.getInt(\"Setting.Pro.Time\");\n\n                        @Override\n                        public void run() {\n                        \n\n                                time1--;\n                                \n                                if(PlayerData.data.getInt(\"Temp.\" + p.getName() + \".Pro\") == 0){\n                                        Bukkit.getScheduler().cancelTask(taskId1);\n                                        return;\n                                }\n                                \n                                double maxheath = p.getMaxHealth();\n                                double entheath = p.getHealth();\n                                double heal = entheath + Main.config.getDouble(\"Setting.Pro.Heal\");\n                                if (heal > maxheath) {\n                                        if (entheath != 0){\n                                        p.setHealth(maxheath);\n                                        }\n                                } else {\n                                        if (entheath != 0){\n                                        p.setHealth(heal);\n                                        }\n                                }\n                                if (time1 <= 0) {\n\n                                        Bukkit.getScheduler().cancelTask(taskId1);\n                                        PlayerData.loadConfig();\n                                        PlayerData.data.set(\"Temp.\" + p.getName() + \".Pro\", 0);\n                                        PlayerData.saveConfig();\n                                        return;\n                                        \n                                }\n                        }\n                }, 5L, 20L);\n        }\n\n不会停止taskId1",
    "replies": [
        {
            "author": "1374004609",
            "timestamp": 1564212180,
            "txt_content": "public static void runs(Player p) {\n                PlayerData.loadConfig();\n                PlayerData.data.set(\"Temp.\" + p.getName() + \".Pro\", 1);\n                PlayerData.saveConfig();\n                taskId1 = Bukkit.getScheduler().scheduleSyncRepeatingTask(plugin, new Runnable() {\n                        int task = 0;\n                        private int time1 = Main.config.getInt(\"Setting.Pro.Time\");\n\n                        @Override\n                        public void run() {\n                        \n                                \n                                if (task == 0){\n                                task = taskId1;\n                                }\n\n                                time1--;\n                                \n                                if(PlayerData.data.getInt(\"Temp.\" + p.getName() + \".Pro\") == 0){\n                                        Bukkit.getScheduler().cancelTask(task);\n                                        return;\n                                }\n                                \n                                double maxheath = p.getMaxHealth();\n                                double entheath = p.getHealth();\n                                double heal = entheath + Main.config.getDouble(\"Setting.Pro.Heal\");\n                                if (heal > maxheath) {\n                                        if (entheath != 0){\n                                        p.setHealth(maxheath);\n                                        }\n                                } else {\n                                        if (entheath != 0){\n                                        p.setHealth(heal);\n                                        }\n                                }\n                                if (time1 <= 0) {\n\n                                        Bukkit.getScheduler().cancelTask(task);\n                                        PlayerData.loadConfig();\n                                        PlayerData.data.set(\"Temp.\" + p.getName() + \".Pro\", 0);\n                                        PlayerData.saveConfig();\n                                        return;\n                                        \n                                }\n                        }\n                }, 5L, 20L);\n        }\n\n问题已解决将taskId1转换成固定的task线程号来终止\n"
        }
    ]
}