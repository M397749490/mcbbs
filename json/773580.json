{
    "title": "如何创建+保存一个属于玩家的仓库？",
    "author": "摇摇车",
    "replyCount": 6,
    "timestamp": 1514708280,
    "txt_content": "如题，如何创建+保存一个玩家的仓库？\n求代码讲解，如果代码大量的，懒得写的话\n直接告诉我思路就好",
    "replies": [
        {
            "author": "鸭蛋只吃黄",
            "timestamp": 1514710680,
            "txt_content": "需要nms\n基本原理是逐个储存物品栏中的每个物品(以及他们所在的位置)\n使用到的主要类是\nItamStack和NBTCompressedStreamTools\n他们的功能类名说的很清楚了\n后者有一个a方法,将信息读进流中\n\n最后建议楼主把读到的nbt信息Base64编码一下,可以避免很多麻烦"
        },
        {
            "author": "摇摇车",
            "timestamp": 1514711100,
            "txt_content": "凋灵兔子 发表于 2017-12-31 16:58\n需要nms\n基本原理是逐个储存物品栏中的每个物品(以及他们所在的位置)\n使用到的主要类是\n不懂\n有时间么？ 给个例子吧？"
        },
        {
            "author": "耗子",
            "timestamp": 1514728980,
            "txt_content": "首先使用Bukkit.createInventory创建一个容器\n然后player.openInventory让玩家打开这个容器\n接下来监听事件InventoryCloseEvent\n当触发事件时调用inventory.getContent将所有内容用一个foreach保存到玩家的配置文件里面"
        },
        {
            "author": "2280761425",
            "timestamp": 1515328980,
            "txt_content": "【刚好做过这种插件】\n先说说我的方法吧，我是直接用nms保存nbt的【个人感觉也就这个方法比较好】\n不过自定义物品栏并没有直接提供获取nbt的方法，所以需要自己把每个物品的nbt存在一个nbt列表里\n代码过长并且不是java写的我就不发了"
        },
        {
            "author": "2280761425",
            "timestamp": 1515329160,
            "txt_content": "2280761425 发表于 2018-1-7 20:43\n【刚好做过这种插件】\n先说说我的方法吧，我是直接用nms保存nbt的【个人感觉也就这个方法比较好】\n不过自定 ...\n刚刚看了下，其实还是有用java写的，相比于nbt，这个不是特别满意\nhttps://pan.baidu.com/s/1o8klz5o"
        },
        {
            "author": "2280761425",
            "timestamp": 1515329400,
            "txt_content": "dmFyIGludmVudG9yeTsKdmFyIGl0ZW1TdGFjazsKdmFyIG5idHRhZzsKdmFyIG5idHRhYjsKdmFyIHNpemU7CnZhciB0aXRsZTsKdmFyIHBsYXllcjsKdmFyIGFwaU5hbWU7CnZhciBsaXN0Owp2YXIgaXRlbXM7CnZhciBVc2luZ0ludmVudG9yeTsKdmFyIG5ld0xpc3Q7CnZhciBubXM7CnZhciBCYWNrcGFja3M7CnZhciBpdGVtTmJ0TGlzdDsKdmFyIGxvcmVMaXN0Owp2YXIgaTsKdmFyIHV1aWQ7CnZhciBiYWNrcGFja0luZm87CnZhciBpdGVtU3RhY2tUYWc7CnZhciBiYWNrUGFjazsKdmFyIGJhY2twYWNrTmJ0Owp2YXIgYmFja3BhY2tJbnZlbnRvcnk7CgpmdW5jdGlvbiBpbml0KCkgewogIFVzaW5nSW52ZW50b3J5ID0gW107CiAgQmFja3BhY2tzID0gewogICAgJ+aXheihjOiAheiDjOWMhScgOiB7CiAgICAgICdtYXRlcmlhbCcgOiBwdnBpbl9tYXRlcmlhbC5DSEVTVCwKICAgICAgJ3NpemUnIDogNTQsCiAgICAgICduYW1lJyA6ICfCpzbCp2zml4XooYzogIXog4zljIUnLAogICAgICAnbG9yZScgOiBbJ8KnMuagueaNruacgOaWsOeahOepuumXtOWtpuaIkOaenOWItuaIkCcsICfCpzLlhbfmnInotoXlpKflrrnph48nXSwKICAgICAgJ2dlbmVyYXRlVVVJRCcgOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gKChwdnBpbl9qX3V0aWwuVVVJRC5yYW5kb21VVUlEKCkudG9TdHJpbmcoKS5zcGxpdCgnLScpKS5qb2luKCcnKSk7CiAgICAgIH0KICAgIH0KICB9Owp9CgpmdW5jdGlvbiBldmVudExvYWQoKSB7CiAgZXZlbnRzLnBsX3BsYXllckludGVyYWN0KCBmdW5jdGlvbiggZXZlbnQgKSB7CiAgICBpZiAoZXZlbnQuZ2V0QWN0aW9uKCkgPT0gcHZwaW5fZXZlbnQuYmxvY2suQWN0aW9uLlJJR0hUX0NMSUNLX0FJUiB8fCBldmVudC5nZXRBY3Rpb24oKSA9PSBwdnBpbl9ldmVudC5ibG9jay5BY3Rpb24uUklHSFRfQ0xJQ0tfQkxPQ0spIHsKICAgICAgaWYgKGV2ZW50Lmhhc0l0ZW0oKSkgewogICAgICAgIHZhciBiYWNrcGFja0luZm8gPSAoZ2V0QmFja3BhY2tJbmZvKGV2ZW50LmdldEl0ZW0oKSkpOwogICAgICAgIGlmIChiYWNrcGFja0luZm8gIT0gbnVsbCkgewogICAgICAgICAgZXZlbnQuc2V0Q2FuY2VsbGVkKHRydWUpOwogICAgICAgICAgdmFyIGludmVudG9yeSA9IChjcmVhdGVJbnZlbnRvcnlCeU5idChiYWNrcGFja0luZm9bJ2l0ZW1zJ10sIGJhY2twYWNrSW5mb1snc2l6ZSddLCBTdHJpbmcoKGV2ZW50LmdldEl0ZW0oKS5nZXRJdGVtTWV0YSgpID09IG51bGwgPyBudWxsIDogZXZlbnQuZ2V0SXRlbSgpLmdldEl0ZW1NZXRhKCkuZ2V0RGlzcGxheU5hbWUoKSkgPT0gbnVsbCA/IGJhY2twYWNrSW5mb1snbmFtZSddIDogKGV2ZW50LmdldEl0ZW0oKS5nZXRJdGVtTWV0YSgpID09IG51bGwgPyBudWxsIDogZXZlbnQuZ2V0SXRlbSgpLmdldEl0ZW1NZXRhKCkuZ2V0RGlzcGxheU5hbWUoKSkpICsgU3RyaW5nKGJhY2twYWNrSW5mb1sndXVpZCddICE9IG51bGwgPyBTdHJpbmcoJ8KnciAtICcpICsgU3RyaW5nKGJhY2twYWNrSW5mb1sndXVpZCddKSA6ICcnKSwgZXZlbnQuZ2V0UGxheWVyKCkpKTsKICAgICAgICAgIFVzaW5nSW52ZW50b3J5LnB1c2goewogICAgICAgICAgICAnaW52ZW50b3J5JyA6IGludmVudG9yeSwKICAgICAgICAgICAgJ2JhY2twYWNrJyA6IGV2ZW50LmdldEl0ZW0oKSwKICAgICAgICAgICAgJ3BsYXllcicgOiBldmVudC5nZXRQbGF5ZXIoKS5nZXROYW1lKCkKICAgICAgICAgIH0pOwogICAgICAgICAgZXZlbnQuZ2V0UGxheWVyKCkub3BlbkludmVudG9yeShpbnZlbnRvcnkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICB9LG1lKTsKICBldmVudHMucGxfaW52ZW50b3J5Q2xvc2UoIGZ1bmN0aW9uKCBldmVudCApIHsKICAgIGlmIChldmVudC5nZXRJbnZlbnRvcnkoKSAhPSBudWxsKSB7CiAgICAgIGlmICghKCFVc2luZ0ludmVudG9yeS5sZW5ndGgpKSB7CiAgICAgICAgdmFyIGlfZW5kID0gVXNpbmdJbnZlbnRvcnkubGVuZ3RoOwogICAgICAgIHZhciBpX2luYyA9IDE7CiAgICAgICAgaWYgKDEgPiBpX2VuZCkgewogICAgICAgICAgaV9pbmMgPSAtaV9pbmM7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDE7CiAgICAgICAgICAgICBpX2luYyA+PSAwID8gaSA8PSBpX2VuZCA6IGkgPj0gaV9lbmQ7CiAgICAgICAgICAgICBpICs9IGlfaW5jKSB7CiAgICAgICAgICBpZiAoZXZlbnQuZ2V0SW52ZW50b3J5KCkuZ2V0TmFtZSgpID09IChVc2luZ0ludmVudG9yeVtpIC0gMV0pWydpbnZlbnRvcnknXS5nZXROYW1lKCkpIHsKICAgICAgICAgICAgdmFyIGJhY2twYWNrSW52ZW50b3J5ID0gKFVzaW5nSW52ZW50b3J5LnNwbGljZShpIC0gMSwgMSlbMF0pOwogICAgICAgICAgICBzZXRCYWNrcGFja0l0ZW1zKGJhY2twYWNrSW52ZW50b3J5WydiYWNrcGFjayddLCBzYXZlSW52ZW50b3J5SXRlbVN0YWNrKGV2ZW50LmdldEludmVudG9yeSgpKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICB9LG1lKTsKICBldmVudHMucGxfaW52ZW50b3J5Q2xpY2soIGZ1bmN0aW9uKCBldmVudCApIHsKICAgIGlmIChldmVudC5nZXRDbGlja2VkSW52ZW50b3J5KCkgIT0gbnVsbCkgewogICAgICBpZiAoZXZlbnQuZ2V0Q3VycmVudEl0ZW0oKSAhPSBudWxsKSB7CiAgICAgICAgaWYgKCEoIVVzaW5nSW52ZW50b3J5Lmxlbmd0aCkpIHsKICAgICAgICAgIHZhciBpX2VuZDIgPSBVc2luZ0ludmVudG9yeS5sZW5ndGg7CiAgICAgICAgICB2YXIgaV9pbmMyID0gMTsKICAgICAgICAgIGlmICgxID4gaV9lbmQyKSB7CiAgICAgICAgICAgIGlfaW5jMiA9IC1pX2luYzI7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGkgPSAxOwogICAgICAgICAgICAgICBpX2luYzIgPj0gMCA/IGkgPD0gaV9lbmQyIDogaSA+PSBpX2VuZDI7CiAgICAgICAgICAgICAgIGkgKz0gaV9pbmMyKSB7CiAgICAgICAgICAgIGlmIChldmVudC5nZXRDbGlja2VkSW52ZW50b3J5KCkuZ2V0TmFtZSgpID09IChVc2luZ0ludmVudG9yeVtpIC0gMV0pWydpbnZlbnRvcnknXS5nZXROYW1lKCkpIHsKICAgICAgICAgICAgICB2YXIgdXVpZCA9IChnZXRCYWNrcGFja0luZm8oKFVzaW5nSW52ZW50b3J5W2kgLSAxXSlbJ2JhY2twYWNrJ10pKVsndXVpZCddOwogICAgICAgICAgICAgIGlmICh1dWlkID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICgoZ2V0QmFja3BhY2tJbmZvKGV2ZW50LmdldEN1cnJlbnRJdGVtKCkpKVsndXVpZCddID09IHV1aWQpIHsKICAgICAgICAgICAgICAgICAgZXZlbnQuc2V0Q2FuY2VsbGVkKHRydWUpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgfSxtZSk7CiAgZXZlbnRzLnBsX2ludmVudG9yeURyYWcoIGZ1bmN0aW9uKCBldmVudCApIHsKICAgIGlmIChldmVudC5nZXRJbnZlbnRvcnkoKSAhPSBudWxsKSB7CiAgICAgIGlmIChldmVudC5nZXRDdXJzb3IoKSAhPSBudWxsIHx8IGV2ZW50LmdldE9sZEN1cnNvcigpICE9IG51bGwpIHsKICAgICAgICBpZiAoISghVXNpbmdJbnZlbnRvcnkubGVuZ3RoKSkgewogICAgICAgICAgdmFyIGlfZW5kMyA9IFVzaW5nSW52ZW50b3J5Lmxlbmd0aDsKICAgICAgICAgIHZhciBpX2luYzMgPSAxOwogICAgICAgICAgaWYgKDEgPiBpX2VuZDMpIHsKICAgICAgICAgICAgaV9pbmMzID0gLWlfaW5jMzsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoaSA9IDE7CiAgICAgICAgICAgICAgIGlfaW5jMyA+PSAwID8gaSA8PSBpX2VuZDMgOiBpID49IGlfZW5kMzsKICAgICAgICAgICAgICAgaSArPSBpX2luYzMpIHsKICAgICAgICAgICAgaWYgKGV2ZW50LmdldEludmVudG9yeSgpLmdldE5hbWUoKSA9PSAoVXNpbmdJbnZlbnRvcnlbaSAtIDFdKVsnaW52ZW50b3J5J10uZ2V0TmFtZSgpKSB7CiAgICAgICAgICAgICAgdmFyIHV1aWQgPSAoZ2V0QmFja3BhY2tJbmZvKChVc2luZ0ludmVudG9yeVtpIC0gMV0pWydiYWNrcGFjayddKSlbJ3V1aWQnXTsKICAgICAgICAgICAgICBpZiAodXVpZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoKGdldEJhY2twYWNrSW5mbyhldmVudC5nZXRDdXJzb3IoKSkpWyd1dWlkJ10gPT0gdXVpZCB8fCAoZ2V0QmFja3BhY2tJbmZvKGV2ZW50LmdldE9sZEN1cnNvcigpKSlbJ3V1aWQnXSA9PSB1dWlkKSB7CiAgICAgICAgICAgICAgICAgIGV2ZW50LnNldENhbmNlbGxlZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgIH0sbWUpOwogIGV2ZW50cy5wbF9wbGF5ZXJEcm9wSXRlbSggZnVuY3Rpb24oIGV2ZW50ICkgewogICAgaWYgKChldmVudC5nZXRJdGVtRHJvcCgpID09IG51bGwgPyBudWxsIDogZXZlbnQuZ2V0SXRlbURyb3AoKS5nZXRJdGVtU3RhY2soKSkgIT0gbnVsbCkgewogICAgICBpZiAoISghVXNpbmdJbnZlbnRvcnkubGVuZ3RoKSkgewogICAgICAgIHZhciBpX2VuZDQgPSBVc2luZ0ludmVudG9yeS5sZW5ndGg7CiAgICAgICAgdmFyIGlfaW5jNCA9IDE7CiAgICAgICAgaWYgKDEgPiBpX2VuZDQpIHsKICAgICAgICAgIGlfaW5jNCA9IC1pX2luYzQ7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDE7CiAgICAgICAgICAgICBpX2luYzQgPj0gMCA/IGkgPD0gaV9lbmQ0IDogaSA+PSBpX2VuZDQ7CiAgICAgICAgICAgICBpICs9IGlfaW5jNCkgewogICAgICAgICAgdmFyIHV1aWQgPSAoZ2V0QmFja3BhY2tJbmZvKChVc2luZ0ludmVudG9yeVtpIC0gMV0pWydiYWNrcGFjayddKSlbJ3V1aWQnXTsKICAgICAgICAgIGlmICh1dWlkICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKChnZXRCYWNrcGFja0luZm8oKGV2ZW50LmdldEl0ZW1Ecm9wKCkgPT0gbnVsbCA/IG51bGwgOiBldmVudC5nZXRJdGVtRHJvcCgpLmdldEl0ZW1TdGFjaygpKSkpWyd1dWlkJ10gPT0gdXVpZCkgewogICAgICAgICAgICAgIGV2ZW50LmdldFBsYXllcigpLmNsb3NlSW52ZW50b3J5KCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgfSxtZSk7Cn0KCmZ1bmN0aW9uIG1haW4oKSB7CiAgaW5pdCgpOwogIGV2ZW50TG9hZCgpOwogIC8vIOa1i+ivlQogIGV2ZW50cy5wbF9wbGF5ZXJDb21tYW5kUHJlcHJvY2VzcyggZnVuY3Rpb24oIGV2ZW50ICkgewogICAgaWYgKGV2ZW50LmdldE1lc3NhZ2UoKSA9PSAnL2JhY2twYWNrIHRlc3QnKSB7CiAgICAgIGV2ZW50LmdldFBsYXllcigpLmdldEludmVudG9yeSgpLmFkZEl0ZW0oWyhjcmVhdGVCYWNrcGFjaygn5peF6KGM6ICF6IOM5YyFJykpXSk7CiAgICAgIGV2ZW50LnNldENhbmNlbGxlZCh0cnVlKTsKICAgIH0KICAgfSxtZSwnTk9STUFMJyk7Cn0KCmZ1bmN0aW9uIHNhdmVJbnZlbnRvcnlJdGVtU3RhY2soaW52ZW50b3J5KSB7CiAgaWYgKGludmVudG9yeSAhPSBudWxsKSB7CiAgICB2YXIgaXRlbU5idExpc3QgPSBuZXcgUGFja2FnZXMubmV0Lm1pbmVjcmFmdC5zZXJ2ZXJbcHZwaW5fc2VydmVyLmdldFNlcnZlcigpLmdldENsYXNzKCkuZ2V0UGFja2FnZSgpLmdldE5hbWUoKS5zcGxpdCgiLiIpWzNdXS5OQlRUYWdMaXN0KCk7CiAgICB2YXIgaV9lbmQ1ID0gaW52ZW50b3J5LmdldFNpemUoKSAtIDE7CiAgICB2YXIgaV9pbmM1ID0gMTsKICAgIGlmICgwID4gaV9lbmQ1KSB7CiAgICAgIGlfaW5jNSA9IC1pX2luYzU7CiAgICB9CiAgICBmb3IgKGkgPSAwOwogICAgICAgICBpX2luYzUgPj0gMCA/IGkgPD0gaV9lbmQ1IDogaSA+PSBpX2VuZDU7CiAgICAgICAgIGkgKz0gaV9pbmM1KSB7CiAgICAgIGlmIChpbnZlbnRvcnkuZ2V0SXRlbShpKSAhPSBudWxsKSB7CiAgICAgICAgdmFyIGl0ZW1TdGFja1RhZyA9IChzYXZlSXRlbVN0YWNrKGludmVudG9yeS5nZXRJdGVtKGkpLCBuZXcgUGFja2FnZXMubmV0Lm1pbmVjcmFmdC5zZXJ2ZXJbcHZwaW5fc2VydmVyLmdldFNlcnZlcigpLmdldENsYXNzKCkuZ2V0UGFja2FnZSgpLmdldE5hbWUoKS5zcGxpdCgiLiIpWzNdXS5OQlRUYWdDb21wb3VuZCgpKSk7CiAgICAgICAgaXRlbVN0YWNrVGFnLnNldEJ5dGUoJ1Nsb3QnLGkpOwogICAgICAgIGl0ZW1OYnRMaXN0LmFkZChpdGVtU3RhY2tUYWcpCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBpdGVtTmJ0TGlzdDsKICB9CiAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIHNhdmVJdGVtU3RhY2soaXRlbVN0YWNrLCBuYnR0YWcpIHsKICBpZiAoaXRlbVN0YWNrICE9IG51bGwpIHsKICAgIHJldHVybiBvcmcuYnVra2l0LmNyYWZ0YnVra2l0W3B2cGluX3NlcnZlci5nZXRTZXJ2ZXIoKS5nZXRDbGFzcygpLmdldFBhY2thZ2UoKS5nZXROYW1lKCkuc3BsaXQoIi4iKVszXV0uaW52ZW50b3J5LkNyYWZ0SXRlbVN0YWNrLmFzTk1TQ29weShpdGVtU3RhY2spLnNhdmUobmJ0dGFnKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUludmVudG9yeUJ5TmJ0KG5idHRhYiwgc2l6ZSwgdGl0bGUsIHBsYXllcikgewogIHZhciBpbnZlbnRvcnkgPSBwdnBpbl9zZXJ2ZXIuY3JlYXRlSW52ZW50b3J5KHBsYXllciwgc2l6ZSwgdGl0bGUpOwogIGlmIChuYnR0YWIgIT0gbnVsbCAmJiAhbmJ0dGFiLmlzRW1wdHkoKSkgewogICAgdmFyIGlfZW5kNiA9IG5idHRhYi5zaXplKCkgLSAxOwogICAgdmFyIGlfaW5jNiA9IDE7CiAgICBpZiAoMCA+IGlfZW5kNikgewogICAgICBpX2luYzYgPSAtaV9pbmM2OwogICAgfQogICAgZm9yIChpID0gMDsKICAgICAgICAgaV9pbmM2ID49IDAgPyBpIDw9IGlfZW5kNiA6IGkgPj0gaV9lbmQ2OwogICAgICAgICBpICs9IGlfaW5jNikgewogICAgICBpbnZlbnRvcnkuc2V0SXRlbShuYnR0YWIuZ2V0KGkpLmdldEJ5dGUoJ1Nsb3QnKSwobG9hZEl0ZW1TdGFjayhuYnR0YWIuZ2V0KGkpKSkpOwogICAgfQogIH0KICByZXR1cm4gaW52ZW50b3J5Owp9CgpmdW5jdGlvbiBpdGVtU3RhY2tfYWxsX3BhcmFtZXRlcih0eXBlLGFtb3VudCxkYW1hZ2UsbmFtZSxsb3JlKSB7CiB2YXIgaXRlbVN0YWNrID0gbmV3IHB2cGluX2ludmVudG9yeV9wZy5JdGVtU3RhY2sodHlwZSxhbW91bnQpOwogaWYgKGRhbWFnZSAhPSBudWxsKXsKICAgaXRlbVN0YWNrLnNldER1cmFiaWxpdHkoZGFtYWdlKTsKIH0KIGlmIChuYW1lICE9IG51bGwpIHsKICAgdmFyIGl0ZW1NZXRhID0gaXRlbVN0YWNrLmdldEl0ZW1NZXRhKCk7CiAgIGl0ZW1NZXRhLnNldERpc3BsYXlOYW1lKG5hbWUpOwogICBpdGVtU3RhY2suc2V0SXRlbU1ldGEoaXRlbU1ldGEpOwogfQogaWYgKGxvcmUgIT0gbnVsbCkgewogICB2YXIgaXRlbU1ldGEgPSBpdGVtU3RhY2suZ2V0SXRlbU1ldGEoKTsKICAgaXRlbU1ldGEuc2V0TG9yZShwdnBpbl9hcnJheXMuYXNMaXN0KGxvcmUpKTsKICAgaXRlbVN0YWNrLnNldEl0ZW1NZXRhKGl0ZW1NZXRhKTsKIH0KICByZXR1cm4gaXRlbVN0YWNrOwp9CgpmdW5jdGlvbiBjcmVhdGVCYWNrcGFjayhhcGlOYW1lKSB7CiAgaWYgKEJhY2twYWNrc1thcGlOYW1lXSAhPSBudWxsKSB7CiAgICB2YXIgbG9yZUxpc3QgPSAobGlzdENvcHkoQmFja3BhY2tzW2FwaU5hbWVdWydsb3JlJ10pKTsKICAgIHZhciB1dWlkID0gbnVsbDsKICAgIGlmICgodHlwZW9mKEJhY2twYWNrc1thcGlOYW1lXS5nZW5lcmF0ZVVVSUQpPT0iZnVuY3Rpb24iKSkgewogICAgICB1dWlkID0gQmFja3BhY2tzW2FwaU5hbWVdWydnZW5lcmF0ZVVVSUQnXSgpOwogICAgICBpZiAobG9yZUxpc3QgPT0gbnVsbCkgewogICAgICAgIGxvcmVMaXN0ID0gW107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9yZUxpc3QucHVzaCgnJyk7CiAgICAgIH0KICAgICAgbG9yZUxpc3QucHVzaCh1dWlkKTsKICAgIH0KICAgIHZhciBiYWNrUGFjayA9IChpdGVtU3RhY2tfYWxsX3BhcmFtZXRlcihCYWNrcGFja3NbYXBpTmFtZV1bJ21hdGVyaWFsJ10sIDEsIChCYWNrcGFja3NbYXBpTmFtZV1bJ2RhdGEnXSA9PSBudWxsID8gbnVsbCA6IEJhY2twYWNrc1thcGlOYW1lXVsnZGF0YSddKSwgKEJhY2twYWNrc1thcGlOYW1lXVsnbmFtZSddID09IG51bGwgPyBudWxsIDogQmFja3BhY2tzW2FwaU5hbWVdWyduYW1lJ10pLCBsb3JlTGlzdCkpOwogICAgdmFyIG5tcyA9IG9yZy5idWtraXQuY3JhZnRidWtraXRbcHZwaW5fc2VydmVyLmdldFNlcnZlcigpLmdldENsYXNzKCkuZ2V0UGFja2FnZSgpLmdldE5hbWUoKS5zcGxpdCgiLiIpWzNdXS5pbnZlbnRvcnkuQ3JhZnRJdGVtU3RhY2suYXNOTVNDb3B5KGJhY2tQYWNrKTsKICAgIGlmICghbm1zLmhhc1RhZygpKSB7CiAgICAgIG5tcy5zZXRUYWcobmV3IFBhY2thZ2VzLm5ldC5taW5lY3JhZnQuc2VydmVyW3B2cGluX3NlcnZlci5nZXRTZXJ2ZXIoKS5nZXRDbGFzcygpLmdldFBhY2thZ2UoKS5nZXROYW1lKCkuc3BsaXQoIi4iKVszXV0uTkJUVGFnQ29tcG91bmQoKSk7CiAgICB9CiAgICBubXMuZ2V0VGFnKCkuc2V0KCdCYWNrcGFjaycsbmV3IFBhY2thZ2VzLm5ldC5taW5lY3JhZnQuc2VydmVyW3B2cGluX3NlcnZlci5nZXRTZXJ2ZXIoKS5nZXRDbGFzcygpLmdldFBhY2thZ2UoKS5nZXROYW1lKCkuc3BsaXQoIi4iKVszXV0uTkJUVGFnQ29tcG91bmQoKSk7CiAgICBubXMuZ2V0VGFnKCkuZ2V0KCdCYWNrcGFjaycpLnNldFN0cmluZygnbmFtZScsYXBpTmFtZSk7CiAgICBubXMuZ2V0VGFnKCkuZ2V0KCdCYWNrcGFjaycpLnNldEJ5dGUoJ3NpemUnLEJhY2twYWNrc1thcGlOYW1lXVsnc2l6ZSddKTsKICAgIGlmICh1dWlkICE9IG51bGwpIHsKICAgICAgbm1zLmdldFRhZygpLmdldCgnQmFja3BhY2snKS5zZXRTdHJpbmcoJ3V1aWQnLHV1aWQpOwogICAgfQogICAgcmV0dXJuIG9yZy5idWtraXQuY3JhZnRidWtraXRbcHZwaW5fc2VydmVyLmdldFNlcnZlcigpLmdldENsYXNzKCkuZ2V0UGFja2FnZSgpLmdldE5hbWUoKS5zcGxpdCgiLiIpWzNdXS5pbnZlbnRvcnkuQ3JhZnRJdGVtU3RhY2suYXNDcmFmdE1pcnJvcihubXMpOwogIH0KICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gbGlzdENvcHkobGlzdCkgewogIGlmIChsaXN0ID09IG51bGwpIHsKICAgIHJldHVybiBudWxsOwogIH0KICB2YXIgbmV3TGlzdCA9IFtdOwogIGZvciAodmFyIGlfaW5kZXggaW4gbGlzdCkgewogICAgaSA9IGxpc3RbaV9pbmRleF07CiAgICBuZXdMaXN0LnB1c2goaSk7CiAgfQogIHJldHVybiBuZXdMaXN0Owp9CgpmdW5jdGlvbiBsb2FkSXRlbVN0YWNrKG5idHRhZykgewogIGlmIChuYnR0YWcgIT0gbnVsbCkgewogICAgdmFyIG5tcyA9IG5ldyBQYWNrYWdlcy5uZXQubWluZWNyYWZ0LnNlcnZlci52MV8xMV9SMS5JdGVtU3RhY2sobmJ0dGFnKTsKICAgIHJldHVybiBvcmcuYnVra2l0LmNyYWZ0YnVra2l0W3B2cGluX3NlcnZlci5nZXRTZXJ2ZXIoKS5nZXRDbGFzcygpLmdldFBhY2thZ2UoKS5nZXROYW1lKCkuc3BsaXQoIi4iKVszXV0uaW52ZW50b3J5LkNyYWZ0SXRlbVN0YWNrLmFzQ3JhZnRNaXJyb3Iobm1zKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIGdldEJhY2twYWNrSW5mbyhpdGVtU3RhY2spIHsKICBpZiAoaXRlbVN0YWNrICE9IG51bGwpIHsKICAgIHZhciBubXMgPSBvcmcuYnVra2l0LmNyYWZ0YnVra2l0W3B2cGluX3NlcnZlci5nZXRTZXJ2ZXIoKS5nZXRDbGFzcygpLmdldFBhY2thZ2UoKS5nZXROYW1lKCkuc3BsaXQoIi4iKVszXV0uaW52ZW50b3J5LkNyYWZ0SXRlbVN0YWNrLmFzTk1TQ29weShpdGVtU3RhY2spOwogICAgaWYgKG5tcy5oYXNUYWcoKSkgewogICAgICB2YXIgbmJ0dGFnID0gbm1zLmdldFRhZygpOwogICAgICBpZiAobmJ0dGFnLmhhc0tleSgnQmFja3BhY2snKSkgewogICAgICAgIHZhciBiYWNrcGFja05idCA9IG5idHRhZy5nZXQoJ0JhY2twYWNrJyk7CiAgICAgICAgdmFyIGJhY2twYWNrSW5mbyA9IHsKICAgICAgICAgICduYW1lJyA6IGJhY2twYWNrTmJ0LmdldFN0cmluZygnbmFtZScpLAogICAgICAgICAgJ3NpemUnIDogYmFja3BhY2tOYnQuZ2V0Qnl0ZSgnc2l6ZScpCiAgICAgICAgfTsKICAgICAgICBpZiAoYmFja3BhY2tOYnQuaGFzS2V5KCd1dWlkJykpIHsKICAgICAgICAgIGJhY2twYWNrSW5mb1sndXVpZCddID0gYmFja3BhY2tOYnQuZ2V0U3RyaW5nKCd1dWlkJyk7CiAgICAgICAgfQogICAgICAgIGlmIChiYWNrcGFja05idC5oYXNLZXkoJ0l0ZW1zJykpIHsKICAgICAgICAgIGJhY2twYWNrSW5mb1snaXRlbXMnXSA9IGJhY2twYWNrTmJ0LmdldCgnSXRlbXMnKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhY2twYWNrSW5mbzsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gc2V0QmFja3BhY2tJdGVtcyhpdGVtU3RhY2ssIGl0ZW1zKSB7CiAgdmFyIG5tcyA9IG9yZy5idWtraXQuY3JhZnRidWtraXRbcHZwaW5fc2VydmVyLmdldFNlcnZlcigpLmdldENsYXNzKCkuZ2V0UGFja2FnZSgpLmdldE5hbWUoKS5zcGxpdCgiLiIpWzNdXS5pbnZlbnRvcnkuQ3JhZnRJdGVtU3RhY2suYXNOTVNDb3B5KGl0ZW1TdGFjayk7CiAgaWYgKG5tcy5oYXNUYWcoKSkgewogICAgdmFyIG5idHRhZyA9IG5tcy5nZXRUYWcoKTsKICAgIGlmIChuYnR0YWcuaGFzS2V5KCdCYWNrcGFjaycpKSB7CiAgICAgIHZhciBiYWNrcGFja05idCA9IG5idHRhZy5nZXQoJ0JhY2twYWNrJyk7CiAgICAgIGlmIChpdGVtcyA9PSBudWxsKSB7CiAgICAgICAgaWYgKGJhY2twYWNrTmJ0Lmhhc0tleSgnSXRlbXMnKSkgewogICAgICAgICAgYmFja3BhY2tOYnQucmVtb3ZlKCdJdGVtcycpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBiYWNrcGFja05idC5zZXQoJ0l0ZW1zJyxpdGVtcyk7CiAgICAgIH0KICAgIH0KICB9CiAgaXRlbVN0YWNrLnNldEl0ZW1NZXRhKG9yZy5idWtraXQuY3JhZnRidWtraXRbcHZwaW5fc2VydmVyLmdldFNlcnZlcigpLmdldENsYXNzKCkuZ2V0UGFja2FnZSgpLmdldE5hbWUoKS5zcGxpdCgiLiIpWzNdXS5pbnZlbnRvcnkuQ3JhZnRJdGVtU3RhY2suYXNDcmFmdE1pcnJvcihubXMpLmdldEl0ZW1NZXRhKCkpOwp9\n\n\n想了想还是发了吧，用base64压缩了一下"
        }
    ]
}