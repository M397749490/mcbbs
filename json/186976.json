{
    "title": "【1.4.7mod制作】求助，自己做的Entity的问题",
    "author": "心灵骑士·杰",
    "replyCount": 15,
    "timestamp": 1382250240,
    "txt_content": " 本帖最后由 心灵骑士·杰 于 2013-10-20 15:48 编辑 \n\n每次读取地图之后，自己做的Entity总会消失。我看了自己的Entity的代码，跟原有的Entity代码相比，没发现缺少的关键代码。\n\n我是用EntityEnderCrystal、RenderEntityCrystal、ModelEntityBlaze的代码复制的。\n\n真心求助。\n 补充：\n\n\n2013-10-20 15:45:17 [信息] [STDERR] java.lang.NoSuchMethodException: net.minecraft.entity.item.EntityPaddleWheel.<init>(net.minecraft.world.World)\n2013-10-20 15:45:17 [信息] [STDERR]  at java.lang.Class.getConstructor0(Class.java:2715)\n2013-10-20 15:45:17 [信息] [STDERR]  at java.lang.Class.getConstructor(Class.java:1659)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.entity.EntityList.createEntityFromNBT(EntityList.java:139)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.world.chunk.storage.AnvilChunkLoader.readChunkFromNBT(AnvilChunkLoader.java:401)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.world.chunk.storage.AnvilChunkLoader.checkedReadChunkFromNBT(AnvilChunkLoader.java:103)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.world.chunk.storage.AnvilChunkLoader.loadChunk(AnvilChunkLoader.java:83)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.world.gen.ChunkProviderServer.safeLoadChunk(ChunkProviderServer.java:182)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.world.gen.ChunkProviderServer.loadChunk(ChunkProviderServer.java:118)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.server.MinecraftServer.initialWorldChunkLoad(MinecraftServer.java:310)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.server.integrated.IntegratedServer.loadAllWorlds(IntegratedServer.java:84)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.server.integrated.IntegratedServer.startServer(IntegratedServer.java:101)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.server.MinecraftServer.run(MinecraftServer.java:458)\n2013-10-20 15:45:17 [信息] [STDERR]  at net.minecraft.server.ThreadMinecraftServer.run(ThreadMinecraftServer.java:16)\n2013-10-20 15:45:17 [信息] [STDOUT] Skipping Entity with id PaddleWheel\n\n\n这是错误信息。。。我正在看代码，如果谁比我先知道那么请请教一下吧",
    "replies": [
        {
            "author": "yuxuanchiadm",
            "timestamp": 1382250240,
            "txt_content": " 本帖最后由 yuxuanchiadm 于 2013-10-23 14:52 编辑 \n心灵骑士·杰 发表于 2013-10-23 14:14 \n另外顺便问下，联机玩的时候，什么时候读写NBT\n基本是在加载和保存Chunk的时候读写NBT，当然TileEntity的NBT读写是在Chunk里有个boolean来决定是否保存TileEntity的数据，当TilEntity有改动时要设这个值为true，否则除非在关闭服务器前这个Chunk有其他东西把这个boolean设为true，否则不会保存。\n\n另外同步到客户端是在Chunk加载的时候。如果NBT数据有改动，需要自己的逻辑来同步。"
        },
        {
            "author": "jjxxz2",
            "timestamp": 1382260380,
            "txt_content": "卧槽，自己做生物么（还是实体\n不会编程的跪了"
        },
        {
            "author": "饕餮魍魉枭蹀躞",
            "timestamp": 1382261220,
            "txt_content": "你把错误的那行代码写出来啊"
        },
        {
            "author": "心灵骑士·杰",
            "timestamp": 1382264820,
            "txt_content": "饕餮魍魉枭蹀躞 发表于 2013-10-20 17:27 \n你把错误的那行代码写出来啊\n没崩，只是有一个Skipping Entity with id PaddleWheel\n\n错误地代码在原版class里 \nEntityList的\n\n    public static Entity createEntityFromNBT(NBTTagCompound par0NBTTagCompound, World par1World)\n    {\n        Entity var2 = null;\n\n        Class var3 = null;\n        try\n        {\n            var3 = (Class)stringToClassMapping.get(par0NBTTagCompound.getString(\"id\"));\n\n            if (var3 != null)\n            {\n                var2 = (Entity)var3.getConstructor(new Class[] {World.class}).newInstance(new Object[] {par1World});            }\n        }\n        catch (Exception var4)\n        {\n            var4.printStackTrace();\n        }\n\n        if (var2 != null)\n        {\n            try\n            {\n                var2.readFromNBT(par0NBTTagCompound);\n            }\n            catch (Exception e)\n            {\n                FMLLog.log(Level.SEVERE, e,\n                        \"An Entity %s(%s) has thrown an exception during loading, its state cannot be restored. Report this to the mod author\",\n                        par0NBTTagCompound.getString(\"id\"), var3.getName());\n                var2 = null;\n            }\n        }\n        else\n        {\n            System.out.println(\"Skipping Entity with id \" + par0NBTTagCompound.getString(\"id\"));\n        }\n\n        return var2;\n    }\n\n\n不知道是不是NBT读写哪里错了。\n\n另外这是我Entity的写NBT的代码\n\n\n    public void writeEntityToNBT(NBTTagCompound par1NBTTagCompound)\n    {\n        try\n        {\n                 par1NBTTagCompound.setTag(\"Pos\", this.newDoubleNBTList(new double[] {this.posX, this.posY + (double)this.ySize, this.posZ}));\n             par1NBTTagCompound.setTag(\"Motion\", this.newDoubleNBTList(new double[] {this.motionX, this.motionY, this.motionZ}));\n             par1NBTTagCompound.setTag(\"Rotation\", this.newFloatNBTList(new float[] {this.rotationYaw, this.rotationPitch}));\n             par1NBTTagCompound.setFloat(\"FallDistance\", this.fallDistance);\n             par1NBTTagCompound.setShort(\"Air\", (short)this.getAir());\n             par1NBTTagCompound.setBoolean(\"OnGround\", this.onGround);\n             par1NBTTagCompound.setInteger(\"Dimension\", this.dimension);\n             par1NBTTagCompound.setInteger(\"PortalCooldown\", this.timeUntilPortal);\n\n             par1NBTTagCompound.setShort(\"Health\", (short)((byte)this.health));\n             par1NBTTagCompound.setInteger(\"rotationR\", this.rotationR);\n             par1NBTTagCompound.setInteger(\"directionR\", this.direction);\n        }\n        catch (Throwable var5)\n        {\n            CrashReport var3 = CrashReport.makeCrashReport(var5, \"Saving entity NBT\");\n            CrashReportCategory var4 = var3.makeCategory(\"Entity being saved\");\n            this.func_85029_a(var4);\n            throw new ReportedException(var3);\n        }\n\n\n\n    }\n\n红色是错误地地方，蓝色是我加进去的新数据。另外写NBT的代码super不了，要不然会崩"
        },
        {
            "author": "饕餮魍魉枭蹀躞",
            "timestamp": 1382272560,
            "txt_content": "心灵骑士·杰 发表于 2013-10-20 18:27 \n没崩，只是有一个Skipping Entity with id PaddleWheel\n\n错误地代码在原版class里 \n好吧。实体方面我不在行……去问专业人士吧"
        },
        {
            "author": "心灵骑士·杰",
            "timestamp": 1382278800,
            "txt_content": "饕餮魍魉枭蹀躞 发表于 2013-10-20 20:36 \n好吧。实体方面我不在行……去问专业人士吧\n{:10_502:}专业人士何在啊，我还是找个替代算法吧。不知道这样在联机里会不会不稳定"
        },
        {
            "author": "饕餮魍魉枭蹀躞",
            "timestamp": 1382350260,
            "txt_content": "话说你还在开发1.4.7的mod啊。"
        },
        {
            "author": "心灵骑士·杰",
            "timestamp": 1382406360,
            "txt_content": "饕餮魍魉枭蹀躞 发表于 2013-10-21 18:11 \n话说你还在开发1.4.7的mod啊。\n懒得搬运{:10_497:}"
        },
        {
            "author": "yuxuanchiadm",
            "timestamp": 1382424240,
            "txt_content": " 本帖最后由 yuxuanchiadm 于 2013-10-22 14:46 编辑 \n\n233 Override父类的writeEntityToNBT方法或readEntityFromNBT要回调父类的对应方法"
        },
        {
            "author": "yuxuanchiadm",
            "timestamp": 1382424480,
            "txt_content": "yuxuanchiadm 发表于 2013-10-22 14:44 \n233 Override父类的writeEntityToNBT方法或readEntityFromNBT要回调父类的对应方法\n另外只管加你的NBT就行了，dimension或者坐标写入NBT回调父类方法即可"
        },
        {
            "author": "yuxuanchiadm",
            "timestamp": 1382424720,
            "txt_content": "另外你说回调父类方法会崩，把崩溃后的调用栈发出来"
        },
        {
            "author": "心灵骑士·杰",
            "timestamp": 1382508300,
            "txt_content": "yuxuanchiadm 发表于 2013-10-22 14:52 \n另外你说回调父类方法会崩，把崩溃后的调用栈发出来\n那是什么。另外我换了个方法解决了这个问题。这个问题可以放放了{:10_495:}\n\n换个话题吧\n\n新的问题就是我照着EntityItem做了个捡不起来的物品Entity。生成在一个block上面，这个Entity显示的内容跟这个block的TileEntity里的东西有关。\n\n问题就是读取之后，不显示东西，除非打开一次这个block的GUI，Entity会正常显示。\n\n这个问题好像解决不了啊，我在BuildCraft里都见过这种bug{:10_499:}"
        },
        {
            "author": "心灵骑士·杰",
            "timestamp": 1382508840,
            "txt_content": "yuxuanchiadm 发表于 2013-10-22 14:52 \n另外你说回调父类方法会崩，把崩溃后的调用栈发出来\n另外顺便问下，联机玩的时候，什么时候读写NBT"
        },
        {
            "author": "yuxuanchiadm",
            "timestamp": 1382510700,
            "txt_content": " 本帖最后由 yuxuanchiadm 于 2013-10-23 14:51 编辑 \n心灵骑士·杰 发表于 2013-10-23 14:05 \n那是什么。另外我换了个方法解决了这个问题。这个问题可以放放了\n\n换个话题吧\n就不该这么写，应该把EntityItem的渲染器里的代码复制到TileEntity的渲染器里，稍加改装后用TileEntity来渲染，另外没啥问题没法解决。 加QQ905965245细聊"
        },
        {
            "author": "心灵骑士·杰",
            "timestamp": 1382512440,
            "txt_content": "yuxuanchiadm 发表于 2013-10-23 14:50 \n基本是在加载和保存Chunk的时候读写NBT，当然TileEntity的NBT读写是在Chunk里有个boolean来决定是否保存T ...\n好评已加 晚上有空聊吧{:10_509:}"
        }
    ]
}