{
    "title": "[1.12function+advancement]在原版添加自定义自然生成建筑（第二代）",
    "author": "pineapple_",
    "replyCount": 9,
    "timestamp": 1505015940,
    "txt_content": " 本帖最后由 pineapple_ 于 2017-11-5 23:04 编辑 \n\n新版本传送门点这里\n\n我是菠萝Pine_apple_，我之前发过一个关于自定义自然生成建筑的帖子http://www.mcbbs.net/thread-715065-1-1.html，只不过那是一个雏形版，20多天前，我就把它修改成了这个完整版的，只不过一直忘记发出来。这次我填补了上次的一些不足的地方，然而观赏性还是很差（你会知道到底多差的233333）。正文注意:看本帖之前建议先看完雏形版那个贴。\n什么是自然生成建筑？村庄，要塞，废弃矿洞……都是原版的自然生成建筑，这很好理解对吧。\n先直接放下载地址吧：https://pan.baidu.com/s/1bUUhGU 密码: wqir\n把下载的压缩包复制到任意.minecraft\\saves\\任意地图下，解压到当前文件夹并覆盖原来的data文件夹，打开游戏即可。\n效果就是只要玩家身处平原生物群系，就会在周围尝试自然生成\"石英树\"，石英树上会随机地长苹果。\n石英树到底长什么样呢，见过橡树吧，把橡树的\"树干\"换成\"竖纹石英块\"，\"树叶\"换成\"錾制石英块\"，\n树叶下面会有果子，具体什么样就留个悬念，开生存打掉可以获得一个\"Apple（装饰）\"。\n主要原理\n网好像炸了，图片死活传不了……所以只能文字叙述了\n本次只是补充下上次的不足，所以看看上个贴子的图也是能理解什么意思的\n\n先把advancement和function放这里，结合adv和func来说吧\ndata\\advancements\\generat\\enter_plains.json\n\n{\n    \"criteria\":{\n        \"generat\":{\n            \"trigger\":\"minecraft:location\",\n                        \"conditions\": {\n                            \"biome\": \"plains\"\n                                    }\n        }\n    },\n    \"rewards\":{\n        \"function\":\"generat:main\"\n    }\n}复制代码\ndata\\functions\\generat\\main.mcfunction\n\nadvancement revoke @a from generat:enter_plains\ngamerule commandBlockOutput false\ngamerule logAdminCommands false\ngamerule sendCommandFeedback false\nexecute @a ~-32 0 ~-32 function generat:mark unless @e[dx=65,dy=0,dz=65,tag=Chunk]\nentitydata @e[tag=Chunk] {Age:0}\n\nscoreboard players tag @e add dropapple {Item:{tag:{SkullOwner:{Id:\"1f5ef611-dcfc-4719-8df5-36aa26a02f33\"}}}}\nentitydata @e[tag=dropapple] {Item:{tag:{display:{Name:\"§r§aApple\",Lore:[\"§r§6装饰\"]}}}}复制代码\n\ndata\\functions\\generat\\mark.mcfunction\n\nexecute @s ~ ~ ~ summon area_effect_cloud ~ 0 ~ {Tags:[\"Chunk\"],Duration:2147483647}\nexecute @s ~ ~ ~ summon area_effect_cloud ~ ~ ~ {Tags:[\"Spread\",\"False\"]}\nexecute @s ~ ~ ~ summon area_effect_cloud ~ ~ ~ {Tags:[\"Spread\",\"False\"]}\nexecute @s ~ ~ ~ summon area_effect_cloud ~ ~ ~ {Tags:[\"SpreadHelper\",\"False\"]}\nfunction generat:spread\nkill @e[tag=SpreadHelper]\nscoreboard players tag @r[type=area_effect_cloud,tag=Spread,c=1] add True\nexecute @r[type=area_effect_cloud,tag=Spread,c=1] ~ ~ ~ function generat:build if @s[tag=True]\nkill @e[tag=Spread]复制代码\n\ndata\\functions\\generat\\spread.mcfunction\n\nscoreboard players tag @e[tag=SpreadHelper] add False\nspreadplayers ~ ~ 17 33 false @e[tag=False]\nscoreboard players tag @e[tag=Spread] remove False\nexecute @e[tag=Chunk] ~-32 0 ~-32 scoreboard players tag @e[tag=Spread,dx=65,dy=255,dz=65] add False\nscoreboard players tag @e[tag=SpreadHelper] remove False\nfunction generat:spread if @e[tag=FalseMarker]复制代码\n\n\ndata\\functions\\generat\\build.mcfunction\n\nsummon area_effect_cloud ~ ~ ~ {Tags:[\"Build\"]}\nsummon area_effect_cloud ~ ~ ~ {Tags:[\"Build\"]}\nsummon area_effect_cloud ~ ~ ~ {Tags:[\"Build\"]}\nsummon area_effect_cloud ~ ~ ~ {Tags:[\"Build\"]}\nsummon area_effect_cloud ~ ~ ~ {Tags:[\"Build\"]}\nspreadplayers ~ ~ 16 32 false @e[tag=Build]\nexecute @e[tag=Chunk] ~-32 ~0 ~-32 kill @e[dx=65,dy=0,dz=65,tag=Build]\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~1 ~3 ~ {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~-1 ~3 ~ {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~ ~3 ~1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~ ~3 ~-1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~1 ~3 ~1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~1 ~3 ~-1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~-1 ~3 ~1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~-1 ~3 ~-1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~2 ~3 ~1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~2 ~3 ~ {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~2 ~3 ~-1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~-2 ~3 ~1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~-2 ~3 ~ {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~-2 ~3 ~-1 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~1 ~3 ~-2 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~ ~3 ~-2 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~-1 ~3 ~-2 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~1 ~3 ~2 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~ ~3 ~2 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 summon area_effect_cloud ~-1 ~3 ~2 {Tags:[\"apple\"]}\nexecute @e[tag=Build] ~ ~ ~ execute @r[type=area_effect_cloud,tag=apple,c=2] ~ ~ ~ setblock ~ ~ ~ skull 2 keep {SkullType:3,Owner:{Id:\"1f5ef611-dcfc-4719-8df5-36aa26a02f33\",Properties:{textures:[{Value:\"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvODU2NDc5N2NkNjI2NjQ0NDhlZDAyOGU0ODdhY2Q5NWQ1NzA3NWRjZTQ5YTM1NmZjYzY1NjU1YjJiNTI1ZGRiIn19fQ==\"}]}}}\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 fill ~-1 ~4 ~-2 ~1 ~5 ~2 minecraft:quartz_block 1 keep\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 fill ~-2 ~4 ~-1 ~2 ~5 ~1 minecraft:quartz_block 1 keep\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 fill ~-1 ~6 ~-1 ~1 ~6 ~1 minecraft:quartz_block 1 keep\nexecute @e[tag=Build] ~ ~ ~ detect ~ ~-1 ~ grass -1 fill ~ ~ ~ ~ ~5 ~ minecraft:quartz_block 2 keep\nkill @e[tag=Build]\nkill @e[tag=apple]复制代码\n\n\n简单说一下：\n在生成建筑之前，要先确定该区块是否被玩家加载过，被玩家加载过的区块不能生成建筑，\n如果被加载过的区块可以生成建筑，那玩家在某处造了个房子，跑图回来发现自己的房子上长树就GG了。\n所以在玩家经过的区块上必须被标记上无法生成，记号(marker)可以选用area_effect_cloud(药水云，简称aec)。\n但是一个原版区块标记一次的话，不仅需要很多实体占用资源，还会使生成的效果不好（跑着跑着突然冒出来一棵树）。\n所以这里记64×256×64大小为一个区块（不和原版区块对齐），以下所说区块均不为原版区块。\n\nadv的作用就是只要玩家在平原生物群系，就会使玩家执行main这个func（省了高频又控制了生物群系）\n\n玩家第一次进入生物草原生物群系，会对当前区块进行标记，并尝试生成树，summon出x个aec，（x与几率有关），和一个辅助用的aec，不断扩散这些aec，直到除了辅助aec都被扩散到没有被marker覆盖的区域，清除辅助aec，给予其中一个aec一个True标签，清除（x-1）个aec，如果留下的aec带有Ture标签，那么它就会在附近随机生成一些树。\n离开这个区块并还在平原生物群系的话，就再标记一次并尝试生成树，每次生成的几率会固定在1/x\n如果生成x个aec太多而无法扩散，但还想要很低的几率，比如想要1/10000的几率，就可以生成10个aec，分别随机给一个marker标签5次，同时拥有5个标签的aec才生成树\n\n\n我这个贴的语言可能过于简单，有时间的话我再编辑一下\n\n\n\n顺便打个广告:[优秀]1.11.2的多人小游戏地图http://www.mcbbs.net/thread-720335-1-1.html",
    "replies": [
        {
            "author": "1134443057",
            "timestamp": 1505037600,
            "txt_content": "简单的说一下都没懂，我果然不适合这个游戏"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1505195220,
            "txt_content": "然而这苹果都不能吃……"
        },
        {
            "author": "2759159258",
            "timestamp": 1505225220,
            "txt_content": "adv的一脸懵B\n还是入门到入土好看些。。。"
        },
        {
            "author": "pineapple_",
            "timestamp": 1505227020,
            "txt_content": "ruhuasiyu 发表于 2017-9-12 13:47\n然而这苹果都不能吃……\n在1.13更新之后配合自定义合成，它就能吃了，23333"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1505227080,
            "txt_content": "pineapple_ 发表于 2017-9-12 22:37\n在1.13更新之后配合自定义合成，它就能吃了，23333\n1.13自定义合成？不存在的"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1509282840,
            "txt_content": "关于苹果我倒是想起来可以这么弄，先在苹果处生成一个生物，然后检测为空气时杀死，掉落苹果，再清楚地面和背包的苹果头颅。这样就能吃了。。。"
        },
        {
            "author": "pineapple_",
            "timestamp": 1509283620,
            "txt_content": "ruhuasiyu 发表于 2017-10-29 21:14\n关于苹果我倒是想起来可以这么弄，先在苹果处生成一个生物，然后检测为空气时杀死，掉落苹果，再清楚地面和 ...\n你这个让我想到\n把苹果都换成头戴苹果头颅的小村民，这样还能让苹果贴到树叶上，怼这个村民一下让它summon苹果并把村民tp到虚空"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1509298740,
            "txt_content": "pineapple_ 发表于 2017-10-29 21:27\n你这个让我想到\n把苹果都换成头戴苹果头颅的小村民，这样还能让苹果贴到树叶上，怼这个村民一下让它summo ...\n直接一血村民呗"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1509298800,
            "txt_content": "pineapple_ 发表于 2017-10-29 21:27\n你这个让我想到\n把苹果都换成头戴苹果头颅的小村民，这样还能让苹果贴到树叶上，怼这个村民一下让它summo ...\n但是村民有一点不好，会吸引僵尸。"
        }
    ]
}