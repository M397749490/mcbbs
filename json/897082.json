{
    "title": "利用阿里云部署MC亲友服",
    "author": "BaiMeow",
    "replyCount": 2,
    "timestamp": 1564970880,
    "txt_content": " 本帖最后由 锦鸡FBI 于 2019-8-5 10:11 编辑 \n本教程使用\n\nUbuntu 16.04 系统\n\n云服务商：阿里云\n\n为什么要做亲友服教程？\n\n这个教程使用了阿里云的按量付费服务器，面向一星期只有周末能上号，又想开服玩家，（住校生）\n\n这种情况下，购买一般云服务商的包月包年套餐都存在一个性价比的问题，\n\n如果自己家里开服，暂且不谈端口映射一系列操作，还需要电脑一直开机，此时开别的游戏还掉帧，总会带来很多不便。\n\n如果使用按量付费服务器，只有在周末开服的时候收取服务器占用费用，其他时候只收取廉价的硬盘费用\n\n（高性能云磁盘0.01元/（h*20GB），折合一个月（30天）7.2元\n\n由于其开服时间较短，ip地址不稳定，因此很难作为正式的游戏服务器对外开放，因此命名其为亲友服。\n\nWarning：本教程涉及使用Linux服务器，不适合没有任何计算机基础的而且不喜欢折腾钻研的人。\n\n0.准备工作下载一个能连接ssh的工具（其实win10本身也可以但是不建议使用\n\n下载一个能连接sftp的工具\n\n我个人使用的是Xshell和FileZilla\n\n1.选购\n\n为了节约成本，这里推荐使用抢占式实例\n\n\n\n当然抢占式实例有一定风险，当他人出价较高时，服务器可能会丢失\n\n不过我们可以通过选购数据盘来规避风险\n\n先不要急着购买，在ECS购买完成后另外购买数据盘挂载上去，具体操作在后文介绍\n\n其次，在服务器配置上暂时不用着急，毕竟付费是按小时付的，配置不够调整也完全来得及（虽然这种实例调整配置有点不是特别方便\n\n游戏1.14以下可以考虑学生机轻量应用服务器1c2g5M（9.5元/月）\n\n找一下阿里的云翼计划了解\n\n同时四五个人没问题\n\n游戏1.14以上版本，如果最高在线也有个四五个人的话，双核，请\n\nmod服建议高主频（有点贵\n\n另外，在宽带的选购上我也建议是慢慢调整，\n\n阿里云的建议是\n\n从带宽平均利用率来考虑：\n\n对于带宽平均利用率较低（低于20%）的**，更适合按使用流量计费。对于带宽平均利用率较高（高于35%）的**，更适合按固定带宽计费。对于带宽平均利用率居中的**，建议根据运行经验进行选择。\n\n四五个人的话其实2M宽带就差不多了\n\n当然你也可以按流量付费，差不了多少的具体情况自己调整\n\n关于镜像，本教程使用Ubuntu 16.04\n\n2.部署密钥对&打开25565端口\n\n我建议使用密钥对连接\n\n\n\n\n\n注意在4-3执行完后会下载一个文件，这个是私钥，一定要保存好\n\n\n\n然后去重启你的服务器（实例）\n\n至此公钥已经放好了\n\n然后我们先去给服务器开个端口\n\n看我操作\n\n\n\n\n\n\n\n至此端口25565已经开放了\n\n3.连接服务器\n\nXshell为例\n\nalt+N键（或者左上角添加）\n\n\n\n\n\n\n\n导入之后选中导入的密钥，\n\n确定\n\n确定\n\n之后，左上角第二排第二个文件夹一样的图标点开\n\n选中刚添加的服务器\n\n连接\n\n\n\n如果有提示什么，全部点确定\n\n于是完成了ssh的部署，下面搞sftp\n\nFileZilla为例\n\n左上角，打开站点管理器\n\n\n\n\n\n完成之后在站点管理器中选中并连接服务器\n\n\n4.风险规避\n\n由于抢占服务器有可能会出现服务器被抢走，数据清空的问题，所以：\n\n首先你得买个云磁盘，用来保存你的存档数据\n\n注意硬盘要和服务器在同一个地域同一个可用区\n\n在ECS后台自己找，买个20GB的高性能云磁盘就可以了，然后挂载上去\n\n之后打开ssh，进行挂载\n\n挂载前我们要格式化这个新硬盘，分区的话我们是不需要的\n\n首先\n\nfdisk -l复制代码\n你应该会看到有一句话\n\nDisk /dev/vdb: 20 GiB, 21474836480 bytes, 41943040 sectors复制代码\n他的意思/dev/vdb有个20GB的硬盘，其实就是我们刚刚挂载的\n\n然后看我操作\n\nroot@iZuf6beuiia49sn2zu03reZ:~# fdisk -u /dev/vdb //输入指令\n\nWelcome to fdisk (util-linux 2.27.1).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\nDevice does not contain a recognized partition table.\nCreated a new DOS disklabel with disk identifier 0xba29ef34.\n\nCommand (m for help): n //输入n 创建分区\nPartition type\n   p   primary (0 primary, 0 extended, 4 free)\n   e   extended (container for logical partitions)\nSelect (default p): //使用默认值，直接enter\nPartition number (1-4, default 1): //使用默认值，直接enter\nFirst sector (2048-41943039, default 2048): //使用默认值，直接enter\nLast sector, +sectors or +size{K,M,G,T,P} (2048-41943039, default 41943039): //使用默认值，直接enter\n\nCreated a new partition 1 of type 'Linux' and of size 20 GiB.\n\nCommand (m for help): p //输入p查看分区状况\nDisk /dev/vdb: 20 GiB, 21474836480 bytes, 41943040 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: dos\nDisk identifier: 0xba29ef34\n\nDevice     Boot Start      End  Sectors Size Id Type\n/dev/vdb1        2048 41943039 41940992  20G 83 Linux\n\nCommand (m for help): w //输入w开始分区，并在完成分区后退出\nThe partition table has been altered.\nCalling ioctl() to re-read partition table.\nSyncing disks.复制代码\n然后要创建一下文件系统\n\nmkfs.ext4 /dev/vdb1复制代码\n假设你要把mc放在/root/mc目录下\n\nmkdir /root/mc   //创建文件夹复制代码mount /dev/vdb1 /root/mc  \n//手动挂载\necho /dev/vdb1 /root/mc ext4 defaults 0 0 >> /etc/fstab\n//开启自动挂载复制代码\n参考文献：https://help.aliyun.com/document_detail/25426.html\n\n如果服务器丢失后第二次挂载硬盘这不需要这样麻烦\n\n假设要挂载在/root/mc目录下\n\n执行\n\nmount /dev/vdb1 /root/mc\n//挂载\necho /dev/vdb1 /root/mc ext4 defaults 0 0 >> /etc/fstab\n//开启自动挂载复制代码\n即可\n\n\n5.开服\n\n假设，我已经将数据盘挂载在/root/mc目录下\n\n首先更新软件包列表\n\napt-get update复制代码\n安装Java\n\napt install openjdk-8-jre复制代码\n检验安装\n\nroot@iZuf6beuiia49sn2zu03reZ:~# java -version\nopenjdk version \"1.8.0_212\"\nOpenJDK Runtime Environment (build 1.8.0_212-8u212-b03-0ubuntu1.16.04.1-b03)\nOpenJDK 64-Bit Server VM (build 25.212-b03, mixed mode)复制代码\n安装screen\n\napt install screen复制代码\n检验安装\n\nroot@iZuf6beuiia49sn2zu03reZ:~# screen -version\nScreen version 4.03.01 (GNU) 28-Jun-15复制代码\n然后，用之前部署的sftp把服务器文件传过去\n\n丢到/root/mc内\n\ncd /root/mc\nls复制代码\n看看是不是在里面了\n\n如果你没有准备好的服务器文件\n\nmcmirror.io 请\n\n到下载文件的时候右键复制链接地址\n\n注意不要使用ctrl+c和ctrl+v\n\n到服务器执行\n\nwget 然后粘贴你的链接复制代码root@iZuf6beuiia49sn2zu03reZ:~/mc# wget https://mcmirror.io/files/Spigot/Spigot-1.14.4-e5b1b5d-20190802-0923.jar\n--2019-08-04 17:55:23--  https://mcmirror.io/files/Spigot/Spigot-1.14.4-e5b1b5d-20190802-0923.jar\nResolving mcmirror.io (mcmirror.io)... 104.28.27.68, 104.28.26.68, 2606:4700:30::681c:1b44, ...\nConnecting to mcmirror.io (mcmirror.io)|104.28.27.68|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 32011572 (31M) [application/java-archive]\nSaving to: ‘Spigot-1.14.4-e5b1b5d-20190802-0923.jar’\n\nSpigot-1.14.4-e5b1b5d-20190 100%[========================================>]  30.53M  1.84MB/s    in 22s     \n\n2019-08-04 17:55:48 (1.41 MB/s) - ‘Spigot-1.14.4-e5b1b5d-20190802-0923.jar’ saved [32011572/32011572]复制代码\n下载完了，你的文件名为Spigot-1.14.4-e5b1b5d-20190802-0923.jar\n\n然后我们写个shell开服\n\nvim start.sh复制代码\n按i键切换insert\n\n输入（右键粘贴）\n\n#!/bin/sh\nwhile true\ndo\njava -jar -Xmx这里填你的最大内存 ./Spigot-1.14.4-e5b1b5d-20190802-0923.jar\nwait\ndone复制代码\n先按Esc退出insert\n\n再输入冒号：切命令模式\n\n最后输入wq 回车保存并退出\n\n这样写的shell可以实现自动重启\n\n同样的方法\n\n去修改eula之类的文件，这里不再赘述\n\n（如果实在不会，你可以用sftp先下载到自己电脑上整好上传回去\n\nLinux服务器是不认cmd的，如果你之前下载了服务器整合包，请你吧cmd改写成shell\n\n接下来使用screen打开一个窗口挂服务器\n\nscreen -S mc //开启一个名字为mc的screen复制代码\n然后你就会被切入这个screen\n\n先cd到你的服务器文件那边然后\n\n./start.sh //运行服务器复制代码\n关闭的时候可以使用stop 然后ctrl+c\n\n6.结算\n\n计算一下成本\n\n如果你使用2c4g的服务器，按照当前价位，\n\n机器带系统盘0.082元/时\n\n周末开服的话一个月满打满算开十天服务器\n\n10x24x0.082=19.68\n\n加上数据盘\n\n0.01x30x24=7.2\n\n加宽带费用，如果你带四五个人的话2M宽带\n\n2.4x10=24\n\n如果流量计费的话\n\n4.8+0.8x流量（GB）\n\n总之，五十块钱能解决一个月\n\n除此之外，在关闭服务器的时候要不要保留EIP（外网ip）也会对成本有影响\n\n我建议是不要保留，\n\n亲友服在开机的时候和同学之类的通知本周的外网IP一下就成了，不需要每个月多支付9.6元\n\n注意：关闭服务器一定要在云服务商控制面板关闭\n\n（咱觉得比较坑的就是按量付费是账户至少100元才能购买，请自行衡量\n\n\n7.番外\n\n暂无\n\n结语\n\n我都写了那么一堆字了，懒得写结语了\n\n",
    "replies": [
        {
            "author": "Nestalie",
            "timestamp": 1564979100,
            "txt_content": "挖藕前排支持一下"
        },
        {
            "author": "小庄c",
            "timestamp": 1565092800,
            "txt_content": "阿里云有针对新手的win系统===="
        }
    ]
}