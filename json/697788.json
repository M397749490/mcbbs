{
    "title": "[翻译][UD]自定义交互式书本",
    "author": "耗子",
    "replyCount": 5,
    "timestamp": 1497262020,
    "txt_content": " 本帖最后由 耗子 于 2018-8-3 11:21 编辑 \n\n交互式书本\n本篇教程是关于如何创建一个有点击事件和悬浮事件的书\n\n目录\n- 创建书本\n- 获取页面\n- 创建一个有点击/悬浮事件的页面\n- 完成创建ItemStack\n- 一份实例代码\n\n创建书本\n首先，我们需要从ItemStack获取一个BookMeta。只有ItemStack是 Material.BOOK_AND_QUILL 或 Material.WRITTEN_BOOK 才有BookMeta。\n\nItemStack book = new ItemStack(Material.WRITTEN_BOOK);\nBookMeta bookMeta = (BookMeta) book.getItemMeta();\n复制代码\n\n获取页面\nBukkit的BookMeta是CraftBukkit的CraftMetaBook的接口。在教程编写的时候，BookMeta接口还没有方法获取页面，一个IChatBaseComponent对象的列表 （它储存在CraftMetaBook）。这意味着我们必须使用反射来获取页面。这是一个例子：\n\nList<IChatBaseComponent> pages = (List<IChatBaseComponent>) CraftMetaBook.class.getDeclaredField(\"pages\").get(bookMeta);\n复制代码\n我们对这个列表做出的任何修改都会更新到这本书，所以当我们完成操作时，我们不需要重新设置这个字段。\n\n创建一个有点击/悬浮事件的页面\n使用 BungeeCord 聊天组件 API（它已经包含在Spigot服务器jar中）你可以创建一个有点击和悬浮事件的 IChatBaseComponent。\n或者你可以生成你自己的json字符串使你使用的书本具有特殊事件。\n\nBaseComponent text; //这是我们将要转换为页面的 BaseComponent\n\n//将BaseComponent转换为Json字符串\nString pageJson = ComponentSerializer.toString(text);\n\n//从Json字符串获取一个IChatBaseComponent对象\nIChatBaseComponent page = IChatBaseComponent.ChatSerializer.a(pageJson);\n\n//添加这个页面到页面列表\npages.add(page);\n复制代码\n\n完成创建ItemStack\n一旦你完成了添加页面，不要忘记设置这个新的BookMeta到原ItemStack！你也可以为这本书设置标题和作者。\n\nbookMeta.setTitle(\"Interactive Book\");\nbookMeta.setAuthor(\"gigosaurus\");\n\nbook.setItemMeta(bookMeta);\n复制代码\n\n一份示例代码\n\n//创建书本\nItemStack book = new ItemStack(Material.WRITTEN_BOOK);\nBookMeta bookMeta = (BookMeta) book.getItemMeta();\nList<IChatBaseComponent> pages;\n\n//获取页面\ntry {\n    pages = (List<IChatBaseComponent>) CraftMetaBook.class.getDeclaredField(\"pages\").get(bookMeta);\n} catch (ReflectiveOperationException ex) {\n    ex.printStackTrace();\n    return;\n}\n\n//创建页面\nTextComponent text = new TextComponent(\"Click me\");\ntext.setClickEvent(new ClickEvent(ClickEvent.Action.OPEN_URL, \"http://spigotmc.org\"));\ntext.setHoverEvent(new HoverEvent(HoverEvent.Action.SHOW_TEXT, new ComponentBuilder(\"Goto the spigot website!\").create()));\n\n//添加页面到页面列表中\nIChatBaseComponent page = ChatSerializer.a(ComponentSerializer.toString(text));\npages.add(page);\n\n//设置书的标题和作者\nbookMeta.setTitle(\"Interactive Book\");\nbookMeta.setAuthor(\"gigosaurus\");\n\n//更新ItemStack的ItemMeta\nbook.setItemMeta(bookMeta);\n复制代码\n\n原文地址：https://www.spigotmc.org/wiki/interactive-books/\n\n欢迎各位支持作者，以编写和翻译更多优秀教程。[afd]mouse[/afd]\n[groupid=1181]Unknown Domain[/groupid]",
    "replies": [
        {
            "author": "拉普达",
            "timestamp": 1523634300,
            "txt_content": "楼主有没有直接给玩家打开书的方法？"
        },
        {
            "author": "耗子",
            "timestamp": 1523636220,
            "txt_content": "拉普达 发表于 2018-4-13 23:45\n楼主有没有直接给玩家打开书的方法？\n欢迎使用UDPL：http://www.mcbbs.net/thread-734427-1-1.html"
        },
        {
            "author": "拉普达",
            "timestamp": 1523684280,
            "txt_content": "耗子 发表于 2018-4-14 00:17\n欢迎使用UDPL：http://www.mcbbs.net/thread-734427-1-1.html\n不过使用你的这个库，打开书的一瞬间又关闭了。"
        },
        {
            "author": "拉普达",
            "timestamp": 1523684340,
            "txt_content": "耗子 发表于 2018-4-14 00:17\n欢迎使用UDPL：http://www.mcbbs.net/thread-734427-1-1.html\n版本是1.12"
        },
        {
            "author": "拉普达",
            "timestamp": 1523685000,
            "txt_content": "耗子 发表于 2018-4-14 00:17\n欢迎使用UDPL：http://www.mcbbs.net/thread-734427-1-1.html\n不好意思 - 解决了\n原因是我判断玩家加入 ess好像会关掉它"
        }
    ]
}