{
    "title": "[安全|管理]MCreCAPTCHA —— 高效率的反假人压测插件 | 网页验证 | 多线程 [1.8+]",
    "author": "Akkariin",
    "replyCount": 48,
    "timestamp": 1565654460,
    "txt_content": " 本帖最后由 Akkariin 于 2019-11-16 04:38 编辑 \n\nMC reCAPTCHA更先进的网页反假人验证码系统\n\n\n简介\n本插件是受到 https://www.mcbbs.net/thread-901461-1-1.html 这篇帖子的启发而制作的。\n为什么叫更先进呢？因为相比起来，鬼畜做的这个需要数据库，有点麻烦，所以我就造了一个不用数据库的版本。\n同时新版本使用 Swoole 开发，原生支持多线程，并且使用内存表储存数据，可以承受更高并发，彻底防止熊孩子攻击。\n\nhttps://www.bilibili.com/video/av63470947\n一张图了解 MCreCAPTCHA 的作用\nMCreCAPTCHA 是如何保护你的服务器的？有哪些强大的地方？\n\n\n最新测试结果（2019.11）一分钟内最高扛下了 23753 次攻击，再高测不到了，因为发包服务器性能极限了\n\n\n\n新版本更新了什么？\n1. 验证方式大改，从原来的玩家进服就发起一次请求改为了定时请求并缓存数据在本地。本次更新极大地提升了服务器可承载的并发请求量，降低验证服务器的负担。\n2. 加入自定义登录失败提示信息功能\n3. 增加网页上显示自定义服务器名字的功能\n4. 新增一个公共验证服务器\n\n更新后请删除旧的插件配置文件让它重新生成！\n\n以往的更新记录：\nv2.2 更新\n1. 新版本 2.1 性能测试结果：在一台 i5-4590 CPU、12G 内存、20Mbps 宽带的服务器上，成功抵御了另外两台服务器使用 EndMinecraftPlus 发起的每分钟接近 2000 次的假人攻击，并且正常玩家在通过验证后可以直接进入服务器，延迟几乎不受影响，服务器 TPS 稳定在 19.95 以上。\n2. 新版本加入了日志屏蔽功能，可以在配置文件中指定开启，你就不会被 Disconnect 的消息刷屏了。同时加入了未验证不允许发消息的功能，禁用 Tab 补全，防止消息刷屏以及 Tab 攻击。\n3. 加入了攻击状态显示功能，可以显示每分钟遭受到的压测数量统计信息。\n4. 加入了自动监测攻击的功能，可以在配置文件中开启，当受到超过指定阈值的攻击数量时会自动打开防御，攻击结束后自动关闭，全程无需人工干预。\n注意：本插件仅用于防御假人压测，不能防御其他类型的攻击（例如 Motd 压测），因此建议配合其他反压测插件使用，然后关闭其他插件的反假人压测功能，使用本插件来防护假人压测即可。具体的可承受并发数受到你的服务器性能和网络影响。\n前置依赖\n如果你是面板服或者只是想测试用，可以使用我搭建好的环境，请跳过这一部分直接看下面的 “公共验证服务器” 部分。\n服务器一般来说只支持 Linux，Windows 的话可以用 Cygwin 运行，也可以用 BashOnWindows（WSL）。我个人是比较推荐 WSL 这个方法的，你只需要：\n在控制面板 > 程序和功能 > 启用或关闭 Windows 功能 > 勾选 “适用于 Linux 的 Windows 子系统”重启电脑打开 Microsoft 应用商城搜索“WSL”，安装 Ubuntu打开开始菜单，运行 Ubuntu，第一次启动会要求输入用户名和密码，然后就可以使用了\n\n首先你需要安装 PHP 7.X，同时还需要安装 Swoole，下面这个命令在大部分 Linux 服务器上应该都可用。\nsudo curl https://tql.ink/php.sh | bash -\nsudo curl https://tql.ink/swoole.sh | bash -复制代码执行之后它会自动给你安装 PHP 7.3.8 ZTS 版本并自动安装好 Swoole 扩展。\n\n安装 reCaptcha 服务端\n输入以下命令安装服务端。\ngit clone https://github.com/kasuganosoras/MCreCaptcha_Server recaptcha_server/\ncd recaptcha_server/复制代码然后是申请 reCaptcha 的秘钥需要登录谷歌，这里需要科学上网，具体申请方法可以看鬼畜的帖子：\nhttps://www.mcbbs.net/thread-901461-1-1.html\n申请到 Site Key 和 Server Key 之后，将它填入到 server.php 的开头配置那部分里面：\nvim server.php复制代码大概改成这样就对了：\n\n\n\n然后你可以使用 Screen 来运行，如果没有安装的话可以用 yum install screen -y 或者 apt install screen 来安装。\nscreen -S recaptcha\nphp server.php\n# 此时可以按下 Ctrl + A + D 后台运行复制代码\n\n公共的验证服务器\n这是我搭建好的现成的验证服务器，用于测试用，兼容 2.1 和 2.2 版本的插件。\n照下面的教程装好插件端，然后在配置文件中指定：\nserver-ip: mcr.moe\nserver-port: 781复制代码然后访问 https://mcr.moe:780/ 就可以进行验证。\n请注意：这个验证服务器不是 100% 稳定的，有可能会被攻击等原因导致无法使用，并且也会受到你和验证服务器之间的延迟影响导致可承受的并发数下降，因此我还是推荐自建更加稳定，通过 localhost 进行验证基本上是不存在延迟的。\n\n安装插件端\n点击下载：\n\n\n\nMCreCAPTCHA-2.2.jar\n(13.3 KB, 下载次数: 116)\n\n\n\n2019-8-19 05:32 上传\n点击文件名下载附件\n\n\n\n\n\n\n下载后丢进 plugins，重启服务器，然后会生成配置文件，修改后输入 /recaptcha reload 重载配置即可。\n执行重载命令需要拥有 slogin.admin 权限。\n提示：插件默认生成的配置文件里面写的 “正版服不适用” 是错的，经过我测试，正版服效果也很好。因为初代版本是用的 PlayerLoginEvent，当假人进来时已经经过了正版验证了，所以服务器被卡死。后来我改成了 AsyncPlayerPerLoginEvent，在服务器对玩家进行正版验证之前就先判断是否是假人，完美解决了这个问题。\n测试效果\n浏览器访问 http://你的服务器IP:980/ 查看是否正常，如果出现下面的界面就说明 OK 了。\n\n\n\n然后试下进入游戏，如果你没有验证的话应该是进不去的，服务器 Log 里会输出调试信息，可以查看验证结果是否正确。\n\n\n\n命令列表\n所有的命令都需要 slogin.admin 权限。\n/recaptcha reload 重载配置文件/recaptcha enable 启用验证码系统/recaptcha disable 禁用验证码系统/recaptcha showattack 开启或关闭显示每分钟被假人攻击的数量\n\n配置非常灵活，随时开关，自由操作，适合在受到攻击时临时打开，攻击过去后随时关闭。\n\n\n本插件所用所有代码均为原创,不存在借用/抄袭等行为\n",
    "replies": [
        {
            "author": "1875038348",
            "timestamp": 1565654760,
            "txt_content": "插件不错，支持原创"
        },
        {
            "author": "幻境雲達達",
            "timestamp": 1565656860,
            "txt_content": "你是来砸场子的？"
        },
        {
            "author": "Akkariin",
            "timestamp": 1565657340,
            "txt_content": "XJue_DaDa 发表于 2019-8-13 08:41\n你是来砸场子的？\nhhh 等会鬼畜要跟我干架了 "
        },
        {
            "author": "楠木i",
            "timestamp": 1565703240,
            "txt_content": "不错，这样看上去很高端\n如果可以配合MOD自动打开页面就更方便了"
        },
        {
            "author": "NGK3",
            "timestamp": 1565838540,
            "txt_content": "太i了。\n很不错的插件~\n（特别是可以不用自己搭嘿嘿。"
        },
        {
            "author": "QAQexe",
            "timestamp": 1565843040,
            "txt_content": "看看，感谢分享"
        },
        {
            "author": "Cavalry_仰望",
            "timestamp": 1569559740,
            "txt_content": "谢谢分享，插件不错"
        },
        {
            "author": "testman",
            "timestamp": 1569566580,
            "txt_content": "非常感谢，找了很久了，我拿走了OvO，给你捧个场"
        },
        {
            "author": "祁诣茗",
            "timestamp": 1572616140,
            "txt_content": "Akkariin，最近你女朋友不在mcbbs上呀"
        },
        {
            "author": "ctsgzs",
            "timestamp": 1573436760,
            "txt_content": "大佬请问已经装了宝塔的该如何接入？直接运行php server.php没有输出信息，对应端口也无法访问。。。\n直接扔网站目录提示只能在cli mode运行"
        },
        {
            "author": "Akkariin",
            "timestamp": 1573488300,
            "txt_content": "ctsgzs 发表于 2019-11-11 09:46\n大佬请问已经装了宝塔的该如何接入？直接运行php server.php没有输出信息，对应端口也无法访问。。。\n直接 ...\n1. 确保你已经正确按照教程配置 Swoole\n2. 确保你已经正确按照教程配置本程序\n3. 检查对应端口是否被占用\n4. 可以尝试打开调试模式 error_reporting(E_ALL);\n你也可以通过 QQ 与我联系取得帮助"
        },
        {
            "author": "死亡进行曲",
            "timestamp": 1574927940,
            "txt_content": "centos能安装吗"
        },
        {
            "author": "死亡进行曲",
            "timestamp": 1574929020,
            "txt_content": "还有我不是qq那个人的\n我是他的朋友"
        },
        {
            "author": "PaulWong",
            "timestamp": 1575118920,
            "txt_content": "gzip: stdin: unexpected end of file\ntar: Unexpected EOF in archive\ntar: Unexpected EOF in archive\ntar: Error is not recoverable: exiting now\nconfigure: WARNING: unrecognized options: --with-mcrypt\nconfigure: error: cannot find sources (README.GIT-RULES) in . or ..\nmake: *** No targets specified and no makefile found.  Stop.\nmake: *** No rule to make target `install'.  Stop."
        },
        {
            "author": "PaulWong",
            "timestamp": 1575118920,
            "txt_content": "akkariin大哥怎么解决"
        },
        {
            "author": "Akkariin",
            "timestamp": 1575122040,
            "txt_content": "egqwea231 发表于 2019-11-30 21:02\ngzip: stdin: unexpected end of file\ntar: Unexpected EOF in archive\ntar: Unexpected EOF in archive\nPHP 下载失败了，你可以用 OneinStack 来安装\nwget -c http://mirrors.linuxeye.com/oneinstack-full.tar.gz && tar xzf oneinstack-full.tar.gz && ./oneinstack/install.sh --php_option 8 --php_extensions swoole"
        },
        {
            "author": "PaulWong",
            "timestamp": 1575122160,
            "txt_content": "Akkariin 发表于 2019-11-30 21:54\nPHP 下载失败了，你可以用 OneinStack 来安装\nwget -c http://mirrors.linuxeye.com/oneinstack-full.tar. ...\n谢谢了\nakkariin san"
        },
        {
            "author": "PaulWong",
            "timestamp": 1575122460,
            "txt_content": "Akkariin 发表于 2019-11-30 21:54\nPHP 下载失败了，你可以用 OneinStack 来安装\nwget -c http://mirrors.linuxeye.com/oneinstack-full.tar. ...\n512m能撑下多少人"
        },
        {
            "author": "PaulWong",
            "timestamp": 1575123120,
            "txt_content": "cc: internal compiler error: Killed (program cc1)\nPlease submit a full bug report,\nwith preprocessed source if appropriate.\nSee <http://bugzilla.redhat.com/bugzilla> for instructions.\nmake: *** [Zend/zend_execute.lo] Error 1\nPHP install failed, Please Contact the author! "
        },
        {
            "author": "PaulWong",
            "timestamp": 1575123780,
            "txt_content": "我欲哭无泪啊"
        },
        {
            "author": "Akkariin",
            "timestamp": 1575159060,
            "txt_content": "egqwea231 发表于 2019-11-30 22:12\ncc: internal compiler error: Killed (program cc1)\nPlease submit a full bug report,\nwith preprocessed ...\n你的机器内存太小了，无法完成编译。。\n换个大点的吧，或者试试设置虚拟内存"
        },
        {
            "author": "AzureHanChen",
            "timestamp": 1575204600,
            "txt_content": " 本帖最后由 AzureHanChen 于 2020-1-3 19:35 编辑 \n\nreCAPTCHA我个人感觉比国内的某些滑动验证的排版干净验证方式也比较正常,希望能持续更新一些自定义性功能\n\n"
        },
        {
            "author": "死亡进行曲",
            "timestamp": 1575230700,
            "txt_content": "HP Parse error:  syntax error, unexpected '?' in /home/admin/recaptcha_server/server.php on line 23\n怎么弄"
        },
        {
            "author": "死亡进行曲",
            "timestamp": 1575231240,
            "txt_content": "akkariin 你的编译出问题了"
        },
        {
            "author": "PaulWong",
            "timestamp": 1575292920,
            "txt_content": "HP Parse error:  syntax error, unexpected '?' in /home/admin/recaptcha_server/server.php on line 23\n怎么弄"
        },
        {
            "author": "Akkariin",
            "timestamp": 1575303960,
            "txt_content": "egqwea231 发表于 2019-12-2 21:22\nHP Parse error:  syntax error, unexpected '?' in /home/admin/recaptcha_server/server.php on line 23\n ...\n把 short_open_tag = 设置为 On"
        },
        {
            "author": "PaulWong",
            "timestamp": 1575345840,
            "txt_content": "可是没找到啊"
        },
        {
            "author": "PaulWong",
            "timestamp": 1575345840,
            "txt_content": "我反复通过搜索搜了好几遍"
        },
        {
            "author": "Akkariin",
            "timestamp": 1575366780,
            "txt_content": "egqwea231 发表于 2019-12-3 12:04\n我反复通过搜索搜了好几遍\n在你的 php.ini 文件里面\n一般在 /usr/local/php/etc/php.ini"
        },
        {
            "author": "Chinamiao喵酱",
            "timestamp": 1575369120,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "PaulWong",
            "timestamp": 1575371580,
            "txt_content": "\n\n\n\n\n无标题.png (81.59 KB, 下载次数: 0)\n\n下载附件\n\n2019-12-3 19:12 上传\n\n\n\n\n上面没有你说的那个选项\n"
        },
        {
            "author": "小小周尼玛",
            "timestamp": 1582444500,
            "txt_content": " 本帖最后由 小小周尼玛 于 2020-2-24 08:40 编辑 \n\n请问BC支持吗？"
        },
        {
            "author": "小小周尼玛",
            "timestamp": 1582456500,
            "txt_content": "[root@iZbp12wcynh0t96fq195p7Z recaptcha_server]# php server.php\nPHP Fatal error:  Uncaught Error: Class 'swoole_http_server' not found in /root/recaptcha_server/server.php:16\nStack trace:\n#0 {main}\n  thrown in /root/recaptcha_server/server.php on line 16\n\nFatal error: Uncaught Error: Class 'swoole_http_server' not found in /root/recaptcha_server/server.php:16\nStack trace:\n#0 {main}\n  thrown in /root/recaptcha_server/server.php on line 16\n您好，php server.php后会这样"
        },
        {
            "author": "Akkariin",
            "timestamp": 1582494420,
            "txt_content": "小小周尼玛 发表于 2020-2-23 19:15\n您好，php server.php后会这样\nSwoole 没装或者没在 php.ini 里面配置"
        },
        {
            "author": "小小周尼玛",
            "timestamp": 1582504980,
            "txt_content": "Akkariin 发表于 2020-2-24 05:47\nSwoole 没装或者没在 php.ini 里面配置\n是按您的操作打了指令装的swoole\n如果是php.ini里没配置，请问需要怎么配置呢\n还想请问BC不支持吗，插件放到BC的plugin里没有加载成功，如果放到大厅的plugin里是否起不到反压测的作用了"
        },
        {
            "author": "Javi_",
            "timestamp": 1582518060,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "Akkariin",
            "timestamp": 1582556340,
            "txt_content": "小小周尼玛 发表于 2020-2-24 08:43\n是按您的操作打了指令装的swoole\n如果是php.ini里没配置，请问需要怎么配置呢\n还想请问BC不支持吗 ...\n输入以下命令查看 php.ini 的位置：\nphp -i | grep \"Loaded Configuration\"复制代码\n插件并不能在 BC 里直接运行，安装在子服理论上也有效果，不过我没有测试过，因为我自己服务器是单端，这个插件最初设计的时候也是给我自己服务器用的，所以没有考虑过兼容 BC，等我有空可以做个兼容版本。"
        },
        {
            "author": "小小周尼玛",
            "timestamp": 1582594200,
            "txt_content": "Akkariin 发表于 2020-2-24 22:59\n输入以下命令查看 php.ini 的位置：\n\n插件并不能在 BC 里直接运行，安装在子服理论上也有效果，不过我没 ...\n非常感谢您的分享和耐心解答！"
        },
        {
            "author": "MCGO1",
            "timestamp": 1582902720,
            "txt_content": "\n\n\n\n\nmcbbs.png (33.67 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-28 23:12 上传\n\n\n\n\n\n"
        },
        {
            "author": "Akkariin",
            "timestamp": 1582970280,
            "txt_content": "MCGO1 发表于 2020-2-28 23:12\ncURL 版本太低了，你用的是什么系统？"
        },
        {
            "author": "MCGO1",
            "timestamp": 1582980120,
            "txt_content": "Akkariin 发表于 2020-2-29 17:58\ncURL 版本太低了，你用的是什么系统？\n系统:centos7"
        },
        {
            "author": "Akkariin",
            "timestamp": 1583085780,
            "txt_content": "MCGO1 发表于 2020-2-29 20:42\n系统:centos7\n请尝试yum install curl-devel -y复制代码之后再进行编译操作"
        },
        {
            "author": "1214090013",
            "timestamp": 1583226480,
            "txt_content": "很不错啊"
        },
        {
            "author": "david890504",
            "timestamp": 1589553180,
            "txt_content": "終於可以擋掉那些熊孩子的攻擊了"
        },
        {
            "author": "めぐみん",
            "timestamp": 1596121620,
            "txt_content": "挺不错的插件，\n另外请问下自建服务器怎么启用https("
        },
        {
            "author": "泉泉Ace解说",
            "timestamp": 1596397320,
            "txt_content": "awa真的不会用，用了半天了，ubuntu填完服务器Screen咋装，然后咋样？我现在有点懵"
        },
        {
            "author": "mc4952",
            "timestamp": 1596397740,
            "txt_content": "askyblockaskyblock"
        },
        {
            "author": "拔丝丝",
            "timestamp": 1596789060,
            "txt_content": "感谢老大的分享。"
        }
    ]
}