{
    "title": "PocketMoney插件怎么赋予权限。",
    "author": "小綮",
    "replyCount": 5,
    "timestamp": 1374464880,
    "txt_content": "有些玩家使用/money指令 显示无权限\n请问怎么赋予权限",
    "replies": [
        {
            "author": "TylrDrdn",
            "timestamp": 1374466560,
            "txt_content": " 本帖最后由 TylrDrdn 于 2013-7-22 12:22 编辑 \n\n也许是因为你安装的PocketMoney插件不是最新版的，作者在新版内应该已经加入了自动注册。。用记事本打开PocketMoney.php对照以下代码，如果发现版本不同，直接将以下代码替换进去即可：\n来源：https://www.dropbox.com/s/zk7t36y5iby0hsf/PocketMoney.php\n<?php \n \n/*\n __PocketMine Plugin__\nname=PocketMoney\ndescription=PocketMoney introduces economy into your PocketMine world.\nversion=1.7.2\nauthor=MinecrafterJPN\nclass=PocketMoney\napiversion=9\n*/\n \ndefine(\"DEFAULT_MONEY\", 500);\n \nclass PocketMoney implements Plugin\n{\n    private $api, $path;\n \n    public function __construct(ServerAPI $api, $server = false)\n    {\n        $this->api = $api;\n    }\n \n    public function init()\n    {\n        $this->api->addHandler(\"player.join\", array($this, \"eventHandler\"));\n        $this->api->addHandler(\"money.handle\", array($this, \"eventHandler\"));\n        $this->api->addHandler(\"money.player.get\", array($this, \"eventHandler\"));\n        $this->api->console->register(\"money\", \"PocketMoney command\", array($this, \"commandHandler\"));\n \n        $this->path = $this->api->plugin->createConfig($this, array());\n    }\n \n    public function eventHandler($data, $event)\n    {\n        $cfg = $this->api->plugin->readYAML($this->path . \"config.yml\");\n        switch($event)\n        { \n            case \"player.join\":\n                $target = $data->username; \n                if(!array_key_exists($target, $cfg))\n                { \n                    $this->api->plugin->createConfig($this,array( \n                            $target => array( \n                                    'money' => DEFAULT_MONEY \n                            ) \n                    ));\n                    $this->api->chat->broadcast(\"[PocketMoney]$target has been registered.\");\n                } \n                break;\n            case \"money.handle\":\n                if(!isset($data['username']) or !isset($data['method']) or !isset($data['amount'])) return false;\n                $target = $data['username'];\n                $method = $data['method'];\n                $amount = (int)$data['amount'];\n                if($this->api->player->get($target) === false or !array_key_exists($target, $cfg) or !is_numeric($amount))\n                { \n                    return false; \n                }\n                switch($method)\n                {\n                    case \"set\":\n                        if($amount < 0)\n                        { \n                            return false; \n                        }\n                        $result = array( \n                                $target => array( \n                                        'money' => $amount\n                                ) \n                        );\n                        $this->overwriteConfig($result);\n                        break;\n                    case \"grant\":\n                        $targetMoney = $cfg[$target]['money'] + $amount;\n                        if($targetMoney < 0) return false; \n                        $result = array( \n                                $target => array( \n                                        'money' => $targetMoney\n                                ) \n                        ); \n                        $this->overwriteConfig($result);\n                        break;\n                    default:\n                        return false;\n                }\n                return true;\n            case \"money.player.get\":\n                if(array_key_exists($data['username'], $cfg))\n                {\n                    return $cfg[$data['username']]['money']; \n                }\n                return false; \n        }\n    }\n    public function userCommandHandler($cmd, $args, $issuer, $alias) \n    {\n        $output = \"\"; \n        switch($cmd){ \n            case \"money\": \n                $subCommand = $args[0]; \n                $cfg = $this->api->plugin->readYAML($this->path . \"config.yml\"); \n                switch($subCommand){ \n                    case \"\": \n                        if(!array_key_exists($issuer->username, $cfg)) \n                        { \n                            $output .= \"[PocketMoney]You have not been registered.\"; \n                            break; \n                        } \n                        $money = $cfg[$issuer->username]['money']; \n                        $output .= \"[PocketMoney]$money PM\"; \n                        break; \n                    case \"pay\": \n                        $target = $args[1]; \n                        $payer = $issuer->username; \n                        if($target === $payer) \n                        { \n                            $output .= \"[PocketMoney]You cannot pay yourself.\"; \n                            break; \n                        } \n                        if(!$this->api->player->get($target)) \n                        { \n                            $output .= \"[PocketMoney]$target is not in the server now.\"; \n                            break; \n                        } \n                        $targetMoney = $cfg[$target]['money']; \n                        $payerMoney = $cfg[$payer]['money']; \n                        $amount = $args[2]; \n                        if(!is_numeric($amount) or $amount < 0 or $amount > $payerMoney) \n                        { \n                            $output .= \"[PocketMoney]Invalid amount.\"; \n                            break; \n                        } \n                        $targetMoney += $amount; \n                        $payerMoney -= $amount; \n                        $result = array( \n                                $payer => array( \n                                        'money' => $payerMoney\n                                ), \n                                $target => array( \n                                        'money' => $targetMoney\n                                ) \n                        ); \n                        $this->overwriteConfig($result); \n                        $output .= \"[PocketMoney]Completed pay process.\"; \n                        $this->api->chat->sendTo(false, \"[PocketMoney]$amount PM paid from $payer\", $target); \n                        break; \n                    case \"top\": \n                        $amount = $args[1]; \n                        $temp = array(); \n                        foreach($cfg as $name => $elements) \n                        { \n                            $temp[$name] = $elements['money']; \n                        } \n                        arsort($temp); \n                        $i = 1; \n                        $output .= \"[PocketMoney]List of Millionaires\\n\"; \n                        foreach($temp as $name => $money) \n                        { \n                            if($i > $amount){ \n                                break; \n                            } \n                            $output .= \"#$i : $name $money PM\\n\"; \n                            $i++; \n                        } \n                        break; \n                    case \"stat\": \n                        $total = 0; \n                        $num = 0; \n                        foreach($cfg as $name => $elements) \n                        { \n                            $total += $elements['money']; \n                            $num++; \n                        } \n                        $avr = floor($total / $num); \n                        $output .= \"[PocketMoney]Circ:$total Avr:$avr Accounts:$num\"; \n                        break; \n                    default: \n                        $output .= \"[PocketMoney]Such sub command dose not exist.\"; \n                        break; \n                } \n                break; \n        } \n        return $output;\n    }\n \n    public function commandHandler($cmd, $args, $issuer, $alias)\n    {\n        $cmd = strtolower($cmd);\n        if($issuer !== \"console\")\n        {\n            return $this->userCommandHandler($cmd, $args, $issuer, $alias);\n        }\n        switch($cmd)\n        {\n            case \"money\":\n                $cfg = $this->api->plugin->readYAML($this->path . \"config.yml\");\n                $subCommand = $args[0];\n                switch($subCommand)\n                {\n                    case \"\":\n                    case \"help\":\n                        console(\"[PocketMoney]/money help( or /money )\");\n                        console(\"[PocketMoney]/money set <target> <amount>\");\n                        console(\"[PocketMoney]/money grant <target> <amount>\");\n                        break;\n                    case \"set\":\n                        $target = $args[1];\n                        $amount = $args[2];\n                        if(!$this->api->player->get($target))\n                        {\n                            console(\"[PocketMoney]$target is not in the server now.\");\n                            break;\n                        }\n                        /*if(!array_key_exists($target, $cfg))\n                         {\n                        console(\"[PocketMoney]$target has not been registered.\");\n                        break;\n                        } */\n                        if($amount < 0 or !is_numeric($amount))\n                        {\n                            console(\"[PocketMoney]Invalid amount.\");\n                            break;\n                        }\n                        $result = array(\n                                $target => array(\n                                        'money' => $amount\n                                )\n                        );\n                        $this->overwriteConfig($result);\n                        console(\"[PocketMoney]Completed set process.\");\n                        $this->api->chat->sendTo(false, \"[PocketMoney][set]Your money has been changed.\\n$target:$amount PM\", $target);\n                        break;\n                    case \"grant\":\n                        $target = $args[1];\n                        if(!$this->api->player->get($target))\n                        {\n                            console(\"[PocketMoney]$target is not in the server now.\");\n                            break;\n                        }\n                        if(!array_key_exists($target, $cfg))\n                        {\n                            console(\"[PocketMoney]$target has not been registered.\");\n                            break;\n                        }\n                        $amount = $args[2];\n                        $targetMoney = $cfg[$target]['money'] + $amount;\n                        if(!is_numeric($amount) or $targetMoney < 0)\n                        {\n                            console(\"[PocketMoney]Invalid amount.\");\n                            break;\n                        }\n                        $result = array(\n                                $target => array(\n                                        'money' => $targetMoney\n                                )\n                        );\n                        $this->overwriteConfig($result);\n                        console(\"[PocketMoney]Completed grant process.\");\n                        $this->api->chat->sendTo(false, \"[INFO][grant]Your money has been changed.\\n$target:$targetMoney PM\", $target);\n                        break;\n                    case \"top\":\n                        $amount = $args[1]; \n                        $temp = array(); \n                        foreach($cfg as $name => $elements)\n                        { \n                            $temp[$name] = $elements['money']; \n                        } \n                        arsort($temp); \n                        $i = 1; \n                        console(\"[PocketMoney]List of Millionaires\"); \n                        foreach($temp as $name => $money)\n                        { \n                            if($i > $amount)\n                            { \n                                break; \n                            } \n                            console(\"#$i : $name $money PM\"); \n                            $i++; \n                        }\n                        break;\n                    case \"stat\":\n                        $total = 0; \n                        $num = 0; \n                        foreach($cfg as $name => $elements)\n                        { \n                            $total += $elements['money']; \n                            $num++; \n                        } \n                        $avr = floor($total / $num); \n                        console(\"[PocketMoney]Circulation:$total Average:$avr Accounts:$num\");\n                        break;\n                    default:\n                        console(\"[PocketMoney]Such command dose not exist.\");\n                        break;\n                }\n                break;\n        }\n \n    }\n \n    private function overwriteConfig($dat)\n    {\n        $cfg = array();\n        $cfg = $this->api->plugin->readYAML($this->path . \"config.yml\");\n        $result = array_merge($cfg, $dat);\n        $this->api->plugin->writeYAML($this->path.\"config.yml\", $result);\n    }\n \n    public function __destruct()\n    { \n    }\n}复制代码\n\n或者使用op指令赋予玩家OP权限应该就可以使用了，如果你不介意所有玩家都有OP权限的话。。/op [玩家名]复制代码（在console内输入指令时前面不需要斜杠）\n\n另外不清楚你有没有使用白名单或者其他插件，也许是受到其他插件影响。。"
        },
        {
            "author": "小綮",
            "timestamp": 1374471000,
            "txt_content": " 本帖最后由 小綮 于 2013-7-22 13:50 编辑 \nTylrDrdn 发表于 2013-7-22 12:16 \n也许是因为你安装的PocketMoney插件不是最新版的，作者在新版内应该已经加入了自动注册。。用记事本打开Poc ...\n\n进入游戏的时候有提示 已注册，但是还是查不了。OP就查的了。。\n我把其他插件全删了只保留PocketMoney也是一样"
        },
        {
            "author": "TylrDrdn",
            "timestamp": 1374481380,
            "txt_content": " 本帖最后由 TylrDrdn 于 2013-7-22 16:25 编辑 \n小綮 发表于 2013-7-22 13:30 \n进入游戏的时候有提示 已注册，但是还是查不了。OP就查的了。。\n我把其他插件全删了只保留PocketMoney ...\n只有OP可以查就表示其他人没有权限了，试试看安装SignConsole赋予权限SignConsole地址：http://www.minecraftforum.net/topic/1678429-pocketmine-mp-plugins-by-omattyao-new-worldlogger-pirsonplugin/"
        },
        {
            "author": "小綮",
            "timestamp": 1374483060,
            "txt_content": "TylrDrdn 发表于 2013-7-22 16:23 \n只有OP可以查就表示其他人没有权限了，试试看安装SignConsole赋予权限SignConsole地址：http://www.minec ...\n能教我怎么用吗，机翻看不懂"
        },
        {
            "author": "TylrDrdn",
            "timestamp": 1374484680,
            "txt_content": "小綮 发表于 2013-7-22 16:51 \n能教我怎么用吗，机翻看不懂\nQQ远程帮你把。。。"
        }
    ]
}