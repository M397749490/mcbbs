{
    "title": "[盗版皮肤相关]或许1.8.9（和1.8.8）的皮肤还能再抢救一下",
    "author": "52Dora",
    "replyCount": 0,
    "timestamp": 1454080800,
    "txt_content": "众所周知，从Minecraft 1.7.10开始，盗版用户的皮肤成了一个大问题，曾经通过AbstractClientPlayer类里面的部分方法获取皮肤的方法已经失效，改用Mojang自带的验证API获取皮肤，不过这些问题都得到了解决——UniSkinMod和CustomSkinLoader提供了解决方案。不过好景不长，由于国外某些技术系玩家找到了通过自定义NBT获取自定义头颅的方法，Mojang于1.8.4时期添加了皮肤域名白名单系统，只能接受来自mojang.com和minecraft.net的皮肤，于是大家懂得。\n最终，即使MinecraftForge升级到1.8.8甚至是1.8.9版还是没有兼容这些版本的皮肤Mod（或许是本人太心急的原因？）。\n\n实际上，1.8.9的皮肤或许还能再抢救一下。\n\n发现祸根\n由于个人原因，想玩玩1.8.9，于是开始找各种Mod，顺便解决一下皮肤问题。\n\n就在准备解决皮肤问题的时候，突然想到1.8.4开始不能使用外站皮肤的“BUG”，于是开始寻找该功能的来源。\n\n很快，本人在验证API的YggdrasilMinecraftSessionService类里找到了这些东西：\nprivate static final String[] WHITELISTED_DOMAINS = new String[]{\".minecraft.net\", \".mojang.com\"}; // 定义白名单域名复制代码private static boolean isWhitelistedDomain(String url) {\n        URI uri = null;\n\n        try {\n            uri = new URI(url); // 定义该皮肤的URL地址\n        } catch (URISyntaxException var4) {\n            throw new IllegalArgumentException(\"Invalid URL \\'\" + url + \"\\'\");\n        }\n\n        String domain = uri.getHost(); // 获取地址的主机名\n\n        for(int i = 0; i < WHITELISTED_DOMAINS.length; ++i) { // 遍历白名单里的域名\n            if(domain.endsWith(WHITELISTED_DOMAINS[i])) { // 检查主机名是否为白名单所设\n                return true; // 如果在白名单里，就算通过\n            }\n        }\n\n        return false; // 如果不在白名单里，对不起，丢掉丢掉\n    }复制代码（别问我怎么弄来的源代码，IDEA大法好，如果违规请通知我删除）\n\n找到万恶之源就很简单了，接下来便是使用Forge的Coremod技术把这个方法给黑掉。\n\n[diamond_pickaxe]大修大补\n\n在这里使用的模组源代码是UniSkinMod，使用GPL v2协议，特别感谢模组原作者@RecursiveG  。\n\n\n首先在Transformers添加修改这些方法的代码，于是有样学样地弄了一下：\n在构造方法里添加：\n// Removes skin domain whitelist system to support custom skin\nhookMethod(\"com.mojang.authlib.yggdrasil.YggdrasilMinecraftSessionService\",\"isWhitelistedDomain\",\"isWhitelistedDomain\",\n                \"(Ljava/lang/String;)Z\",\n                new isWhitelistedDomainTransformer());\n\n然后弄一个类：\n    /** Removes skin domain whitelist system to support custom skin [url=home.php?mod=space&uid=1231151]@author[/url] DoraJDJ */\n    private class isWhitelistedDomainTransformer implements IMethodTransformer{\n        @Override\n        public void transform(MethodNode mn, String srgName, boolean devEnv, String classObfName) {\n            mn.instructions.clear();\n            mn.instructions.add(new InsnNode(Opcodes.ICONST_1));\n            mn.instructions.add(new InsnNode(Opcodes.IRETURN));\n            mn.maxLocals=0;mn.maxStack=0;\n        }\n    }复制代码\n通常情况下，这样做就算可以了，但是后来发现在运行的时候出现了错误\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]: java.lang.reflect.InvocationTargetException\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at java.lang.reflect.Method.invoke(Method.java:497)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at net.minecraftforge.gradle.GradleStartCommon.launch(GradleStartCommon.java:97)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at GradleStart.main(GradleStart.java:26)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at java.lang.reflect.Method.invoke(Method.java:497)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1052]:         at com.intellij.rt.execution.application.AppMain.main(AppMain.java:144)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1061]: Caused by: net.minecraftforge.fml.relauncher.FMLSecurityManager$ExitTrappedException\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1061]:         at net.minecraftforge.fml.relauncher.FMLSecurityManager.checkPermission(FMLSecurityManager.java:30)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1061]:         at java.lang.SecurityManager.checkExit(SecurityManager.java:761)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1061]:         at java.lang.Runtime.exit(Runtime.java:107)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1061]:         at java.lang.System.exit(System.java:971)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1061]:         at net.minecraft.launchwrapper.Launch.launch(Launch.java:138)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1061]:         at net.minecraft.launchwrapper.Launch.main(Launch.java:28)\n[19:14:55] [Client thread/INFO]: [java.lang.ThreadGroup:uncaughtException:1061]:         ... 11 more复制代码\n经过各种自学，发现疑似是try-catch block和exceptions的问题，在mn.instructions.clear();后面再添加两行代码，问题解决：\n            mn.exceptions.clear();\n            mn.tryCatchBlocks.clear();复制代码（若有错误欢迎指出）\n\n至此，1.8.9的皮肤问题完美解决。\n\n最后，好奇的孩子可以看下源码了解下：https://github.com/DoraJDJ/UniSkinMod\n\n初投稿，若有任何意见欢迎指出(:3JZ\n",
    "replies": []
}