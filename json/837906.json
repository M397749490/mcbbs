{
    "title": "关于迁移数据出现的问题",
    "author": "混乱",
    "replyCount": 28,
    "timestamp": 1547639520,
    "txt_content": "由于数据迁移不全，部分变量没有正确储存，权衡利弊后，管理组决定为了修复bug，回滚一天数据。\n对各位会员造成的影响，我们深感抱歉，还请见谅。后续补偿方案正在讨论中。\n\n目前还存在的问题：由于缓存机制失灵，我们暂时关闭的缓存功能，未来还可能再次发生维护。\n\n\nMCBBS管理组\n2019年1月16日\n\n",
    "replies": [
        {
            "author": "ruhuasiyu",
            "timestamp": 1547652420,
            "txt_content": "成功补签"
        },
        {
            "author": "Оil",
            "timestamp": 1547652840,
            "txt_content": "回滚还行……"
        },
        {
            "author": "未知幻想",
            "timestamp": 1547656380,
            "txt_content": "回滚可还行"
        },
        {
            "author": "Twilight_Two",
            "timestamp": 1547656500,
            "txt_content": "没事，比前段时间好多了"
        },
        {
            "author": "小cheng",
            "timestamp": 1547676540,
            "txt_content": "关闭的缓存功能\n这是什么功能，作用是什么。"
        },
        {
            "author": "向文",
            "timestamp": 1547682600,
            "txt_content": " 本帖最后由 向文 于 2019-1-17 07:51 编辑 \n\n反正不会经常404就好"
        },
        {
            "author": "MC_Eleven",
            "timestamp": 1547697720,
            "txt_content": "至少比几天前好多了,几天前时不时就会无法显示网页刷新还没用,浏览器医生都修复不了"
        },
        {
            "author": "凛",
            "timestamp": 1547700180,
            "txt_content": "三十個石頭 全壇失憶"
        },
        {
            "author": "ppipip110",
            "timestamp": 1547707740,
            "txt_content": "老是让激活邮箱，是迁移的问题吗？版主大大查一下"
        },
        {
            "author": "暗夜Elen",
            "timestamp": 1547714760,
            "txt_content": "没看到这条 没补签 哦豁 完蛋\n一人血书补签卡"
        },
        {
            "author": "A_egg-Chan",
            "timestamp": 1547725380,
            "txt_content": "awa。我小号重注一遍。我说怎么登都上不去"
        },
        {
            "author": "莉莉霍瓦特",
            "timestamp": 1547727360,
            "txt_content": "请提供20钻石作为补偿（滑稽）"
        },
        {
            "author": "pixelgear",
            "timestamp": 1547736240,
            "txt_content": "雨夜蔷薇 发表于 2019-1-17 16:46\n没看到这条 没补签 哦豁 完蛋\n一人血书补签卡\n早早就睡了 没补签 完蛋\n二人血书补签卡"
        },
        {
            "author": "可爱的吐司",
            "timestamp": 1547766900,
            "txt_content": "迁移数据后论坛流畅了不少，希望mcbbs越来越好"
        },
        {
            "author": "Akkariin",
            "timestamp": 1547848560,
            "txt_content": " 本帖最后由 Akkariin 于 2019-1-19 06:01 编辑 \n\n关于本次论坛的更新，我有几句话想说。\n\n论坛更新后，Empty Response 问题得以解决，但是 403 的问题还是持续存在。最外层的 CDN 应该还是腾讯云的 CDN，个人对于腾讯云的 CDN 感觉并不是很好，以前用过，体验不佳，防护效果较差。使用了一些工具进行扫描，发现论坛安装的插件数量较多，不排除是有部分插件优化不佳导致拖慢整体运行速度。之前在部分页面加载时，根据底部的统计数据可以看到，执行时间超过了 0.2s，现在快了一点。感觉是 MCBBS 的服务器配置不够，容我瞎猜一下，大概不超过 8 核 8G？\n\n为什么会得出上面的部分结论呢？\n\n首先，MCBBS 目前用的这套主题感觉上优化不是特别好，根据控制台的统计，首页加载的 CSS 共 3 个，JS 共 12 个。\n有些 Js 像 JQuery 其实可以用很多公共的 CDN 服务代替，例如百度的前端公共 DNS，BootCss 等等。\n然后就是请求数，一般来说请求数越少加载越快，可以尝试将多个 CSS、JS 合并为一个以缩短加载时间。\n\n最后就是 CDN 和服务器，如果我没记错 MCBBS 之前的服务器用的是扬-州高防秒解，现在迁移了以后不清楚。\n8 核 8G 是我之前通过拿自己的机器做对比测试得出的结果，实际上可能不止。\n目前的配置可能是比之前高了，或者更换了 PHP 版本提升了执行效率，总体感觉比之前快了不少。\n\n之前总是容易被别人攻击就挂掉，感觉还是服务器配置低了或者优化不好，之前我在半夜做过测试（也只是唯一的一次，一次没有恶意的测试），使用了 1024 线程 + 代理 CC 了一下，直接就 502 Bad Gateway 了，但是我用同样的线程数量攻击我自己的论坛，完全打不动，直到我把线程开到 8192 才打死，并且我的论坛是没有任何 CDN 防护的，纯靠单机硬扛 CC。不过我的 CPU 是 32 核 64 线程……所以抗打还是有原因的。\n\n防御 CC 光靠 CDN 也是没用的，别人很容易绕过 CDN 直接攻击源站，具体原因可以看我的一篇文章：https://lo-li.cn/942\n文章内容写的很详细，介绍了几种绕过网站 CDN 的方法，以及防御的方法。\nCDN 顶多也就扛个 DDoS，缓存一下静态页面，如果别人 CC 动态页面，还是一样回源。而让数万 QPS 的包转发率进入后端，网站早死了。\n\n最后也希望 MCBBS 继续发展，越做越好。\n混乱和全体管理组，你们辛苦了。"
        },
        {
            "author": "南雉。",
            "timestamp": 1547872800,
            "txt_content": "回滚？动词精辟"
        },
        {
            "author": "ljh221",
            "timestamp": 1548031080,
            "txt_content": "本人发帖，编辑502望重视"
        },
        {
            "author": "gamerteam",
            "timestamp": 1548042960,
            "txt_content": "Akkariin 发表于 2019-1-19 05:56\n关于本次论坛的更新，我有几句话想说。\n1.403的问题确认了下，是B站防火墙设定的太严格导致。\n2.目前腾讯云CDN是与B站共用的，经过B站这么久的使用来看，并没有什么问题（毕竟世界加钱可及）。\n3.目前正式论坛的插件并不多，而且目前大部分插件都是由我来编写的。为了保证稳定性与未来dz更新等因素，部分功能只能做成插件的形式。\n4.底部那个是数据库响应速度。\n5.服务器是与B站某分站共用的服务器，不存在配置问题，更多是dz框架上的局限性。\n\n同时，由于dz的模块化设计，部分css没法合并；css这些dz自带有压缩等，基本上影响不是很大了。至于使用共用CDN，以前有过360提供的CDN跑路的情况的，所以这一点我保持谨慎的态度。毕竟这类静态资源论坛本身CDN就有缓存的，不缺这点CDN流量。\n\n关于CC防御等这些内容，受限于dz的局限性，没法进行大刀阔斧的改动，也只能硬抗。\n绕过CDN这点之前已经有很多人提交过了，不过防御这种东西本来就没有完美无缺的。"
        },
        {
            "author": "hcnzy",
            "timestamp": 1548055740,
            "txt_content": "还阔以               "
        },
        {
            "author": "Akkariin",
            "timestamp": 1548097020,
            "txt_content": " 本帖最后由 Akkariin 于 2019-1-22 03:05 编辑 \ngamerteam 发表于 2019-1-21 11:56\n1.403的问题确认了下，是B站防火墙设定的太严格导致。\n2.目前腾讯云CDN是与B站共用的，经过B站这么久的使 ...\n嗯，关于插件和论坛优化，我有几个建议：\n\n在 SQL 查询方面，尽量做成连接复用，减少查询数量服务器 PHP 如果支持 Zend OPcache，可以考虑打开，这是一个高性能的缓存在储存临时用户数据时可以用 Redis，如果数据量大可以考虑上 Memcached公共前端资源 CDN 服务尽量选择可靠的，例如百度。360 的不良记录太多了不可信首页、帖子列表做静态化，推荐首页缓存时间 10 分钟，帖子列表缓存时间 5 分钟，帖子内容缓存 5 分钟。限制单 IP 搜索查询速率，重点防护搜索页面，通常 CC 攻击对于 Search 是致命的\n\n论坛方面如果有什么我可以帮得上的，欢迎来找我，最近太闲了（笑\n未来可能考虑给 MCBBS 赞助一台服务器？这样就不用和 B 站挤同一台服务器了（如果有需要的话）。\n如果能够参与论坛的建设与维护，我觉得是一件很荣幸的事情。\n另外……我又回来了，之前自闭了一段时间，现在还是打算重新回到 MCBBS \n每天就是看看帖，打打游戏，除此之外我好像也没什么事做了。\n\nPS：小萝莉又在深夜爆改论坛吧……回个帖的时间又发现好几个地方变了 233"
        },
        {
            "author": "a2393627994",
            "timestamp": 1548102840,
            "txt_content": "还行应该可以吧"
        },
        {
            "author": "56646545",
            "timestamp": 1548896880,
            "txt_content": "论坛总是页面无法访问，和这个有关系吗"
        },
        {
            "author": "cyqsimon",
            "timestamp": 1549400820,
            "txt_content": "听说有人要我背锅？\n\n\n\n\n\nTIM图片20190205210710.jpg (4.77 KB, 下载次数: 21)\n\n下载附件\n\n2019-2-6 05:07 上传\n\n\n\n\n"
        },
        {
            "author": "何祈睿",
            "timestamp": 1554545340,
            "txt_content": "asdasdasdasdasdas"
        },
        {
            "author": "WSY666",
            "timestamp": 1558756200,
            "txt_content": "66666666666666"
        },
        {
            "author": "天阁守护",
            "timestamp": 1564308900,
            "txt_content": "我知道了，好奇怪，呵呵"
        },
        {
            "author": "QWRTWETWTW",
            "timestamp": 1566695280,
            "txt_content": "幸亏我来晚了 跟我一点关系没有 awa"
        },
        {
            "author": "2431267050",
            "timestamp": 1568158860,
            "txt_content": "我发现丢了好多钻石，原来回档了啊"
        }
    ]
}