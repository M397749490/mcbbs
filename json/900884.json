{
    "title": "GuiContainer Container如何在客户端与服务端之间同步非物品的数据",
    "author": "common",
    "replyCount": 4,
    "timestamp": 1565531460,
    "txt_content": "按照教程添加了GUIContainer和Container，实现了物品之间的转移，但添加了一个按钮希望按下的时候改变数据的时候发现，不管是在GUIContainer中重写的actionPerformed函数中直接操作GUIContainer中的EntityPlayer还是调用对应的Container中的函数操作Container里传进的EntityPlayer，所有的修改都只是华丽的客户端特效，退出重进存档就恢复原样......我想可能是少了一个客户端发送 指令/数据 到服务端的步骤，然而教程中只提到了如何从服务端传输数据同步到客户端，那么如何从客户端传输 数据/指令 到服务端？\nGUIContainer源代码\npackage kk.kk_mod.EnchantmentLevelUp;\n\nimport java.io.IOException;\n\nimport kk.kk_mod.KKItemLoader;\nimport kk.kk_mod.kk_mod;\nimport net.minecraft.client.gui.GuiButton;\nimport net.minecraft.client.gui.inventory.GuiContainer;\nimport net.minecraft.client.renderer.GlStateManager;\nimport net.minecraft.client.resources.I18n;\nimport net.minecraft.item.ItemStack;\nimport net.minecraft.util.ResourceLocation;\nimport net.minecraftforge.fml.relauncher.Side;\nimport net.minecraftforge.fml.relauncher.SideOnly;\nimport net.minecraft.entity.player.EntityPlayer;\n\n@SideOnly(Side.CLIENT)\npublic class KKTransEnergyPointGuiContainer extends GuiContainer\n{\n        private static final int BUTTON_EXP = 0;\n        EntityPlayer EntityPlayer;//直接对它操作貌似会出现华丽的客户端特效\n        KKTransEnergyPointContainer KKTransEnergyPointContainer;\n        @Override\n    public void initGui()\n    {\n                super.initGui();\n                int offsetX = (this.width - this.xSize) / 2, offsetY = (this.height - this.ySize) / 2;\n                this.buttonList.add(new GuiButton(BUTTON_EXP, offsetX + 24, offsetY + 40, 80, 20, \"将经验转化为附魔点数\"));\n    }\n        \n        public KKTransEnergyPointGuiContainer(KKTransEnergyPointContainer KKTransEnergyPointContainerIn) \n        {\n                super(KKTransEnergyPointContainerIn);\n                KKTransEnergyPointContainer=KKTransEnergyPointContainerIn;\n                EntityPlayer=KKTransEnergyPointContainer.EntityPlayer;\n                this.xSize = 256;\n        this.ySize = 256;\n        }\n\n        private static final String TEXTURE_DOMAIN = kk_mod.MODID;\n        private static final String TEXTURE_PATH = \"textures/gui/container/kk_enchant_table256x.png\";\n    private static final ResourceLocation TEXTURE = new ResourceLocation(TEXTURE_DOMAIN,TEXTURE_PATH);\n    \n        @Override\n        protected void drawGuiContainerBackgroundLayer(float partialTicks, int mouseX, int mouseY) \n        {\n                \n                GlStateManager.color(1.0F, 1.0F, 1.0F);\n        this.mc.getTextureManager().bindTexture(TEXTURE);\n        int offsetX = (this.width - this.xSize) / 2, offsetY = (this.height - this.ySize) / 2;\n        this.drawTexturedModalRect(offsetX, offsetY, 0, 0, this.xSize, this.ySize);\n        \n        }\n        \n        @Override\n    protected void actionPerformed(GuiButton button) throws IOException\n    {\n        switch (button.id)\n        {\n        case BUTTON_EXP:\n                KKTransEnergyPointContainer.doTranExpToPoint();\n            break;\n        default:\n            return;\n        }\n    }\n        \n        @Override\n    protected void drawGuiContainerForegroundLayer(int mouseX, int mouseY)\n    {\n                this.drawVerticalLine(37, 19, 36, 0xFF000000);\n                this.drawVerticalLine(69, 19, 36, 0xFF000000);\n                this.drawVerticalLine(101, 19, 36, 0xFF000000);\n                this.drawVerticalLine(133, 19, 36, 0xFF000000);\n                this.drawVerticalLine(54, 19, 36, 0xFF000000);\n                this.drawVerticalLine(86, 19, 36, 0xFF000000);\n                this.drawVerticalLine(118, 19, 36, 0xFF000000);\n                this.drawVerticalLine(150, 19, 36, 0xFF000000);\n        this.drawHorizontalLine(37, 54, 19, 0xFF000000);\n        this.drawHorizontalLine(69, 86, 19, 0xFF000000);\n        this.drawHorizontalLine(101, 118, 19, 0xFF000000);\n        this.drawHorizontalLine(133, 150, 19, 0xFF000000);\n        this.drawHorizontalLine(37, 54, 36, 0xFF000000);\n        this.drawHorizontalLine(69, 86, 36, 0xFF000000);\n        this.drawHorizontalLine(101, 118, 36, 0xFF000000);\n        this.drawHorizontalLine(133, 150, 36, 0xFF000000);\n\n        String title = I18n.format(\"container.KKEnchantGuiContainer.title\");\n        this.fontRenderer.drawString(title, (this.xSize - this.fontRenderer.getStringWidth(title)) / 2, 6, 0x404040);\n\n        ItemStack item = new ItemStack(KKItemLoader.ControlKKEnchantBook);\n        this.itemRender.renderItemAndEffectIntoGUI(item, 8, 20);\n    }\n}\n复制代码\nContainer源代码\npackage kk.kk_mod.EnchantmentLevelUp;\n\nimport net.minecraft.entity.player.EntityPlayer;\nimport net.minecraft.inventory.Container;\nimport net.minecraft.inventory.Slot;\nimport net.minecraft.item.ItemStack;\nimport net.minecraftforge.fml.common.network.simpleimpl.SimpleNetworkWrapper;\nimport net.minecraftforge.fml.relauncher.Side;\nimport net.minecraftforge.fml.relauncher.SideOnly;\nimport net.minecraftforge.items.ItemStackHandler;\nimport net.minecraftforge.items.SlotItemHandler;\n\npublic class KKTransEnergyPointContainer extends Container\n{\n        private static final int SlotCount = 4;\n        private ItemStackHandler items = new ItemStackHandler(4);\n        public EntityPlayer EntityPlayer;\n        \n        public KKTransEnergyPointContainer(EntityPlayer playerIn)\n        {\n                super();\n                EntityPlayer=playerIn;\n        for (int i = 0; i < SlotCount; ++i)\n        {\n            this.addSlotToContainer(new SlotItemHandler(items, i, 38 + i * 32, 20));\n        }\n\n        for (int i = 0; i < 3; ++i)\n        {\n            for (int j = 0; j < 9; ++j)\n            {\n                this.addSlotToContainer(new Slot(playerIn.inventory, j + i * 9 + 9, 8 + j * 18, 171 + i * 18));\n            }\n        }\n\n        for (int i = 0; i < 9; ++i)\n        {\n            this.addSlotToContainer(new Slot(playerIn.inventory, i, 8 + i * 18, 229));\n        }\n        }\n        \n        @Override\n    public ItemStack transferStackInSlot(EntityPlayer playerIn, int index)\n    {\n                Slot slot = inventorySlots.get(index);\n                \n        if (slot == null || !slot.getHasStack())\n        {\n            return null;\n        }\n\n        ItemStack newStack = slot.getStack(), oldStack = newStack.copy();\n\n        boolean isMerged = false;\n        \n        if (index <= SlotCount-1)\n        {\n            isMerged = mergeItemStack(newStack, SlotCount, SlotCount+36, true);\n        }\n        else if (index >= SlotCount)\n        {\n            isMerged = mergeItemStack(newStack, 0, SlotCount, false);\n        }\n\n        if (!isMerged)\n        {\n            return ItemStack.EMPTY;\n        }\n\n        if (newStack.getCount() == 0)\n        {\n            slot.putStack(ItemStack.EMPTY);\n        }\n        else\n        {\n            slot.onSlotChanged();\n        }\n\n        return oldStack;\n    }\n        \n        public void doTranExpToPoint()\n        {\n                this.EntityPlayer.addExperienceLevel(1);\n                SimpleNetworkWrapper SimpleNetworkWrapper=new SimpleNetworkWrapper(null);\n                \n        }\n        \n        \n        @Override\n        public boolean canInteractWith(EntityPlayer playerIn) \n        {\n                return true;//不检查合法性直接打开Gui\n        }\n        \n        @Override\n        public void onContainerClosed(EntityPlayer playerIn)\n        {\n                super.onContainerClosed(playerIn);\n                if(playerIn.isServerWorld())\n                {\n                        ItemStack ItemStack;\n                        for(int i=0;i<SlotCount;i++)\n                        {\n                                ItemStack=this.inventoryItemStacks.get(i);\n                                playerIn.addItemStackToInventory(ItemStack);\n                        }\n                }\n                \n        }\n}\n复制代码\n\n",
    "replies": [
        {
            "author": "土球球",
            "timestamp": 1565534820,
            "txt_content": "使用 SimpleImpl 手动发包，mc 原版都是这么干的"
        },
        {
            "author": "common",
            "timestamp": 1566569520,
            "txt_content": " 本帖最后由 common 于 2019-8-23 22:14 编辑 \nustc_zzzz 发表于 2019-8-11 22:47\n使用 SimpleImpl 手动发包，mc 原版都是这么干的\n请问能给个 示例代码 或 者SimpleImpl 有文档吗？有点搞不明白同一个代码客户端服务端如何执行不同的函数？"
        },
        {
            "author": "土球球",
            "timestamp": 1566599400,
            "txt_content": "common 发表于 2019-8-23 22:12\n请问能给个 示例代码 或 者SimpleImpl 有文档吗？有点搞不明白同一个代码客户端服务端如何执行不同的函数 ...\n你在帖子里引用到的教程里就有 SimpleImpl 的介绍，另外，客户端服务端执行不同的函数用 SidedProxy，这个那篇教程里也有。"
        },
        {
            "author": "common",
            "timestamp": 1566615240,
            "txt_content": " 本帖最后由 common 于 2019-8-24 12:32 编辑 \nustc_zzzz 发表于 2019-8-24 06:30\n你在帖子里引用到的教程里就有 SimpleImpl 的介绍，另外，客户端服务端执行不同的函数用 SidedProxy，这 ...刚刚的回复搞错了，把两个教程搞混了，我再看看\n\n"
        }
    ]
}