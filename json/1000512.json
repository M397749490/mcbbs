{
    "title": "[BoneStudio]原版Debug的Profile分析+看卡顿情况方法",
    "author": "阴阳师元素祭祀",
    "replyCount": 5,
    "timestamp": 1585405620,
    "txt_content": " 本帖最后由 阴阳师元素祭祀 于 2020-3-28 22:42 编辑 \n\n前置说明\ndebug命令b站wiki\n本贴为个人理解  因为wiki居然没有该文件的说明搜索引擎我也不会用\n如果有错欢迎指出\n本贴使用的命令我也不清楚具体如何获得和下载和安装 但那肯定不是这个帖子需要讲的\n本文使用的样例文件\n因单附件最大200KB 所以使用rar压缩了\n\n\n\nprofile-results-2020-03-28_20.37.44.rar\n(30.44 KB, 下载次数: 6)\n\n\n\n2020-3-28 21:06 上传\n点击文件名下载附件\n\n\n\n\n\n\n该次报告概括:\ntps:6.66\n采样时间: 18615 ms\n采样tick: 124 ticks\n来自个人局域网电脑测试服\n\n\n文件头\n---- Minecraft Profiler Results ----\n// Am I not running fast enough? :(\n\nVersion: 1.15.2\nTime span: 18615 ms\nTick span: 124 ticks\n// This is approximately 6.66 ticks per second. It should be 20 ticks per second\n复制代码从中可以看到\n\n随机产生的有趣的注释\n版本 现实时间 和tick次数\n以及计算好的tps (6.66)\n\n--- BEGIN PROFILE DUMP ---\n\n个人理解的格式:\n[深度]  名字(调用次数/每个tick平均调用次数) - 当前深度占比/总占比复制代码例如 (深度0和1的例子)\n\n$ cat profile-results-2020-03-28_20.37.44.txt | grep \"\\[00]\\|\\(END\\)\" | head -n100 \n[00] tick(124/1) - 94.23%/94.23%\n[00] nextTickWait(123/1) - 5.77%/5.77%\n--- END PROFILE DUMP ---\n....目前无关被人工截断的输出信息复制代码\n$ cat profile-results-2020-03-28_20.37.44.txt | grep \"\\[0[01]]\\|\\(END\\)\" | head -n100\n[00] tick(124/1) - 94.23%/94.23%\n[01] |   levels(124/1) - 95.94%/90.99%\n[01] |   commandFunctions(124/1) - 2.70%/2.56%\n[01] |   connection(124/1) - 1.23%/1.16%\n[01] |   unspecified(124/1) - 0.13%/0.13%\n[01] |   tallying(124/1) - 0.00%/0.00%\n[01] |   players(124/1) - 0.00%/0.00%\n[01] |   snooper(124/1) - 0.00%/0.00%\n[01] |   server gui refresh(124/1) - 0.00%/0.00%\n[00] nextTickWait(123/1) - 5.77%/5.77%\n[01] |   #getEntities 2377/19\n[01] |   #chunkGenerate light 33/0\n[01] |   #runTask 8459/68\n[01] |   #chunkLoad 33/0\n[01] |   #getChunkCacheMiss 593/4\n[01] |   #getChunk 119095/960\n[01] |   unspecified(123/1) - 78.55%/4.56%\n[01] |   pathfind(13/0) - 16.77%/0.97%\n[01] |   move(1187/10) - 3.12%/0.18%\n[01] |   rest(1187/10) - 1.51%/0.09%\n[01] |   queueCheckLight(16/0) - 0.04%/0.00%\n--- END PROFILE DUMP ---\n....目前无关被人工截断的输出信息复制代码在深度0的情况 不存在当前深度和总的区分\n所以\n94.23+5.77=100  /  94.23+5.77=100\n在深度1的情况\n    在root下:  95.94+2.70+1.23+0.13 = 100 / 90.99+2.56+1.16+0.13 = 94.84     \n (至于为什么不等于94.23 你问为什么要四舍五入到两位数)\n    在nextTickWait下:  78.55+16.77+3.12+1.51+0.04 = 99.99 / 4.56+0.97+0.18+0.09 = 5.8\n\n\ndebug的时候 后台有提示  (比如这种很卡的时候)\n[anchor=折叠内容]折叠内容[/anchor]\n\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root.tick.levels.world minecraft:overworld.tick.entities.regular' took aprox 102.731888 ms\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root.tick.levels.world minecraft:overworld.tick.entities' took aprox 105.683346 ms\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root.tick.levels.world minecraft:overworld.tick' took aprox 118.617118 ms\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root.tick.levels.world minecraft:overworld' took aprox 118.64945 ms\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root.tick.levels' took aprox 130.197029 ms\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root.tick' took aprox 134.487606 ms\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root' took aprox 144.88927 ms\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root' took aprox 113.63108 ms\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root.tick.levels.world minecraft:overworld.tick' took aprox 100.887564 ms\n[20:37:43] [Server thread/WARN]: Something's taking too long! 'root.tick.levels.world minecraft:overworld' took aprox 101.077215 ms\n[20:37:44] [Server thread/WARN]: Something's taking too long! 'root.tick.levels' took aprox 124.359252 ms\n[20:37:44] [Server thread/WARN]: Something's taking too long! 'root.tick' took aprox 129.7687 ms\n[20:37:44] [Server thread/INFO]: [yinyangshi: Stopped debug profiling after 18.62 seconds and 124 ticks (6.66 ticks per second)]复制代码\n\n\n可得 是万恶的实体\n\n找到相关深度 然后就获得了 (排序好的)\n$ cat profile-results-2020-03-28_20.37.44.txt | grep \"\\[07\\|\\(END\\)\" | head \n[07] |   |   |   |   |   |   |   minecraft:pillager(3505/28) - 37.31%/23.70%\n[07] |   |   |   |   |   |   |   minecraft:zombie(10613/86) - 8.73%/5.54%\n[07] |   |   |   |   |   |   |   minecraft:cod(13529/109) - 7.17%/4.55%\n[07] |   |   |   |   |   |   |   minecraft:villager(4960/40) - 5.15%/3.27%\n[07] |   |   |   |   |   |   |   minecraft:sheep(8014/65) - 4.47%/2.84%\n[07] |   |   |   |   |   |   |   minecraft:creeper(7547/61) - 4.15%/2.63%\n[07] |   |   |   |   |   |   |   minecraft:chicken(7986/64) - 3.85%/2.44%\n[07] |   |   |   |   |   |   |   minecraft:salmon(7258/59) - 3.83%/2.43%\n[07] |   |   |   |   |   |   |   minecraft:bat(5954/48) - 3.10%/1.97%\n[07] |   |   |   |   |   |   |   unspecified(153349/1237) - 2.27%/1.44%复制代码\n根据海螺描述\npillager是村民\n所以可以知道 是[ruby=村民]pillager[/ruby]卡服\n然后依次往下 程度减低 可以先不管\n\n最后 询问你服玩家在干嘛 然后发现是刷掠夺\n解决方法: disable玩家ai\n优化完成\n\n\n--- BEGIN COUNTER DUMP ---\n$ cat profile-results-2020-03-28_20.37.44.txt | grep \"\\[00\\|\\(Counter\\)\\|\\(BEGIN\\)\" | tail -n30\n--- BEGIN PROFILE DUMP ---\n[00] tick(124/1) - 94.23%/94.23%\n[00] nextTickWait(123/1) - 5.77%/5.77%\n--- BEGIN COUNTER DUMP ---\n-- Counter: chunkGenerate light --\n[00] root total:0/33 average: 0/0\n-- Counter: chunkLoad --\n[00] root total:0/33 average: 0/0\n-- Counter: chunkSave --\n[00] root total:0/45 average: 0/0\n-- Counter: getChunk --\n[00] root total:0/11074494 average: 0/89310\n-- Counter: getChunkCacheMiss --\n[00] root total:0/403813 average: 0/3256\n-- Counter: getChunkNow --\n[00] root total:0/548255 average: 0/4421\n-- Counter: getEntities --\n[00] root total:0/328495 average: 0/2649\n-- Counter: getLoadedEntities --\n[00] root total:0/54944 average: 0/443\n-- Counter: runTask --\n[00] root total:0/8459 average: 0/68\n-- Counter: tickNonPassenger --\n[00] root total:0/132146 average: 0/1065\n-- Counter: tickPassenger --\n[00] root total:0/89 average: 0/0复制代码\n\n\n\n我也不知道 因为知道是实体卡了我就走了\n个人猜测:[深度] 名字 当前深度累计调用次数/当前深度及深层调用总次数 average: 平均每个tick当前深度累计调用次数/平均每个tick当前深度及深层调用总次数 \n猜测依据: profile dump以及平均tick次数 和当时从其他地方看到的那个实体的数量\n\n\n\n/Debug report\n格式清楚 查看区域 实体 和其他信息的\n可以用来判断位置\n基本无用 (因为你知道位置了你也做不了什么 除非是crash  既然都crash了 那crash的时候还可能会用这个命令么)\n我不用。\n\n\n--- END ---\n原版的Debug好像就这么点 走了\n\n\n什么 你还在问看卡顿的方法？我命令都给你们了啊(@折叠内容 )\n\n哦 对不起 泥潭有叫折叠的\n\n\n\n\n\n\n\n\n\n\n[groupid=1306]Bone Studio[/groupid]",
    "replies": [
        {
            "author": "45gfg9",
            "timestamp": 1585406100,
            "txt_content": "这就是你用某服数据测试的原因？\n\n发的什么高级玩意 看不懂 我爬了"
        },
        {
            "author": "叶烨子",
            "timestamp": 1586858280,
            "txt_content": "一只鸡也是可以卡bug的（恼）我的服务器两人存档差点没了……"
        },
        {
            "author": "逆别蔚蓝",
            "timestamp": 1586883360,
            "txt_content": "大佬可以的"
        },
        {
            "author": "310749832",
            "timestamp": 1592557620,
            "txt_content": "感谢分享"
        },
        {
            "author": "310749832",
            "timestamp": 1592560200,
            "txt_content": "感谢分享"
        }
    ]
}