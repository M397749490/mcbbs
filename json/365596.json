{
    "title": "PM插件简单教程老Api",
    "author": "ccooRE",
    "replyCount": 13,
    "timestamp": 1416124020,
    "txt_content": " 本帖最后由 ccooRE 于 2014-12-8 13:10 编辑 \n\n大家好，我叫ccooRE,现任一服务器腐竹，目前自学pm插件中，看到有很多人找我学，我也没多少时间去教，挤了挤时间就打算在这里教吧。。联系方式\nQQ 1064247512\n没了....这些教程都是一些基础的。\n没有牵扯到什么牌子，方块，配置文件之类的\nPM插件纯属我自学，如果教学内容有错误，请及时告诉我！（防止误导新人）\n好，废话不多说，开始- -\n\n看这个教程之前，建议你先看看这个教程，这些你都应该学会后再来看这些：\n【DreamWork新年礼物】[原创] PocketMine-MP 插件制作教程【01/31更】\nhttp://www.mcbbs.net/thread-228104-1-1.html\n(出处: http://www.mcbbs.net/)\n\n\n1.先从最简单的开始\n  1）\n  了解指令注册方式（上面的教程其实有一部分，但是现在不完整）：\n  注册命令的语句一般是这样的格式\n$this->api->console->register(\"xxx\",\"help\",array($this,\"commandHandler\"));复制代码  括号里第一个引号是你想注册的命令，第二个引号就是显示在/help里的帮助内容，后面的commandHandler可以随便改，command,cmd啥的都行，但是要跟后面的地方相等\n比如我这样写一个\n$this->api->console->register(\"xx\",\"NO\",array($this,\"command\"));复制代码\n后面几行的就应该是\npublic function command($cmd,$args,$issuer){\n//代码\n}\npublic function 后面的内容跟array($this,\"\")引号里的一样。\n  2）\n   $issuer的一些内容:\n   先来个例子吧还是，我表达能力不太好。。。。<?php\n/*\n__PocketMine Plugin__\nname=xx\ndescription=nothing\nversion=0.1\nauthor=ccooRE\nclass=pluginxx\napiversion=10,11,12\n*/\nclass pluginxx implements Plugin{\nprivate $api;\npublic function __construct(ServerPI $api,$server=false){\n$this->api=$api;\n}\npublic function init(){\n$this->api->console->register(\"hi\",\"NO\",array($this,\"command\"));\n$this->api->ban->cmdwhitelist(\"hi\");\n}\npublic function __destruct(){}\npublic function commnad($cmd,$args,$issuer){\nswitch($cmd){\n    case\"hi\":\n      $id=$issuer->username;\n      $issuer->sendChat(\"你是 \".$id.\" ，我想说 hi ,\".$id);\n    break;\n}\n}\n}复制代码\n\n源码里定义了一个命令 /hi  而且玩家也可以使用/hi\n接着看后面的public function command\n里面首先检测你是否用了命令/hi\n一旦用了\n就会运行case\"hi\":\n后面的内容。\n首先定义一个变量  id \n$id=$issuer->usernmae;\n这一句是把使用命令的玩家的名字赋值到$id里面，\n$issuer->sendChat()\n这一句\n$issuer->sendChat   的含义是给使用者发送信息括号里的是你想发送的内容\n可以看到里面是   \"你是 \".$id.\" ，我想说hi , \".$id\n把它运行起来\n玩家ABC输入/hi\n玩家的屏幕左上方就会出现\n你是 ABC ，我想说 hi , ABC\n这样看懂了吗\n    #另外一些$issuer用法     1.  $issuer->entity->x   获得当前玩家X坐标（包含小数点）\n     2.  $issuer->entity->y   获得当前玩家Y坐标（同上）\n     3.  $issuer->entity->z   获得当前玩家Z坐标（同上）\n     4.  $issuer->level->getName();       获得当前玩家世界名称\n     5.  $issuer->teleport()        将玩家传送到一个坐标/玩家 位置\n  我知道的差不多就这些，也就这些经常用 ，至于怎么用还是要看你想象力了。\n3)\n  事件监视\n    这个语句的结构是这样的\n      $this->api->addHandler(\"//事件\",array($this,\"//随便\"));\n         第一个引号的内容是你要添加的事件，后面引号跟注册命令的那个一样，只是不要跟命令的重复.......\n        先来看个例子\n         我就直接写个插件。。。<?php\n/*\n__PocketMine Plugin__\nname=SChat\nversion=0.1\ndescription=SChat\nauthor=ccooRE\nclass=sc\napiversion=10,11,12\n*/\nclass sc implements Plugin{\nprivate $api,$server;\npublic function __construct(ServerAPI $api,$server=false){\n$this->api=$api;\n}\npublic function init(){\n$this->api->addHandler(\"player.chat\",array($this,\"handler\"));\n$this->api->addHandler(\"player.connect\",array($this,\"handler\"));\n$this->api->addHandler(\"player.quit\",array($this,\"handler\"));\n}\npublic function __destruct(){}\npublic function handler(&$data,$event){\n  switch($event){\n  case\"player.chat\":\n  $id=$data['player']->username;\n  $plv=$data['player']->level->getName();\n  $msa=$data['message'];\n  $ms=\"[聊天] \".$plv.\" : \".$id.\" :  \".$msa;\n  $this->api->chat->broadcast($ms);\n  return false;\n  break;\n  case\"player.connect\":\n  $jid=$data->username;\n  if($this->api->ban->isOP($jid)){\n        $this->api->chat->broadcast(\"[提示]一只可爱的op加入了服务器~\");\n     }\n  $this->api->chat->broadcast(\"[提示]玩家 \".$jid.\" 心情大好的进入了服务器\");\n  break;\n  case\"player.quit\":\n  $qid=$data->username;\n  if($this->api->ban->isOP($qid)){\n        $this->api->chat->broadcast(\"[提示]一只可爱的op退出了服务器~\");\n     }\n  $this->api->chat->broadcast(\"[提示]玩家 \".$qid.\" 恋恋不舍的离开了服务器\");\n  break;\n}\n}\n}复制代码\n\n\n这个是我前几个礼拜写的聊天插件了，如果你喜欢就拿去吧（反正没啥技术含量- -）好，来看看源码\n首先看public function init(){}里的\n我注册了三个事件\n分别是\nplayer.connect             玩家连接服务器时（指玩家点服务器那个存档的时候）\nplayer.chat                   玩家说话时\nplayer.quit                    玩家退出服务器时\n\n继续看源码\nswitch($event){}指触发事件的时候，这里的$event要跟public function handler()里面的相同。\n\n           /*public function handler(&$data)  这个$data前面的&可以去掉，但是$data[]里面就不是单引号了，是双引号，我也不清楚这有啥区别，大概加&功能更多吧- - 我不清楚，希望大神指点！*/\ncase\"player.chat\":\n玩家说话的时候\n$id=$data['player']->username;            这里是获得事件里玩家的id\n$plv=$data['player']->level->getName();               这里是获得事件里玩家的世界名\n$msa=$data['message'];              这里获得玩家发言的内容\n$ms=\"[聊天] \".$plv.\" : \".$id.\" :  \".$msa;                 将上面的信息整理成  [聊天]  //玩家所在世界 :   //玩家名 :  玩家发言内容\n然后$this->api->chat->broadcast($ms);                 整合后广播到服务器信息中      这个语句的作用就是广播的作用\n还有一个重要的地方！！！\n  return false;          用来阻止默认的动作，就是阻止玩家发送默认消息，而不阻止广播，其实这个也就是原理。\n如果没有    return fasle;\n会有这样的现象:\n一个倒霉蛋玩家   Bearboy 在世界world 发送了一句话  \"我是熊孩纸，我要炸服\"\n然后屏幕左上角会出现\n[聊天] world : Bearboy : 我是熊孩纸，我要炸服\n<Bearboy> 我是熊孩纸，我要炸服\n然后他就被ban了。。。。。。\n显然，没有return false; 是不行的\n接着看，\"player.connect\"\n当玩家进服时，会首先得到玩家id\n然后\nif($this->api->ban->isOP($jid)){}\n这一句话是判断括号里内容是否在op.txt里，也就是会判断是不是OP，如果为true则执行大括号的内容，false则不执行\n然后 $this->api->chat->broadcast(\"[提示]玩家 \".$jid.\" 心情大好的进入了服务器\");     广播[提示]玩家 //玩家名 心情大好的进入了服务器\nplayer.quit也是同样的原理，只不过把进入改成了离开。还有一些事件，我举几个例子\n       player.teleport.level                玩家转换世界时\n       player.block.touch                  玩家点击方块时\n       player.block.place                  玩家防止方块时（和点击不一样！）\n       player.block.break                  玩家破坏方块时\n       player.death                          玩家死亡时\n       player.join                             玩家进入服务器时（和player.connect不一样！）\n       player.spawn                         玩家进入服务器并且出生时（和player.join不一样）\n       player.respawn                      玩家重生时\n       player.move                          玩家移动时\n       entity.health.change               玩家血量发生变化时\n       差不多就这些经常用\n另外提一下player.block.touch和player.block.place  是不一样的，比如一个玩家空手点了一下方块，会触发player.block.touch  ，玩家拿着方块点击另一个方块,会触发player.block.place\n所以知道为啥有些领地插件不能使用牌子了吧，其实把里面的player.block.touch改成player.block.place就好了\n     在写几个我知道的$data里的\n    $data[\"target\"]->getName()             得到玩家即将转换世界的名称，比如一个玩家从world转换到sc了，这时它获得的内容是sc而不是world\n    $data[\"entity\"]->player->level->getName()           得到玩家当前世界名称，跟$data[\"player\"]->level->getName()  差不多\n    $data[\"health\"]      得到玩家当前血量\n    $data[\"entity\"]->player->entity->setHealth(value,//事件类型,true)              这个是个语句，用来设置玩家血量，value是血量值，里面的事件类型不太清楚。。\n\n 再总结几个\n     $this->api->level->get(worldname)->getSpawn()             获得世界worldname的出生地信息，不是坐标\n     $this->server->spawn                           代表服务器出生地 ，常用于$data[\"entity\"]->player->teleport()或$issuer->teleport()里\n     $issuer->__get(\"ip\")            获取玩家ip\n     $this->api->ban->banIP(//ip)                   ban掉某个ip，//前后好有联系--\n\n差不多结束了，可能有的人看不太懂，不清楚的加我Q联系我~做的不好的地方也可以联系我~\n本教程纯手打  //反正我打字快\n\n加我QQ可以跟我要几个插件哦，我这里插件很全的，有两个我写的插件准备内测，不妨你也来玩玩，交流交流~~\n收工，走人\n\n",
    "replies": [
        {
            "author": "cheng000",
            "timestamp": 1416124920,
            "txt_content": "看楼主写的挺用心的...."
        },
        {
            "author": "18wyj2",
            "timestamp": 1416201300,
            "txt_content": "1.3.12都被pm淘汰了..."
        },
        {
            "author": "ccooRE",
            "timestamp": 1416318240,
            "txt_content": "18wyj2 发表于 2014-11-17 13:15\n1.3.12都被pm淘汰了...\n可我还在玩1.3.11............"
        },
        {
            "author": "iSteven",
            "timestamp": 1416547740,
            "txt_content": "18wyj2 发表于 2014-11-17 13:15\n1.3.12都被pm淘汰了...\nPM都快被淘汰了"
        },
        {
            "author": "hsk001ufo",
            "timestamp": 1417328700,
            "txt_content": "=。=最好注明一下这是老API的"
        },
        {
            "author": "martinsmith",
            "timestamp": 1417408860,
            "txt_content": "好评，感觉很详细，正好弥补一下知识！"
        },
        {
            "author": "1427208963",
            "timestamp": 1422690600,
            "txt_content": "楼主你咋这么好嘞{:10_562:}"
        },
        {
            "author": "410855403",
            "timestamp": 1422706620,
            "txt_content": "ccooRE 发表于 2014-11-18 21:44\n可我还在玩1.3.11............\n1.4 可以支持1.0了哦"
        },
        {
            "author": "uuuu1",
            "timestamp": 1422753360,
            "txt_content": "PM1.4的更复杂"
        },
        {
            "author": "hsk001ufo",
            "timestamp": 1422768540,
            "txt_content": "排版有点乱"
        },
        {
            "author": "2503180246",
            "timestamp": 1471439400,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "mohist",
            "timestamp": 1570325460,
            "txt_content": "1.3的pm被淘汰了 希望出个新版本教程"
        },
        {
            "author": "BBT4136",
            "timestamp": 1571627220,
            "txt_content": "好东西 收藏了"
        }
    ]
}