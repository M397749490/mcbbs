{
    "title": "[已解决][Spigot]如何用javaagent魔改nms中的类",
    "author": "Lucky_fish0w0",
    "replyCount": 3,
    "timestamp": 1533282180,
    "txt_content": " 本帖最后由 cx62d 于 2018-8-5 16:48 编辑 \n\n如题= =代码所使用的是objectweb的asm对nms进行修改，却是源源不断的报错，一直搞不清楚如何解决这个问题\n完整报错如下：\nlucky-fish@lucky-fish-pet:~/Minecraft/plugin-dev/test-server$ java -javaagent:MiniPlayer-1.0.0.jar -jar spigot-1.12.2.jar \n*** Error, this build is outdated ***\n*** Please download a new build as per instructions from [url]https://www.spigotmc.org/[/url] ***\n*** Server will start in 15 seconds ***\nLoading libraries, please wait...\n[STDOUT]: entity setSize method injected.\n[STDOUT]: entity setSize method maxs injected.\n[STDERR]: java.lang.LinkageError: loader (instance of  sun/misc/Launcher$AppClassLoader): attempted  duplicate class definition for name: \"net/minecraft/server/v1_12_R1/Entity\"\n[STDERR]:     at java.lang.ClassLoader.defineClass1(Native Method)\n[STDERR]:     at java.lang.ClassLoader.defineClass(ClassLoader.java:763)\n[STDERR]:     at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)\n[STDERR]:     at java.net.URLClassLoader.defineClass(URLClassLoader.java:467)\n[STDERR]:     at java.net.URLClassLoader.access$100(URLClassLoader.java:73)\n[STDERR]:     at java.net.URLClassLoader$1.run(URLClassLoader.java:368)\n[STDERR]:     at java.net.URLClassLoader$1.run(URLClassLoader.java:362)\n[STDERR]:     at java.security.AccessController.doPrivileged(Native Method)\n[STDERR]:     at java.net.URLClassLoader.findClass(URLClassLoader.java:361)\n[STDERR]:     at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n[STDERR]:     at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:338)\n[STDERR]:     at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n[STDERR]:     at net.minecraft.server.v1_12_R1.DispenserRegistry.c(DispenserRegistry.java:679)\n[STDERR]:     at net.minecraft.server.v1_12_R1.MinecraftServer.main(MinecraftServer.java:875)\n[STDERR]:     at org.bukkit.craftbukkit.Main.main(Main.java:194)\nlucky-fish@lucky-fish-pet:~/Minecraft/plugin-dev/test-server$ \n复制代码\n忘了说，已经对ClassWrite中的自动计算参数做过各种尝试，但没有任何效果。\n\n问题已解决，感谢各位的帮助:)\n其原因是在魔改类的时引用了这个类造成了类的重复加载，从而导致了重复定义的问题，顺便排除了字节码上面的逻辑错误",
    "replies": [
        {
            "author": "耗子",
            "timestamp": 1533285120,
            "txt_content": "估计是没有开自动计算Max和Frame造成的。\n请把new ClassWriter的代码都改成如下代码。\nnew ClassWriter(ClassWriter.COMPUTE_FRAMES);复制代码"
        },
        {
            "author": "耗子",
            "timestamp": 1533288540,
            "txt_content": "可以考虑把修改完成的代码保存，反编译看看哪里出错了"
        },
        {
            "author": "弱鸡绿毛怪",
            "timestamp": 1533353280,
            "txt_content": " 本帖最后由 MagicLocyDragon 于 2018-8-4 11:39 编辑 \n\n它的意思大概就是你这个类被重复加载了。\n可以的话加一下我QQ聊。\n\n\n"
        }
    ]
}