{
    "title": "【UEL Creators】针对做图新手：如果有效降低地图卡顿",
    "author": "天佑酱",
    "replyCount": 21,
    "timestamp": 1584940020,
    "txt_content": " 本帖最后由 天佑酱 于 2020-4-27 11:06 编辑 \n如何有效降低你地图的延迟\n Part.1 前言本期是一个干货帖子，目的是告知做图新手，如何有效降低地图的延迟。之前我的地图也存在这个问题，地图的延迟很高很高，破坏方块要5s+才会掉落物品，我经过多方求助，总结出了一套降低地图延迟的办法。如有其它方法，欢迎在下方评论区指出！Part.2 实体实体算是MC很卡的一个东西了...10w个方块在你面前不怎么卡，而1w个实体在你面前，你绝对能吃到CPU煎蛋。那么怎么降低实体给你地图带来的卡顿呢？方法：尽量减少实体。解释：这点很好理解，就是实体能少用的就少用，比如，不用矿车计时（矿车也是实体）、及时删除不需要的实体；如果是做PVE或者CTM或者RPG等打怪地图，刷怪笼的“需要玩家所在半径”尽量调小，刷怪频率尽量调小，刷怪区域内最大怪物量尽量调小。可以做点比如定时或定数清怪系统等等等等。Part.3 方块很多方块的增加延迟能力堪比实体。这点尤为突出的就是红石家族...很多红石服务器，比如TIS，延迟都是比较大的，这或多或少与红石都有很多关系。那么怎么降低方块给你地图带来的卡顿呢？方法：同样，能少用就少用，能不用就不用。解释：同样很好理解，直接举例子：如果遇到连锁型命令方块不好解决的，用setblock红石块而不要用比较器；能用连锁方块的尽量用连锁命令方块，不要用中继器；需要做剧情类的东西尽量用计分板（也别盲用，详细见下面），少用比较器；做高频不要用红石，尽量用function（详细见下面）或者滚动红石（详情见下面）；少用漏斗，尽量用命令检测；少用红石机械，尽量用命令方块实现；尽量减少高空流水、高空岩浆。Part.4 高频\n一提到高频，立马就会联想到卡，yysy，qs，高频基本都很卡。目前来讲红石高频是最卡的，其次便是开启的循环型命令方块。那么怎么降低高频带来的卡顿呢？方法：化高为慢，化有为无解释：这点可能比较难理解，先说第一个，化高为慢，什么意思呢？就是有一些确实不需要执行频率很高，执行频率低一点不怎么影响，比如检测丢出某物执行命令，这个不需要每秒执行很多次，甚至1s执行一次差别也不是很大。那么我们就可以减少检测频率，假如你地图里面有30个道具，如果全用保持开启的循环型命令方块检测，延迟觉对立马升的很高，而如果放到一起，0.5s执行一次，那么不会有什么延迟。这里就要提到一个方法了：滚动红石块（感谢@SMFX阜星 的创意）这个方法是，利用一个红石块，让它在一条线上滚来滚去。具体做法就是：A2  AB2  BC2  C这6个方块，B2、B 均为空气，A执行在B2放置红石块，C执行在B放置空气，依次类推，当在B手动放下一个红石块，这个装置就可以激活，再在B、B2的旁边放置命令方块就不怎么卡了。再来解释第二个：化有为无，什么意思呢？就是本来你用保持开启的循环型命令方块执行，你换用function执行，这样就做到化有为无了，很多人不了解function，觉得function和命令方块不差不多吗，其实不然，function在执行时的延迟极低极低，我估计大概有一个保持开启的循环型命令方块的1%（真实比例甚至小于1%）（我地图里面用function执行500+条命令才大概是4-5个保持开启的循环型命令方块的延迟）有些人会用 保持开启的循环型命令方块 (以下简称KRCB，Keep Run Repeating Command Block)来执行function，这样其实已经很流畅了，但还可以更流畅，就是把你要保持执行的function全编到一个function里面，再用gamerule执行这1个function，一个KRCB都没用，延迟绝对很低。Part.5 计分板\n很多人做的计分板很多很乱，这里我有一些关于计分板的建议。建议：化多为少解锁：这点就是，把很多计分板，化为一个计分板，比如，剧情需要停顿，用计分板，不要每段对话就用1个，这样真的过于浪费过于奢侈，我的建议是：整个剧情只用一个计分板，用到的时候清零，当成新的计分板用就好了。Part.6 粒子效果\n粒子效果真的很卡...每次我玩别人的地图，把粒子效果全部关闭都能提升20%+fps，虽然粒子效果应用在你地图会很酷炫，但是也会妥妥的卡。所以使用粒子效果也要注意：建议：化繁为简，化多为少解释：第一个，就是比如你想做一些效果，不要各种粒子效果疯狂执行，有时候，播放多个粒子效果，并没有酷炫程度翻倍，卡顿确是绝对翻倍的，所以，粒子效果这种东西，做到点到为止就行了，相对于卡顿和酷炫，玩家肯定会更讨厌卡顿。第二个，就是比如你想做个玩家tp，播放末影效果，能播放128次就不要播放256次，他们的效果差不了多少，但是流畅度确是差了很多的。再如，有一些粒子，你想让玩家随时都能看见，可以不要每时每刻的执行，可以当玩家在你要执行的地方的半径xxx之内，才播放，这样可以提升玩家在不必要时的卡顿。Part.7 区块密度 \n这点对于一些人（包括曾经的我）来说是个很严重的问题。很多人把很多区域很密集的放在一起，玩家随时都能加载这些区块，这一点是很致命的。那么如何降低这点带来的卡顿呢？方法：降低加载区块密度解释：什么意思呢？就是把各个地方尽量分开。比如你做一个RPG地图，各个区域之间可以隔很远，1000格以上，这样玩家的流畅度会提高很多。还有个方法就是把每个地方做稍微大一点，边缘大一点，这样会比较自然的降低卡顿。Part.8 优化模组\n这点也是很重要的，有时候你各种办法都想了，卡顿度却一直居高不下，那么这时候我们可以请一些优化模组，他们降低卡顿的能力是非常强的。建议：你可以在你地图做好后，新建一个文件夹，里面专门存放优化模组，提示玩家如果很卡，就安装这些模组，或者更直接的就是直接做个流畅的整合包，玩家下载就可以流畅游玩。下面有部分优化模组链接。Part.9 相关链接引用链接：Wiki对function的介绍：https://minecraft-zh.gamepedia.com/%E5%87%BD%E6%95%B0%EF%BC%88Java%E7%89%88%EF%BC%89Wiki对命令方块的介绍：https://minecraft-zh.gamepedia.com/%E5%91%BD%E4%BB%A4%E6%96%B9%E5%9D%97Wiki对红石的介绍：https://minecraft-zh.gamepedia.com/%E7%BA%A2%E7%9F%B3%E7%B2%89Wiki对红石中继器的介绍：https://minecraft-zh.gamepedia.com/%E7%BA%A2%E7%9F%B3%E4%B8%AD%E7%BB%A7%E5%99%A8Wiki对于红石比较器的介绍：https://minecraft-zh.gamepedia.com/%E7%BA%A2%E7%9F%B3%E6%AF%94%E8%BE%83%E5%99%A8资源地址：FPS减速器：https://www.mcbbs.net/thread-960123-1-1.html高清修复：https://www.mcbbs.net/thread-606019-1-1.htmlFPS优化：https://www.curseforge.com/minecraft/mc-mods/fpsplus-lagfixes更好的FPS：http://www.mcbbs.net/thread-539780-1-1.html原版修复：http://www.mcbbs.net/thread-792493-1-1.html泡沫修复：https://www.mcbbs.net/thread-678442-1-1.html更少的滞后：https://www.mcbbs.net/thread-785968-1-1.html\n\n[groupid=1530]UEL Creators[/groupid]",
    "replies": [
        {
            "author": "rooke_zb",
            "timestamp": 1584955560,
            "txt_content": "0202年了，新手直接从function学起，放弃CB吧"
        },
        {
            "author": "⊙u⊙",
            "timestamp": 1584960180,
            "txt_content": "提得好，我也来补充一些个人的建议\n\n游戏制作方面\n需要高频检测的单次触发内容在触发后应当关闭检测。\n游戏设计为\"关卡\"制，或者说分段加载，除必要内容保持时刻高/低频，仅加载与当前关卡相关的检测。\n玩家想作弊的话也防不过来，所以1s、1t高频药水效果的可以省点心改用长时段药水效果。\n\n\n\n命令方面，考虑到性能及泛用性，以下由推荐到不推荐\n命令的编写位置：fu[ruby=方便版本移植及命令编写]nction/数据[/ruby]包 >[ruby=少了比较器中继器这种中间商] 连锁命令方块 [/ruby]> 红[ruby=红石高频吓人]石布线的命[/ruby]令方块\nmarker的使用：area_effect_cloud > armor_stand > 其他实体\nnbt储存位置：storage ≈ 潜影盒内的物品 > 其他地方的物品\n\n\nnbt检测方面，不需要检测一整段，只需要检测独特的一小段\n矿车是很宝贵且独特的资源，尽量少用。短计时可用药水云，长计时可用schedule或记分板。\n记分板除非多到数不过来，否则减少板量并不会有显著的性能提升。但为了方便管理可创建一个计算时储存数值的记分板和多个使用该板的虚拟玩家。\n记分板分数方面，比如计时、记部分地图信息，可[ruby=减少选择器的使用]以使用虚拟玩家代替[/ruby]实体\n穷举内容的检测可以使用二分或四分法，貌似又叫树形结构，在检测玩家头部转向时就可以从每t检测64800次减少到可能不到300次，例：\n#检测16次\nexecute @a[ry=1,rym=1] ~ ~ ~ say 1\nexecute @a[ry=2,rym=2] ~ ~ ~ say 2\nexecute @a[ry=3,rym=3] ~ ~ ~ say 3\nexecute @a[ry=4,rym=4] ~ ~ ~ say 4\nexecute @a[ry=5,rym=5] ~ ~ ~ say 5\nexecute @a[ry=6,rym=6] ~ ~ ~ say 6\nexecute @a[ry=7,rym=7] ~ ~ ~ say 7\nexecute @a[ry=8,rym=8] ~ ~ ~ say 8\nexecute @a[ry=9,rym=9] ~ ~ ~ say 9\nexecute @a[ry=10,rym=10] ~ ~ ~ say 10\nexecute @a[ry=11,rym=11] ~ ~ ~ say 11\nexecute @a[ry=12,rym=12] ~ ~ ~ say 12\nexecute @a[ry=13,rym=13] ~ ~ ~ say 13\nexecute @a[ry=14,rym=14] ~ ~ ~ say 14\nexecute @a[ry=15,rym=15] ~ ~ ~ say 15\nexecute @a[ry=16,rym=16] ~ ~ ~ say 16复制代码\n#检测8次\nexecute @a[rym=1,ry=4] ~ ~ ~ function foo:1_4\nexecute @a[rym=5,ry=8] ~ ~ ~ function foo:5_8\nexecute @a[rym=9,ry=12] ~ ~ ~ function foo:9_12\nexecute @a[rym=13,ry=16] ~ ~ ~ function foo:13_16\n\n#foo:1_4\nexecute @s[rym=1,ry=2] ~ ~ ~ function foo:1_2\nexecute @s[rym=3,ry=4] ~ ~ ~ function foo:3_4\n\n#foo:1_2\nexecute @s[rym=1,ry=1] ~ ~ ~ say 1\nexecute @s[rym=2,ry=2] ~ ~ ~ say 2复制代码\n\n尽量使用@s选择器以减少对实体的搜寻\n在有意义的情况下，选择器应填上下列参数以快速筛选搜寻的实体，且部分参数顺序按以下顺序排列为优\ntype，快速筛选实体种类gamemode，区分玩家与非玩家，@a或@p时无意义teamtype!tag，优于分数name，json分析，因此比tag慢半拍scoresadvancementsnbt，若可以避免请不要使用\n\n可以的话也请包括distance或dx/dy/dz参数，这能缩减搜索范围以加快实体搜寻\n\n还希望获得更好的优化，找[ruby=抱团取暖]群是个好[/ruby]方法"
        },
        {
            "author": "⭐✔️",
            "timestamp": 1584964200,
            "txt_content": "简单来讲，优化分为两类：\n区块优化、渲染优化\n前者卡顿则会出现跳tick，影响的是服务器包括本地服务器\n后者卡顿本质是客户端性能决定的\n\n简而言之优化前者就是减少区块更新(减少方块更新，减少实体更新，将非即时更新内容移至出生点区块外，还有一个非常容易忽略的光照更新)，优化后者就是减少渲染消耗(优化模型加载，粒子加载)\n\n后者其实因人而异，施展空间不大; 前者关系到服务器，就区块更新还能细分，涉及到发包，存取，一段短小的回复说不完，所以就说到这里\n\n其实最后才考虑到命令迭代深度优化，原因是区块更新涉及频繁存取、收发包，是主要的性能瓶颈。"
        },
        {
            "author": "(=°ω°)丿",
            "timestamp": 1585115580,
            "txt_content": "Mojang 的优化本来做的就不是很好（\n\n和命令有关系的大部分都在这里了：\n[1.14.4] 追根溯「源」——实体选择器\nhttps://www.mcbbs.net/thread-891687-1-1.html\n\n地图的加载方式可以学学 Mojang 加载区块的方式（\n还有改材质（把动态改成静态，改低分辨率）也可以降低地图卡顿。\n\n我个人的话，测试数据包是在 64×64 的虚空的基岩平台上，需要用到地形的时候，再调用函数生成。"
        },
        {
            "author": "1539776978",
            "timestamp": 1594875360,
            "txt_content": "        MCBBS有你更精彩~"
        },
        {
            "author": "堕天使之墓",
            "timestamp": 1595804160,
            "txt_content": "66666666666666666666666666666"
        },
        {
            "author": "🥶❄️☠️",
            "timestamp": 1595808000,
            "txt_content": "哦，不过这些感觉效果不明显啊\n感觉还是需要优化模组"
        },
        {
            "author": "天佑酱",
            "timestamp": 1595826300,
            "txt_content": "Stray79 发表于 2020-7-27 08:00\n哦，不过这些感觉效果不明显啊\n感觉还是需要优化模组\n以上内容看你自己。\n我自己的经历:二代地图100多个保存开启的RCB，fps只为平时的30%，延迟大概是1个食物要吃20s。\n三代地图改用滚动红石块和function，如果在二代地图这就是300个保持开启的RCB，fps为平时的60%(在2k地形的情况下)，延迟几乎觉查不出来。\n这还是没完全优化的情况。"
        },
        {
            "author": "🥶❄️☠️",
            "timestamp": 1595826480,
            "txt_content": "天佑酱 发表于 2020-7-27 08:05\n以上内容看你自己。\n我自己的经历:二代地图100多个保存开启的RCB，fps只为平时的30%，延迟大概是1个食物 ...\n嗯，可以，我试试\n那么第一代？\n还有我的05年的超级计算机本来就卡到15秒4帧，破罐子破摔"
        },
        {
            "author": "爱兽耳的狼狼",
            "timestamp": 1595832540,
            "txt_content": "就算你的方法很好可也抗不过渣机"
        },
        {
            "author": "天佑酱",
            "timestamp": 1595948820,
            "txt_content": "爱兽耳的狼狼 发表于 2020-7-27 14:49\n就算你的方法很好可也抗不过渣机\n好好的做图优化怎么老是扯到渣机……"
        },
        {
            "author": "AuroraOdes",
            "timestamp": 1595951460,
            "txt_content": "真的有用 码一个"
        },
        {
            "author": "永爱不忘",
            "timestamp": 1597898340,
            "txt_content": "woc 起飞  实用啊"
        },
        {
            "author": "宅男Mars",
            "timestamp": 1597904700,
            "txt_content": "可以可以，谢谢啦"
        },
        {
            "author": "胖虎123",
            "timestamp": 1598027160,
            "txt_content": "我试了一下真的不卡了直接起飞了"
        },
        {
            "author": "yangchangda",
            "timestamp": 1598346300,
            "txt_content": "不错不错,回去试验一下!"
        },
        {
            "author": "寒柯",
            "timestamp": 1598349300,
            "txt_content": "得到了想要的答案，很有用的帖子"
        },
        {
            "author": "王老师1999",
            "timestamp": 1609226100,
            "txt_content": "感觉不错呦 收藏了！"
        },
        {
            "author": "爱你么么...",
            "timestamp": 1611687120,
            "txt_content": "大佬大佬，膜拜大佬"
        },
        {
            "author": "hyflp123",
            "timestamp": 1611702720,
            "txt_content": "Mcbbs有你更精彩~"
        },
        {
            "author": "15711138168",
            "timestamp": 1611718800,
            "txt_content": "卧槽牛啊学会了666实用"
        }
    ]
}