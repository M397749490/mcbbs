{
    "title": "关于MySql故障问题",
    "author": "魂蛋呃",
    "replyCount": 5,
    "timestamp": 1592721060,
    "txt_content": "\n\n\n\n\nTIM图片20200621142941.png (124.02 KB, 下载次数: 0)\n\n下载附件\n\n2020-6-21 14:29 上传\n\n\n\n\n\n服务端正常运行时突然刷出这报错，所有使用了数据库的服务端都出现了，需要重启机子才恢复\n\n请问这个是什么问题呢，有什么办法能解决或者避免再度发生吗\n\n\n",
    "replies": [
        {
            "author": "新科",
            "timestamp": 1592721060,
            "txt_content": " 本帖最后由 新科 于 2020-6-21 17:18 编辑 \n\n首先说一下如何预防这个问题, 你的报错中显示错误是 state 08S01, 这种情况是 数据库主动断连 , 如果数据库之前可以连接, 那么只有两种情况, 要不然是数据库主动崩溃, 要不然就是是最**接数、连接不活跃超时秒数配置有问题, 都有可能导致数据库主动断开与服务端连接.\n\n首先打开你的 MySQL 配置文件, 如果你不知道它在哪请点我\n\n[mysqld]\nsocket          = .../mysql.sock\ndatadir         = /...\n\n[client]\nsocket = .../mysql.sock\n\n\n你的配置差不多长这样, 如果有更多配置项那可能是Win自带的, 我这个是Linux下纯净配置\n然后在 [mysqld] 下面添加以下配置值，你可以到你的[mysqld]下面直接复制即可\n\n[mysqld]\nmax_connections = 256\nwait_timeout = 604800\n\n\n上面的配置我试启动过是没问题的, 如果出错可能是因为有冲突, 找到配置里重复的配置项删掉即可\n以上配置会把你的数据库最**接数调整为 256, 最大超时时间调整为7天。除非你的插件7天都不读写数据库否则以后应该都不会超时了。应该就只是这个问题吧233\n\n当然，还是建议检查是否是 MySQL 崩溃，因为如果你的 MySQL 实例与MC服务器在同一台服务器上，那么重启服务器必然也会重启 MySQL，所以无法看出是谁崩溃了。你可以通过检查 MySQL 日志的方法看看是不是 MySQL 崩溃，到时候可以再来问。\n"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1592721840,
            "txt_content": "这是这个插件的问题 与mysql数据库本身没有直接关联\n\n是这个插件对连接池的处理有问题 没有判断连接是否可用\n\n建议直接向插件作者反馈"
        },
        {
            "author": "William_Shi",
            "timestamp": 1592725620,
            "txt_content": "你的MySQL连接出问题了\n的确很有可能运行时莫名奇妙的连接断掉了\n然后当你再操作PreparedStmt、或者是普通Stmt的时候\n就会开始刷这个报错\n\n我的建议是在创建连接的时候就使用连接池进行管理\n要不然就每次使用时判断connection 是不是null\n\n等等，最上面那个好像是hikari连接池啊\n估计是使用上出错了吧\n要不然就是你的数据库本身出问题了莫名奇妙断连了"
        },
        {
            "author": "1109288668",
            "timestamp": 1592726400,
            "txt_content": "没有应对办法，要么重启要么无视但是他一直刷屏就很烦所以定时重启服务器可以解决加个重启插件"
        },
        {
            "author": "redfish",
            "timestamp": 1592729040,
            "txt_content": " 本帖最后由 redfish 于 2020-6-21 16:46 编辑 \n\n检查服务器数据库是否能连接，检查是否到了连接池上限也有可能数据库配置给低了，这就很复杂了\n"
        }
    ]
}