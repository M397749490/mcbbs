{
    "title": "[PVPHealth][BUG彻底修复]问了好多人都说不知道,提问帖还被删了,只好自己动手解决了!",
    "author": "minecraftpe8",
    "replyCount": 3,
    "timestamp": 1423795620,
    "txt_content": " 本帖最后由 minecraftpe8 于 2015-2-13 12:00 编辑 \n\n红色的地方为出错的地方,已经彻底修复过来了!\n错误1:onEntityDamageByEntity()函数接收到2个事件对象:onEntityDamageByEntity和EntityDamageByEntityEvent,必须做一下判断!\n错误2:僵尸没有对应的getgamemode()函数,所以获取模式的时候,必须限定为获取玩家模式!\n<?php\n\nnamespace PVPHealth;\n\nuse pocketmine\\utils\\TextFormat as MT;\n//想要自己插件色彩斑斓的同学不要忘了use这个\nuse pocketmine\\event\\Listener;\nuse pocketmine\\event\\entity\\EntityDamageEvent;\nuse pocketmine\\event\\entity\\EntityDamageByEntityEvent;\nuse pocketmine\\Player;\nuse pocketmine\\plugin\\PluginBase;\nclass main extends PluginBase implements Listener{\n                \n        public function onEnable(){ \n                $this->getLogger()->info(MT::BLUE . \"插件运行,by 18wyj2\");\n                $this->getServer()->getPluginManager()->registerEvents($this, $this);\n                $this->getLogger()->info(MT::YELLOW . \"加载成功,欢迎使用\");\n        }\n\n        public function onDisable(){\n                $this->getLogger()->info( MT::RED .\"PH关闭中....\");\n        }\n        \n        public function onEntityDamageByEntity(EntityDamageEvent $event){\n                if($event instanceof EntityDamageByEntityEvent){\n/*\n [CRITICAL] Could not pass event pocketmine\\event\\entity\\EntityDamageEvent to PVPHealth vBuild_1: \n Argument 1 passed to PVPHealth\\main::onEntityDamageByEntity() must be an instance of \n pocketmine\\event\\entity\\EntityDamageByEntityEvent,\n instance of pocketmine\\event\\entity\\EntityDamageEvent given, \n called in phar:///home/pocketmine/PocketMine-MP.phar/src/pocketmine/plugin/MethodEventExecutor.php on line 36 and defined on PVPHealth\\main\n09:28:52 [NOTICE] InvalidArgumentException: \"Argument 1 passed to \nPVPHealth\\main::onEntityDamageByEntity() must be an instance of \npocketmine\\event\\entity\\EntityDamageByEntityEvent, \ninstance of pocketmine\\event\\entity\\EntityDamageEvent given, \ncalled in phar:///home/pocketmine/PocketMine-MP.phar/src/pocketmine/plugin/MethodEventExecutor.php \non line 36 and defined\" (E_RECOVERABLE_ERROR) in \"/PVPHealth_vBuild_1.phar/src/PVPHealth/main\" \n\nat line 23\n*/\n                        $victim = $event->getEntity();\n                $attacker = $event->getDamager();\n                        $vhp = $victim->getHealth();\n                        $ahp = $attacker->getHealth();\n                        $vmhp = $victim->getMaxHealth();\n                        $amhp = $attacker->getMaxHealth();\n                        if($victim instanceof Player && $attacker instanceof Player){\n/*\nFatal error: Call to undefined method pocketmine\\entity\\Zombie::getgamemode() in phar:///home/pocketmine/plugins/PVPHealth_vBuild_1.phar/src/PVPHealth/main.php on line 30\n09:31:16 [EMERGENCY] An unrecoverable error has occurred and the server has crashed. Creating a crash dump\n09:31:16 [EMERGENCY] Please submit the \"/home/pocketmine/CrashDump_Mon_Feb_9-09.31.16-CST_2015.log\" file to the Bug Reporting page. Give as much info as you can.\n\n09:31:18 [EMERGENCY] The crash dump has been automatically submitted to the Crash Archive. You can view it on http://crash.pocketmine.net/view/116084 or use the ID #116084.\n*/\n                                $vgm = $victim->getgamemode();\n                                $agm = $attacker->getgamemode();\n                        }else{\n                                $vgm = 0;\n                                $agm = 0;        \n                        }\n                if($victim instanceof Player && $attacker instanceof Player){\n                                if($vgm == $agm){\n                                //当两人模式相同时\n                                    if($vhp > $ahp){\n                                                $victim->sendMessage(\"[PH]血量大于对方,反击吧,骚年!\\n对方血量\".$ahp.\"/\".$amhp);\n                                                $attacker->sendMessage(\"[PH]血量小于对方,小心反击!\\n对方血量\".$vhp.\"/\".$vmhp);\n                                    }elseif($ahp > $vhp){\n                                                $attacker->sendMessage(\"[PH]血量大于对方,乘胜追击吧!\\n对方血量\".$vhp.\"/\".$vmhp);\n                                                $victim->sendMessage(\"[PH]血量小于对方,快逃吧,小样!\\n对方血量\".$ahp.\"/\".$amhp);\n                                        }elseif($ahp == $vhp){\n                                            $victim->sendMessage(\"[PH]对方与你势均力敌!\\n对方血量\".$ahp.\"/\".$amhp);\n                                                $attacker->sendMessage(\"[PH]对方与你势均力敌!\\n对方血量\".$vhp.\"/\".$vmhp);\n                                        }\n                            }else{\n                                //当两人模式不相同时\n                                   $attacker->sendMessage(\"[PH]你们的游戏模式不同，没有可比性!对方模式为\".$vgm);\n                                   $event->setCancelled();\n                            }        \n                          }\n                }\n        }\n}\n",
    "replies": [
        {
            "author": "aq8sunjie",
            "timestamp": 1423797660,
            "txt_content": "沙发   顶........."
        },
        {
            "author": "Usdin",
            "timestamp": 1423797720,
            "txt_content": "不知道你在说什么 说的详细点好么"
        },
        {
            "author": "hsk001ufo",
            "timestamp": 1423810020,
            "txt_content": "提问贴被删应该是你发错版了"
        }
    ]
}