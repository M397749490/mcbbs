{
    "title": "[SCT]MC插件使用HikariCP连接池教程",
    "author": "大阔",
    "replyCount": 2,
    "timestamp": 1596468540,
    "txt_content": " 本帖最后由 大阔 于 2020-8-3 23:31 编辑 \n\n  1、前言\nHikariCP是一款高性能的JDBC连接池组件.凭借其体积小性能优简单可靠的特点深受MC插件开发者的喜爱.本文观看需要有一定JDBC基础\n\n2、HikariCP搭配MC插件使用详解\n\n首先使用maven引入HikariCP依赖及MySQL连接驱动依赖 大部分核心中会有mysql的驱动依赖所以不需要打包出去         <dependency>\n             <groupId>com.zaxxer</groupId>\n             <artifactId>HikariCP</artifactId>\n             <version>3.4.5</version>\n             <scope>compile</scope>\n         </dependency>\n         <dependency>\n             <groupId>mysql</groupId>\n             <artifactId>mysql-connector-java</artifactId>\n             <version>5.1.48</version>\n             <scope>provided</scope>\n         </dependency>复制代码\n如果没有使用maven构建项目，手动下载引入即可。\n为了方便插件使用服主更方便的控制HikariCP的参数，先将需要的参数写在配置文件中。\n  HikariCP:\n    connectionTimeout: 30000\n    #连接超时时间 默认值：30000（30秒）\n    minimumIdle: 10\n    #最小空闲连接数\n    maximumPoolSize: 50\n    #池允许达到的最大大小，包括空闲和正在使用的连接\n  Mysql:\n    address: localhost\n    port: 3306\n    database: test\n    user: root\n    password: 123456复制代码\n2.1、新建一个工具类(HikariCPUtils)\n首先在工具类中写入一个静态方法获取配置文件中的配置，并一一放入HikariConfig对象中，这里的HikariConfig为HikariCP的配置对象，再使用HikariConfig对象得到HikariDataSource对象。\n\n\n\n\n\nfile_1596467098000.jpg (137.62 KB, 下载次数: 3)\n\n下载附件\n\n2020-8-3 23:05 上传\n\n\n\n\n\n\n接着写一个获取连接的方法\n\n\n\n\nimage-20200803215459544.png (113.69 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-3 23:04 上传\n\n\n\n\n\n\n\n\n在主类中onEnable()方法中需要调用一下setSqlConnectionPool();\n\n\n\n\n\nimage-20200803215609125.png (19.65 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-3 23:04 上传\n\n\n\n\n\n这样做的目的是为了让静态资源只在开服的时候加载一次，可以避免不必要的资源浪费\n2.2、编写JDBC操作数据库代码1.新建一个数据表实体类\n\n\n\n\nimage-20200803223735110.png (199.21 KB, 下载次数: 3)\n\n下载附件\n\n2020-8-3 23:04 上传\n\n\n\n\n\n2.编写数据库操作类\n\n\n\n\nfile_1596467098000.jpg (116.55 KB, 下载次数: 3)\n\n下载附件\n\n2020-8-3 23:05 上传\n\n\n\n\n\n\n这中间的代码不理解的可以去看一下JDBC基础\n\n到此为止MC插件使用HikariCP连接池的代码就写完了，我们可以写一个测试方法试一下\n\n\n在onEnable注册一个命令\n\n\n\n\nimage-20200803223953015.png (42.8 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-3 23:04 上传\n\n\n\n\n\n\n在命令方法中调用一下sql类中的方法\n\n\n\n\nimage-20200803224010499.png (128.58 KB, 下载次数: 3)\n\n下载附件\n\n2020-8-3 23:04 上传\n\n\n\n\n\n\n\n\n编译插件，放入测试环境运行当你的控制台提醒下面这两句时说明你的HikariCP配置没有问题，可以使用\n\n\n\n\nimage-20200803224120473.png (2.32 KB, 下载次数: 3)\n\n下载附件\n\n2020-8-3 23:03 上传\n\n\n\n\n\n\n在控制台中输入test测试一下\n\n\n\n\nimage-20200803224200136.png (3 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-3 23:03 上传\n\n\n\n\n\n\n经测试没有任何问题\n\n\n常见问题：驱动程序没有收到来自服务器的任何数据包\n\n\n\n\n\nimage-20200803224352485.png (21.07 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-3 23:03 上传\n\n\n\n\n\n    解决办法：检查JDBCURL是否正确\n多次频繁输出信息\n\n\n\n\n\nimage-20200803224120473.png (2.32 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-3 23:04 上传\n\n\n\n\n\n解决办法：请不要close HikariDataSource\n\n3、HikariCP基本配置详解\n\n3.1、主要配置\n\n1.DirverClassName 驱动类名\n2.jdbcUrl jdbc连接所需要的url连接，通常需要加入很多参数，在我上面的介绍中也有写一些参数\n3.username  jdbc连接所需要的用户名\n4.password  jdbc连接所需要的密码\n\n3.2、常用配置\n\n1.autoCommit 自动提交事务，关于事务还是推荐有能力的开发者手动写入事务回滚以避免不必要的错误，如果你问事务是干什么用的，请自行学习jdbc基础\n2.connectionTimeout 最大等待延迟，如果在没有可用连接的情况下超过此时间，则会抛出SQLException最低可接受的连接超时时间为250 ms。 默认值：30000（30秒）\n3.idleTimeout 允许连接在池中闲置的最长时间 允许的最小值是10000ms（10秒）。 默认值：600000（10分钟）\n4.maxLifetime 连接池中连接的最大生存期 默认值：1800000（30分钟）\n5.connectionTestQuery 如果你的驱动程序支持JDBC4，建议不要设置此属性 在连接从池中获得连接以确认与数据库的连接仍然存在之前将要执行的查询\n6.minimumIdle 最小空闲连接数，请将此属性写入配置文件中以方便服主拓展使用需求  默认值10\n7.maximumPoolSize 最**接数包括空闲及正在使用的连接 请将此属性也写入配置文件中以方便服主拓展使用需求  默认值10\n8.poolName 连接池用户自定义名称  默认：自动生成\n\n\n此教程使用的目录结构\n\n\n\n\n\nQQ截图20200803232155.png (15.89 KB, 下载次数: 3)\n\n下载附件\n\n2020-8-3 23:22 上传\n\n\n\n\n\n\n请各位开发者根据自己插件的需求量选择使用数据库连接池\n如果教程中有哪些描述不当的地方请多多见谅，第一次写教程类帖子，如果代码中有需要改进的地方欢迎提出\n\nHikariCP官方GItHub\nHikariCP码云\n\n\n\n\n\n\nYeSJTIPbx1kQB45.png (3.09 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-3 23:20 上传\n\n\n\n\n\n\n\n\n[groupid=1511]Server CT[/groupid]",
    "replies": [
        {
            "author": "many先生",
            "timestamp": 1597021920,
            "txt_content": "写的很棒，感谢楼主教程"
        },
        {
            "author": "汤圆宝宝",
            "timestamp": 1597068720,
            "txt_content": "很好用，谢谢楼主，mcbbs有你更精彩"
        }
    ]
}