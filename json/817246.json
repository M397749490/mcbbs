{
    "title": "服务器内存泄漏问题如何解决?",
    "author": "飞翼ID",
    "replyCount": 12,
    "timestamp": 1535204700,
    "txt_content": " 本帖最后由 飞翼ID 于 2018-8-28 02:25 编辑 \n\n我服算是小服,1.7.10,uranium端\n\n40人,只要是开得越久,占用的内存就越多.\n开服后占用内存11G,大半天后占用21G左右.启动器最大内存我限制在20G.\n听大佬说可以用 jstack  查找原因,但是我不会用.\n\n还有其他办法或者帮小生一把?\n\nset a=20\n\"C:\\Program Files\\Java\\jre1.8.0_181\\bin\\java.exe\" -Xmx%a%G -Xms1G -Dfml.ignorePatchDiscrepancies=true -XX:+AggressiveOpts -jar Uranium-1710-dev-4-B203-server.jar\n启动器部分参数\n\n自动重启方案排除,因为人数后面可能有点多,几个小时内存就差不多用完了.\n\n二十分钟timings\n\nhttps://timings.spigotmc.org/?url=codunarefo\n\n\n################################################################\n\n已解决.\n",
    "replies": [
        {
            "author": "xmdhs",
            "timestamp": 1535205060,
            "txt_content": " 本帖最后由 xmdhs 于 2018-8-26 07:59 编辑 \n\n不建议使用这么多启动参数\n\n一般 java -jar 就够了\n\n这个优化教程的最后一章有个能统计服务器消耗的教程\n\nhttp://www.mcbbs.net/thread-478126-1-1.html"
        },
        {
            "author": "Cherls",
            "timestamp": 1535205060,
            "txt_content": "-XX:+UseG1GC\n-XX:+UseFastAccessorMethods -XX:+OptimizeStringConcat \n-XX:+AggressiveOpts \n-XX:+UseStringDeduplication \n-XX:-OmitStackTraceInFastThrow \n-XX:-UseAdaptiveSizePolicy \n你可以尝试这些参数（另外建议3小时重启一次 完美解决"
        },
        {
            "author": "剑气如虹一",
            "timestamp": 1535206260,
            "txt_content": "试试这个java -Xms1G -Xmx5G -XX:+AggressiveOpts -XX:+UseCompressedOops -jar"
        },
        {
            "author": "Yehao_pika",
            "timestamp": 1535237940,
            "txt_content": "装个neverlag插件呗，估计能减少不小负担，还可以输入释放内存指令，设置定时指令就好"
        },
        {
            "author": "游侠崔斯特",
            "timestamp": 1535246580,
            "txt_content": "设置定时重启啊  服务器"
        },
        {
            "author": "骚马克",
            "timestamp": 1535251740,
            "txt_content": "Minecraft服务器优化教程 —— 让多带50%的玩家不再是梦\nhttp://www.mcbbs.net/thread-478126-1-1.html\n(出处: Minecraft(我的世界)中文论坛)"
        },
        {
            "author": "3343977167",
            "timestamp": 1535259720,
            "txt_content": "由于我的世界PC是Java编写的，核心也是Java，所以要重启服务器，Java虚拟机会越来越大"
        },
        {
            "author": "TRCRedstoner",
            "timestamp": 1535260020,
            "txt_content": "试试看定期重启"
        },
        {
            "author": "482453675",
            "timestamp": 1535290920,
            "txt_content": "每天定时重新启动服务器就好了"
        },
        {
            "author": "Pangxie_",
            "timestamp": 1535299980,
            "txt_content": "内存泄漏一般都是装的插件有问题，仔细检查一下，我之前也是装的某些插件导致内存泄漏，现在删了，服务器开一天不用自动重启，20-30人的情况下tps都是保持平均19以上"
        },
        {
            "author": "zhangekun",
            "timestamp": 1535342760,
            "txt_content": "限制内存上限，或者加装自动卸载区块的插件"
        },
        {
            "author": "飞翼ID",
            "timestamp": 1535390580,
            "txt_content": "已解决,感谢聪聪dalao的帮助.\n原因是全球商店用数据库会出现某种内存泄漏,不过已经联系作者修了.\n\n下面分享具体方法,需要配置好jdk,和Memory Analyzer这个软件.\nhttps://blog.csdn.net/kevin_luan/article/details/8447896\n这里有教程,下面是我写的部分教程.\n\n服务器运行一段时间后,在桌面打开cmd命令窗口\n\n输入\njmap -dump:live,format=b,file=dump.hprof <pid>\n会在桌面生成一个名为dump.hprof的文件,<pid>是进程ID,任务管理器可查看\n\n如果文件比较大,设置一下Memory Analyzer启动参数的运行内存即可(MemoryAnalyzer.ini)\n\n打开MemoryAnalyzer → Open Heap Dump... → 找到生成的那个文件,点击打开 → 点击圆饼 → merge shortest paths ... → 第一条 → 自行排除\n\n教程结束,告辞!\n\n"
        }
    ]
}