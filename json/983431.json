{
    "title": "【服务端与客户端优化】解决服务器内存占用大和客户端卡顿！",
    "author": "ikanade",
    "replyCount": 9,
    "timestamp": 1583957340,
    "txt_content": " 本帖最后由 ikanade 于 2020-3-15 03:00 编辑 \n\n几句吐槽：\n\n这是一个懒人向的优化...只要改一下配置加上去就行，本教程为我在网络上找的方法经过亲自测试有效！\n\n\n\n\n\n最近也是心血来潮的自己开了一个服务器，前前后后也是忙了很久来准备，我把我开服的一些亲测的优化方案分享给大家！\n\n\n服务端问题：\n\n等我开服后，开心的邀请我的小伙伴们加入服务器游玩，一开始问题也不算多。\n就这样服务器开了一段时间后我发现，随着开服的时间增加，原本10个人在线，内存使用也就接近3G，结果开了3个小时以上游戏内玩家也降至3位（小伙伴去吃饭了）内存却到了可怕的6G ？\n\n人少了内存不降反增，这我就有点不解了！\n\n我这16G的服务器都感觉不够这游戏来长期运行...（其实在没有优化之前服务器内存是8G，后来才加上去的，结果优化后内存过剩了....）\n\n\n\n\nQQ截图20200312033108.png (32.78 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-12 03:31 上传\n\n\n\n\n\n（图中是优化后的截图，服务器是开启的）\n\n于是我开始网络上寻找问题所在和各自优化方法，得出的结论可能地图加载导致（可能还有其他原因）\n\n\n找到优化的教程也不多，最终经过好几天的折腾，也是发现一个很好用的方法。\n\n\n\n\n\n\n\n进入正题：服务器内存优化\n\n\n其实就是用启动参数来优化，加上我测试的一个java版本配合用，具体参数和java版本如下！\n\n\n我现在使用的服务器端启动参数：使用的是Contigo的核心java -server -Xincgc -Xmx最大内存M -Xms初始内存M -Xss512K -XX:+AggressiveOpts -XX:+UseCompressedOops -XX:+UseCMSCompactAtFullCollection -XX:+UseFastAccessorMethods -XX:ParallelGCThreads=4 -XX:+UseConcMarkSweepGC -XX:CMSFullGCsBeforeCompaction=2 -XX:CMSInitiatingOccupancyFraction=70 -XX:-DisableExplicitGC -XX:TargetSurvivorRatio=90 -jar 服务端核心.jar复制代码\n\nJAVA版本：jre-8u241-windows-x64\n\n\n以上配置是我亲测，服务器MOD有69个\n\n\n\n\nQQ截图20200312035559.png (82.89 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-12 03:56 上传\n\n\n\n\n\n\n\n在我服里使用是效果显著（效果看上图）。服务器内13位玩家长期开服内存也一直在3G\n\n\n注意：我不确定大家使用后是否都会有效，但是大家不妨试一试。\n\n\n\n\n\n\n\n\n\n\n进入正题：客户端卡顿解决\n\n\n那么服务端问题是解决了，但是客户端的问题就来了...\n\n1，也是和服务器一样开久了后内存暴增，到之后直接内存溢出，导致客户端崩溃\n2，进入服务器不久后卡顿，就是时不时卡一下\n\n\n解决方法：\n\n\n也是和服务端一样使用：jre-8u241-windows-x64\n\n然后在游戏启动器添加启动参数：\n-Xss512K -XX:+AggressiveOpts -XX:+UseCompressedOops -XX:+UseCMSCompactAtFullCollection -XX:+UseFastAccessorMethods -XX:ParallelGCThreads=4 -XX:+UseConcMarkSweepGC -XX:CMSFullGCsBeforeCompaction=2 -XX:CMSInitiatingOccupancyFraction=70 -XX:-DisableExplicitGC -XX:TargetSurvivorRatio=90复制代码\n\n我用的启动器是 HMCL 3.2.149版本\n\n\n\n\n\nQQ截图20200312035159.png (272.8 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-12 03:52 上传\n\n\n\n\n\n\n\n\n\n\nQQ截图20200312035243.png (226.64 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-12 03:52 上传\n\n\n\n\n\n\n\n这是客户端里的mod\n\n\n\n\n\nQQ截图20200312035712.png (116.57 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-12 03:57 上传\n\n\n\n\n\n\n\n\n\n\n我使用这个配置后，客户端长期运行后，内存一直保持在7G内（多人服务器），单机在8G多。\n\n\n使用以上配置后，游戏客户端没有因为内存不断增大导致内存溢出崩溃过，玩游戏顺畅了，整个游戏体验真的是好了太多！\n\n\n\n如果大家使用也有效果的话可以在回复表示支持喔~\n\n\n\n\n\n",
    "replies": [
        {
            "author": "ikanade",
            "timestamp": 1583988060,
            "txt_content": "别看我我注册很久了...其实我还是个新人！"
        },
        {
            "author": "Rhythm",
            "timestamp": 1583992380,
            "txt_content": "这边提一点 一个优秀的服务器不应该追求内存占用率低\n如果你只开一个服务器 那么内存空着又有什么用？\n按照你这样的设置方式 服务器不仅会频繁分配/释放内存\n还会反复进行GC 占用更多的CPU时间 得不偿失 更加卡顿"
        },
        {
            "author": "ikanade",
            "timestamp": 1583994060,
            "txt_content": "Rhythm 发表于 2020-3-12 13:53\n这边提一点 一个优秀的服务器不应该追求内存占用率低\n如果你只开一个服务器 那么内存空着又有什么用？\n按照 ...\n但是我觉得比之前流畅多了，cpu并没有占用很大，和平常差不多"
        },
        {
            "author": "Rhythm",
            "timestamp": 1583994660,
            "txt_content": "ikanade 发表于 2020-3-12 14:21\n但是我觉得比之前流畅多了，cpu并没有占用很大，和平常差不多\n建议百度 内存加速球危害"
        },
        {
            "author": "ikanade",
            "timestamp": 1583996280,
            "txt_content": "Rhythm 发表于 2020-3-12 14:31\n建议百度 内存加速球危害\n各有所需吧，我也没能看到有什么大的危害，这些教程也是网络上大佬提供的，我只不过整合出来分享，有需要的人可以试一试"
        },
        {
            "author": "ikanade",
            "timestamp": 1584262020,
            "txt_content": " 本帖最后由 ikanade 于 2020-3-15 23:52 编辑 \n\n本教程测试平台为：\n客户端：1.7.10+jre-8u241+Window10\n服务端：1.7.10+jre-8u241+Windows server 2019"
        },
        {
            "author": "皮特刘",
            "timestamp": 1584381420,
            "txt_content": "沙发前排！！"
        },
        {
            "author": "23329678",
            "timestamp": 1584587280,
            "txt_content": "自己电脑开服和租面板服有啥区别？（朋友联机）"
        },
        {
            "author": "zjm001",
            "timestamp": 1585608420,
            "txt_content": "4G内存开5个人的够不够？"
        }
    ]
}