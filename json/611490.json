{
    "title": "关于服务器卡顿问题",
    "author": "ls2552",
    "replyCount": 2,
    "timestamp": 1469748840,
    "txt_content": "本服务器为BC群组服，子服一共有5个，后续应该还会加，平时CPU占用，内存占用都不过30%，也就是说没有它们的问题，网络比较好，无丢包。但是在人数15人左右，带宽占用1Mbps时候会发生瞬卡，有时候30秒一次，每次能卡1-10秒以上是服务器情况，下面我说一下问题的现象，我自己的猜想\n——————————————————————\n服务器是VPS，4核心X5560，内存8G，50Gbps单防，网络接入的是15M上下对等，经过测试，下行大约450Mbps，上行大约17Mbps，算是商家没骗我。但是网络应用达到1Mbps左右的时候会出现瞬卡，打开ping会发现，那一段时间的延迟飙升，甚至发生丢包。而服务器没有人的时候ping一天也不会有任何丢包。\n\n作为一个研究硬件比软件好的人，我有一个猜想，几万字的长话说成短话。也就是按照服务商提供服务器1:10比例来讲，以双网卡1Gbps作为硬件配置。按照一个网口内网，一个网口外网来计算，经过虚拟化，每台服务器大约分到100Mbps最大带宽，而有效的利用率最大不超过85%（无规则发包不考虑延迟），作为服务器来说，大约只有5%-15%能够利用，也就是无卡顿情况下，大约为10Mbps。而再计算上SQL等，尤其是BC的内网互联会让内网的网络利用率增大好几倍。最终导致了有效的带宽不足。而相比之下，我一位朋友的服务器是一个Cauldron服务器，无BC，接入10Mbps的时候运行大约100人没有卡顿现象，而另外一个朋友，是BC服务器+6个子服，使用独立机，1Gbps网卡，运行120人左右的时候出现的瞬卡现象。这样一来，以上所阐述的猜想应该是成立的。如果这样的话，那么开BC服务器如果想要做大只能使用负载均衡，前端仅BC ，独立机，多网口，然后几个后端的独立机。但是会发现这样并不平衡，也就是说难道没这些东西就没法开服了吗？我不断纠结当中。我又想起了去年的时候，我的服务器60人在线，接入百兆光纤，明显够用但是突然出现丢包问题，虽然没有集体掉线但是有的人延迟甚至过千。这台独立机的提供者是我一个朋友，专门搞网络的，他跟我说的是单个端口流量过大，端口无法承受导致的，要加防火墙。但是按照今年的情况来说并非如此\n\n———————————————————————\n可能有人没有兴趣看我上面所说的了，一目十行是可以的，可以粗略看看。\n毕竟我一个理论级别的不能和有经验的相提并论，所以来MCBBS请教一下各位老司机\n\n此问题困扰我两年了。如果能帮我解决，无论是跟我说关于解决方法还是教我什么的，只要是能解决，有效。120金粒奉上\n\n\n\n\n\n不给点金粒能把你们弄出来？\n\n抱歉，昨天本来给的是120金粒，结果被说是发错版了，然后把我删帖，金粒也被吃掉了。就剩30了\n",
    "replies": [
        {
            "author": "酷车手BB弹",
            "timestamp": 1469761740,
            "txt_content": "这话多的我都要用CTRL+F搜关键词了。。。\n你先检查一下后台有没有报错之类的\n如果没有，你就试着检查一下插件有没有造成卡顿\n后台输入/timings\n让他开始检测之后等待10分钟左右，最好是出现了卡顿之后再输入/timings paste 获取报告\n他会给出网址，浏览器打开那个网址结果就出来了，在那里可以详细的看到各个插件的性能报告"
        },
        {
            "author": "ls2552",
            "timestamp": 1469766360,
            "txt_content": "酷车手BB弹 发表于 2016-7-29 11:09\n这话多的我都要用CTRL+F搜关键词了。。。\n你先检查一下后台有没有报错之类的\n如果没有，你就试着检查一下插 ...\n报错之类的全部修复了，插件没有问题，timings说我服务器tps稳定20，load 3.8%左右，\n这样一来服务器是没有问题的，在于网络封包，我不太清楚为什么会造成一跳一跳的情况.... 平均占用1M，刚刚又一次，跳到10M左右，持续3秒"
        }
    ]
}