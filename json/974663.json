{
    "title": "存在4年了的-自定义NPC【伙伴】职业饥饿BUG，想到了修复方法，但如何锁定一条NBTtag？",
    "author": "inuyasha01",
    "replyCount": 5,
    "timestamp": 1583156520,
    "txt_content": " 本帖最后由 inuyasha01 于 2020-3-2 22:42 编辑 \n\n望着作者git迟迟不来的更新。。NPC伙伴职业从2016年到今天还是WIP（未完成）。。。\n自己用的2019Oct的最新版NPC，所以。。估计这BUG已经存在四年多了。\n描述一下：\nMOD：自定义NPC (CustomNPC 作者noppes)  2019Oct  -  1.12.2\n\n问题：\n【伙伴】职业在吃完背包内 最后一个物品 后，会进入一个【无限死亡】的状态。无法互动，无法被更改，无法复活。然而【伙伴】职业 是所有NPC里唯一一个带饱食度的种类然而【伙伴】职业无论通过何种方法都 无法取消饱食度的自动下降问题        （即使NPC被关闭了背包功能，无法进食，但他的饥饿值仍然会被更新）\n\n\n\n\n20200302081152.png (142.66 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-2 21:41 上传\n\n\n\n\n曾想过用脚本来解决的。。。\n但。。作者在官网http://www.kodevelopment.nl/minecraft/customnpcs/roles/ \nhttp://www.kodevelopment.nl/customnpcs/api/1.12.2/noppes/npcs/api/event/package-summary.html \n都没有提供修改NPC饥饿的API （无论你搜food  hunger，都是plyaer实体才可被操作的，npc的没写接口，调用直接报错）\n\n此外discord的npc脚本大佬的讨论版里，也没人能解决饱食度的问题。。\n          （他们给的建议是改NBT，但他们改完端崩了，我改完没崩但无效）\n\n\n\n\n\n20200302214022.png (176.04 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-2 21:41 上传\n\n\n\n\n\n\n\n\n\n20200302214035.png (82.34 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-2 21:41 上传\n\n\n\n\n此外通过nbtEdit查看NPC的NBT，发现关于food类的所有项，无论改成-1，还是删除tag，都无法停止foodticktimer的运转（会自动重置）\n此外通过【治疗者】NPC给【伙伴】增加【饱腹BUFF】，也无法增加伙伴职业NPC的饱食度\n此外通过脚本addPotionEffect id23给NPC，也无效\n此外通过myitems手持道具buff，让NPC手持饱腹BUFF道具，也无效\n此外由于npc的git没开源https://github.com/Noppes/CustomNPCsAPI 作者只给了API的开源，无法动及mod里的代码。。\n此外自己也尝试过通过反汇编直接删掉BUG代码，但部分代码丢失，无法给mod进行完善和重编译。。\n此外NPC最近也在停更状态。。他主discord的邀请链接也过时了，不知道怎么能有效地联系上作者本人。。\n\n\n因此。。。能做的都做了。。但。。NPC饿了还是该扣血就扣血，吃完物品该卡死就卡死。\n但有没有什么办法可以从根本上解决伙伴NPC饥饿的问题？  ——如何让一个实体不会饿？比如锁定单一实体的NBT， FoodTickTimer这个tag，理论上可以。如果有人知道方法的话。。\n所以  感谢阅读。。也感谢帮忙。。。。 Orz\n\n\n\n\n\n",
    "replies": [
        {
            "author": "Hueihuea",
            "timestamp": 1583156520,
            "txt_content": " 本帖最后由 Hueihuea 于 2020-3-9 13:32 编辑 \n\n现在 你甚至可以尝试这个\nhttps://www.mcbbs.net/thread-979548-1-1.html\n\n论坛代码功能好像不太喜欢我 放粘贴板了\nhttps://paste.ubuntu.com/p/JrzQzwJCsk/\n\n\n/**\n*@author Hueihuea\n*/\n\n//注意要在tick事件使用\nfunction tick(event) {\n  //让当前NPC吃饱\n  Satiate(event.npc);\n}\n\n/**\n * void **Satiate(ICustomNpc npc)\n * @param {\"ICustomNpc\"} npc 要喂饱的npc\n * @description 让这个该死的NPC吃饱吧\n */\nfunction Satiate(npc) {\n  var RoleCompanion = Java.type(\"noppes.npcs.roles.RoleCompanion\");\n  var CompanionFoodStats = Java.type(\"noppes.npcs.roles.companion.CompanionFoodStats\");\n  var role = npc.getMCEntity().roleInterface;\n  if (!(role instanceof RoleCompanion)) {\n    return;\n  }\n  var foodstats = role.foodstats;\n  var CompanionFoodStatsClass = CompanionFoodStats.class;\n  var foodLevelField = CompanionFoodStatsClass.getDeclaredField(\"foodLevel\");\n  var foodTimerField = CompanionFoodStatsClass.getDeclaredField(\"foodTimer\");\n  foodLevelField.setAccessible(true);\n  foodTimerField.setAccessible(true);\n  foodLevelField.set(foodstats, 20);\n  foodTimerField.set(foodstats, 0);\n}复制代码"
        },
        {
            "author": "Hueihuea",
            "timestamp": 1583157900,
            "txt_content": "版本是1.12.2吗？还是1.7.10？\n理论上用脚本可以解决问题\n因此我个人不建议直接修改npcmod\n\n如果修改这个NPC的职业 他会离开\"无限死亡\"状态吗"
        },
        {
            "author": "inuyasha01",
            "timestamp": 1583159820,
            "txt_content": " 本帖最后由 inuyasha01 于 2020-3-2 22:41 编辑 \nHueihuea 发表于 2020-3-2 22:05\n版本是1.12.2吗？还是1.7.10？\n理论上用脚本可以解决问题\n因此我个人不建议直接修改npcmod\n感谢回复， 版本是最新的2019 Oct 1.12.2\n脚本。。。。。的话。。http://www.kodevelopment.nl/customnpcs/api/1.12.2/noppes/npcs/api/event/package-summary.html\n最新的脚本API。。作者并没有提供对NPC进行饱食度控制的接口。。。\n你可以看看我spolier起来的那块，在discord脚本区的发帖记录。。 \n强行调取IPlyaer的函数NPC会直接报错，提示setHunger不存在于npc类中。  \n\n然后职业就是因为【伙伴】才会有BUG。。。所以如果要用伙伴的话，这BUG不修很不方便。。\n"
        },
        {
            "author": "Hueihuea",
            "timestamp": 1583160480,
            "txt_content": "inuyasha01 发表于 2020-3-2 22:37\n感谢回复， 版本是最新的2019 Oct 1.12.2\n脚本。。。。。的话。。http://www.kodevelopment.nl/customnpcs ...\n所以 不使用该职业 就不会出现该bug？是这样吗？"
        },
        {
            "author": "inuyasha01",
            "timestamp": 1583160780,
            "txt_content": "Hueihuea 发表于 2020-3-2 22:48\n所以 不使用该职业 就不会出现该bug？是这样吗？\n对的。但问题是  如果想用，就会出现。。这BUG是固定存在的"
        }
    ]
}