{
    "title": "如何监控 tileentity 加载到世界中？",
    "author": "Himmelt",
    "replyCount": 6,
    "timestamp": 1578896940,
    "txt_content": "我需要对某些tileentity做一些一次性处理，却苦于无法获取 其 加载到世界中的事件。不知可有什么方案？",
    "replies": [
        {
            "author": "roj234",
            "timestamp": 1578899220,
            "txt_content": "mod? TileEntity.validate() {super.validate(); // 好了, 放些东西八}"
        },
        {
            "author": "Himmelt",
            "timestamp": 1578903120,
            "txt_content": "roj234 发表于 2020-1-13 15:07\nmod? TileEntity.validate() {super.validate(); // 好了, 放些东西八}\n插件，也不是自定义，而是原版的tileentity。"
        },
        {
            "author": "roj234",
            "timestamp": 1578907800,
            "txt_content": "ASM修改原版TileEntity的字节码调用某个static方法？或者试试Mixin"
        },
        {
            "author": "Himmelt",
            "timestamp": 1578986820,
            "txt_content": "roj234 发表于 2020-1-13 17:30\nASM修改原版TileEntity的字节码调用某个static方法？或者试试Mixin\nMixin确实是个好东西，Sponge可以直接用，但是Bukkit就没招了"
        },
        {
            "author": "roj234",
            "timestamp": 1579336860,
            "txt_content": "Himmelt 发表于 2020-1-14 15:27\nMixin确实是个好东西，Sponge可以直接用，但是Bukkit就没招了\n自定义ClassLoader,检测类名返回指定的字节码\n缺点： 版本更新就要重新做字节码\n几乎没有与其他ASM的兼容性\n至于字节码哪里来？ 在加载别的class时读取\npublic class JustStaticLoadsomeClass {\n    static {\n        TileEntityXXX_Fix.StaticClassLoad();\n    }\n}\n\npublic class MyClassLoader extends ClassLoader {\n    puvlic byte[] loadClass(Param...) {\n        switch(className) {\n             case \"myplugin.exampletileentity.TileEntityXXX_Fix\":\n                  [static] tmp1 = super.loadClass(xxxxx); // 也可以用FileInputStream\n             case \"net.minecraft.tileentity.TileEntityXXX\":\n                   return new String(tmp).replace(旧包名，新包名); // 实际上肯定不能用String，用别的方法替换\n             default:\n                   return super.loadClass();\n}\n}\n}"
        },
        {
            "author": "Himmelt",
            "timestamp": 1579342920,
            "txt_content": "roj234 发表于 2020-1-18 16:41\n自定义ClassLoader,检测类名返回指定的字节码\n缺点： 版本更新就要重新做字节码\n几乎没有与其他ASM的兼容 ...\n我已经找到合适的替代方案，监控区块加载事件，然后遍历该区块的tileentities，处理特定类型的方块，且处理内容很少，所以不会造成额外负担。"
        }
    ]
}