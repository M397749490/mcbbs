{
    "title": "【数据包】MotionIt - 原版算Motion (含UI操作)",
    "author": "⭐✔️",
    "replyCount": 8,
    "timestamp": 1559299200,
    "txt_content": " 本帖最后由 ⭐✔️ 于 2020-6-29 15:44 编辑 \n\nGithub\n本项目开源，用于展示相关命令：\nhttps://github.com/tremblestarman/datapacks/tree/master/MotionIt版权相关\n用到了Bio-Hazard的公式\n原帖链接：https://www.bilibili.com/read/cv1342860\n（有点回忆起了四年前我制作的渣Motion计算器，并非基于两点坐标和时间运算，反而关注的是速率和夹角，现在看来实用性太低了）\n\n[ruby=3张1~2M的gif]效果[/ruby]利用两点坐标计算Motion矿车\n掉落沙\n掉落沙\n\n（对于其他实体因为最大速度以及其他限制， 理论与实际有所偏差）\n\n使用方法命令操作\n#   set target position (0.500, 8.000, 6.500)\n#       the value is rounded to three decimal places.\nscoreboard players set @x tx 500\nscoreboard players set @x ty 8000\nscoreboard players set @x tz 6500\n#   set time (ticks)\nscoreboard players set @x t 40复制代码设定tx、ty、tz为终点坐标（保留三位小数），设定t为运动时间（刻数）。\nexecute as @x run function motionit:calculate复制代码接下来执行运算函数。\nexecute as @x run function motionit:go复制代码再执行赋值函数运行。UI操作\n\nfunction motionit:ui/reset复制代码获取\"EntitySelector\"，右键选择实体，然后聊天栏点击操作。\n\n\n原理其实主要原理就在下面三张图中：\n\n\n\npy脚本如下：\nimport sys\nimport math\n\no = (0.5,4,-3.5)\np = (0.5,8,6.5)\ng = -0.02\nf = 0.08\nt = 20\n\ndx = p[0] - o[0]\ndy = p[1] - o[1]\ndz = p[2] - o[2]\n\nx = f * dx / (1 - math.pow(1 - f, t))\ny = (f * dy - g * t) / (1 - math.pow(1 - f, t)) + g / f - g\nz = f * dz / (1 - math.pow(1 - f, t))\n\nprint (\"{Motion:[\", x, \",\", y, \",\", z, \"]}\")复制代码原理上来讲很容易实现，所以本数据包主要内容体现在如何让计算保持一定精度，尤其是仅运用储存上限为2147483647的计分板运算\n\n变量储存规则\n介绍变量规则，以免一会儿大家看混淆\n主要分为两类，常量和变量：\n常量如物理常量'g'和'f'，以及常数-1、0、1、10……储存在计分板\"con\"中；\n变量主要是过程量'a'、'b'、'c'等等就不列举了。\n三维变量中ox、oy、oz和tx、ty、tz还有m0、m1、m2因为与实体NBT存储有关，另开了计分板。第一步：获取物理常量 （motionit:getparam）\n原理是穷举，用到了实体标签：\n例如tags/entity_types/mincart.json\n{\n    \"replace\": false,\n    \"values\": [\n        \"minecraft:boat\",\n        \"minecraft:minecart\",\n        \"minecraft:tnt_minecart\",\n        \"minecraft:chest_minecart\",\n        \"minecraft:furnace_minecart\",\n        \"minecraft:hopper_minecart\",\n        \"minecraft:spawner_minecart\",\n        \"minecraft:command_block_minecart\"\n    ]\n}复制代码穷举的命令则是：\n# boat & minecart : g = -0.04, f = 0.05\nexecute as @s[type=#motionit:minecart] run scoreboard players set g con -4\nexecute as @s[type=#motionit:minecart] run scoreboard players set f con 5复制代码这里的'g'和'f'我们用一位整数替代两位小数。第二步：获取1-(1-f)^t （motionit:pow/x）\n原来想法是递归运算pow()，因为舍的位数太多，结果是运行不超过十次必得到0，因此舍弃了（仍保留在数据包中，函数为oppow.mcfunction和oppowc.mcfunction，毕竟方法是正确的）。\n后来果断穷举了，因为f的值是恒定的常数，所以分为0、1、2、5四种情况穷举，脚本如下：\nimport sys\nimport math\n\nf = 0.01\nm = 0\nml = 0\ntl = 0\n\nfor t in range(1000):\n    m = int((1-pow((1-f),t))*10000)\n    if m != ml or t == 999:\n        if tl == t - 1 : print(\"execute as @s[scores={t=%s}] run scoreboard players set p con %s\" %(tl, ml))\n        else : print(\"execute as @s[scores={t=%s..%s}] run scoreboard players set p con %s\" %(tl, t, ml))\n        ml = m\n        tl = t复制代码第三步：计算坐标差 （motionit:relativeswitch、motionit:relativeconfirm）\nmotionit:relativeswitch：\n# distance rounding\nexecute store result score x1 var run data get entity @s Pos[0] 1000\nexecute store result score y1 var run data get entity @s Pos[1] 1000\nexecute store result score z1 var run data get entity @s Pos[2] 1000\nscoreboard players operation @s m0 = @s tx\nscoreboard players operation @s m1 = @s ty\nscoreboard players operation @s m2 = @s tz\nscoreboard players operation x2 var = @s tx\nscoreboard players operation y2 var = @s ty\nscoreboard players operation z2 var = @s tz\nscoreboard players operation x2 var -= x1 var\nscoreboard players operation y2 var -= y1 var\nscoreboard players operation z2 var -= z1 var\nscoreboard players operation x2 var /= 1000 con\nscoreboard players operation y2 var /= 1000 con\nscoreboard players operation z2 var /= 1000 con\nscoreboard players operation x3 var = x2 var\nscoreboard players operation y3 var = y2 var\nscoreboard players operation z3 var = z2 var\nexecute if score x2 var < 0 con run scoreboard players operation x2 var *= neg con\nexecute if score y2 var < 0 con run scoreboard players operation y2 var *= neg con\nexecute if score z2 var < 0 con run scoreboard players operation z2 var *= neg con\n\n# flexibly standardize decimal place format\n#   calculate relatively to improve accuracy\nexecute if score x2 var >= 10000 con run scoreboard players operation @s m0 = x3 var\nexecute if score x2 var >= 1000 con if score x2 var < 10000 con run execute store result score x1 var run data get entity @s Pos[0] 10\nexecute if score x2 var >= 1000 con if score x2 var < 10000 con run scoreboard players operation @s m0 /= 100 con\nexecute if score x2 var >= 100 con if score x2 var < 1000 con run execute store result score x1 var run data get entity @s Pos[0] 100\nexecute if score x2 var >= 100 con if score x2 var < 1000 con run scoreboard players operation @s m0 /= 10 con\nexecute if score x2 var >= 10 con if score x2 var < 100 con run execute store result score x1 var run data get entity @s Pos[0] 1000\nexecute if score x2 var >= 1 con if score x2 var < 10 con run execute store result score x1 var run data get entity @s Pos[0] 10000\nexecute if score x2 var >= 1 con if score x2 var < 10 con run scoreboard players operation @s m0 *= 10 con\nexecute if score x2 var < 1 con run execute store result score x1 var run data get entity @s Pos[0] 100000\nexecute if score x2 var < 1 con run scoreboard players operation @s m0 *= 100 con\n\nexecute if score y2 var >= 10000 con run scoreboard players operation @s m1 = y3 var\nexecute if score y2 var >= 1000 con if score y2 var < 10000 con run execute store result score y1 var run data get entity @s Pos[1] 10\nexecute if score y2 var >= 1000 con if score y2 var < 10000 con run scoreboard players operation @s m1 /= 100 con\nexecute if score y2 var >= 100 con if score y2 var < 1000 con run execute store result score y1 var run data get entity @s Pos[1] 100\nexecute if score y2 var >= 100 con if score y2 var < 1000 con run scoreboard players operation @s m1 /= 10 con\nexecute if score y2 var >= 10 con if score y2 var < 100 con run execute store result score y1 var run data get entity @s Pos[1] 1000\nexecute if score y2 var >= 1 con if score y2 var < 10 con run execute store result score y1 var run data get entity @s Pos[1] 10000\nexecute if score y2 var >= 1 con if score y2 var < 10 con run scoreboard players operation @s m1 *= 10 con\nexecute if score y2 var < 1 con run execute store result score y1 var run data get entity @s Pos[1] 100000\nexecute if score y2 var < 1 con run scoreboard players operation @s m1 *= 100 con\n\nexecute if score z2 var >= 10000 con run scoreboard players operation @s m2 = z3 var\nexecute if score z2 var >= 1000 con if score z2 var < 10000 con run execute store result score z1 var run data get entity @s Pos[2] 10\nexecute if score z2 var >= 1000 con if score z2 var < 10000 con run scoreboard players operation @s m2 /= 100 con\nexecute if score z2 var >= 100 con if score z2 var < 1000 con run execute store result score z1 var run data get entity @s Pos[2] 100\nexecute if score z2 var >= 100 con if score z2 var < 1000 con run scoreboard players operation @s m2 /= 10 con\nexecute if score z2 var >= 10 con if score z2 var < 100 con run execute store result score z1 var run data get entity @s Pos[2] 1000\nexecute if score z2 var >= 1 con if score z2 var < 10 con run execute store result score z1 var run data get entity @s Pos[2] 10000\nexecute if score z2 var >= 1 con if score z2 var < 10 con run scoreboard players operation @s m2 *= 10 con\nexecute if score z2 var < 1 con run execute store result score z1 var run data get entity @s Pos[2] 100000\nexecute if score z2 var < 1 con run scoreboard players operation @s m2 *= 100 con\n\n# get difference\nscoreboard players operation @s m0 -= x1 var\nscoreboard players operation @s m1 -= y1 var\nscoreboard players operation @s m2 -= z1 var\n\n#tellraw @a [\"\",{\"text\":\"x2 = \"},{\"score\":{\"name\":\"x2\",\"objective\":\"var\"},\"color\":\"red\"},{\"text\":\", y2 = \"},{\"score\":{\"name\":\"y2\",\"objective\":\"var\"},\"color\":\"blue\"},{\"text\":\", z2 = \"},{\"score\":{\"name\":\"z2\",\"objective\":\"var\"},\"color\":\"green\"}]\n#tellraw @a [\"\",{\"text\":\"m0 = \"},{\"score\":{\"name\":\"@s\",\"objective\":\"m0\"},\"color\":\"red\"},{\"text\":\", m1 = \"},{\"score\":{\"name\":\"@s\",\"objective\":\"m1\"},\"color\":\"blue\"},{\"text\":\", m2 = \"},{\"score\":{\"name\":\"@s\",\"objective\":\"m2\"},\"color\":\"green\"}]\n复制代码先计算整数位的差值，根据差值的大小动态保留差值的位数，将差值限定到5位数（y=0是个特例）\nmotionit:relativeconfirm：\n# mark decimal places\nexecute if score x2 var >= 10000 con run tag @s add acy0\nexecute if score x2 var >= 1000 con if score x2 var < 10000 con run tag @s add acx1\nexecute if score x2 var >= 100 con if score x2 var < 1000 con run tag @s add acx2\nexecute if score x2 var >= 10 con if score x2 var < 100 con run tag @s add acx3\nexecute if score x2 var >= 1 con if score x2 var < 10 con run tag @s add acx4\nexecute if score x2 var < 1 con run tag @s add acx5\n\nexecute if score y2 var >= 10000 con run tag @s add acy0\nexecute if score y2 var >= 1000 con if score y2 var < 10000 con run tag @s add acy1\nexecute if score y2 var >= 100 con if score y2 var < 1000 con run tag @s add acy2\nexecute if score y2 var >= 10 con if score y2 var < 100 con run tag @s add acy3\nexecute if score y2 var >= 1 con if score y2 var < 10 con run tag @s add acy4\nexecute if score y2 var > 0 con if score y2 var < 1 con run tag @s add acy5\nexecute if score y2 var = 0 con run tag @s add acy4\n\nexecute if score z2 var >= 10000 con run tag @s add acz0\nexecute if score z2 var >= 1000 con if score z2 var < 10000 con run tag @s add acz1\nexecute if score z2 var >= 100 con if score z2 var < 1000 con run tag @s add acz2\nexecute if score z2 var >= 10 con if score z2 var < 100 con run say 1\nexecute if score z2 var >= 10 con if score z2 var < 100 con run tag @s add acz3\nexecute if score z2 var >= 1 con if score z2 var < 10 con run tag @s add acz4\nexecute if score z2 var < 1 con run tag @s add acz5复制代码上标签，表示保留多少位，以便于后续的赋值处理。水平方向 （motionit:opx、motionit:opz）\n以opx为例：\n# f * m0 / p\nscoreboard players operation a var = f con\nscoreboard players operation a var *= 1000 con\ntellraw @a [\"\",{\"text\":\"p = \"},{\"score\":{\"name\":\"p\",\"objective\":\"con\"},\"color\":\"yellow\"}]\ntellraw @a [\"\",{\"text\":\"m0 = \"},{\"score\":{\"name\":\"a\",\"objective\":\"var\"},\"color\":\"yellow\"}]\nscoreboard players operation a var *= @s m0\nscoreboard players operation a var /= p con\nscoreboard players operation @s m0 = a var\n\n#tellraw @a [\"\",{\"text\":\"m0 = \"},{\"score\":{\"name\":\"a\",\"objective\":\"var\"},\"color\":\"yellow\"}]复制代码可以说就是把图中公式用四则运算表示了一遍。竖直方向（motionit:opy）\n# f * m1 - g * t / p\nscoreboard players operation a var = f con\nscoreboard players operation a var *= @s m1\n\nscoreboard players operation b var = g con\nscoreboard players operation b var *= @s t\nexecute if score y2 var >= 1000 con if score y2 var < 10000 con run scoreboard players operation b var *= 10 con\nexecute if score y2 var >= 100 con if score y2 var < 1000 con run scoreboard players operation b var *= 100 con\nexecute if score y2 var >= 10 con if score y2 var < 100 con run scoreboard players operation b var *= 1000 con\nexecute if score y2 var >= 1 con if score y2 var < 10 con run scoreboard players operation b var *= 10000 con\nexecute if score y2 var > 0 con if score y2 var < 1 con run scoreboard players operation b var *= 100000 con\nexecute if score y2 var = 0 con run scoreboard players operation b var *= 10000 con\n\nscoreboard players operation a var -= b var\nscoreboard players operation a var /= p con\nscoreboard players operation a var *= 100 con\n#tellraw @a [\"\",{\"text\":\"f * m1 - g * t / p = \"},{\"score\":{\"name\":\"c\",\"objective\":\"var\"},\"color\":\"yellow\"}]\n\n# g / f - g\nscoreboard players operation c var = g con\nscoreboard players operation c var *= 10000 con\nscoreboard players operation c var /= f con\n\nscoreboard players operation d var = g con\nscoreboard players operation d var *= 100 con\nscoreboard players operation c var -= d var\n\n# set\nscoreboard players operation a var += c var\nscoreboard players operation @s m1 = a var\n\n#tellraw @a [\"\",{\"text\":\"g / f - g = \"},{\"score\":{\"name\":\"c\",\"objective\":\"var\"},\"color\":\"yellow\"}]复制代码除了表示公式外，还要协调位数，所以竖直方向处理更特殊，这边我就不解释怎么协调得了，看看就行。总流程 （motionit:calculate）\n# avoid momentum loss\ndata merge entity @s {NoGravity:1b}\n# get g & f\nexecute as @s run function motionit:getparam\n\n# flexible accurancy\n#   get mx/y/z\nexecute as @s run function motionit:relativeswitch\nexecute as @s run function motionit:relativeconfirm\n\n#   exhaustive method to get constant : p = (1 - (1 - f) ^ t)\nexecute if score f con = 0 con run function motionit:pow/0\nexecute if score f con = 1 con run function motionit:pow/1\nexecute if score f con = 2 con run function motionit:pow/2\nexecute if score f con = 5 con run function motionit:pow/5\n#   f * mx / p  or  f * mz / p \nexecute as @s run function motionit:opx\nexecute as @s run function motionit:opz\n#   ( f * my - gt ) / p + g / f - g\nexecute as @s run function motionit:opy\n\nscoreboard players set g con 0\nscoreboard players set f con 0复制代码把上面一套流程按顺序走了一遍，计算所得的Motion用(m0,m1,m2)表示。赋值 （motionit:go）\n# assign values to motion\nexecute as @s[tag=acx0] store result entity @s Motion[0] double 0.1 run scoreboard players get @s m0\nexecute as @s[tag=acx1] store result entity @s Motion[0] double 0.01 run scoreboard players get @s m0\nexecute as @s[tag=acx2] store result entity @s Motion[0] double 0.001 run scoreboard players get @s m0\nexecute as @s[tag=acx3] store result entity @s Motion[0] double 0.0001 run scoreboard players get @s m0\nexecute as @s[tag=acx4] store result entity @s Motion[0] double 0.00001 run scoreboard players get @s m0\nexecute as @s[tag=acx5] store result entity @s Motion[0] double 0.000001 run scoreboard players get @s m0\n\nexecute as @s[tag=acy0] store result entity @s Motion[1] double 1 run scoreboard players get @s m1\nexecute as @s[tag=acy1] store result entity @s Motion[1] double 0.1 run scoreboard players get @s m1\nexecute as @s[tag=acy2] store result entity @s Motion[1] double 0.01 run scoreboard players get @s m1\nexecute as @s[tag=acy3] store result entity @s Motion[1] double 0.001 run scoreboard players get @s m1\nexecute as @s[tag=acy4] store result entity @s Motion[1] double 0.0001 run scoreboard players get @s m1\nexecute as @s[tag=acy5] store result entity @s Motion[1] double 0.00001 run scoreboard players get @s m1\n\nexecute as @s[tag=acz0] store result entity @s Motion[2] double 0.1 run scoreboard players get @s m2\nexecute as @s[tag=acz1] store result entity @s Motion[2] double 0.01 run scoreboard players get @s m2\nexecute as @s[tag=acz2] store result entity @s Motion[2] double 0.001 run scoreboard players get @s m2\nexecute as @s[tag=acz3] store result entity @s Motion[2] double 0.0001 run scoreboard players get @s m2\nexecute as @s[tag=acz4] store result entity @s Motion[2] double 0.00001 run scoreboard players get @s m2\nexecute as @s[tag=acz5] store result entity @s Motion[2] double 0.000001 run scoreboard players get @s m2\n\n# avoid momentum loss\ndata merge entity @s {NoGravity:0b}复制代码还原位数，然后赋值给Motion。\n这里涉及到失重，原因是为了修复一个莫名其妙的动量亏损。也就是说重力状态下，通过命令修改的Motion值会在第二刻突然减弱，而初始化生成实体时设定的Motion不受影响。UI\nUI的具体细节就不讲了，射线等老技术自己翻翻源码也就明白了。\n",
    "replies": [
        {
            "author": "18168559302",
            "timestamp": 1563944400,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "jiningning",
            "timestamp": 1573778820,
            "txt_content": "生存党看完表示一脸懵逼"
        },
        {
            "author": "2677513295",
            "timestamp": 1586324460,
            "txt_content": "正好做地图需要"
        },
        {
            "author": "一只swift",
            "timestamp": 1593830760,
            "txt_content": "py怎么和minecraft联系在一起呢？"
        },
        {
            "author": "破碎の琉璃",
            "timestamp": 1594343040,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "破碎の琉璃",
            "timestamp": 1594344420,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "qq207655127",
            "timestamp": 1594353720,
            "txt_content": " 非常有创造性啊，支持作者！"
        },
        {
            "author": "咕噜and呼噜",
            "timestamp": 1596948180,
            "txt_content": "嗯....@x是什么...没见过"
        }
    ]
}