{
    "title": "[Forge][已解决]如何在服务器端获取玩家的语言",
    "author": "的风格好",
    "replyCount": 3,
    "timestamp": 1561279140,
    "txt_content": " 本帖最后由 的风格好 于 2019-6-23 17:40 编辑 \n\n如题，有一个仅在服务端安装的mod，需要为EntityPlayerMP 调用 sendMessage，发送信息。如何获取EntityPlayerMP的语言环境，在服务器本地化信息？\n\n项目中写过这样一段代码，在idea Debug模式runServer情况下，能正常工作，但在相同版本的forge服务器下，会出现“java.lang.NoSuchFieldException: language”\n\nForge 版本 ：forge-1.12.2-14.23.5.2768\n    private static String getLangType(EntityPlayerMP player) {\n        String langType;\n        try\n        {\n            Field playerLangField = player.getClass().getDeclaredField(\"language\");\n            playerLangField.setAccessible(true);\n            langType = (String)playerLangField.get(player);\n        }\n        catch(Exception e)\n        {\n            langType = \"en_us\";\n            e.printStackTrace();\n        }\n        return langType;\n    }复制代码\n\n部分EntityPlayerMP的代码\npackage net.minecraft.entity.player;\npublic class EntityPlayerMP extends EntityPlayer implements IContainerListener\n{\n    private static final Logger LOGGER = LogManager.getLogger();\n    private String language = \"en_US\";\n    /** The NetServerHandler assigned to this player by the ServerConfigurationManager. */\n    public NetHandlerPlayServer connection;\n    /** Reference to the MinecraftServer object. */\n........\n}复制代码\n\n",
    "replies": [
        {
            "author": "的风格好",
            "timestamp": 1561282500,
            "txt_content": "找到原因了，因为minecraft代码被混淆，所以\"language\"实际对应的字段名为“field_71148_cg”。\n    private static String getLangType(EntityPlayerMP player) {\n        String langType;\n        try\n        {\n            Field playerLangField = EntityPlayerMP.class.getDeclaredField(\"field_71148_cg\");\n            playerLangField.setAccessible(true);\n            langType = (String)playerLangField.get(player);\n        }\n        catch(Exception e)\n        {\n            langType=\"en_us\";\n            e.printStackTrace();\n        }\n        return langType;\n    }复制代码"
        },
        {
            "author": "caizhong3",
            "timestamp": 1561619160,
            "txt_content": "的风格好 发表于 2019-6-23 17:35\n找到原因了，因为minecraft代码被混淆，所以\"language\"实际对应的字段名为“field_71148_cg”。\n ...\n请教一下  楼主 在服务端是如何进行获取相应语言的本地化文本的"
        },
        {
            "author": "的风格好",
            "timestamp": 1561714620,
            "txt_content": "caizhong3 发表于 2019-6-27 15:06\n请教一下  楼主 在服务端是如何进行获取相应语言的本地化文本的\n我的实现是模仿minecraft做了一个本地化工具，服务器启动时从文件里读取文本，需要翻译时，从内存中调用。"
        }
    ]
}