{
    "title": "【MCBBS独家】【PCD】【用过的都说好】【坤坤の技巧课堂】网络优化教程，lona直呼内行",
    "author": "凌坤坤",
    "replyCount": 9,
    "timestamp": 1596619860,
    "txt_content": " 本帖最后由 凌坤坤 于 2020-8-5 20:45 编辑 \n\n\n零、【序章】目录零、[序章]目录一、[教程]服务端影响网络的基础配置二、[心得]关于开群组服的一些经验三、[技巧]如何利用Authme防御假人四、[技巧]如何利用阿里云轻量级做一个BGP转发线路五、[技巧]利用插件自动备份对接FTP做内网并同步到网盘六、[干货]快速解决网络质量差的问题\n\n一、【教程】服务端影响网络的基础配置注意该章节内容只讲到会影响网络的一些服务端配置若你想优化服务端自带的全部配置，Bukkit.yml Server.properties Spigot.yml甚至paper.yml请转到@jiongjionger 的https://www.mcbbs.net/thread-478126-1-1.html同时也感谢jiongjionger的优化教程，对我在近两年的服务器制作方面有很大的启发（废话不多说直接正题）\n1.服务端启动.bat（启动脚本）虽然这个配置对于网络而言可能影响不大但谈到服务器优化也是必不可少的这里直接指路一个站内的软件 MinecraftServerBat by @7649102 可一键生成服务器启动脚本，就算你是小白也可以快速配置完你的启动脚本~\n当然这里也分享一个本人常用的脚本\n\n@echo off\nset isre=1\nchcp 936 #活动页面代码\nset retime=5 #重启时间5秒\n\n\nset restart=0\nset maxre=10\n:start\n\nCLS\n\nset server_name=xxxx #服务器名字\nset min_ram=1024 #最小内存\nset max_ram=1024 #最大内存\ncolor b\nset tm1=%time:~0,2%\nset tm2=%time:~3,2%\nset tm3=%time:~6,2%\n@echo. \necho  现在时间：%date% %tm1%点%TM2%分\n@echo. -----------------------------------------------------------------\n@echo.\n@echo.                         %server_name%服务器     \n@echo.\n@echo. -----------------------------------------------------------------\n\n\nset jar_name=paper-655.jar #服务端核心名\n\nif %isre% == 0 (title %server_name%服务器 最大内存%max_ram%M) else (title %server_name%服务器 最大内存%max_ram%M 重启次数%restart%次)\n\n\njava -server -XX:+UseG1GC -Xmx%max_ram%M -Xms%min_ram%M -Dfile.encoding=UTF-8 -XX:+AggressiveOpts -XX:+UseCompressedOops -jar %jar_name%\n\n@echo. -----------===服务端关闭，即将在五秒内重启,按Ctrl+C终止重启===------------\n@echo.\n@echo.               %server_name% --- 玩家数据保存完毕 已关服\n@echo.\n@echo. -----------------------------------------------------------------\n\nset/a restart=restart+1\n\nif %isre% == 0 (goto stop) else (goto restart)\n:restart\ntimeout /t %retime% /NOBREAK\nif %restart% == %maxre% (goto stop) else (goto start)\n:stop\nif %isre% == 0 (echo 未开启自动重启，如果需要，请到bat中开启) else (echo 已经自动重启%maxre%次，停止自动重启，按任意键关闭)\npause\n复制代码\n2.Server.properties 中极大程度上影响网络的配置\n>>> network-compression-threshold默认为256，这个参数在官端中的server.properties也会有，具体这个参数是干嘛的呢？这个就相当于是一个压缩包，开服如果是公网联机的状态下会通过网络封包进行通信(误)则这个参数就会网络封包进行压缩，如果调成256的话（默认）说明封包大于256才会被压缩，小的话是不会作影响的\n这就好比一个文件夹文件夹内的文件太多，合计内存大，那当你传给别人的时候自然要压缩一下发给别人但如果你可以调整压缩率 将压缩率提高 则你的压缩之后的文件容量就会小传给别人的时候自然就快，但这也同时会增加你的CPU开销\n这个设置的话建议如果是用Catserver服务端的服主可以改成32甚至8如果是用其他服务端核心如spigot或官端一般情况下128就够，再调小可能会导致玩家掉线频繁等情况\n注意，如果你开的是BungeeCord群组服那么你的子服，也就是登录服、生存服这样的子服服务端内，该参数可以改成-1调成-1就相当于关闭该压缩功能，为什么要关闭啊？因为BungeeCord群组端自带一个这样的参数，不需要在子服再用了具体可参考论坛内两位大佬 @贺兰星辰 的BungeeCord搭建教程或@SkyCatcher 的BungeeCord搭建教程\n3.bukkit.yml 中的一个重要参数>>> connection-throttle\n这个参数默认是4000\n我只能说懂的都懂 因为涉及太深我可能一时半会讲不清楚反正讲了你们也不懂所以干脆不讲了，具体情况百度去吧（滑稽）\n这个的话是单个玩家进服的限制，以毫秒为单位（大概）默认4000也就是说限制玩家4秒钟进一次服如果在4秒内重复进一次服务器就会提示You are already connected to this server!\n\n这个参数的话自行根据情况修改就好，但是要注意的是群组服的子服都得改成-1 关闭掉这个功能哦不然可能会导致进服太快进不去子服等情况\n4.Spigot.yml 中影响网络的重要参数>>> timeout-time这个参数是这样的情况，尽管调大调小对网络优化没什么影响但建议如果是BC群组服的童鞋们，可以在登录服中把这个参数改成登录超时时间比如登录时间是30秒，那这个timeout-time也改成30（假人 影分身压测），默认是60\n>>> anti-xray这是一个防止假矿的功能，但不推荐使用如果将模式改成2，则占用带宽非常大甚至导致服务器卡顿建议直接关闭这个功能，将enabled改成false就可以了\n>>> entity-tracking-range这个是实体可见范围，建议都改成视距的6倍如视距限制1，那么实体可见范围在6左右是较为合理的\n视距的话牵扯到另一个设置 view-distance，这个在server.properties和spigot.yml中都有，如果你是红石服或建筑服建议改成12甚至更高如果你是个RPG 神奇宝贝服，建议6但可能玩家体验不是很好如果你设置8的话，个人测试在客户端中视距改成12以上就跟12没什么区别了具体根据实际情况来定\n>> max-bulk-chunks 这个参数是指服务端给客户端传输网络封包时可存在多少个区块适当提高的确可以提高不少网络质量，过高的话客户端可能承受不住\n\n二、[心得]关于开群组服的一些经验\n这个并不教你如何优化，而是讲一些心得和本人多年开服来总结的经验以及踩过的坑......\n首先如果你是开MOD服做群组，Waterfall真的是兼容性特别的强如果是纯净的话，好好用你的BungeeCord就可以了\n首先盘一下个人的一些群组方案吧，曾经想过开一个群组小游戏服但是工程量比较大如果要做好做大的话，所以到最后也没开成\n个人习惯-文件夹树新建一个文件夹作整个服务器的目录[端口]BungeeCord随后在该文件夹中放入群组核心及该有的程序如phpstudy等数据库文件\n然后新建一个名为1的文件夹，为什么呢？因为根据名称排列的话1 会在所有文件中第一个显示然后在 1 这个文件夹中新建所有你的子服文件夹[端口]简称\n如[1101]Login\n当然这是个人习惯emmm不过可以提高找子端文件的效率而不是一堆乱七八糟的名字，这样难以管理这么多子服然后建议在开服前就已规划好你所有的子服端口列表且子服建议都在内网中进行如果要外网的话建议用两个BC服务端对接，而不是直接通过IP+端口跳转，不然管理起来麻烦分类也很麻烦 当然如果你会RedisBungee 就随便啦~\n管理方面如果你是开群组服的运营者，小游戏服的话建议安插志愿者进行管理给予志愿者每个子服的/server权限及隐身观察者权限人为监管是最好的防作弊处理解决方法，同时开销和人力资源需求也大\n如果你是MOD服，且使用的是Catserver这边建议您这样做，首先把登录服和主服分开，将md5检测放在登录服，检测完之后传送至主服这样也不会导致主服因为实时检测而卡顿甚至突然掉线\n宣传方面群组服因为可玩性较高，可选的服务器也多宣传方面建议着重考虑将能留住玩家的子服放在第一位且最好是通过累计在线时长的方式给予玩家一定奖励或权限群组服最难的就是留住玩家，玩家的流动性很高，那么如果解决了这个问题相信你的服务器会越来越多人玩的~\n这边个人宣传的方案是这样的群组服有rank等级制当你累计在线一定时间可以获得高级rank当你邀请一名玩家，邀请的玩家与你一起完成一盘小游戏即可获得更高级的rank甚至友情羁绊 增加羁绊值羁绊值越高，在某个生存子服中你们在同服的经验收益也越高，甚至小游戏硬币等收益\n而如果你邀请的那名玩家充值了一定点券，则你可获得那名玩家充值点券数量的10%类似于推销一样，但这样的效果也的确偏好和比较吃香毕竟如果那名玩家拉的人是他朋友，那么他与他朋友都可以获得奖励岂不乐乎？\n运营方面运营方面的话，建议前期制作服务器时只租用一般的VPS[指E5？]或个人本地端口映射制作\n可以先跟某些MC平台（某易）或某其他MC平台（某游）发出入驻申请\n入驻申请通过后平台很大可能会给你提供机器如果没入驻成功也没关系，再改就是了，当然如果你想单干的话不推荐，为什么呢？因为做大之后会被割韭菜的.......\n组装机器方面这边可以给出一个意见如果希望成本较少的话可以尝试E3E3-1230v2或v3等，当然如果希望稳一点就E5/26xx系列内存方面肯定是插大不插小，插多不插少操作系统建议使用centos，如果你想兼顾网页管理的话可以用multicraft和翼龙搭建起来做群组服当然如果你想门槛低一点 windows又不是不能用硬盘方面建议said10阵列 好做备份，考虑到成本少要求高就可以用U.2转Pcie等硬盘托管方面就不推荐了，这个根据个人要求来叭。\n\n三、[技巧]如何利用Authme防御假人\n这或许是最简单的防假人？\n你也许没有想到一个简简单单的Authme也能有效防止假人压测\n首先我们安装一个Authme，重启服务器之后会出现Authme文件夹打开Authme文件夹可以看到commands.yml有些DALAO可能知道这是干撒子的\n我们可以设置一个，当玩家注册后踢出玩家大部分假人压测都是可设置指令的，也就是说进你服务器之后还可以注册操作甚至其他操作但是这些假人压测都是只进一次，不进第二次，也可能是代理IP方案的限制问题我们可以将计就计，设置一个当玩家注册第一时间踢出玩家的操作\ncommands.yml\nonFirstLogin: {}\nonJoin: {}\nonLogin: {}\n# These commands are called whenever a logged in player uses /logout or quits.\n# The commands are not run if a player that was not logged in quits the server.\n# Note: if your server crashes, these commands won't be run, so don't rely on them to undo\n# 'onLogin' commands that would be dangerous for non-logged in players to have!\nonLogout: {}\nonRegister:\n    welcome:\n        command: kick %p 你已注册成功，请重新进入游戏。\n        delay: 0\n        executor: CONSOLE\nonSessionLogin: {}\n# Commands to run whenever a player is unregistered (by himself, or by an admin)\nonUnregister: {}\n复制代码\n尽管这个方法很蠢很笨，但确实好用且轻便甚至你还可以在Authme中的config.yml屏蔽掉其他国家的IP，只允许国内IP进入（如果你在海外宣传了那就当没看见这个）\n\n四、[技巧]如何利用阿里云轻量级做一个BGP转发线路\n相信大家了解过加速IP，这个方法应该已经烂了但我觉得还是可以提一下的\nCentos的TCP端口转发（TCP内网穿透）众所周知Minecraft的PC服务端数据传输是基于TCP协议诶等等？TCP协议...让我想想这？Windows的TCP Mapping！\n噗！大人，时代变了\n现在都0202年了，跟我一起用IPtables吧！（误）都0202年了，赶紧整一个阿里云轻量级服务器吧，或者其他服务器都行主要阿里云线路较好，五线甚至八线甚至12*******阿里云购买一个轻量级应用算比较便宜的\n首先我们在Linux（Centos 7.7）环境下\n\n输入【yum -y install gcc* wget】复制代码安装必备的东西输入【wget [url]http://www.boutell.com/rinetd/http/rinetd.tar.gz[/url]】复制代码下载一下Rinetd程序输入【tar zxvf rinetd.tar.gz】复制代码解压程序输入【cd rinetd】复制代码进入程序目录输入【vi rinetd.c】复制代码修改将bindPort的65536和connectPort的65536都改成65535复制代码修改完后Esc再:!w保存输入【make】复制代码编译输入【mkdir /usr/man】复制代码创建一个目录输入【make install】复制代码安装输入【vi /etc/rinetd】复制代码编辑程序配置配置格式如下0.0.0.0 25565 1.1.1.1 25565复制代码源地址 源端口 目的地址 目的端口然后一样的Esc再:!w保存输入【./rinetd -c /etc/rinetd】复制代码正式启用转发若要关闭则输入【pkill rinetd】复制代码关闭进程\n这个方法虽然可以做到TCP穿洞的效果，但也是根据iptable的nat转发功能来实现的这样的话，进这个线路的玩家，ip都会变成内网，这是一个弊端但也可以通过其他方法将内网再转发成外网，这个DALAO们自行研究叭\n当然最好的加速IP方法就是再整一条IP出来做代理并使用魔法（可能机房不支持或运营商不支持）\n\n\n五、[技巧]利用插件自动备份对接FTP做内网并同步到网盘\n这个的话是本人在用的一个自动备份功能且不限速首先我们用插件可以有自动备份的功能站内有很多这样的插件，也有对接FTP的\n那么我们可以创建一个本地FTP，再创建一个本地网盘本地网盘挂载到onedrive就实现了内网备份并同步到网盘，还是不限速的onedrive个人可以免费5G容量，当然也可以通过其他方法获得更高容量\n【这里的图片介绍待补充】\n\n六、快速解决网络质量差的问题\n这个方法我只能说懂的都懂不懂的我也不好说，因为这可能涉及到某些人的利益但你如果非要了解我也没办法，只能自己去百度反正懂的都懂\n??[物理]拔同路由的其他电脑网线[法术]带打火机将同机房的同一条硬路由线全烧了，网络质量提升100%\n[groupid=1330]PluginsCDTribe[/groupid]",
    "replies": [
        {
            "author": "Carry-saozhu",
            "timestamp": 1596641580,
            "txt_content": " 本帖最后由 Carry-saozhu 于 2020-8-6 09:11 编辑 \n\n冲啊坤坤！超级棒的教程，authme永远的神！好多实用功能都说了，不愧是坤坤\n\n\n\n\nY5(KYP~GM5HK}{5ISMAKAHK.png (12.18 KB, 下载次数: 4)\n\n下载附件\n\n2020-8-5 23:36 上传\n\n\n\n\n感觉假人压测得去更新了，没想到只需要改下authme就可以反压测，而且目前是100%！\n"
        },
        {
            "author": "youwen",
            "timestamp": 1596646200,
            "txt_content": "看完这个教程，才发现原来的轻量应用服务器似乎没有退款的必要...Get新知识"
        },
        {
            "author": "7649102",
            "timestamp": 1596685380,
            "txt_content": "一脸懵逼的呗at过来QWQ"
        },
        {
            "author": "Onism_",
            "timestamp": 1600693920,
            "txt_content": "[物理]拔同路由的其他电脑网线\n[法术]带打火机将同机房的同一条硬路由线全烧了，网络质量提升100%懂了，这就带打火机去凌坤机房"
        },
        {
            "author": "中华博",
            "timestamp": 1608881940,
            "txt_content": "两根网线怎么代理？"
        },
        {
            "author": "阿莎蕊雅同学",
            "timestamp": 1609607160,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "3472320255",
            "timestamp": 1610613720,
            "txt_content": "搞了一下楼主的第四部分\n发现了一些问题\n首先就是这个【【wget http://www.boutell.com/rinetd/http/rinetd.tar.gz】】\n应该是【wget http://www.boutell.com/rinetd/http/rinetd.tar.gz】\n但是我用了阿里云和腾讯云的centos7.6和7.7都无法顺利解压\n后来我是去官网下载了rinetd的文件压缩包\n上传到自己的服务器里面\n再用wget指令从自己的服务器里面下载下来的\n最后还有一点就是./rinetd -c /etc/rinetd指令\n在你成功了之后是没有提示的\n重复输入这个指令只会报错pwp\n再上传到了我自己的服务器，再利用wget指令下载下来才顺利解压（盲猜直接下地址是不是会少点）\n然后楼主在vi rinetd.c 这一段内没有说清楚\n进入编辑模式需要按i\n退出编辑模式进入浏览模式按esc\n然后楼主退出保存是直接输入“:!W” 但是我自己实验了一下发现不能保存\n然后百度发现“:wq” 指令是可以保存并退出的\n然后就是，希望楼主大大加油，再给力更新有亿点用的小知识吧pwp\n帮了大忙了"
        },
        {
            "author": "敏感字符adb",
            "timestamp": 1610702760,
            "txt_content": "皮这一下很开心（滑稽）"
        },
        {
            "author": "阿莎道长",
            "timestamp": 1610769420,
            "txt_content": "属实不错，对我很有帮助"
        }
    ]
}