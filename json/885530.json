{
    "title": "草稿",
    "author": "azbh111",
    "replyCount": 0,
    "timestamp": 1563073620,
    "txt_content": " 本帖最后由 azbh111 于 2019-7-16 23:00 编辑 ' ]0 L$ ?3 z( w: K6 Z\n\n% K( G. }: Y: o: ^/ t$ @5 k 背景（SpringBootPlugin简称SBP）      相信各位开发者或多或少遇到过以下情况（当然，腐竹也可以装这个插件使用汉化和DevTools功能）    每写一个监听器，都要注册一次（不爽，就不能自动嘛，我要自动化。）    每个新的指令，都要在plugin.yml中声明，然后在代码里一堆if-else解析指令，一个方法几百行。过段时间来看，都看不懂解析指令的代码了（简直抓狂。。。我要自动化）    处理玩家指令，各种数字解析，异常判断，权限控制，异步，并发等等（OMG！我要自动化）    总要去写一个配置文件，然后用代码一项一项的读取，还要保证配置文件和代码的一致性，还要考虑配置文件乱码问题（神烦有木有。。。我要自动化啊）    需要用数据库时，手动创建连接，传递sql参数，解析sql结果，释放连接（简直原始人有木有。。能不能自动啊）    在服务端内，读取不到物品的汉化名（比如以前大名鼎鼎的QS商店，牌子上的物品是英文名）    想用NMS时，却苦于多版本兼容很困难，反射又很麻烦，望而却步    当插件逐渐壮大起来后，主类越来越大，启动逻辑越来越多，维护起来越来越难    当然，还有很多。。8 b9 U( W5 D0 F\" q$ o8 T& P\n以上这些问题，都是本人亲身经历    于是在经历了PluginLoader到PluginBoot的迭代，最后本插件SpringBootPlugin诞生了。    SpringBootPlugin基于SpringBoot（百度百科/中文索引），拥有其全部特性。在SpringBoot基础上，适配了Bukkit环境，对许多常用的NMS接口做了全版本封装，并提供了许多有助于开发的工具类，帮助腐竹进行快速开发，并构建可维护性强的插件！  P# ~5 m3 z- t/ A0 T\n6 W9 Q* f& F9 T9 O) z\" u! T  S+ Z/ k\n0 V! w4 y, r. |3 H- ]\n\n( u! F  m$ y) r- U# W& ^7 N\" _% Y\n7 m# x6 ]& e# _6 R- ?5 Q\n; E* d. e: G# [, E- @9 u3 t6 ^0 l2 a& P; Z+ z6 p7 i$ w# ]\n\n5 r6 R+ O: x, {( }' ] 基于SBP开发的插件    [经济|机制|开源][比赛]Taobao —— 跨服/SBP/开店/交易/市场/税收/NBT [1.7-1.14]http://www.mcbbs.net/thread-876012-1-1.html(出处: Minecraft(我的世界)中文论坛)  ---------------------------------------------------------------------------------------------------[安全][PCD]AutoCloseGui-Block ——方块被破坏，自动关闭其GUI(广谱修复)[1.7-1.14]http://www.mcbbs.net/thread-865557-1-1.html(出处: Minecraft(我的世界)中文论坛)---------------------------------------------------------------------------------------------------[安全][PCD]InventorySingleViewer —— 只允许一个玩家同时打开容器[1.7-1.14]http://www.mcbbs.net/thread-866577-1-1.html(出处: Minecraft(我的世界)中文论坛)---------------------------------------------------------------------------------------------------[安全][PCD]AutoFixPlayerData —— 高性能玩家数据修复[1.7-1.14]http://www.mcbbs.net/thread-866581-1-1.html(出处: Minecraft(我的世界)中文论坛)---------------------------------------------------------------------------------------------------[安全][PCD]GuiProtector —— 关服前自动关闭玩家GUI,避免物品消失[1.7-1.14]http://www.mcbbs.net/thread-873327-1-1.html(出处: Minecraft(我的世界)中文论坛)6 N\" y& E& q  C$ r! a% b\n+ S' _2 r. a& i\n5 V$ G4 e( d5 T\" O# m) G\n\n, C6 E8 d' E# Z9 \\! |8 V. s/ u3 b& x3 X6 Q. z; @- I% c\n\n; Z. U5 W\" x: h' R. a5 _2 F9 Z6 ^. h. L\" W4 C0 G\n\n' m4 i; T7 b' T& ^/ P3 x/ b  m# @  {  A4 r\n\n$ P: \\  \\& v% ?1 ?) U\n& J; m& \\8 {# }- c 插件功能  1. 拥有SpringBoot全部特性，有兴百度自行了解2. 自动测监听器这里以GuiProtector的核心代码为例这个类会自动被框架new出来，并且注册到bukkit里成为监听器3. 自动注册指令（无需再plugin.yml中声明）这里展示一个只有服务端版>=1.9时，才会注的指令注解@CommandDefine会定义并注册这个指令注解@ConditionalOnMinecraftVersion(@MinecraftVersionRange(min = 10900))让这个指令只在版本>=1.9时才注册4.强大的指令参数解析这里以我自己服自用的rpg指令为例(手动解析我可能要疯)/frpg rangeAttack fan <攻击者> <范围> <角度> <高度> <高度偏移> <伤害> [--sound=<声音>,<声音类别>,<音量>,<角度>] [--effect=<粒子特效>,<data>,<能见度>]这是个异步指令让指定攻击者，对其前方一定距离/角度/高度的扇形范围内的实体造成指定伤害，并产生指定音效(可选)和例子特效(可选)\n7 R) A+ _  x\" k+ t+ \\5 _5. 配置文件注入（无需写配置文件，更无需手动读取配置文件）展示一个完整的配置文件除了截图内的东西，不需要在多谢任何代码或yml6. 强大的定时任务7. 服务端汉化功能 (汉化后许多会展示物品名字的插件，就会展示物品的中文名了，具体语言可在配置文件中修改)服务端汉化说明SBP会自动扫描mod的汉化文件，并注册SBP配置文件中指定的语言原版物品的汉化，需要自行将汉化文件放置到 plugins/SpringBootPlugin/lang 文件夹下汉化文件以 .lang 结尾这里展示一份1.12的原版汉化文件 -> 戳本人收集的许多mod汉化文件 -> 戳 （你当然可以把它们全部放到plugins/SpringBootPlugin/lang 文件夹下）* T- `$ M; ]$ Q+ T\n8. 自带一个DevTools模块，方便腐竹和开发者对物品/方块/事件/ProtocolLib数据包等进行调试8. 集成Druid连接池和Mybatis框架，操作数据库so easy！支持Mysql和H2数据库这里列举几个Taobao操作数据库的例子, w$ U. F1 T' U' Z/ g\n9. 全版本兼容：基于SBP的插件，可直使用NMS和CB接口，SBP在运行时会将其兼容到当前服务端版本。8 M+ Q6 Y$ L( G\n以SBP的ItemStackUtils中的toNBTTagCompound接口为例此接口使用了1.7的nms，却可以在1.7-1.14所有版本中运行跨版本原理(自定义ClassLoader，ASM，Remap)SBP插件的所有类，都是在SpringBoot的ClassLoder下加载的而SBP替换了SpringBoot默认的ClassLoader，从而代理了类加载的过程remap分为两个步骤（假设服务端是v1_12_R1，而插件是v1_7_R1）：1. 更改类版本号net.minecraft.server. v1_7_R1.Item -> net.minecraft.server.v1_12_R1.Itemorg.bukkit.craftbukkit.v1_7_R4.inventory.CraftItemStack -> org.bukkit.craftbukkit. v1_12_R1.inventory.CraftItemStack2.  若服务端为forge环境，则对nms方法和字段进行remap(nms->mcp)) g! h. f9 m\" I: J2 a\n10.封装大量常用好用的操作，其中不乏使用NMS实现的11. JavaScript脚本支持12. 太多了，说不完了。。。。\n+ M: ^! `( K0 V+ P# ~\n' n4 l\" ~( [+ d6 X\" ^8 E; o' o; N. \\\n\n  b7 z5 }( Q: R0 S9 G) G7 q$ @( [+ [0 W8 d  U! U3 m\n/ M, s: E$ P: C/ e. w\n2 O5 }: @# m( M2 z+ S+ y4 r\n\n- v8 a$ Q9 |! U) ]7 [: \\, a+ W\n8 E% N$ c0 J0 Q\n9 B6 U# D* g  X! o9 m; y 自带指令  devtools (需要op权限)springboot (需要op权限)\n( \\\" ]7 a& J1 Q; W- f: n\n% X( }1 J% w3 F) d, ]% V: ~4 \\/ _) P# F. h4 O4 r) \\- c\n/ Y6 L\" _  i5 _$ {8 ]' h$ n, r\n\n; G# a. c  A2 a, D* V# v\n$ c* g' I+ o  h1 t0 q: p0 `& u9 P7 j+ @3 P# }( {8 Y  H7 `% K\n, }/ P# O\" D# z$ x$ n\" C\n\n, L' u, N- T& d4 N7 V\n\" C+ d0 r0 M5 t% \\% j 安装  安装SBPSpringBootPlugin-x.x.x.x.jar复制到服务端 plugins 目录下启动服务器，将自动生成插件配置文件: plugins/SpringBootPlugin/config.conf---------------------------------------------------------------------------------------------------------------------------------------------安装SBP插件（基于SBP开发的插件，我称之为SBP插件）将SBP插件复制到 plugins/SpringBootPlugin/plugins 端目录下启动服务器，将自动生成插件的配置文件---------------------------------------------------------------------------------------------------------------------------------------------SBP目录结构plugins/SpringBootPlugin/config.conf: SBP的配置文件plugins/SpringBootPlugin/plugins: 放置SBP插件plugins/SpringBootPlugin/data: 放置/springboot item 指令的数据文件plugins/SpringBootPlugin/javascript: 放置js脚本，可用JSUtils加载plugins/SpringBootPlugin/lang: 放置汉化文件data/SpringBoot: 若使用h2作为数据库，数据库文件会存放于此\n) |: v1 l& n' D\" P1 ?\n\" N7 F) L: j: T9 }' c6 h$ {' I0 ~& r9 `0 p& `0 o! M4 V\n\n) j) g! X3 N% v+ B, F$ y9 B& w, U  @+ P, o  e\n\n9 H& u/ b  ^) p  O\n+ k6 t. p: j5 w3 Z$ _$ _1 w\" P# {% p3 F, d2 a, ]% u\n\n9 i0 `: U& T' H! X5 N\" y2 Z\n! J( L3 j( D' |1 ]. h& t2 r# V- L\n4 ?) M5 I9 k2 g+ t7 C' y\n, t2 r* x. z* W$ X0 A- n/ m. s7 E. C+ T: w7 \\3 _\n 兼容性  兼容的核心有：Cauldron/KCauldron/Thermos/Uranium/Spigot/CatServer/Paper/Mohist兼容的版本跨度为：1.7-1.144 V9 ~1 h. F& [, l: m' g0 @: M% k\nCauldron 、KCauldron、Thermos这几个端不支持java8需要更换SpecialSourc才能使用本插件戳:将服务端内的 libraries/net/md-5/SpecialSource/x.x.x/SpecialSource-x.x.x.jar 文件(x代表的数字)文件替换为1.7.3或者更高版本:下载地址 (删除该文件夹内所有的文件，并将下载的文件改成相同名字放进去)- v, X+ A+ Q0 M9 }2 y- Q2 g\n注：若SBP启动失败，会主动关闭服务器，防止发生不必要的损失后续将计划将是否关闭服务器改为可配置\n0 ]+ T+ M) F  u- h+ P\n' o* x3 P$ A\" a$ P+ S% g2 O) Y7 G* v$ `\n( b5 a+ W! J8 ?9 F2 S\n% ^! s3 s\" K\" ]- q9 f& S\n\n: ^5 X\" W+ d/ z. d8 t; r7 q# U+ Y% ?6 t% L& V1 m\" p' G\n\n. z7 v, G# ]\" x! ?& `; {7 { 更新日志  --------------------------------------------------------------------------2019-07-14 0.4.01. shell脚本进行构建，实现替换SpringBoot默认的类加载器，为remap提供条件2. 实现Remap逻辑，从而达到不用反射就可以兼容多版本的目的3. SBP项目结构大调整，方便直接使用不同版本的API4. 将反射几乎全部替换为直接调用，极大提高高频调用下的性能（近乎重构）5. 支持1.14（1.14改动巨大，真是太难了）& t% e' B6 Q1 V7 t9 ]8 o8 [, x\n2019-06-26 0.3.6fix sql日志开关无效修复Uranium核心无法注册MBean导致报错的问题新增一个开关,当打开时控制台会打印加载配置文件和最后保存的配置文件fix 因SpringBean机制,导致Jackson延迟家都,物品序列化出错--------------------------------------------------------------------------2019-06-24 0.3.4/0.3.51. 不支持的核心:Contigo2. h2连接模板开放到配置文件里,方便腐竹自定义3. 启动失败时保存已加载到内存的配置4. NMS反射规范化,明确使用版本号来判断5. 对基础的bukkit版本信息放到plugin里6. 升级日志库,把执行失败的sql也打印出来7. 兼容spigot 1.138. 更改h2包路径，彻底解决版本冲突--------------------------------------------------------------------------2019-06-23 0.3.1/0.3.2/0.3.31. 将SBP插件配置与SpringEnvironment进行深度集成        可直接从SpringEnvironemnt中读取所有SBP插件的配置2. 指令增强:@Command注解的desc字段，支持${...}占位符3. 指令增强：@Command增加一个选项，可控制是否自动转换指令中的颜色字符4. RawMessage增加点击执行回调功能5. 增加一个高效的消息构建器MessageBuilder，专门用来解析${...}占位符6. 更改h2连接参数，兼容更低版本h27. 配置解析支持直接使用MessageBuilder，并支持颜色字符转换8. fixbug: 配置解析中，深层次字段的颜色字符替换失败--------------------------------------------------------------------------2019-06-22 晚 0.3.01. 增加几个高效无拷贝的获取区块实体的API# k! K) ^\" Z* v* F3 I3 D\n0 ~9 t) F; b) _5 j- S8 O\n& I/ t) }6 A9 @9 ]\nint countEntities(Chunk chunk);\n- M6 k4 ]/ M5 C2 V0 R6 _! Uint countEntities(Chunk chunk, Predicate<Entity> filter);! \\. k5 _& I4 p0 c3 ^. G\nint countNMSEntities(Chunk chunk, Predicate<Object> filter);\n\" J' ?4 S8 b; UIterator<Entity> getEntities(Chunk chunk);6 B3 y: n9 [% ]\" r2 L+ `5 W( v$ }\nIterator<Entity> getEntities(Chunk chunk, Predicate<Entity> filter);\n6 f8 W0 |6 r; I9 Q4 @8 j3 o. F& KIterator<Object> getNMSEntities(Chunk chunk);\n  ~2 ~4 W9 J0 Q% T- p\" M: OIterator<Object> getNMSEntities(Chunk chunk, Predicate filter);! a/ z& |- i4 e\n复制代码\n* C\" a! S& d& O% Z% m& [& k; x4 s2 }/ E5 B\n% R; \\) W7 k6 ^. A7 `6 S- a1 U\" r\" `1 D; J\n2. SBP插件增加版本号字段3. 增加EntityItem的NMS反射4. 升级基础类库5. 把Metrics统计集成进SBP，SBP插件会自动被统计\n$ R5 D2 }+ p8 B\" e, a* A--------------------------------------------------------------------------2019-06-220.2.8 支持Paper核心的服务端0.2.9支持Mohist核心的服务端2019-06-21 0.2.7js脚本：JSUtils支持添加自定义的默认变量fix ItemStackUtils.setDisplayName打包h2增加h2支持，且默认使用h2，方便没有mysql的腐竹更改数据库连接池启动逻辑，兼容h2注解增强： 注解ConditionalOnConfig的havingValue支持多个值,匹配一个就行--------------------------------------------------------------------------2019-06-19 0.2.6sql日志换成druid连接池专用sql日志开关放到SBP配置文件里，方便腐竹控制MenuUtils增强:按钮点击支持异步、冷却限制、并发控制MenuUtils.open打开GUI支持异步调用新增：配置文件直接存储ItemStack可设置服务端语言，并自动将服务端及mod语言文件替换为指定的语言新增一个查找资源的API：SpringContext.findResourcesSpringContext去掉ResourceLoader的缓存,可能为null,需要时自己从SpringApplication中取fix InventoruUtils.pull放物品到背包异常2019-06-14 0.2.5EntityUtils增加判断盔甲架的API! Z0 k/ x  ?6 O' C8 I, G' r0 {\nWorldUtils支持world和DIM转换\n1 ~\" T/ c  C5 _WorldUtils支持获取world的tps\n8 l3 M# f9 `& a0 ?& H1 `ServerUtils支持获取服务器的tps\n/ N: S) p) U4 ^' `\" y# R0 \\6 tServerUtils增加判断当前服务器是否还在运行的API. b6 n, Z/ B! N# |4 l- I) Q& }\nJSUtils支持直接编译js脚本, [+ [# g0 e\" {\" a+ g* c\nInventoryUtils增加大量便捷方法4 Y# D1 \\4 T, z1 \\( h\n增加ProjectileUtils\n( l8 `/ _3 t\" |) Z# ?% N  t增加VectorUtils8 `% T3 N  A7 I& D+ V. f\n增加AxisAlignedBBUtils! t2 A$ u. ]* ]* u\n增加MovingObjectPosition$ }( d8 M8 ]\" ~7 T; ^\n增加一个轻量便捷的菜单接口：MenuUtils\n, D0 `7 Z# m# x0 M6 _命令参数解析支持Vector\n3 o+ E1 ?2 c7 v7 _\" ?EntityUtils增加获取准星实体的API，精度100%（赞）' o8 \\9 x7 ]: t1 z( _\n启用Spring异步支持9 \\/ Y\" J: L, `\n关闭SpringBoot的jmx注册，兼容某些服务端1 T8 b! b) x, Y' l\nRawMessage支持清空，支持移除最后一个Part% N7 t! U0 X* @2 v2 I* p8 {- M7 [\n支持插件启动时自动执行sql脚本（主要用于建表）\n) J  m0 e. `  o. R! Vfix NBT反射/ `3 }/ K9 ~* S; \\% n) ]6 T\nfix 指令帮助翻页\n; d( k, z& m8 O8 E3 G( Tfix 命令参数解析4 ]& F, }5 w6 F, Q) m\nfix spigot核心判断--------------------------------------------------------------------------0.2.0InventoryUtils增加大量接口CraftReflectUtils改名为CraftClasses新增ChunkUtils关服时打印异常信息物品持久化fix nbt反序列化fix 多层指令解析fix jackson冲突fix RawMessage1.7是数字id,以上是字符串id,做兼容插件文件夹统一改为SpringBootPlugin,不然某些面板路径区分大小写的不打包gson引入mybatis，ItemStackTypeHandlerSQL日志引入Caffeine缓存指令框架增加冷却功能，可用权限绕开异步指令指令并发执行控制--------------------------------------------------------------------------0.1.4springboot启动失败后执行关服操作--------------------------------------------------------------------------0.1.3/springboot reload支持tab补全) G0 G; a& m$ s+ Q\n@TranslateColoreCode支持颜色字符自动转换5 m9 y& v' e\" |* H# O/ k\n增加PreReload和PostReload回调* w\" ?5 Q* a' {% S' r1 E\n增加重载脚本的指令\n$ x+ G' J  ~: k4 j- ijs脚本添加一些常驻变量\n9 G$ G\" V+ K! w0 d6 \\1 G9 x3 Xjs脚本不限制文件后缀9 B9 @5 l7 V! U9 O: I' F\n把反射API提到plugin里,方便bukkit插件使用--------------------------------------------------------------------------2019-05-23 0.1.2增加API ItemStackUtils.getDisplayName增加API PlayerUtils.sendTitle增加js脚本工具 JSUtils支持动态注册和移除监听器fix nbt序列化--------------------------------------------------------------------------2019-05-20 0.1.0修复指令中的引号解析异常--------------------------------------------------------------------------2019-05-19PlayerUtils增加大量接口新增TileEntity的序列化新增Location的序列化支持判断流体Block和InventoryBlock增加Block的序列化增加一个类扫描工具@Command可以指令Tab补全的实现类--------------------------------------------------------------------------2019-05-18增加RawMessage的构造和发送API增加NBTTagCompound和NBTTagList的json序列化和反序列化ItemStack用nbt序列化时,使用TypeName作为ID同指令多定义时,使用优先级来获取最佳定义指令系统:帮助分页指令系统:tab补全指令解析支持枚举类型--------------------------------------------------------------------------2019-05-14 0.0.3 打包5.1.5的spring-core,而不是5.0.6fix ASMUtils读取字段--------------------------------------------------------------------------\n( `$ ?; V% H3 t- g0 y( w' b$ U2019-05-13 0.0.2增加了TileEntityUtils提供ASM反射获取字段的方式，避免NoClassDefFoundErrorNMS反射机制，支持父类字段、方法提供Location和BlockPostion转换API插件卸载时，关闭spring context--------------------------------------------------------------------------, M7 ?0 _# j. N5 J* f8 z\n2019-05-12 开源、发布\n/ a% X3 i  z3 v+ r! S! U\n, M9 t* J, j) l- s  C& O  }\n1 j1 m2 V( S! S1 |  f7 P0 @$ m\n' g\" M$ {7 z) R4 r2 ?( M\n) x' `/ Q9 Q3 N3 Q9 Y9 D9 M\n) X2 X' B$ i6 p, V5 y& t/ T6 Q( H1 \\: H( s  I3 `\n链接:https://pan.baidu.com/s/1VeZ-rQZM3aeGOsFf2V4E6A  密码:ww04* D+ R# M% R+ r; t\n文档（持续完善中） 戳& j& \\9 ~& C/ |  k\n开源地址\n  u) L+ c. L9 e6 W6 SQQ群：628496236\n! t3 k! B\" h. ^7 `本插件所用代码部分来自spring-boot开源项目\n/ A3 g' Y% t; i% R\n",
    "replies": []
}