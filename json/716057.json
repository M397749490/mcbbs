{
    "title": "[Bukkit][未知之域]JAVA机制-反射 通过反射调用成员变量",
    "author": "qianji20000420",
    "replyCount": 0,
    "timestamp": 1501939020,
    "txt_content": " 本帖最后由 qianji20000420 于 2017-8-5 21:54 编辑 \n\n 导读 通过反射获取成员变量并遍历通过反射修改成员变量的值通过反射获取修改私有成员变量\n\n获取成员变量的值在第二篇我有讲过如何获取Class文件对象，所以我就不再过多的进行阐述了\n先创建两个类 这里我已经写好了Demo_01主方法 及test_01的三个不同权限修饰符的成员变量\n\n\n\n\n01.png (26.97 KB, 下载次数: 10)\n\n下载附件\n\n2017-8-5 20:44 上传\n\n\n\n\n\n然后我们翻看api，找啊找 终于找到了这两个和成员变量有关的方法\n\n\n\n\nCF0@0JN7NZ$NM`RA}6IE)80.png (18.58 KB, 下载次数: 6)\n\n下载附件\n\n2017-8-5 20:46 上传\n\n\n\n\n\n那稍微理解一下应该第一个方法是获取单个Field对象，下面的是获取所有的Field对象\n然后我用了一下下面那个方法Field[] f = test.getFields();然后遍历一下发现只遍历到了一个Field对象，为什么呢？ 我们继续翻看API\n\n\n\n\n一个参数.png (2.65 KB, 下载次数: 6)\n\n下载附件\n\n2017-8-5 20:50 上传\n\n\n\n\n\n原来是两条漏网之鱼\n\n\n\n\nQQ截图20170805204004.png (18.29 KB, 下载次数: 9)\n\n下载附件\n\n2017-8-5 20:48 上传\n\n\n\n\n\n现在把Declared加上再遍历试试\n\n\n\n\n三个参数.png (20.94 KB, 下载次数: 6)\n\n下载附件\n\n2017-8-5 20:52 上传\n\n\n\n\n\n恩，这就没问题了\n那如何获取这个变量的值呢？\n首先我们先写一个构造方法，并实例化一个新的对象\n这里我为了简便先用链式编程了。test_01 cc= (test_01) test.getConstructor(String.class, int.class, double.class).newInstance(\"fff\", 5, 5d);复制代码然后我想获取那个String值怎么办呢？\n我们先看一下api 发现在Field类中有\n\n\n\n\nField.png (1.98 KB, 下载次数: 6)\n\n下载附件\n\n2017-8-5 21:03 上传\n\n\n\n\n\n那在这之前呢 我先获取那个String字段所对应的Field对象Field f = test.getDeclaredField(\"a\");复制代码那个“a” 即为变量名\n然后我们通过输出System.out.println(f.get(cc));yeah！\n\n\n\n\n输出.png (16.6 KB, 下载次数: 4)\n\n下载附件\n\n2017-8-5 21:05 上传\n\n\n\n\n\n\n\n修改成员变量的值通过查询API中Field类的方法可以看到\n\n\n\n\nset.png (14.65 KB, 下载次数: 4)\n\n下载附件\n\n2017-8-5 21:07 上传\n\n\n\n\n\n我们还是按照之前的那个写法public class Demo_01 {\npublic static void main(String[] args) throws Exception {\nClass<?> test = Class.forName(\"indi.Tshoiasc.reflect.test_01\");\ntest_01 cc = (test_01) \ntest.getConstructor(String.class, int.class, double.class).newInstance(\"fff\", 5, 5d);\nField f = test.getDeclaredField(\"a\");  \n   }\n}\n\nclass test_01 {\n     \n   public String a;\n   int b;\n  private double c;\n\n  \n      public test_01(String a, int b, double c) {\n                this.a = a;\n                this.b = b;\n                this.c = c;\n        }\n\n}复制代码再main中Field f = test.getDeclaredField(\"a\");下面在加一句f.set(cc, \"b\");\nSystem.out.println(cc.a);复制代码这回我们会发现\n\n\n\n\nb.png (62.41 KB, 下载次数: 3)\n\n下载附件\n\n2017-8-5 21:10 上传\n\n\n\n\n\n已经成功了。\n\n\n获取并修改私有变量当我们把镜头移到private double c；(啪，哪有钱买镜头)\n好吧，我们在主方法中这样写Field f = test.getDeclaredField(\"c\");\nf.set(cc, 1d);\nSystem.out.println(cc.getC());复制代码运行，果不其然，IllegalAccessException\n相比看完第二篇的你已经猜到了吧\n在set上一句放上f.setAccessible(true);就可以正常修改啦！\n\n\n\n\n修改.png (62.3 KB, 下载次数: 10)\n\n下载附件\n\n2017-8-5 21:15 上传\n\n\n\n\n\n获取就不用我讲了吧~  只要setAccessible之后和公共的一样哦\n\n\n下一篇反射中对成员方法的调用\n返回索引贴\n第一次做教程，如果教程中有遗漏的或说错的地方请及时指出哇。~[groupid=1181]Unknown Domain[/groupid]\n",
    "replies": []
}