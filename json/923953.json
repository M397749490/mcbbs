{
    "title": "关于flan子弹的玩家获取问题",
    "author": "1042571047",
    "replyCount": 5,
    "timestamp": 1572728400,
    "txt_content": "我现在想开发一个自己用的插件，但是获取不到flan子弹的玩家，之前有看过很多帖子都不实用。\n因此想问问论坛里的大佬有没有什么办法，最好是直接写出代码，比较省事和理解。\n\n我想通过被攻击这一监听来获取子弹的来源，如果是玩家则减免伤害。\n现在就卡在如何获取到子弹来源这里，论坛里看见过一个大佬用的反射获取方法，但是根本获取不出东西。",
    "replies": [
        {
            "author": "a8105",
            "timestamp": 1572730860,
            "txt_content": "EntityDamageByEntityEvent e\n\n\n\n\nPlayer damager=null;\nif (e.getDamager().getType().name().equalsIgnoreCase(\"FLANSMOD_BULLET\") || e.getDamager().getType().name().equalsIgnoreCase(\"FLANSMODX_BULLET\"))\n {\n     try {\n        Object bullet = e.getDamager().getClass().getMethod(\"getHandle\").invoke(e.getDamager());\n        Object owner = bullet.getClass().getField(\"owner\").get(bullet);\n        Object bukkitEntity = owner.getClass().getMethod(\"getBukkitEntity\").invoke(owner);\n        if (bukkitEntity instanceof Player) {\n            damager = (Player) bukkitEntity;\n        }\n    }\n    catch (IllegalArgumentException | IllegalAccessException | NoSuchFieldException | SecurityException | InvocationTargetException | NoSuchMethodException ex)\n    {\n\n    }\n}复制代码\n适用于新老版本FlanMod\n"
        },
        {
            "author": "1042571047",
            "timestamp": 1572731160,
            "txt_content": "a8105 发表于 2019-11-3 05:41\nEntityDamageByEntityEvent e\n多谢支援 感谢您的不吝赐教"
        },
        {
            "author": "窝屎上帝",
            "timestamp": 1572760200,
            "txt_content": "看不懂~~~~~~~~~~~~~~~~~"
        },
        {
            "author": "窝屎上帝",
            "timestamp": 1572760200,
            "txt_content": "随便你怎么讲  我觉得我可看不懂"
        },
        {
            "author": "Himmelt",
            "timestamp": 1572769140,
            "txt_content": "反射，但是需要反射到nms，也就是mc类而不是bukkit类，然后获取实体的uuid，再用uuid获取bukkit玩家。如果你不懂反射，也不懂bukkit类和mc类的关系，还是先学习这部分知识吧。"
        }
    ]
}