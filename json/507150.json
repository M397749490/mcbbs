{
    "title": "求问cauldron服的流畅度问题",
    "author": "5igm1",
    "replyCount": 28,
    "timestamp": 1443633180,
    "txt_content": "我服是8核12g，装有neverlag，ptweak，nospawn优化插件，然而tps才12上下。根据任务管理器显示，cpu和内存都才用20%。java装的是64位，求大神帮助提供个优化方法。",
    "replies": [
        {
            "author": "778563781",
            "timestamp": 1443633180,
            "txt_content": "5igm1 发表于 2015-10-2 13:57\n你要看什么文件？加个q如何？\n[url=mailto:123456@mcwyg.com[qq]778563781[/qq]123456@mcwyg.com[qq]778563781[/qq[/url]]"
        },
        {
            "author": "wxx463236",
            "timestamp": 1443637680,
            "txt_content": "带宽呢？应该是网络问题吧"
        },
        {
            "author": "wldhk",
            "timestamp": 1443650580,
            "txt_content": "java是否是java8 若是java7注意前置参数设置永久带"
        },
        {
            "author": "极光酋长",
            "timestamp": 1443657180,
            "txt_content": "有时候装优化插件会适得其反（个人看法）\n建议备份删除"
        },
        {
            "author": "778563781",
            "timestamp": 1443658560,
            "txt_content": "server.properties中可以优化性能的参数：\n\n* view-distance，视距，默认值是10。含义是玩家的视距也就是加载的区块范围，默认是10个区块，视距10加载的区块是视距5的四倍。加载更多的区块则需要更多的内存和运算能力。推荐将这个值设置在5或者6，如果在线人数非常多可以设置为4。降低视距可以有效减少内存的占用，也能有效提高TPS，还可以减少宽带的使用量。这个参数对性能提升是立竿见影的。\n\n* generate-structures，默认值是true。含义是生成和计算一些特殊的环境，例如女巫塔、村民到达数量生成铁傀儡等等。设置为false可以减少这些特殊环境生成和周期性检查带来的开销。这个参数很少被提起，但是对性能的提升有着不少的帮助。例如我的服务器生存子服有130人左右在线，TPS在17左右，关闭这个功能后提高到了19左右。需要彻底关闭这个参数，还需要在spigot.yml中把save-structure-info设置为false。并且关服后手动删除每个世界（例如world、world_nether、world_the_end）下的data文件夹里的Fortress.dat、Mineshaft.dat、Stronghold.dat、Temple.dat、Village.dat文件。\n\nnetwork-compression-threshold，默认值是256。这个参数只有1.8的服务端才有，含义是网络封包压缩的阀值。例如设置为16，代表封包大于16才被压缩，设置成256代表着封包大于256才被压缩。设置的值越小则会压缩更多的封包，可以使得宽带使用减少，提高网络流畅程度，但是也会增加性能的开销。如果性能够用可以设置为128，使得更多通讯封包被压缩，一定程度上减少宽带使用率又不会带来太多的性能开销。设置的值太小，例如小于等于32会明显增加对性能的开销，不建议这么做。\n\nbukkit.yml中可以优化性能的参数：\n\n* spawn-limits，意思是限制实体的生成。这个并不是限制一个区块生成多少实体，而是针对一个人可以生成多少实体。例如monsters: 70，在线人数只有10个人，则最多只能生成700个怪物实体（僵尸、骷髅、蜘蛛等等），适当的设置这些参数可以减少实体对性能的影响。\n\n* chunk-gc，控制着区块的回收，单位是Tick（1/20秒），period-in-ticks是指每过多少tick回收一次需要回收的区块，设置的太小会导致回收过于频繁而影响性能，设置的太大会导致需要回收的区块迟迟不回收使得内存占用过大。合理的数值一般是300~400。load-threshold是指达到多少需要回收的区块的时候才进行回收。例如设置成300，只有当需要回收的区块到达300以上才进行回收，合理的设置这个数值可以使得额外只多占用一丁点内存却使得区块回收的性能开销可以被无视。一般设置为300~600比较合适。\n\nautosave，自动保存存档（地图、玩家数据等）的周期，单位是Tick（1/20秒），如果你使用了定时保存的插件，例如Saveit、AutoSave等等，你可以将他设置为0，即关闭这个功能。这样可以减少服务器瞬卡发生的可能。\n\nspigot.yml中可以优化性能的参数：\n\n* user-cache-size，1.7.5以上版本才有，其控制用户缓存的大小，如果你的服务器玩家很多，可以设置的更大一些，例如5000。\n\n* save-user-cache-on-stop-only，1.7.5以上版本才有，其含义是是否只在服务器关闭/重启的时候保存用户缓存，设置为true可以提高性能。\n\n* view-distance，同server.properties里的view-distance一样。\n\n* chunks-per-tick，是指每tick（1/20秒）扫描计算多少区块，计算的内容是作物的生长。默认值是650，可以设置成350来提高性能。极端的情况可以设置成150，但是会使得作物生长的速度明显变慢。\n\n* max-tick-time:  （仅较新的版本有该参数，如1.8.3+）是指每tick，实体和tile最多可以用的时间（单位是毫秒），要明白其含义首先要解释什么是TPS，TPS的意思是每秒有多少tick，最大值是20，也就是每秒tick20次，每次50毫秒。如果运算量过大导致每tick计算了超过了50毫秒，那么TPS就会下降，一旦TPS低于15就会产生明显的卡顿。在这参数中tile代表着熔炉、箱子、牌子、骷髅头等等所能占用的最大时间，entity是指的实体，例如动物、怪物、村民、展示框、掉落物、船、矿车等等。设置tile和entity的总和小于等于30则能明显降低tile和entity对TPS的影响，而服务器运算资源几乎一大半都是由这两者消耗的。设置tile为10，entity为20比较合适，如果实体非常多，还可以设置tile为6，entity为24。\n\n* anti-xray，服务端自带的反透视功能，俗称假矿。这个功能相比插件版的假矿来说，额外内存占用极少，少到可以忽略，并且矿物的变动计算是异步进行的，对TPS的影响很小。engine-mode为1则是隐藏矿物，engine-mode为2则是将非矿物也伪装成矿物，engine-mode设置为2的效果最好，但是会额外吃一定的性能和宽带，但是engine-mode设置为1无法防御矿追。具体如何权衡请自行决定。如果你不需要本功能，例如你是纯RPG服务器，可以直接把enabled设置为false关闭这个功能，提高性能。\n\nnerf-spawner-mobs，简单来说就是让刷怪笼生成的怪物变成白痴，直观感受就是刷怪笼刷出的怪不能攻击了。默认为false，意思是不开启。设置为true可以获得一定的性能提升。\n\n* entity-activation-range，这个参数是控制实体的活跃范围，例如monsters: 32意思是在玩家附近32格范围内的怪物才会活跃（被计算AI等），减少这个数值可以明显提升性能，但是设置得过小会使得游戏难度大幅降低。一般可以把monsters设置为24，animals设置为12，misc设置为2（misc主要是掉落物，设置2可以使得掉落物几乎不再卡服）。\n\nentity-tracking-range，这个参数是控制实体的可见范围，这个参数不会影响性能，对宽带的影响也极小。不建议修改这个参数，但是适当的降低数值可以减少客户端的卡顿。\n\n* random-light-updates，随机的光照更新，设置为true的话服务器会随机更新光照，并且在区块加载的第一个tick运算光照逻辑。设置为false可以提高不少性能。\n\n* save-structure-info，在前面已经介绍了。\n\nmax-bulk-chunks，1.7.10+才有这个参数，意思是每个数据封包里塞多少个区块。适当提高这个数值，例如从10提高到15可以减少网络卡顿和客户端读取区块的速度，但是设置得过高会导致客户端崩溃。\n\n* max-entity-collisions，实体碰撞箱的阀值。建议设置为2，可以减少密集卡服的问题。\n\n* max-tnt-per-tick，每tick（1/20秒）最多计算多少TNT爆炸，设置为20可以显著防御TNT蹦服。\n\n\npaper.yml中可以优化性能的参数：\n\nkeep-spawn-loaded，spawn区块是否常驻内存，设置为false可以减少一定的内存占用和计算量\n\n* tick-next-tick-list-cap，每tick最大的运算量，减少数值可以提高TPS，例如设置为8000\n\n* tick-next-tick-list-cap-ignores-redstone，达到上面的运算阀值是否无视红石运算，设置为true可以显著减少红石对服务器性能的影响。\n\n* optimize-explosions，是否开启爆炸算法优化，设置为true可以提升一定的服务器性能\n\n* use-async-lighting，是否让光照的逻辑运算异步化，设置为true可以使得光照运算不再影响TPS，强烈推荐设置为true\n\n* cache-chunk-maps，是否缓存chunkmaps，可以让区块的数据更多得被复用，可以一定程度提高性能，推荐设置为true\n\n* fast-drain，快速液体流动运算，推荐设置为true，可以减少液体流动运算对服务器性能的影响\n\n* 五 - 优化插件的选择和一些插件建议 *\n\n服务器的主要性能开销在于实体的运算（往往占用了一半的CPU时间），所以定时清理实体（怪物、动物等）和限制密集卡服的插件对性能的帮助是最大的。我在这里厚颜无耻的推荐下自己的插件——NeverLag。具体功能请在此查看：http://www.mcbbs.net/thread-415779-1-2.html\n\n很多插件都支持使用Mysql来存储数据，例如CoreProtect、QucikShop、LWC等等，如果条件允许的话，请使用Mysql来代替文本数据库和Sqlite。这么做可以一定程度的提高服务器的流畅程度。\n\n安装插件的时候也不要太懒使用网页后台现成的插件或者使用论坛上搬运的网盘地址下载。请到bukkit或者spigot官网看看插件有无新版本。举个例子，RPG服常用插件MythicMobs很多服务器还在使用1.*的版本，然而目前最新版本为2.0.6。2.0.0相比1.*就有着不少的性能提升。2.0.5版本相比老版本的改动在于修复bug和大幅提高性能，2.0.6更是使得怪物技能和扫描异步化，明显提高了性能。所以说往往新版本的插件都意味着性能的提升和bug的修复，如果版本兼容，尽可能使用最新稳定版的插件。\n\n\n\n                                     ------------选自jiongjionger的帖子\n希望最佳   还不懂可以找我QAQ"
        },
        {
            "author": "5igm1",
            "timestamp": 1443664740,
            "txt_content": "wldhk 发表于 2015-10-1 06:03\njava是否是java8 若是java7注意前置参数设置永久带\n请问什么是前置参数设置永久带？谢谢"
        },
        {
            "author": "5igm1",
            "timestamp": 1443676800,
            "txt_content": "\n如图，求问为什么会这样？"
        },
        {
            "author": "5igm1",
            "timestamp": 1443676980,
            "txt_content": "图坏了，补图一张\n"
        },
        {
            "author": "5igm1",
            "timestamp": 1443677100,
            "txt_content": "778563781 发表于 2015-10-1 08:16\nserver.properties中可以优化性能的参数：\n\n* view-distance，视距，默认值是10。含义是玩家的视距也就是加 ...\n感谢大触的信息，然而我按照这个改了没用啊。现在关键的不是资源不足，而是我发现资源没用上。您可以看下我后来发的那张图。"
        },
        {
            "author": "778563781",
            "timestamp": 1443678180,
            "txt_content": "5igm1 发表于 2015-10-1 13:25\n感谢大触的信息，然而我按照这个改了没用啊。现在关键的不是资源不足，而是我发现资源没用上。您可以看下 ...\n把你的启动参数给我看看"
        },
        {
            "author": "5igm1",
            "timestamp": 1443678360,
            "txt_content": "778563781 发表于 2015-10-1 13:43\n把你的启动参数给我看看\n"
        },
        {
            "author": "778563781",
            "timestamp": 1443678720,
            "txt_content": "5igm1 发表于 2015-10-1 13:46\n你这个是mod服？"
        },
        {
            "author": "778563781",
            "timestamp": 1443678960,
            "txt_content": "5igm1 发表于 2015-10-1 13:46\n如果方便的话截图一下mod和插件\n然后你看一下你的区块有没有问题"
        },
        {
            "author": "778563781",
            "timestamp": 1443679020,
            "txt_content": "5igm1 发表于 2015-10-1 13:46\n你输入gc截图给我看看"
        },
        {
            "author": "5igm1",
            "timestamp": 1443679500,
            "txt_content": "778563781 发表于 2015-10-1 13:57\n你输入gc截图给我看看\n"
        },
        {
            "author": "5igm1",
            "timestamp": 1443679620,
            "txt_content": "778563781 发表于 2015-10-1 13:57\n你输入gc截图给我看看\n"
        },
        {
            "author": "5igm1",
            "timestamp": 1443679740,
            "txt_content": "778563781 发表于 2015-10-1 13:57\n你输入gc截图给我看看\n"
        },
        {
            "author": "778563781",
            "timestamp": 1443680760,
            "txt_content": "5igm1 发表于 2015-10-1 14:05\n推荐直接开bungeecord  单服开这么多世界 tps不低才怪"
        },
        {
            "author": "778563781",
            "timestamp": 1443680940,
            "txt_content": "5igm1 发表于 2015-10-1 14:09\n噗。。。。。。。。。。。。。。。12算高的了"
        },
        {
            "author": "5igm1",
            "timestamp": 1443681900,
            "txt_content": "778563781 发表于 2015-10-1 14:29\n噗。。。。。。。。。。。。。。。12算高的了\n求问有没有什么好的蹦极设置教程？"
        },
        {
            "author": "5igm1",
            "timestamp": 1443689820,
            "txt_content": "778563781 发表于 2015-10-1 14:29\n噗。。。。。。。。。。。。。。。12算高的了\n我还想再请教一些问题。。比如为什么计分板人数超过一定数量后，sidebar就消失了？我应该从哪知道数据？\n能否推荐一个好的蹦极教程？\n因为以为这个帖子沉了，所以我另开了一个问题贴，同样的问题：http://www.mcbbs.net/forum.php?m ... p;page=1#pid9139158\n请在这里回复，我为你设置最佳答案"
        },
        {
            "author": "778563781",
            "timestamp": 1443703320,
            "txt_content": "5igm1 发表于 2015-10-1 16:57\n我还想再请教一些问题。。比如为什么计分板人数超过一定数量后，sidebar就消失了？我应该从哪知道数据？\n ...\n蹦极啊  cc和bs都可以你也可以用BungeeSuitePortal（要数据库）个人推荐这个  高端大气上档次\n\n\n下午无聊写了一下午网站=-=   没看论坛  回复晚了点"
        },
        {
            "author": "5igm1",
            "timestamp": 1443712680,
            "txt_content": "778563781 发表于 2015-10-1 20:42\n蹦极啊  cc和bs都可以你也可以用BungeeSuitePortal（要数据库）个人推荐这个  高端大气上档次\n大触啊，能不能请你出手帮忙搭建下蹦极？。。"
        },
        {
            "author": "5igm1",
            "timestamp": 1443760740,
            "txt_content": "778563781 发表于 2015-10-1 20:42\n蹦极啊  cc和bs都可以你也可以用BungeeSuitePortal（要数据库）个人推荐这个  高端大气上档次\n服现在出现了极限模式，开了蹦极之后，只要死了就被ban了，求问解决办法"
        },
        {
            "author": "778563781",
            "timestamp": 1443764940,
            "txt_content": "5igm1 发表于 2015-10-2 12:39\n服现在出现了极限模式，开了蹦极之后，只要死了就被ban了，求问解决办法 ...\n6666666666666666666666666666666666666\n在server.p啥的改一个选项\n具体忘了  服务器不在旁边=-=  还不能看 你截个图过来我给你找=-=\n 日了狗的快递"
        },
        {
            "author": "778563781",
            "timestamp": 1443765060,
            "txt_content": "5igm1 发表于 2015-10-1 23:18\n大触啊，能不能请你出手帮忙搭建下蹦极？。。\n可以帮你弄=-=  但是我怕我弄得东西你看不懂"
        },
        {
            "author": "5igm1",
            "timestamp": 1443765420,
            "txt_content": "778563781 发表于 2015-10-2 13:51\n可以帮你弄=-=  但是我怕我弄得东西你看不懂\n你要看什么文件？加个q如何？"
        },
        {
            "author": "5igm1",
            "timestamp": 1443765600,
            "txt_content": "778563781 发表于 2015-10-2 13:51\n可以帮你弄=-=  但是我怕我弄得东西你看不懂\nhardcore我已经选了false了，可是并没有用"
        }
    ]
}