{
    "title": "StructurePiece.applyXTransform 方法做了什么事[已解决]",
    "author": "鸭蛋只吃黄",
    "replyCount": 1,
    "timestamp": 1569168840,
    "txt_content": " 本帖最后由 SkinBBS 于 2019-9-23 08:44 编辑 \n\n环境是 Fabric 1.14.4 896c7fbb42\n其中在 net.minecraft.structure.StructurePiece 下有一个方法:\nprotected int applyXTransform(int int_1, int int_2) {\n      Direction direction_1 = this.getFacing();\n      if (direction_1 == null) {\n         return int_1;\n      } else {\n         switch(direction_1) {\n         case NORTH:\n         case SOUTH:\n            return this.boundingBox.minX + int_1;\n         case WEST:\n            return this.boundingBox.maxX - int_2;\n         case EAST:\n            return this.boundingBox.minX + int_2;\n         default:\n            return int_1;\n         }\n      }\n   }复制代码其实逻辑是很简单的, 就是根据 boundingBox 将相对坐标的 x 分量转化为在世界中的绝对坐标(顺便考虑朝向). 但是它对默认方向(北向)的处理有点看不懂. 即便是什么都不考虑, 在面朝北的时候绝对坐标怎么可能等于相对坐标. 在使用相对坐标时 x,z 的最大值 = 15, y 最大值 = 512, 难道面朝北的结构就只能生成在地图中心的这一点区域了么... 不过奇怪的是其他方法自己调用运行时正常的. 求 dalao 解答一下....我快哭了真的\n\n\n\n\n睡了一觉醒来脑子清晰了很多, 自己分析一波:\n\n以后请叫我铁憨憨谢谢\n\n刚在分析的过程中, 一位朋友找到我, 说在代码执行时返回的是南向的值, 我当时就惊呆了, 在我的理解中 switch 只要没遇到 break 就回一直向下匹配. 也就是说 North 虽然匹配上了, 但是代码块是空的而且没有 break, 继续向下匹配, 没有匹配到任何其他值就执行 default. 但是经过朋友的提示, 我写了个 demo:\nenum Type {\n        A, B, C\n    }\n    public static void main(String... args) throws IOException {\n        Type type = Type.A;\n        System.out.println(check(type));\n    }\n    public static String check(Type type) {\n        switch (type) {\n            case A:\n            case B:\n                return \"B\";\n            case C:\n                return \"C\";\n            default:\n                return \"A\";\n        }\n    }复制代码返回的居然是 \"B\"....\n\n这就告诉我们: 不能好高骛远, 一定要有扎实的基本功\n\n至于为什么会返回 B, 容我 javap...\n我的天, 还真是:\n\n\n下面的别看了, 太丢人了\n\n\n\n\n\n先自己反编译一下 mc 的代码, 看看是不是在反编译的过程中出现了错误:\n  protected int a(int var0, int var1) {\n    EnumDirection var2 = i();\n    if (var2 == null) {\n      return var0;\n    }\n    \n    switch (null.a[var2.ordinal()]) {\n      case 1:\n      case 2:\n        return this.n.a + var0;\n      case 3:\n        return this.n.d - var1;\n      case 4:\n        return this.n.a + var1;\n    } \n    return var0;\n  }复制代码看来不是...\n\n\n然后 javap 一波, 看看是不是两次反编译都出了错:\n\n         0: aload_0\n         1: invokevirtual #141                // Method i:()Lnet/minecraft/server/v1_14_R1/EnumDirection;\n         4: astore_3\n         5: aload_3\n         6: ifnonnull     11\n         9: iload_1\n        10: ireturn\n        11: getstatic     #252  // Field net/minecraft/server/v1_14_R1/StructurePiece$1.a:[I\n        14: aload_3\n        15: invokevirtual #255  // Method net/minecraft/server/v1_14_R1/EnumDirection.ordinal:()I\n        18: iaload\n        19: tableswitch   { // 1 to 4\n\n                       1: 48\n\n                       2: 48\n\n                       3: 58\n\n                       4: 68\n                 default: 78\n            }\n        48: aload_0\n        49: getfield      #89   // Field n:Lnet/minecraft/server/v1_14_R1/StructureBoundingBox;\n        52: getfield      #200   // Field net/minecraft/server/v1_14_R1/StructureBoundingBox.a:I\n        55: iload_1\n        56: iadd\n        57: ireturn\n        58: aload_0\n        59: getfield      #89  // Field n:Lnet/minecraft/server/v1_14_R1/StructureBoundingBox;\n        62: getfield      #212   // Field net/minecraft/server/v1_14_R1/StructureBoundingBox.d:I\n        65: iload_2\n        66: isub\n        67: ireturn\n        68: aload_0\n        69: getfield      #89  // Field n:Lnet/minecraft/server/v1_14_R1/StructureBoundingBox;\n        72: getfield      #200   // Field net/minecraft/server/v1_14_R1/StructureBoundingBox.a:I\n        75: iload_2\n        76: iadd\n        77: ireturn\n        78: iload_1\n        79: ireturn复制代码\n翻...翻车了\n\n\n不要紧, 一计不成再生一计, 丛林神庙也使用了这个代码, 断点一下看看它为什么能正常运行\n",
    "replies": [
        {
            "author": "Bryan33",
            "timestamp": 1569225840,
            "txt_content": "仅调侃 无他意\n\n\n\n\n\n\nSAI~VSL55DLZ5~USPPD{E.png (198.19 KB, 下载次数: 0)\n\n下载附件\n\n2019-9-23 16:03 上传\n\n\n\n\n\n           跳过了Java基础的Modder\n\n这个时候安利一波kotlin\n\nwhen表达式就不会有这个问题了233\n\n"
        }
    ]
}