{
    "title": "[CNPC]通过MojangAPI达到获取正版玩家UUID、profile以及SkinUrl",
    "author": "Hueihuea",
    "replyCount": 9,
    "timestamp": 1539433800,
    "txt_content": " 本帖最后由 skpsk自己家 于 2019-5-4 21:51 编辑 \n声明:只能对正版用户进行获取操作 离线？ 下次在研究看看好了\n\n如果你不想做 什么 右键后把NPC设置成互动者皮肤的操作之类的操作\n就可以不用往下看了\n毕竟用NPC魔杖就可以实现了\n\n我 一般 不多BB 直接 上 代码！\n\n\n\nHttpGetPost.jar\n(2.41 KB, 下载次数: 19)\n\n\n\n2018-10-13 20:23 上传\n点击文件名下载附件\n\n\n\n\n\n<<<请先安装类库 以支持http协议的get和post方法（服务器只需要服务端安装）\n声明:Base64加密解密改自https://blog.csdn.net/ziwoods/article/details/58595840\nfunction getUUID(name){\ntry{\nvar HttpRequest=Java.type(\"HttpGetPostMain.HttpRequest\")\nuuid=HttpRequest.sendGet(\"https://api.mojang.com/users/profiles/minecraft/\"+name,\"\")\nuuid=uuid.substring(uuid.indexOf(\"id\":\"\"),uuid.indexOf(\"\",\"name\")).replace(\"id\":\"\",\"\");\nif(uuid!=\"\"){return uuid;}else{return \"§4connection failed §4or this is not an online §4player.§4(无法链接或没有该玩家)\"}\n}catch(err){}\n//只能获取正版玩家(Only get online players.)\n}\nfunction getProfile(uuid){\ntry{\nvar HttpRequest=Java.type(\"HttpGetPostMain.HttpRequest\")\nprofile=HttpRequest.sendGet(\"https://sessionserver.mojang.com/session/minecraft/profile/\"+uuid,\"\")\nprofile=profile.substring(profile.indexOf(\"value\":\"\"),profile.indexOf(\"\"}]}\")).replace(\"value\":\"\",\"\");\nif(profile!=\"\"){return profile;}else{return \"connection failed or this is not an online player.\"}\n}catch(err){}\n}\nfunction Base64(string,type){\nvar Base64={_keyStr:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",encode:function(e){var t=\"\";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t=\"\";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,\"\");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/rn/g,\"n\");var t=\"\";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t=\"\";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}\nswitch(type){\ncase 0:\nreturn Base64.decode(string)\n//解密\ncase 1:\nreturn Base64.encode(string)\n//加密\n}\n}\nfunction getSkinUrl(name){\nuuid=Base64(getProfile(getUUID(name)),0)\nuuid=uuid.substring(uuid.indexOf(\"/texture/\"),uuid.indexOf(\"\"\",uuid.indexOf(\"/texture/\"))).replace(\"/texture/\",\"\").replace(\"undefined\",\"\");\nurl=\"http://textures.minecraft.net/texture/\"+uuid\nif(uuid!=\"\"){return url;}else{return \"§4connection failed or this is §4not an online §4player.(无法链接(有请求冷却)§4或没有该玩家)\"}\n//获取正版皮肤直连\n}\n复制代码如果你只是要用的话\n复制走 使用方法getSkinUrl(玩家ID)会返回玩家皮肤直连\n\n如果你想理解的话\nfunction getUUID(name){\ntry{\nvar HttpRequest=Java.type(\"HttpGetPostMain.HttpRequest\")\nuuid=HttpRequest.sendGet(\"https://api.mojang.com/users/profiles/minecraft/\"+name,\"\")\nuuid=uuid.substring(uuid.indexOf(\"id\":\"\"),uuid.indexOf(\"\",\"name\")).replace(\"id\":\"\",\"\");\nif(uuid!=\"\"){return uuid;}else{return \"§4connection failed §4or this is not an online §4player.§4(无法链接或没有该玩家)\"}\n}catch(err){}\n//只能获取正版玩家(Only get online players.)\n}复制代码这段是获取UUID\n先通过Mojang的APIURL接口\n获取玩家UUID数据\n在通过文本操作取出UUID文本\n参考\nMojangAPIDOC:https://wiki.vg/Mojang_API\nhttps://api.mojang.com/users/profiles/minecraft/<ID>\n<ID>是玩家正版ID 如果没有或网络问题则不会响应\n\nfunction getProfile(uuid){\ntry{\nvar HttpRequest=Java.type(\"HttpGetPostMain.HttpRequest\")\nprofile=HttpRequest.sendGet(\"https://sessionserver.mojang.com/session/minecraft/profile/\"+uuid,\"\")\nprofile=profile.substring(profile.indexOf(\"value\":\"\"),profile.indexOf(\"\"}]}\")).replace(\"value\":\"\",\"\");\nif(profile!=\"\"){return profile;}else{return \"connection failed or this is not an online player.\"}\n}catch(err){}\n}复制代码获取Profile\nprofile这么说呢 这个不好解释\n一般也用不上 跳过好了\n\nfunction Base64(string,type){\nvar Base64={_keyStr:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",encode:function(e){var t=\"\";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t=\"\";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,\"\");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/rn/g,\"n\");var t=\"\";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t=\"\";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}\nswitch(type){\ncase 0:\nreturn Base64.decode(string)\n//解密\ncase 1:\nreturn Base64.encode(string)\n//加密\n}\n}复制代码因为profile中的textures数据是加密的需要解密 懂？function getSkinUrl(name){\nuuid=Base64(getProfile(getUUID(name)),0)\nuuid=uuid.substring(uuid.indexOf(\"/texture/\"),uuid.indexOf(\"\"\",uuid.indexOf(\"/texture/\"))).replace(\"/texture/\",\"\").replace(\"undefined\",\"\");\nurl=\"http://textures.minecraft.net/texture/\"+uuid\nif(uuid!=\"\"){return url;}else{return \"§4connection failed or this is §4not an online §4player.(无法链接(有请求冷却)§4或没有该玩家)\"}\n//获取正版皮肤直连\n}复制代码这个就是把解密后的textures中的SkinUrl提取出来而已说简单点 就是会返回你的皮肤直连这个是针对1.7.10的CNPC编写的当然 思路是全版本通用的bukkit和forge也通用计算就是bukkit和forge开发的时候才不会这样子获取呢对了 还有个很恶心的东西profile获取是有冷却的所以 请自己写一个冷却时跳过设置之类的不然？自己看图\n所以我可能又做了一个没用的东西？\n不 还是用点用的 比如教会了大家 怎么通过http协议post和get\n所以我单独拿出来说一下好了var HttpRequest=Java.type(\"HttpGetPostMain.HttpRequest\")//导入包\nHttpRequest.sendGet(url/*网址*/,param/*参数*/)\nHttpRequest.sendPost(url/*网址*/,param/*参数*/)\n//需要先安装类库支持\n复制代码至于为什么要安装上面的那个JAR呢\n因为我也不会用nashorn做到Get和Post啊\n\n源码:\n声明:CV自https://www.cnblogs.com/zhuawang/archive/2012/12/08/2809380.html\n\npackage HttpGetPostMain;\n\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.io.PrintWriter;\nimport java.net.URL;\nimport java.net.URLConnection;\nimport java.util.List;\nimport java.util.Map;\n\npublic class HttpRequest {\n    /**\n     * 向指定URL发送GET方法的请求\n     * \n     * @param url\n     *            发送请求的URL\n     * @param param\n     *            请求参数，请求参数应该是 name1=value1&name2=value2 的形式。\n     * [url=home.php?mod=space&uid=491268]@Return[/url] URL 所代表远程资源的响应结果\n     */\n    public static String sendGet(String url, String param) {\n        String result = \"\";\n        BufferedReader in = null;\n        try {\n            String urlNameString = url + \"?\" + param;\n            URL realUrl = new URL(urlNameString);\n            // 打开和URL之间的连接\n            URLConnection connection = realUrl.openConnection();\n            // 设置通用的请求属性\n            connection.setRequestProperty(\"accept\", \"*/*\");\n            connection.setRequestProperty(\"connection\", \"Keep-Alive\");\n            connection.setRequestProperty(\"user-agent\",\n                    \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)\");\n            // 建立实际的连接\n            connection.connect();\n            // 获取所有响应头字段\n            Map<String, List<String>> map = connection.getHeaderFields();\n            // 遍历所有的响应头字段\n            for (String key : map.keySet()) {\n                System.out.println(key + \"--->\" + map.get(key));\n            }\n            // 定义 BufferedReader输入流来读取URL的响应\n            in = new BufferedReader(new InputStreamReader(\n                    connection.getInputStream()));\n            String line;\n            while ((line = in.readLine()) != null) {\n                result += line;\n            }\n        } catch (Exception e) {\n            System.out.println(\"发送GET请求出现异常！\" + e);\n            e.printStackTrace();\n        }\n        // 使用finally块来关闭输入流\n        finally {\n            try {\n                if (in != null) {\n                    in.close();\n                }\n            } catch (Exception e2) {\n                e2.printStackTrace();\n            }\n        }\n        return result;\n    }\n\n    /**\n     * 向指定 URL 发送POST方法的请求\n     * \n     * @param url\n     *            发送请求的 URL\n     * @param param\n     *            请求参数，请求参数应该是 name1=value1&name2=value2 的形式。\n     * @return 所代表远程资源的响应结果\n     */\n    public static String sendPost(String url, String param) {\n        PrintWriter out = null;\n        BufferedReader in = null;\n        String result = \"\";\n        try {\n            URL realUrl = new URL(url);\n            // 打开和URL之间的连接\n            URLConnection conn = realUrl.openConnection();\n            // 设置通用的请求属性\n            conn.setRequestProperty(\"accept\", \"*/*\");\n            conn.setRequestProperty(\"connection\", \"Keep-Alive\");\n            conn.setRequestProperty(\"user-agent\",\n                    \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)\");\n            // 发送POST请求必须设置如下两行\n            conn.setDoOutput(true);\n            conn.setDoInput(true);\n            // 获取URLConnection对象对应的输出流\n            out = new PrintWriter(conn.getOutputStream());\n            // 发送请求参数\n            out.print(param);\n            // flush输出流的缓冲\n            out.flush();\n            // 定义BufferedReader输入流来读取URL的响应\n            in = new BufferedReader(\n                    new InputStreamReader(conn.getInputStream()));\n            String line;\n            while ((line = in.readLine()) != null) {\n                result += line;\n            }\n        } catch (Exception e) {\n            System.out.println(\"发送 POST 请求出现异常！\"+e);\n            e.printStackTrace();\n        }\n        //使用finally块来关闭输出流、输入流\n        finally{\n            try{\n                if(out!=null){\n                    out.close();\n                }\n                if(in!=null){\n                    in.close();\n                }\n            }\n            catch(IOException ex){\n                ex.printStackTrace();\n            }\n        }\n        return result;\n    }    \n}复制代码\n",
    "replies": [
        {
            "author": "Mccraft-pepsi",
            "timestamp": 1539784500,
            "txt_content": "厉害厉害，虽然实际用处不大，但是脑洞很强大！"
        },
        {
            "author": "473937269",
            "timestamp": 1547957460,
            "txt_content": "看不懂。。。。好复杂"
        },
        {
            "author": "absc123",
            "timestamp": 1556976000,
            "txt_content": "如果可以的话把代码改为正常，居中太难看了"
        },
        {
            "author": "Hueihuea",
            "timestamp": 1556977920,
            "txt_content": "absc123 发表于 2019-5-4 21:20\n如果可以的话把代码改为正常，居中太难看了\n改了 最好还是复制走放文本编辑器看吧"
        },
        {
            "author": "absc123",
            "timestamp": 1558140240,
            "txt_content": "还有dalao离线可以通过uuid算是否alex，至于uuid怎么获取......可以参考盗版客户端"
        },
        {
            "author": "absc123",
            "timestamp": 1558140300,
            "txt_content": "还有dalao离线可以通过uuid算是否alex，至于uuid怎么获取......可以参考盗版客户端"
        },
        {
            "author": "absc123",
            "timestamp": 1558140360,
            "txt_content": "在wiki.vg/Mojang_API里"
        },
        {
            "author": "Hueihuea",
            "timestamp": 1558151460,
            "txt_content": "absc123 发表于 2019-5-18 08:46\n在wiki.vg/Mojang_API里\n\n好好好 但是这跟本教程有什么关系吗"
        },
        {
            "author": "absc123",
            "timestamp": 1559037240,
            "txt_content": "似乎......没有"
        }
    ]
}