{
    "title": "[1.13][技术分析]海龟蛋孵化到底需要多少时间？",
    "author": "gooding300",
    "replyCount": 49,
    "timestamp": 1532808240,
    "txt_content": " 本帖最后由 gooding300 于 2018-8-19 18:58 编辑 \n\n0.引言\n作为一名标准的非酋，在服务器中与他人联机时，想要使用乌龟壳制作一顶绿帽子，也非常幸运的遇到了不少海龟，并让他们产下了海龟蛋，然而在苦苦等待后，未见海龟蛋有任何动静..\n为什么会变成这样呢，第一次遇到了成对的海龟，见到了那么多的海龟蛋，两件快乐的事情重合在一起，又给我带来了更多的快乐，得到的，本应是梦境一般幸福的时间，可为什么..会变成这样呢..（逃\n\n本文通过反编译Minecraft1.13查看相关代码，来从数学期望的角度分析海龟蛋孵化所需的时间。\n\n1.基础说明\n海龟蛋是一个方块（Block），通过HATCH、EGGS两个标签在方块状态中分别记录孵化程度、海龟蛋数量两个信息。\n其中，孵化程度有0、1、2三个状态，会随着时间增加（具体如何增加请看下文），在状态2时如果继续增加，则会消失海龟蛋并生成对应数量的小海龟，也就是说需要增加三次状态才能完成孵化。\n海龟蛋数量为当前方块中拥有的海龟蛋的数量，最高为4。\n海龟蛋方块的代码位于net/minecraft/block/BlockTurtleEgg\n以下所有使用的代码均采用SRG混淆方式（半混淆），并尽可能减少代码的使用\n2.基本条件\n首先先谈一谈海龟蛋孵化的基本条件是什么    public void func_196267_b(IBlockState p_196267_1_, World p_196267_2_, BlockPos p_196267_3_, Random p_196267_4_) {\n          if (this.func_203169_a(p_196267_2_) && this.func_203168_a(p_196267_2_, p_196267_3_)) {\n                 int i = p_196267_1_.func_177229_b(field_203170_a);//获得孵化程度\n                 if (i < 2) {\n                        //孵化程度增加\n                        //...\n                 } else {\n                        //移除方块、生成小海龟\n                        //...\n                 }\n          }\n   }复制代码从海龟蛋方块的tick（每个随机刻）方法中可以看出，有两个方法func_203169_a和func_203168_a共同决定了海龟蛋能否生长\n其中func_203168_a用于判断孵化环境，func_203169_a通过随机决定是否进行孵化，也就是说前者判断了孵化的基本条件        private boolean func_203168_a(IBlockReader p_203168_1_, BlockPos p_203168_2_) {\n                return p_203168_1_.func_180495_p(p_203168_2_.func_177977_b()).func_177230_c() == Blocks.field_150354_m;\n        }复制代码什么？你说你看不懂？好吧..直接看我也看不懂，总之就是判断了海龟蛋底下的方块是否为沙子。\n也就是说，海龟蛋只有在沙子上才能孵化。\n\n3.时间期望\n现在，我们的海龟乖乖的将海龟蛋产在沙子上后（本来就只产在沙子上），我们也没有作死强行把海龟蛋移植到泥土等其他方块上了，那么，到底要等多久才能见到可爱的小海龟呢？\n      private boolean func_203169_a(World p_203169_1_) {\n                float f = p_203169_1_.func_72826_c(1.0F);//获得星空仰角\n                if ((double)f < 0.69D && (double)f > 0.65D) {//如果星空仰角在(0.65,0.69)区间内，则返回真\n                        return true;\n                } else {\n                        return p_203169_1_.field_73012_v.nextInt(500) == 0;//从0-499中取一个数字，如果为0则返回真\n                }\n        }复制代码也就是说，在每个随机刻中，如果星空仰角在(0.65,0.69)之间，或者从500个数字中幸运的抽到了0，那么就能增加一个孵化程度了。\n肯定有人要问了，星空仰角是什么奇怪的东西？我们无需知道它是什么，只需要知道它是如何被计算出来的即可。\n        //参数一为当前世界时间（单位：刻），参数二为时间偏移值（海龟蛋计算时为1）\n        public float func_76563_a(long p_76563_1_, float p_76563_3_) {\n                int i = (int)(p_76563_1_ % 24000L);//当前时间对24000（一天的时间）取余，计算出当前时间是单日中的第几刻\n                float f = ((float)i + p_76563_3_) / 24000.0F - 0.25F;//加上偏移值，并减去6000刻（出生时间），除以一天的总时间\n                //调节时间到[0,1)区间内\n                //..\n                float f1 = 1.0F - (float)((Math.cos((double)f * 3.141592653589793D) + 1.0D) / 2.0D);\n                f = f + (f1 - f) / 3.0F;\n                return f;\n        }复制代码无论能否理解代码，只用知道所谓的“星空仰角”是一个只与当前时间（刻tick）有关的函数即可。\n\n大致上是这样的关系，x∈[6000+24000k, 30000+24000k), x∈N, k∈N，是一个周期函数。\n经过计算，y∈(0.65,0.69)时，x∈[21060, 21903]（周期同上），（细心的朋友会注意到，在这个时间范围内，海龟蛋的生长速度是最快的）\n也就是说，每24000ticks中，有844ticks的随机刻生长概率为100%，而剩余的23156ticks的生长概率只有1/500=0.2%\n换而言之，每个随机刻的平均生长概率为(844/24000)*100%+(23156/24000)*0.2%=3.7% 。\n\n而随机刻是如此进行的，每游戏刻，每16*16*16（4096）个方块中，随机抽取3个方块执行随机刻。\n即，每个方块，每游戏刻都有(3/4096)的概率被抽到执行随机刻，每秒钟20个游戏刻，每个方块每分钟平均执行60*20*(3/4096)=0.8789个随机刻。\n\n综上，每分钟海龟蛋期望增加0.8789*3.7%=0.0325193个生长程度。\n上文已经解释过，海龟蛋从产下到孵出小海龟需要3个生长程度，因此期望上需要3/0.0325193=92.3分钟\n\n4.总结\n海龟蛋需要改变三次生长状态才能孵化，\n海龟蛋只有在沙子上才能孵化，\n海龟蛋在晚上特定时间会有远超其他时间的速度，\n海龟蛋期望上需要92.3分钟进行孵化。\n有深入了解过随机刻的人会发现，单个方块轮到一个随机刻的时间离散程度相当巨大，也就是说孵化海龟这完全是一个看脸的操作，无论数学期望上时间是多少，每个人海龟蛋的孵化时间都会有所差距，你就是那个欧洲人吗？\n\n请求dalao指点QAQ\n\n[afd]xfl03[/afd]\n\n[groupid=128]HAYO Studio[/groupid]",
    "replies": [
        {
            "author": "robbit",
            "timestamp": 1532811960,
            "txt_content": "厉害了我的龟龟"
        },
        {
            "author": "uhuichongfu",
            "timestamp": 1532821320,
            "txt_content": "我记得谁说过大约六分钟的？拖出去打！"
        },
        {
            "author": "zjxx",
            "timestamp": 1532833800,
            "txt_content": "第一次看懂大佬的分析...嘤嘤嘤\n\n然后有字打错了233\n"
        },
        {
            "author": "爱心魔王FHC",
            "timestamp": 1532836680,
            "txt_content": "这一年不要@我，我也不在，谢谢了"
        },
        {
            "author": "8784",
            "timestamp": 1532839200,
            "txt_content": " 本帖最后由 8784 于 2018-7-29 12:42 编辑 \n\n那个，其实用引雷三叉戟杀海龟有机率掉乌龟壳的"
        },
        {
            "author": "aa0307bb",
            "timestamp": 1532841720,
            "txt_content": "能否这样理解：\n在每个游戏刻中，系统会在每16*16*16（4096）个方块中，随机抽取3个方块执行随机刻\n如果海龟蛋被幸运地抽中执行了随机刻，那么就会执行：\n①检测现在的游戏时间是多少（运行星空仰角这个函数），如果刚好为晚上的某一特定时间（星空仰角函数的返回值在(0.65,0.69)，也就是x∈[21060, 21903]这844个tick，减去6000，也就是每天的第15060到底15903这几个游戏刻），那么孵化程度+1\n②如果不是那个特定的欧气时间，那么再随机抽取0-500中的一个数，如果是0，那么孵化程度+1\n③如果都不是，海龟蛋就错过了这个随机刻，什么都没得到\n\n所以创造党只需要关掉昼夜循环再time set就可以看到海龟蛋高速生长咯← ←"
        },
        {
            "author": "Argon_gas",
            "timestamp": 1532841780,
            "txt_content": "表示有一次挂了30分钟左右就孵化好了..\n其实龟壳真的没啥用"
        },
        {
            "author": "aa0307bb",
            "timestamp": 1532841840,
            "txt_content": "能否这样理解：\n在每个游戏刻中，系统会在每16*16*16（4096）个方块中，随机抽取3个方块执行随机刻\n如果海龟蛋被幸运地抽中执行了随机刻，那么就会执行：\n①检测现在的游戏时间是多少（运行星空仰角这个函数），如果刚好为晚上的某一特定时间（星空仰角函数的返回值在(0.65,0.69)，也就是x∈[21060, 21903]这844个tick，减去6000，也就是每天的第15060到底15903这几个游戏刻），那么孵化程度+1\n②如果不是那个特定的欧气时间，那么再随机抽取0-500中的一个数，如果是0，那么孵化程度+1\n③如果都不是，海龟蛋就错过了这个随机刻，什么都没得到\n\n所以创造党只需要关掉昼夜循环再time set就可以看到海龟蛋高速生长咯← ←\n"
        },
        {
            "author": "gooding300",
            "timestamp": 1532842080,
            "txt_content": "aa0307bb 发表于 2018-7-29 13:24\n能否这样理解：\n在每个游戏刻中，系统会在每16*16*16（4096）个方块中，随机抽取3个方块执行随机刻\n如果海 .../gamerule randomTickSpeed 50000\n/time set 21060复制代码\n感受飞一般的速度吧233"
        },
        {
            "author": "玄素",
            "timestamp": 1532851080,
            "txt_content": " 本帖最后由 玄素 于 2018-7-29 15:59 编辑 \n8784 发表于 2018-7-29 12:40\n那个，其实用引雷三叉戟杀海龟有机率掉乌龟壳的\n1.13.jar/data/minecraft/loot_tables/entities/turtle.json\n{\n    \"pools\": [\n        {\n            \"rolls\": 1,\n            \"entries\": [\n                {\n                    \"type\": \"item\",\n                    \"name\": \"minecraft:seagrass\",\n                    \"weight\": 3,\n                    \"functions\": [\n                        {\n                            \"function\": \"set_count\",\n                            \"count\": {\n                                \"min\": 0,\n                                \"max\": 2\n                            }\n                        },\n                        {\n                            \"function\": \"looting_enchant\",\n                            \"count\": {\n                                \"min\": 0,\n                                \"max\": 1\n                            }\n                        }\n                    ]\n                }\n            ]\n        }\n    ]\n}复制代码掉落仅受掠夺附魔影响 增加1的可能掉落的海草上限\n与三叉戟/引雷附魔无关"
        },
        {
            "author": "ShiChunAn",
            "timestamp": 1532853840,
            "txt_content": "也就是说每天的第15060到15903的游戏刻概率暴增，换算一下就是进入夜晚约2.5分钟~约3分钟这一段时间？\n再换一句话说就是进入夜晚后3分钟过点再睡觉咯？"
        },
        {
            "author": "nggcgg2",
            "timestamp": 1532854320,
            "txt_content": "FHC红石 发表于 2018-7-29 11:58\n这一年不要@我，我也不在，谢谢了\n@FHC红石 我@了 咋整"
        },
        {
            "author": "8784",
            "timestamp": 1532854620,
            "txt_content": "英文wiki-Turtle-Drops\n0-1 bowl, if killed by a lightning bolt[Java Edition only] [1]\n搞错了，其实是碗（说来奇怪，我是怎么看错的？这碗掉落表里又没有…）"
        },
        {
            "author": "andylizi",
            "timestamp": 1532910180,
            "txt_content": "话说为什么要用srg name呢。。演示说明的话mcp name不是好得多。用srg name的话放代码就跟没放没区别了，，反正一样的看不懂。"
        },
        {
            "author": "kongbaiyo",
            "timestamp": 1532914320,
            "txt_content": "能否根据根据随机刻的规律计算出方差呢！\n既然每次生长都是独立的与前一个状态无关，\n那就可以假设海龟蛋生长时间服从特定方差和期望正态分布\n然后三次生长就能孵化了 所以可以根据这个得到海龟蛋生长的概率密度图\n然后就可以知道大概在多长时间之内海龟蛋大概率孵化出来了！"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1532920380,
            "txt_content": "kongbaiyo 发表于 2018-7-30 09:32\n能否根据根据随机刻的规律计算出方差呢！\n既然每次生长都是独立的与前一个状态无关，\n那就可以假设海龟蛋生 ...\n应该还是泊松分布的线性组合吧"
        },
        {
            "author": "sjx",
            "timestamp": 1532924640,
            "txt_content": "8784 发表于 2018-7-29 16:57\n搞错了，其实是碗（说来奇怪，我是怎么看错的？这碗掉落表里又没有…） ...\n这是真的，被雷击中掉碗\n详见源码"
        },
        {
            "author": "BlackCB.",
            "timestamp": 1532928840,
            "txt_content": "93分钟……\n首先先谈一谈海龟蛋孵化的基本条件是什么\n踩上几脚即可"
        },
        {
            "author": "gooding300",
            "timestamp": 1532930580,
            "txt_content": "andylizi 发表于 2018-7-30 08:23\n话说为什么要用srg name呢。。演示说明的话mcp name不是好得多。用srg name的话放代码就跟没放没区别了，， ...\n主要是因为这里大部分东西（基本都是1.13才加的新方法）都还没有确定的mcp name..\n我自己强塞mcp name的话感觉不太好QAQ\n\n等出确定的mcp name的时候我会更新贴子的www"
        },
        {
            "author": "xiaowei233v",
            "timestamp": 1533703560,
            "txt_content": "萌新看着这里的大佬瑟瑟发抖\n什么事周期函数 什么事线性分布\n表示看得一脸懵逼（跑去度娘了awa）"
        },
        {
            "author": "种拔",
            "timestamp": 1533822360,
            "txt_content": "想要孵海龟，挂机去吧。不然改随机刻"
        },
        {
            "author": "天子~Tensi",
            "timestamp": 1533831780,
            "txt_content": "羡慕懂编程的人什么都可以直接从源代码里查看QnQ"
        },
        {
            "author": "難篱",
            "timestamp": 1536290940,
            "txt_content": "emm我上次挂机看着海龟孵化好像花了3个晚上 看到评论花30分钟的哭了"
        },
        {
            "author": "QWQQWQTAT",
            "timestamp": 1544878560,
            "txt_content": "解释的很接地气呀！我都能看懂qwq"
        },
        {
            "author": "uuu2011",
            "timestamp": 1548249840,
            "txt_content": "不错，最终还是看脸"
        },
        {
            "author": "摸鱼",
            "timestamp": 1548305700,
            "txt_content": "你这个是分段函数呀  高中的  应该研究了很久了吧 辛苦了 楼主！"
        },
        {
            "author": "是谁",
            "timestamp": 1550039160,
            "txt_content": "哇，还是randomTickSpeed有点用，话说你为什么要绿帽子"
        },
        {
            "author": "laofangkuai",
            "timestamp": 1552404480,
            "txt_content": "1.7.10玩家表示很慌"
        },
        {
            "author": "灬屮灬屮灬",
            "timestamp": 1552570260,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "BigGay_BODJ",
            "timestamp": 1552572180,
            "txt_content": "要孵化好久"
        },
        {
            "author": "qaz1357077767",
            "timestamp": 1557418260,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "1453🐱",
            "timestamp": 1557629340,
            "txt_content": "厉害了，怎么看代码啊？"
        },
        {
            "author": "1677343686",
            "timestamp": 1557637920,
            "txt_content": "emmmmm,其实为什么要管啥时候掉落呢，往沙子里挤进去一个漏斗矿车不就行了吗"
        },
        {
            "author": "aa0307bb",
            "timestamp": 1566145920,
            "txt_content": "忽然想起一件事……这星空仰角函数的意义是什么……直接判定随机刻执行时是否满足x∈[21060, 21903]就行了，为什么要用一个图像近似为直线的曲线的函数来表示……"
        },
        {
            "author": "zxcvx_nian",
            "timestamp": 1566204180,
            "txt_content": "海龟蛋孵化不管要多久 反正我是不会在意的哈哈"
        },
        {
            "author": "2411453931",
            "timestamp": 1570872900,
            "txt_content": "感谢楼主分享"
        },
        {
            "author": "我爱54290",
            "timestamp": 1586507580,
            "txt_content": "那个90多分钟孵化时间是游戏时间对吧.."
        },
        {
            "author": "young_panda",
            "timestamp": 1588511160,
            "txt_content": "踩一下就没233"
        },
        {
            "author": "社会我祺大大",
            "timestamp": 1613244300,
            "txt_content": "8784 发表于 2018-7-29 12:40\n那个，其实用引雷三叉戟杀海龟有机率掉乌龟壳的\n那是碗（壳被雷劈焦了？），并且仅限Java版（大家最常用的也是这个版吧）"
        },
        {
            "author": "社会我祺大大",
            "timestamp": 1613244540,
            "txt_content": "社会我祺大大 发表于 2021-2-14 03:25\n那是碗（壳被雷劈焦了？），并且仅限Java版（大家最常用的也是这个版吧） ...\n啊，好像大家已经回复过了……那当没看到吧[汗]"
        },
        {
            "author": "Lao_5493",
            "timestamp": 1613295480,
            "txt_content": "什么版本的有海龟啊"
        },
        {
            "author": "聂明锐",
            "timestamp": 1613321760,
            "txt_content": "\n厉害了我的龟龟"
        },
        {
            "author": "小猪猪007",
            "timestamp": 1613338860,
            "txt_content": "好家伙，孵化都是门学问，我傻了"
        },
        {
            "author": "6566pqh",
            "timestamp": 1613358000,
            "txt_content": "6666666666666666"
        },
        {
            "author": "feige2464",
            "timestamp": 1613370840,
            "txt_content": "看起来挺好用，可以有"
        },
        {
            "author": "cu665462",
            "timestamp": 1613621160,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "1372959307",
            "timestamp": 1613646420,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "rDUPjJ",
            "timestamp": 1613855700,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "陈c",
            "timestamp": 1613890800,
            "txt_content": "话说为什么要用srg name呢。。演示说明的话mcp name不是好得多。用srg name的话放代码就跟没放没区别了，，反正一样的看不懂。"
        }
    ]
}