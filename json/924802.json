{
    "title": "[GroupManager]man[*]addp 与 man[*]delp 的使用误区",
    "author": "Karlatemp",
    "replyCount": 1,
    "timestamp": 1573139940,
    "txt_content": " 本帖最后由 Karlatemp 于 2019-11-7 23:20 编辑 \n\n\nGroupManager 中 addp 与 delp 的使用误区\n首先，我们来看一下一个事件\n\n有一位服主, 他想要某位OP不能使用彩色字, 于是他找到需要删除这位OP两个权限\nessentials.chat.color 和 essentials.chat.colour\n于是他就去用delp删除权限了, 但是...\n\n然后这位服主心想: 既然del不了我add一次不就能del了吗(笑),于是\n\n此时这位OP上线并给了这位服主一棒子\n\n此时他想到好像可以用add加负权限, 然后\n\n\n这位服主终于把这位OP的权限删除了, 可喜可贺!\n启示(滑稽)\n我们需要给玩家/权限组删除权限的时候, 应该用 addp 添加负权限而不是用 delp\n原因分析(不想看的可以走了)\n首先，这部分是以原版的 OP 命令进行解析的\n首先 原版的op命令所需要的权限是 minecraft.command.op (不信的可以自己去查去验证)\n然后, 我们需要知道这些概念\n\n默认值\n\n以 minecraft.command.op 为例, 当玩家是 OP 和 不是 OP 时有两种情况\n是 OP: 有权限\n不是 OP: 没有权限\n注意, 默认值什么的是这个权限所属的插件设置的, 目前主流的权限组插件都没有修改默认值的功能\n如果所属插件不是通过代码批量注册的话可以在 <插件.jar>!/plugin.yml 找到默认权限注册信息\n\n插件权限覆盖 (请注意, 这是我个人的术语, 实际上是PermissionAttachment 权限附属, 覆盖比较好理解)\n\n直接看下面的权限检测流程就OK\n实际就是一个池子\n一个 HashMap<String, Boolean>\n\n\n然后我们需要了解一下权限系统是怎么工作的\n\n首先查询是否需要检测的权限已经被覆盖设置了\n如果没有被覆盖的话就返回默认值\n\nGM 的权限系统是怎么工作的\nTips: 如果你想要了解GM的内核是怎么工作的, 可以去翻GM源码, 这里只给出GM的工作流程\n首先, GroupManager是由一个个Node信息组成的, 这里不怎么说, 主要说addp和delp的工作原理\n\naddp [Target] [permissions]\n\n把 [permission] 添加到 [Target]的 插件权限覆盖区 的记录中\n\ndelp [Target] [permissions]\n\n把 [permission] 从 [Target] 的 插件权限覆盖区 的记录中移除\n\n\n是的, 相信大家都看到我划出重点的内容: 插件权限覆盖区, 这就是 GM 中最容易误导人的地方,\n甚至中文翻译的Wiki都是有误导的 Group Manager/命令\n> /manudelp: 从玩家直接移除权限。\n直接, 是的, 这也就是误导服主们的因素, 应该是\n> /manudelp: 从GroupManager的记录中移除玩家的记录\nAddp / Delp 的具体分析\n首先, 我们在这里定义玩家是 Default 组\nDefault组有以下权限\n\nperm.group.default\n-perm.group.default.del\n\n玩家(Player)还有这些权限\n\nuser.perm\n-user.perm.del\nperm.group.default.del\n\nTips: 这些都可以在GM的存储文件中看到, 也就是 记录 内容, GM真正记下来的\n然后, 以 - 开头的就是真正移除的权限, 下面给出这些Node的插件覆盖区的值\n\nDefault\n\nperm.group.default -> true\nperm.group.default.del -> false\n\nPlayer\n\nuser.perm -> true\nuser.perm.del -> false\nperm.group.default.del -> true\n\n\n然后在权限出现重复设置的时候,\n由最高层把底层的权限情况给覆盖掉, 也就是 Player 的会把 Default组 的给覆盖掉\n此时 GM 传给服务器的实际权限覆盖区的情况是这样的\n\nuser.perm -> true\nuser.perm.del -> false\nperm.group.default.del -> true\nperm.group.default\n\n其中 perm.group.default.del 被Player的值给覆盖掉了\n如果你认真看到这里的话, 你就会很容易理解 addp 和 delp 做了什么\n\naddp 负责把权限加入到 Target\ndelp 负责把记录从 Target 中移除\n\nBukkit 检测权限流程(详细)\n假如玩家 Karlatemp 的权限覆盖区是这个样子的\n\nminecraft.command.op -> true\n\n然后 Karlatemp 执行 /op 的时候服务器就会这样做\n\n我先从覆盖区看看有没有记录啊, 啊, 是true, 你有权限执行啊\n\n[Karlatemp: 已将 Karlatemp 设置成服务器管理员]\n\n\n如果OP Karlatemp 的权限覆盖区是这样子的\n\nminecraft.command.deop -> false\n然后 [OP]Karlatmep 执行 deop 的时候服务器就会这样做\n我先从覆盖区看看有没有记录啊, 啊, false, 权限拒绝哦\nKarlatemp: 我是OP!\n服务器: 权限拒绝\nKarlatemp: 我是你管理!\n服务器: 你有没有 minecraft.command.deop 权限, 滚啊\n\n\n如果玩家 Karlatemp 的权限覆盖区是这样的:\n\na.b -> true\n然后服务器检查权限 permission.example 的时候\n啊, 权限覆盖区没东西呢..\n\n搜索默认值, 是 true 呢\n玩家 Karlatemp 拥有权限 permission.example\n搜索默认值, 是 false 呢\n玩家 Karlatemp 没有权限 permission.example\n\n\n",
    "replies": [
        {
            "author": "筱柒不会哭",
            "timestamp": 1573880280,
            "txt_content": "非常有用的帖子 帮助了我更改玩家权限 \n非常谢谢这片帖子的作者\n"
        }
    ]
}