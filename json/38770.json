{
    "title": "利用Forge API开发联机MOD【基础篇】【第七章】",
    "author": "yuxuanchiadm",
    "replyCount": 2,
    "timestamp": 1343884380,
    "txt_content": " 本帖最后由 yuxuanchiadm 于 2013-8-4 15:16 编辑 \n\n利用Forge API开发联机MOD【基础篇】【第七章】\n改善你制作的方块的功能\n作者：yuxuanchiadm\n\n索引贴地址：http://www.mcbbs.net/thread-38211-1-1.html\n\n请确定你已经阅读完成第六章的内容:\nhttp://www.mcbbs.net/thread-38526-1-1.html\n否则不要阅读此贴！\n\n序：\n在上一章里，我们创建了一个极不完善的刷怪笼方块，而我们的目标是制作一个能够自定义所刷生物和刷怪间隔的高级刷怪笼。所以，在这一章里，首先让我们让这个方块具有基本的刷怪功能吧！：)。\n\n使你的MOD具有基本的刷怪功能：\n首先，刷怪笼需要一个继承自TileEntity的子类，用于储存所刷生物和刷怪间隔和刷新间隔计数。\n/**知识点：什么是TileEntity\nTileEntity也能算一种实体，只不过它是一种特殊的实体，而且不继承自Entity，用于记录方块的附加信息，比如箱子里的物品等，它与方块紧密相连，另外还可以对这个实体进行渲染。\n**/\n在myFirstMod包下新建包TileEntity，再新建一个类，命名为TileEntityAdvancedMobSpawner，出于简单考虑，继承自TileEntityMobSpawner，输入以下内容：\npackage myFirstMod.TileEntity;\n\nimport java.lang.reflect.Field;\n\nimport net.minecraft.entity.Entity;\nimport net.minecraft.entity.EntityList;\nimport net.minecraft.tileentity.TileEntityMobSpawner;\n\npublic class TileEntityAdvancedMobSpawner extends TileEntityMobSpawner\n{\n    private Field minSpawnDelayField;\n    private Field maxSpawnDelayField;\n    private Field cachedEntity;\n    private Field spawnerTags;\n    private Field mobID;\n    public TileEntityAdvancedMobSpawner()\n    {\n        Class<TileEntityMobSpawner> TileEntityMobSpawnerClass =TileEntityMobSpawner.class;\n        try\n        {\n            minSpawnDelayField = TileEntityMobSpawnerClass.getDeclaredField(\"minSpawnDelay\");\n            minSpawnDelayField.setAccessible(true);\n            maxSpawnDelayField = TileEntityMobSpawnerClass.getDeclaredField(\"maxSpawnDelay\");\n            maxSpawnDelayField.setAccessible(true);\n            cachedEntity = TileEntityMobSpawnerClass.getDeclaredField(\"field_92017_j\");\n            cachedEntity.setAccessible(true);\n            spawnerTags = TileEntityMobSpawnerClass.getDeclaredField(\"spawnerTags\");\n            spawnerTags.setAccessible(true);\n            mobID = TileEntityMobSpawnerClass.getDeclaredField(\"mobID\");\n            mobID.setAccessible(true);\n        }\n        catch (Exception e)\n        {\n            e.printStackTrace();\n        }\n    }\n    public void setMobID(String id)\n    {\n        try\n        {\n            mobID.set(this, id);\n            cachedEntity.set(this, null);\n            spawnerTags.set(this, null);\n        }\n        catch (Exception e)\n        {\n            e.printStackTrace();\n        }\n    }\n    public String getMobID()\n    {\n        try\n        {\n            if(((Entity)cachedEntity.get(this)) != null)\n            {\n                return EntityList.getEntityString(((Entity)cachedEntity.get(this)));\n            }\n            else\n            {\n                return func_92015_a();\n            }\n        }\n        catch (Exception e)\n        {\n            e.printStackTrace();\n            return null;\n        }\n    }\n    public int getSpawnDelay()\n    {\n        try\n        {\n            int max = ((Integer)maxSpawnDelayField.get(this)).intValue();\n            int min = ((Integer)minSpawnDelayField.get(this)).intValue();\n            return min + (max - min) / 2;\n        }\n        catch (Exception e)\n        {\n            e.printStackTrace();\n        }\n        return 0;\n    }\n    public void setSpawnDelay(int value)\n    {\n        try\n        {\n            maxSpawnDelayField.set(this, value);\n            minSpawnDelayField.set(this, value);\n            if(delay > value)\n            {\n                delay = value;\n            }\n        }\n        catch (Exception e)\n        {\n            e.printStackTrace();\n        }\n    }\n    public int getMaxSpawnDelay()\n    {\n        try\n        {\n            return ((Integer)maxSpawnDelayField.get(this)).intValue();\n        }\n        catch (Exception e)\n        {\n            e.printStackTrace();\n        }\n        return 0;\n    }\n    public int getMinSpawnDelay()\n    {\n        try\n        {\n            return ((Integer)minSpawnDelayField.get(this)).intValue();\n        }\n        catch (Exception e)\n        {\n            e.printStackTrace();\n        }\n        return 0;\n    }\n    public void setMaxSpawnDelay(int value)\n    {\n        try\n        {\n            maxSpawnDelayField.set(this, value);\n        }\n        catch (Exception e)\n        {\n            e.printStackTrace();\n        }\n    }\n    public void setMinSpawnDelay(int value)\n    {\n        try\n        {\n            minSpawnDelayField.set(this, value);\n        }\n        catch (Exception e)\n        {\n            e.printStackTrace();\n        }\n    }\n}复制代码\n以上的公共实例方法主要是为了获取、设置刷怪间隔和所刷怪物，包括一些通过反射来越权访问。\n然后，在mod_myFirstMod的load方法里注册它：\n\nTileEntity.addMapping(TileEntityAdvancedMobSpawner.class, \"AdvancedMobSpawner\");复制代码\n现在，保存你的代码，并编译运行，你就可以用一个刷怪笼和8个钻石得到一个高级刷怪笼，虽然和普通刷怪笼看上去没啥区别。\n\n总结：\n这一章里，我们让我们的高级刷怪笼已经有了普通刷怪笼的功能，下一章里，我们将要为刷怪笼能够实现更多功能做准备，建立我们的网络通信框架！",
    "replies": [
        {
            "author": "王叙皓",
            "timestamp": 1374228720,
            "txt_content": "占沙发                    "
        },
        {
            "author": "huanghongxun",
            "timestamp": 1384664220,
            "txt_content": "问一下在updateEntity时肯定是要在world.isRemote时return掉的。\n但是客户端的tileEntity和服务端的tileEntity是不一样的。\n怎么使两个tileEntity相互通信（如果onDataPacket是接收，怎么发送packet给客户端的TileEntity）？\n看了BuildCraft、RailCraft的源代码，但是看不太懂，IC2的也一样看不懂。。CompactWindmills干脆就直接在客户端和服务端都算一遍，但这是不可行的。\n"
        }
    ]
}