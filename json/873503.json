{
    "title": "forge代码转fabric失败",
    "author": "1a2s3d4f1",
    "replyCount": 3,
    "timestamp": 1560573420,
    "txt_content": " 本帖最后由 1a2s3d4f1 于 2019-6-15 12:46 编辑 \n\nfabric不能像forge一样有获取tps的指令，所以我尝试吧forge的tps获取指令移动到fabric，获取原码后修改了下就一直报错\nCommandGetTps.java:39: 错误: 需要';'复制代码forge代码：\nhttps://github.com/MinecraftForg ... and/CommandTps.java\n/*\n * Minecraft Forge\n * Copyright (c) 2016-2019.\n *\n * This library is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation version 2.1\n * of the License.\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this library; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n */\n\npackage net.minecraftforge.server.command;\n\nimport java.text.DecimalFormat;\nimport java.util.stream.Collectors;\nimport java.util.stream.StreamSupport;\n\nimport com.mojang.brigadier.builder.ArgumentBuilder;\nimport com.mojang.brigadier.exceptions.CommandSyntaxException;\nimport com.mojang.brigadier.exceptions.DynamicCommandExceptionType;\nimport net.minecraft.command.CommandSource;\nimport net.minecraft.command.Commands;\nimport net.minecraft.command.arguments.DimensionArgument;\nimport net.minecraft.util.text.TranslationTextComponent;\nimport net.minecraft.world.dimension.DimensionType;\n\nclass CommandTps\n{\n    private static final DynamicCommandExceptionType INVALID_DIMENSION = new DynamicCommandExceptionType(dim -> new TranslationTextComponent(\"commands.forge.tps.invalid\", dim, StreamSupport.stream(DimensionType.getAll().spliterator(), false).map(d -> DimensionType.getKey(d).toString()).sorted().collect(Collectors.joining(\", \"))));\n    private static final DecimalFormat TIME_FORMATTER = new DecimalFormat(\"########0.000\");\n\n    static ArgumentBuilder<CommandSource, ?> register()\n    {\n        return Commands.literal(\"tps\")\n            .requires(cs->cs.hasPermissionLevel(0)) //permission\n            .then(Commands.argument(\"dim\", DimensionArgument.getDimension())\n                .executes(ctx -> sendTime(ctx.getSource(), DimensionArgument.func_212592_a(ctx, \"dim\")))\n            )\n            .executes(ctx -> {\n                for (DimensionType dim : DimensionType.getAll())\n                    sendTime(ctx.getSource(), dim);\n\n                double meanTickTime = mean(ctx.getSource().getServer().tickTimeArray) * 1.0E-6D;\n                double meanTPS = Math.min(1000.0/meanTickTime, 20);\n                ctx.getSource().sendFeedback(new TranslationTextComponent(\"commands.forge.tps.summary.all\", TIME_FORMATTER.format(meanTickTime), TIME_FORMATTER.format(meanTPS)), true);\n\n                return 0;\n            }\n        );\n    }\n\n    private static int sendTime(CommandSource cs, DimensionType dim) throws CommandSyntaxException\n    {\n        long[] times = cs.getServer().getTickTime(dim);\n\n        if (times == null)\n            throw INVALID_DIMENSION.create(DimensionType.getKey(dim));\n\n        double worldTickTime = mean(times) * 1.0E-6D;\n        double worldTPS = Math.min(1000.0 / worldTickTime, 20);\n        cs.sendFeedback(new TranslationTextComponent(\"commands.forge.tps.summary.named\", dim.getId(), DimensionType.getKey(dim), TIME_FORMATTER.format(worldTickTime), TIME_FORMATTER.format(worldTPS)), true);\n\n        return 1;\n    }\n\n    private static long mean(long[] values)\n    {\n        long sum = 0L;\n        for (long v : values)\n            sum += v;\n        return sum / values.length;\n    }\n}复制代码我搞得代码：\n\n\n\nCommandGetTps.zip\n(1.15 KB, 下载次数: 0)\n\n\n\n2019-6-15 12:36 上传\n点击文件名下载附件\n\n\n\n\n\n\nclass CommandGetTps\n{\n    private static final DynamicCommandExceptionType INVALID_DIMENSION = new DynamicCommandExceptionType(dim -> new TranslatableComponent(\"commands.forge.tps.invalid\", dim, StreamSupport.stream(DimensionType.getAll().spliterator(), false).map(d -> DimensionType.getId(d).toString()).sorted().collect(Collectors.joining(\", \"))));\n    private static final DecimalFormat TIME_FORMATTER = new DecimalFormat(\"########0.000\");\n\n    static ArgumentBuilder<CommandSource, ?> register()\n    {\n        return CommandManager.literal(\"gettps\")\n                .requires(cs->cs.hasPermissionLevel(0)) //permission\n                .then(CommandManager.argument(\"dim\", DimensionArgumentType.getDimensionArgument())\n                        .executes(ctx -> sendTime(ctx.getSource(), DimensionArgumentType.create(ctx, \"dim\")))\n                )\n                .executes(ctx -> {\n                            for (DimensionType dim : DimensionType.getAll())\n                                sendTime(ctx.getSource(), dim);\n\n                            double meanTickTime = mean(ctx.getSource().getWorld()).tickTimeArray) * 1.0E-6D;\n                            double meanTPS = Math.min(1000.0/meanTickTime, 20);\n                            ctx.getSource().sendFeedback(new TranslatableComponent(\"commands.tps.info\", TIME_FORMATTER.format(meanTickTime), TIME_FORMATTER.format(meanTPS)), true);\n\n                            return 0;\n                        }\n                );\n    }\n\n    private static int sendTime(CommandSource cs, DimensionType dim) throws CommandSyntaxException\n    {\n        long[] times = cs.getCompletions().getTickTime(dim);\n\n        if (times == null)\n            throw INVALID_DIMENSION.create(DimensionType.getId(dim));\n\n        double worldTickTime = mean(times) * 1.0E-6D;\n        double worldTPS = Math.min(1000.0 / worldTickTime, 20);\n        cs.hasPermissionLevel(new TranslatableComponent(\"commands.tpsmod.tps.summary.named\", dim.getId(), DimensionType.getId(dim), TIME_FORMATTER.format(worldTickTime), TIME_FORMATTER.format(worldTPS)), true);\n\n        return 1;\n    }\n\n    private static long mean(long[] values)\n    {\n        long sum = 0L;\n        for (long v : values)\n            sum += v;\n        return sum / values.length;\n    }\n}复制代码\n\n",
    "replies": [
        {
            "author": "森林蝙蝠",
            "timestamp": 1560577200,
            "txt_content": "你用的是哪一版的fabric？我用最新的fabric对了一下，发现你这个代码参数是错的。"
        },
        {
            "author": "2131886605qq",
            "timestamp": 1560602340,
            "txt_content": "666666666666666"
        },
        {
            "author": "l89669",
            "timestamp": 1562217420,
            "txt_content": "你会java吗？"
        }
    ]
}