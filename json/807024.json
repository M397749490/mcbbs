{
    "title": "技能冷却倒计时",
    "author": "2609848420",
    "replyCount": 4,
    "timestamp": 1531907400,
    "txt_content": "我想做一些被动触发的技能\n就比如连续攻击3次 就会额外造成一次伤害 然后有10秒的冷却时间\n也就是10秒后才能再次触发该被动\n\n还有就是怎么判断连续3次攻击 我的想法是每次攻击不得间隔超过2秒\n否则计数器归零",
    "replies": [
        {
            "author": "qq111222sb",
            "timestamp": 1531913460,
            "txt_content": "可以用配置文件存储Long时间戳来实现，最近刚写完一个技能插件，冷却也是这样做的，详细可以私聊"
        },
        {
            "author": "a8105",
            "timestamp": 1531922640,
            "txt_content": "HashMap<String,Long> lastDamageTime=new HashMap<>();\nHashMap<String,Integer> lastDamageCount=new HashMap<>();\n首先用EntityDamageByEntityEvent事件\n判断攻击者是否属于玩家\n如果属于则:\n  Long lastDamage=lastDamageTime.get(player.getName());\n  //如果有效连击的时间是null或System.currentTimeMillis()大于有效连击时间,则连击失败\n  if(lastDamage==null || System.currentTimeMillis()>lastDamage)\n  {\n    //这里是连续攻击判断不通过\n    //重新第一次攻击\n    //对于时间的判断主要是利用好System.currentTimeMillis()方法,他对于判断cd等是很方便的一个东西\n    //这一行的代码是往map里put新的有效连击时间,2000=2000毫秒=2秒\n    //在2秒内调用的System.currentTimeMillis()都不会大于这个值\n    lastDamageTime.put(player.getName(),System.currentTimeMillis()+2000L);\n    //由于判断连击已经失效,不需要增加连击次数,无脑塞个1进去即可\n    lastDamageCount.put(player.getName(),1);\n  }\n  //其他两项判断不成立,这里则是连击判断通过\n  else\n  {\n    //如果你想要每次连击都会刷新2秒的攻击连击判断,这一行必不可少\n    lastDamageTime.put(player.getName(),System.currentTimeMillis()+2000L);\n    //这里就是上次的连击次数了,应该对他再次进行+1\n    //然后判断int>你要的连击次数然后执行其他代码这么简单的应该不需要贴出代码了吧\n    Integer damageCount=lastDamageCount.get(player.getName());\n    \n  }"
        },
        {
            "author": "RaycusMX",
            "timestamp": 1531927560,
            "txt_content": " 本帖最后由 RaycusMX 于 2018-7-18 23:48 编辑 \n\n    public static class SkillData {                public long 上次攻击时间 = -1;        public int 连击数 = 0;        public long 冷却开始时间 = -1;                public void attack() {            long current = System.currentTimeMillis();            if (冷却开始时间 == -1 || current - 冷却开始时间 >= 10000) {                if (上次攻击时间 == -1 || current - 上次攻击时间 < 2000) {                    if (++连击数 >= 3) {                        连击数 = 0;                        冷却开始时间 = current;                        skill();                    }                } else {                    连击数 = 1;                }                上次攻击时间 = current;            }        }                public void skill() {            //TODO 施放技能        }            }       private Map<String, SkillData> map = new HashMap<>();       //你的攻击监听器    public void onAttack(String player) {        SkillData data = map.get(player);        if (data == null) {            map.put(player, data = new SkillData());        }        data.attack();    }提供一种写法给楼主？两次间隔不超过2秒的连击达到3次时释放技能并冷却10秒，间隔超过2秒时连击数归1。\n"
        },
        {
            "author": "RaycusMX",
            "timestamp": 1531928460,
            "txt_content": "810587921 发表于 2018-7-18 22:04\nHashMap lastDamageTime=new HashMap();\nHashMap lastDamageCount=new HashMap();\n首先用EntityDamageByEnt ...\n应该还差个技能冷却？"
        }
    ]
}