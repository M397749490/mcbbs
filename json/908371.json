{
    "title": "[前置|信息]ServerPingLib —— 直接通过IP地址获取目标服务器信息[全版本]",
    "author": "TRCRedstoner",
    "replyCount": 13,
    "timestamp": 1566803520,
    "txt_content": " 本帖最后由 迪安小弱渣 于 2019-12-14 21:52 编辑 \n这个API库的开发简介\n\n[size=14.6667px]在编写这个插件的过程中，我本来是打算只是将它做成一个可以独立运作的程序，但因为我本人以往都在做Bukkit与Bungee插件的开发，所以我还是让它可以在bungecord、spigot和bukkit服务器上运作，这可能没有什么实际作用，但毕竟林子一大什么鸟都能有（例如可以做一个不需要通过BungeeCord来获取子服务器在线人数的插件 [滑稽]）。\n\n[size=14.6667px]\n\n这个API库能做什么？\n\n[size=14.6667px]\n这个API库可以伪造一道假的协议连接，直接读取指定IP地址的Minecraft服务器的信息，而不需要通过Minecraft客户端，并且它可以独立运作，开发者可以导入到IDE库内并直接使用其API。\n[size=14.6667px]\n\n[size=14.6667px]\n\n\n这个API库支持哪些功能？\n[size=14.6667px]\n支持使用在目标为 MineCraft 1.7.2 - 1.15 （或者更高的版本，等待慢慢更新）的服务器上支持读取服务器的MOTD信息支持使用在域名为SRV解析的服务器支持读取最基本的信息（在线人数、最大在线、服务器版本、核心信息等）支持获取目标服务器的模组列表与他们的版本（需要目标服务器本身支持安装Mod）支持获取目标服务器的样本（Samples，这个我实在不知道应该翻译成什么，至于这是什么东西请看下边的截图）支持获取目标服务器的图标，并且可以将它保存到本地目录上（效果请看下边截图）在读取文字类信息的时候，不会丢失彩色字体效果可自定义流的字符编码（默认UTF-8，能显示中文）\n[size=14.6667px]\n\n\n\n\n效果图：\n\n查询Hypixel的信息（来自插件TRCStudioServerTeleport 基于API库编写的跨服插件）\n\n\n\n\n\nQQ图片20190826145902.png (97.76 KB, 下载次数: 0)\n\n下载附件\n\n2019-8-26 14:58 上传\n\n\n\n\n\n\n查询EarthMC服务器的信息（国外著名的正版小游戏服务器，主要是给各位看看SRV解析的效果 [原IP地址earthmc.net]）\n\n\n\n\n\nQQ图片20190826150144.png (14.81 KB, 下载次数: 0)\n\n下载附件\n\n2019-8-26 15:01 上传\n\n\n\n\n\n\n查询Badlion服务器的信息（已关闭的国外正版PVP服务器，给各位看看上边说的“样品”指的是什么）\n\n\n\n\n\nQQ图片20190826150456.png (36.52 KB, 下载次数: 0)\n\n下载附件\n\n2019-8-26 15:05 上传\n\n\n\n\n\n\n\n\n\nQQ图片20190826150659.png (41.37 KB, 下载次数: 0)\n\n下载附件\n\n2019-8-26 15:06 上传\n\n\n\n\n\n\n更多的请看下边介绍\n\n\n\n\n开发者食用的API与方法列表：\n\nstudio.trc.minecraft.serverpinglib.API.MCServerSocket: 操控服务器的连接\n方法列表：\n[size=14.6667px][size=14.6667px]\n[size=14.6667px]public String getIP() 获取IP地址public int getPort() 获取端口public boolean isOnline() 目标服务器是否在线public boolean isSRVDomainName() 目标服务器的域名地址是否使用了SRV解析public MCServerStatus getStatus() 获取MCServerStatus实例public MCServerStatus getStatus(ProtocolVersion version) 使用指定协议版本获取MCServerStatus实例public Socket getSocket() 获取Socket类实例public static MCServerSocket getInstance(String ip, int port, int timeout) 连接到服务器public static MCServerSocket getInstance(String ip, int port) 同上\n[size=14.6667px][size=14.6667px]\n\nstudio.trc.minecraft.serverpinglib.API.MCServerStatus: 获取目标服务器的各个信息\n[size=14.6667px]方法列表：\n[size=14.6667px][size=14.6667px]\n[size=14.6667px]public int getMaxPlayers() 获取最大在线人数public int getOnlinePlayers() 获取当前在线人数public int getServerProtocolNumber() 获取服务器协议号public int getProtocolNumber() 获取你所使用的协议号（这取决于getStatus()时括号中填写的协议，若填无即为最新版本）public String getVersion() 获取服务器版本public String getProtocolVersion() 获取你的协议版本public String getStringJson() 获取服务器Json信息public MCServerModInfo getModInfo() 获取MCServerModInfo实例public MCServerMotd getMotd() 获取MCServerMotd实例public MCServerSample getSample() 获取MCServerSample实例public MCServerIcon getIcon() 获取MCServerIcon实例public boolean isMCServer() 目标服务器是否为MC服务器public boolean supportVersion() 若使用与连接协议版本一致的客户端能否进入该服务器public static MCServerStatus getStatus(MCServerSocket mcsocket) 获取实例public static MCServerStatus getStatus(MCServerSocket mcsocket, ProtocolVersion version) 使用指定版本获取协议\n[size=14.6667px][size=14.6667px]\n\nstudio.trc.minecraft.serverpinglib.API.MCServerSample: 获取服务器样品（所以说sample应该翻译成什么比较好呢）\n方法列表：\n[size=14.6667px]\n[size=14.6667px]public List<SampleText> getSampleList() 获取样品集合实例public boolean hasSample() 是否拥有样本内部类    SampleText:    public String getID() 获取样本的UUIDpublic String getName() 获取样本的内容或名字public String get(SampleEnum object) （SampleEnum是一个枚举类，里边有两个枚举选项 ID和NAME）获取指定样品目标信息public String getColorID() 同上获取UUID，但保留彩色字体public String getColorName() 同上获取内容或名字，保留彩色字体public String getColor(SampleEnum object) 同上...\n[size=14.6667px][size=14.6667px]\n\nstudio.trc.minecraft.serverpinglib.[size=14.6667px]API.MCServerModInfo: 获取服务器模组信息\n方法列表：\n[size=14.6667px]\n\n[size=14.6667px]public boolean hasModInfo() 目标服务器是否存在模组信息（目标是Bungee服务器的话会返回true，但不一定有模组）public boolean hasMod() 目标服务器是否安装了模组public String getModType() 获取模组Json信息public List<MCMod> getModList() 获取MCMod的实例列表内部类：    MCMod:    public String getVersion() 获取模组的版本    public String getModId() 获取模组的名字 & ID\n[size=14.6667px][size=14.6667px]\n\nstudio.trc.minecraft.serverpinglib.API.MCServerMotd: 获取服务器的MOTD信息\n方法列表：\n[size=14.6667px]\n[size=14.6667px]public String getMotdText() 获取服务器的MOTD（包含换行符号）public String getColorMotdText() 获取服务器的MOTD（保留彩色字体）public String getLine1MotdText() 获取服务器第一行MOTDpublic String getLine2MotdText() 获取服务器第二行MOTDpublic String getLine1ColorMotd() 同上，保留彩色字体public String getLine2ColorMotd() 同上，保留彩色字体（人类本质[确信]）\n\n[size=14.6667px][size=14.6667px]\n\nstudio.trc.minecraft.serverpinglib.[size=14.6667px]API.MCServerMotd: 获取服务器的图标\n方法列表：\n[size=14.6667px][size=14.6667px]\n[size=14.6667px]public void saveImageFile(File file) 将图标保存到本地（如果文件不存在，将自动创建）public void saveImageFile(String path) 同上，但这里是直接填写文件地址的public boolean hasServerIcon() 是否存在服务器图标public String getBase64Image() 获取Base64格式的服务器图标信息public byte[] getImageBytes() 获取图标的字节组\n[size=14.6667px][size=14.6667px]\n[size=14.6667px]\n\n示例代码\n[size=14.6667px][size=14.6667px]\n    public static void main(String[] args) {\n        MCServerSocket socket = MCServerSocket.getInstance(\"play.trc-studio.com\", 25565);\n        if (socket == null) {\n            System.out.println(\"无法连接到服务器!\");\n            return;\n        }\n        MCServerStatus status = socket.getStatus(ProtocolVersion.v1_8_X);\n        if (!status.isMCServer()) {\n            System.out.println(\"这不是一个MineCraft服务器.\");\n            return;\n        }\n        System.out.println(\"服务器IP: \" + socket.getIP() + \":\" + socket.getPort());\n        System.out.println(\"是否使用SRV域名解析: \" + socket.isSRVDomainName());\n        System.out.println(\"服务器版本: \" + status.getVersion());\n        System.out.println(\"你的协议号码: \" + status.getProtocolNumber());\n        System.out.println(\"目标服务器的协议号码: \" + status.getServerProtocolNumber());\n        System.out.println(\"协议版本: \" + status.getProtocolVersion());\n        System.out.println(\"是否支持当前协议的客户端进入服务器: \" + status.supportVersion());\n        System.out.println(\"最大在线人数: \" + status.getMaxPlayers());\n        System.out.println(\"当前在线人数: \" + status.getOnlinePlayers());\n        if (status.getSample().hasSample()) { //是否存在样品\n            System.out.println(\"样品列表: \");\n            for (SampleText st : status.getSample().getSampleList()) {\n                System.out.println(st.getName()); //只获取样品的名字或内容\n            }\n        }\n        System.out.println(\"MOTD: \");\n        System.out.println(status.getMotd().getLine1MotdText()); //第一行MOTD\n        System.out.println(status.getMotd().getLine2MotdText()); //第二行MOTD\n        if (status.getIcon().hasServerIcon()) { //服务器是否拥有图标\n            status.getIcon().saveImageFile(\"E:/程序用/TRCStudio.png\"); //保存图标文件到 E:/程序用/TRCStudio.png\n            System.out.println(\"已保存服务器图标到 E:/程序用/TRCStudio.png\"); \n        }\n        if (status.getModInfo().hasModInfo()) { //是否拥有模组信息\n            if (status.getModInfo().hasMod()) { //是否安装了模组\n                System.out.println(\"Mods\");\n                for (MCMod mods : status.getModInfo().getModList()) {\n                    System.out.println(mods.getModId() + \", v\" + mods.getVersion()); //输出模组信息， 格式为“模组ID, v版本号”\n                }\n            }\n        }\n    }\n[size=14.6667px][size=14.6667px][size=14.6667px]\n\n\n[size=14.6667px]在上述代码中，play.trc-studio.com是我服务器的IP地址（别说我恶意宣传，我在mcbbs有自己的服务器宣传贴）。可以使用其他服务器的IP地址代替它并获取它们的信息。\n[size=14.6667px]PS：建议不要在主线程中使用MCServerSocket.getInstance()方法。如果目标服务器连接时间过长，可能会导致主线程长时间不响应，甚至造成其他不必要的后果。\n\n代码执行后输出的结果：\n[size=14.6667px]\n服务器IP: play.trc-studio.com:25565\n是否使用SRV域名解析: false\n服务器版本: TRCStudio 1.7.x-1.14.x\n你的协议号码: 47\n目标服务器的协议号码: 47\n协议版本: 1.8.X\n是否支持当前协议的客户端进入服务器: true\n最大在线人数: 2048\n当前在线人数: 27\nMOTD: \n=> TRC Studio 国际 | 1.7.2 - 1.15 <=\n[!] 生存服玩家小镇计划进行中！ 传送点/res tp csz(广告)\n已保存服务器图标到 E:/程序用/TRCStudio.png\n\n服务器图标保存的效果：\n\n\n\n\nQQ图片20190826145046.png (9.79 KB, 下载次数: 0)\n\n下载附件\n\n2019-8-26 14:50 上传\n\n\n\n\n\n[size=14.6667px]\n[size=14.6667px]\n\n[size=14.6667px]其他类简介:\n[size=14.6667px]ProtocolNumber: 操控协议号码\n[size=14.6667px]ProtocolVersion: 协议版本的枚举常量列表\n[size=14.6667px]ProtocolPacket: 协议包信息\n[size=14.6667px]Encoding: 操控返回流的字符编码\n[size=14.6667px]\n\n\n\n本插件所用所有代码均为原创,不存在借用/抄袭等行为\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "TRCRedstoner",
            "timestamp": 1566803820,
            "txt_content": "为什么排版又乱了，还出现了一大堆编辑帖子时不存在的代码"
        },
        {
            "author": "我觉得很淦",
            "timestamp": 1566811860,
            "txt_content": "不会制作插件 但还是支持一下"
        },
        {
            "author": "TRCRedstoner",
            "timestamp": 1576336020,
            "txt_content": "更新至1.1.0版本"
        },
        {
            "author": "1622784146",
            "timestamp": 1578506640,
            "txt_content": "怎么没有找到下载地址呢？"
        },
        {
            "author": "Itsusinn",
            "timestamp": 1583317620,
            "txt_content": "很不错的插件"
        },
        {
            "author": "战神你史哥",
            "timestamp": 1584711180,
            "txt_content": "能不能把下载文件直接放在mcbbs呢。。。。。。去外网都进不去"
        },
        {
            "author": "2722008080",
            "timestamp": 1586259600,
            "txt_content": "感谢楼主的\n分享"
        },
        {
            "author": "Aurora211",
            "timestamp": 1593483180,
            "txt_content": "请问这个可以用php网页调用显示在线人数吗？"
        },
        {
            "author": "TRCRedstoner",
            "timestamp": 1593489300,
            "txt_content": "Aurora211 发表于 2020-6-30 10:13\n请问这个可以用php网页调用显示在线人数吗？\n可以，前提是你能配合得好"
        },
        {
            "author": "南桥南阳",
            "timestamp": 1598572020,
            "txt_content": "感谢楼主分享"
        },
        {
            "author": "ml0834666",
            "timestamp": 1609511940,
            "txt_content": "与LuckPerms冲突。"
        },
        {
            "author": "345308145",
            "timestamp": 1612072140,
            "txt_content": "这么好的插件这么不能支持一下哒"
        },
        {
            "author": "1091692594",
            "timestamp": 1612076700,
            "txt_content": "1.16.4完美支持"
        }
    ]
}