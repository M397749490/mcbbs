{
    "title": "Dialect - 就算是服务端也可以本地化！",
    "author": "阿淼",
    "replyCount": 6,
    "timestamp": 1536625020,
    "txt_content": " 本帖最后由 阿淼 于 2018-9-11 08:57 编辑 \n\n\n\nDialect在服务端做本地化也可以如此轻松\n\nAquarink 工作室出品\n\n\n\n我一开始还打算发布一个插件后来发现这个模块实在是太小太小了于是就直接发源码好了\n甚至连 Github 我都不想发 :\\\n\n\n- Dialect 是什么？ -\n\nDialect 的意思是“方言”，实际上是用于本地化的。\n由于 Forge 已经提供了本地化，所以客户端不再需要。\n它可以让你的服务端插件依照玩家的设置支持多种语言，不再需要在设置中设置一种固定的语言啦！\n如果你想让你的插件走向国际化，试试这个模块吧！\n\n\n\n- 怎么使用 Dialect？-\n\n它没有依赖 Spigot 的任何库，所以你需要自己麻烦麻烦了噢\n\n1. 语言文件\n每一行都是一个翻译项。key=value复制代码例如title.container.treasure=藏宝箱复制代码它和 Forge 的语言文件是基本一致的。虽然你不一定把它存成zh_CN.lang，但是我们推荐你这么做。\n\n2. Dialect 对象你可以创建多个对象，但是这样对于单个插件并没有什么X用。DialectManager dialect = new DialectManager();复制代码你可以将它放在你的 JavaPlugin 中作为一个成员变量，然后在需要的时候获得它\npublic static DialectManager getDialect() { return instance.dialect; }复制代码\n\n3. 加载语言\n创建了 Dialect 对象还需要加载语言噢\n这里有三种加载方式\n\n通过文件加载dialect.addDialect(/* 你的语言名字，例如zh_CN */ \"zh_CN\", /* 你的文件 */ new File(\"lang\\zh_CN.lang\", plugin.getDataFolder()));复制代码\n通过保存为字节数组的方式加载dialect.addDialect(\"zh_CN\", ByteBuffer.wrap(bytes));复制代码\n当然还有通过 Map 直接加载Map<String, String> lang = new HashMap<>();复制代码\n\n4. 重载语言\n重载一个语言需要先把原来的语言移除后再加载，否则将无法移除一些被移除的翻译dialect.removeDialect(\"zh_CN\");复制代码\n\n5. 看看哪些翻译没有被支持？\n通过调用dialect.getUnsupportedKeys(\"zh_CN\");复制代码就可以知道那些翻译别的语言支持但是中文不支持啦！\n\n6. Spigot Integration!\n当然，我们的 Dialect 是要和服务端结合的！当我们要给玩家发送一段消息时player.sendMessage(dialect.getLocalizedTextOrDefault(player.getLocale(), \"message.hello\", \"Hello! \"));复制代码我们可以通过player.getLocale(); // 老版本为 player.spigot().getLocale();复制代码获得玩家的语言设置！\n\n7. 非阻塞设计\n\n如果我们直接加载一个语言文件，会导致 IO 阻塞 Minecraft 服务器的主线程，导致顿卡。我们可以用另外一个线程来加载它！<div align=\"center\"><p style=\"line-height: 30px; text-indent: 2em;\"></p><div align=\"center\" style=\"text-align: left; \">Bukkit.getScheduler.runTaskAsynchronously(() -> {</div><div align=\"center\" style=\"text-align: left; \">    try {</div><div align=\"center\" style=\"text-align: left; \">        dialect.addDialect(\"zh_CN\", new File(\"lang\\zh_CN\", plugin.getDataFolder()));</div><div align=\"center\" style=\"text-align: left; \">    } catch(IOException ex) {</div><div align=\"center\" style=\"text-align: left; \">        doSomething();</div><div align=\"center\" style=\"text-align: left; \">    }</div><div align=\"center\" style=\"text-align: left; \">});</div></div>复制代码\n\n\n当然，从另外一个线程为 Dialect 加入一个语言是不安全的，所以我们要创建一个线程安全的版本！DialectManager dialect = new ConcurrentDialectManager();复制代码这下就安全了！\n\n\n\n- 我可以在哪里找到 Dialect 的源码？ -\n\n我懒得传 GitHub 了，在这里下吧emmm\n\n\n\n\ndialect-src.zip\n(3.65 KB, 下载次数: 3)\n\n\n\n2018-9-11 08:14 上传\n点击文件名下载附件\nDialect 源码\n\n\n\n\n\n\n\n让你的插件走向国际化吧！\n\n附：\n\n什么是线程安全（侵删）：https://www.cnblogs.com/shynshyn/p/7966409.html\n\n上一个发布的项目：SecureCustomPacket，让你的 SimpleMessage 安全起来\n\n下一个将发布的项目：Realtime，让玩家的进度不再被 TPS 拖累\n\n重磅项目预告：MineIO，面向对象的储存与通信库\n\n\n\n版权归 Aquarink 所有。\n插代码会乱码的问题希望有关部门能管管。\n\n",
    "replies": [
        {
            "author": "gooding300",
            "timestamp": 1536643680,
            "txt_content": "请检查一下格式，我这里未能正常显示所有代码\n以及建议传到Github上"
        },
        {
            "author": "阿淼",
            "timestamp": 1536646200,
            "txt_content": "gooding300 发表于 2018-9-11 13:28\n请检查一下格式，我这里未能正常显示所有代码\n以及建议传到Github上\n我检查格式了，重新保存又会变成这样"
        },
        {
            "author": "缤纷的烟火",
            "timestamp": 1536661500,
            "txt_content": "完全没看懂啊"
        },
        {
            "author": "阿淼",
            "timestamp": 1536702540,
            "txt_content": "缤纷的烟火 发表于 2018-9-11 18:25\n**** 作者被禁止或删除 内容自动屏蔽 ****\n没看懂的部分私信我或者发我邮箱Kelvely@inkme.cc或者在这里留言，你的意见可以帮助到很多人噢！"
        },
        {
            "author": "Kyokuki",
            "timestamp": 1536703440,
            "txt_content": "建议上传到Github,mcbbs有长度限制"
        },
        {
            "author": "阿淼",
            "timestamp": 1536705780,
            "txt_content": "残雪、 发表于 2018-9-12 06:04\n建议上传到Github,mcbbs有长度限制\nokk那我待会传"
        }
    ]
}