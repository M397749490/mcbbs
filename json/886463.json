{
    "title": "[PCD]爷爷都看得懂的从零开始的核心代码注入教程(三)",
    "author": "弱鸡绿毛怪",
    "replyCount": 6,
    "timestamp": 1563197400,
    "txt_content": " 2-1 前言 · 如果你没有看我的上一个教程，请先去看一下.\n                  >>>点我跳转 <<<\n· 本教程所有源码都是开源的，而且你可以任意使用。\n本次教程的两个开源地址:\nhttps://github.com/LocyDragon/Course2 (JavaAgent核心注入部分)\nhttps://github.com/LocyDragon/Course3_Plugin (插件部分)\n\n 2-2 学习目标 上次，我们说过，插件本体得和核心注入.jar分开来写。\n于是，我们尝试写一个核心注入联动插件的例子吧:\n当玩家收到一条信息时，我们让插件把这一条信息复读一遍，像这个样子:\n\n\n\n\n\nTIM截图20190715205420.jpg (7.96 KB, 下载次数: 0)\n\n下载附件\n\n2019-7-15 20:54 上传\n\n\n\n\n\n(?)你问我为什么复读的信息在收到的信息之前\n这是因为监听sendMessage的时候，我们监听的地方在信息发送给玩家之前，当然你也可以监听在发送给玩家之后.\n当你监听在发送给玩家之前时，你甚至可以取消这条信息，就像event.setCancelled()方法一样\n\n 2-3 实现     众所周知，插件可以直接调用核心里的方法，来实现一些奇奇怪怪的东西。但是核心却不能直接调用插件，必须通过反射来实现。根本原因就是插件被加载进了PluginClassLoader里(见上一章)\n\n 首先，我们和第一章一样，写一个核心注入\n\n\n\n\n\nTIM截图20190715205734.jpg (222.67 KB, 下载次数: 0)\n\n下载附件\n\n2019-7-15 20:57 上传\n\n\n\n\n\n实际上和第一章的代码差不了太多，因为监听的是同一个类的同一个方法(sendMessage)，如果这里看不懂可以回第一章去看看   >>> 点我 <<<\n改变的两个地方:\n· 前面import的包变了\n· 底下注入的代码改了\n我们看一下这注入的代码:\n\n\n\n\n\nTIM截图20190715212225.jpg (44.87 KB, 下载次数: 0)\n\n下载附件\n\n2019-7-15 21:22 上传\n\n\n\n\ntry {\nJavaPlugin plugin = Bukkit.getPluginManager().getPlugin(\"TestPlugin\");\nMethod method = plugin.getClass().getMethod(\"onCall\", new Class[] {Player.class, String.class});\nmethod.invoke(null, new Object[]{(Player)this, $1});\n} catch (Exception e) {}这段代码搞过反射的都看得懂吧。\n我们的对象插件名叫TestPlugin,我们通过反射，相当于在核心里，调用一下我们插件里的方法。\n注意，我们这个代码注入的类叫CraftPlayer,这个类实现了Player,所以(Player)this这么转过去时没有问题的\n注意，$1表示是第一个参数，比如我们监听的方法\nCraftPlayer.sendMessage(String message)\n这里的$1代表的就是这个message了\n\n\n\n\n\n\nTIM截图20190715212633.jpg (40.71 KB, 下载次数: 0)\n\n下载附件\n\n2019-7-15 21:26 上传\n\n\n\n\n而我们的主类很简单，就这么点代码，与上面在核心注入里写的反射内容相匹配，这样就实现了核心注入与插件本体联动的效果了。\n\n\n效果如上。\n\n插件本体下载:\n\n\n\n\nTestPlugin-1.0-SNAPSHOT.jar\n(3.21 KB, 下载次数: 1)\n\n\n\n2019-7-15 21:29 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n核心注入(JavaAgent)下载，记得改.bat里的JavaAgent参数!!\n\n\n\n\nTest1-1.0.0.jar\n(594.61 KB, 下载次数: 1)\n\n\n\n2019-7-15 21:30 上传\n点击文件名下载附件\n\n\n\n\n\n[groupid=1330]PluginsCDTribe[/groupid]",
    "replies": [
        {
            "author": "dark_cool233",
            "timestamp": 1563199980,
            "txt_content": "加油学!我自己去试了试,emmmmm"
        },
        {
            "author": "131082126",
            "timestamp": 1563200760,
            "txt_content": "MCBBS有你更精彩~"
        },
        {
            "author": "破晓大辣鸡",
            "timestamp": 1563201720,
            "txt_content": "那就叫你爷爷来，告诉他密码123\n哦不好意思我不行^"
        },
        {
            "author": "July_Summer",
            "timestamp": 1563232440,
            "txt_content": "这不是明年该更新的内容吗、\n咋更这么早"
        },
        {
            "author": "猿汐",
            "timestamp": 1563242100,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "wwf520",
            "timestamp": 1563252120,
            "txt_content": "小白路过了。。"
        }
    ]
}