{
    "title": "MCmod制作 1.11(5.优化物品使用)",
    "author": "zkm00323",
    "replyCount": 2,
    "timestamp": 1484545980,
    "txt_content": "上一张我们完成了血瓶的基本使用逻辑和功能\n但这还不够完美\n我希望他按住右键的时候可以像和药水一样有动作和声音\n呢么我们可以参照一下原版药水的代码来给我们的血瓶加入这个功能\n\n1.优化物品使用体验\n首先我们在ItemBloodsave里面重写getMaxItemUseDuration方法\n    public int getMaxItemUseDuration(ItemStack stack){\n        return 32;\n    }\n\n32就是32tick,1tick=1/20秒,所以等于要长按右键1.6秒才会触发onItemUseFinish方法\n再加上下面的方法\n    public EnumAction getItemUseAction(ItemStack stack){\n        return EnumAction.DRINK;\n    }\n\n\n物品正在使用时候执行DRINK动作\n\n再来我们在原本的onItemRightClick开头加入\n    public ActionResult<ItemStack> onItemRightClick(World world, EntityPlayer player, EnumHand handIn){\n        player.setActiveHand(handIn);\n\n右键则设定玩家正在使用手里(handIn)的物品\n\n把之前右键回血的代码提取出来放到onItemUseFinish方法里\npublic ItemStack onItemUseFinish(ItemStack item, World world, EntityLivingBase player) {\n            if(!world.isRemote){\n                    if(item.getTagCompound().getInteger(\"bloodsave\")>0 && !(player.getMaxHealth() == player.getHealth())){\n                                if(player.getMaxHealth()-player.getHealth()>item.getTagCompound().getInteger(\"bloodsave\")){\n                                        player.heal(item.getTagCompound().getInteger(\"bloodsave\"));  \n                                        item.getTagCompound().setInteger(\"bloodsave\", 0);\n                                }else{\n                                        item.getTagCompound().setInteger(\"bloodsave\",(item.getTagCompound().getInteger(\"bloodsave\")-(int)(player.getMaxHealth()-player.getHealth())));\n                                        player.setHealth(player.getMaxHealth()); \n                                }        \n                            ((EntityPlayer) player).addChatComponentMessage(new TextComponentString(\"bloodsave:\"+item.getTagCompound().getInteger(\"bloodsave\")), true);\n                        }  \n            }\n            return super.onItemUseFinish(item, world, player);\n    }\n\n我加了((EntityPlayer) player).addChatComponentMessage方法,这会在玩家物品栏上方显示信息\n\n呢么现在的onItemRightClick去除了补血方面的代码只留下扣血以及创建nbt的代码\n   public ActionResult<ItemStack> onItemRightClick(World world, EntityPlayer player, EnumHand handIn){\n       player.setActiveHand(handIn);\n                   if(!world.isRemote){\n                ItemStack item = player.getHeldItemMainhand();\n                    if(item.getTagCompound()==null){\n                            item.setTagCompound(new NBTTagCompound());\n                            NBTTagCompound nbt = new NBTTagCompound();\n                            nbt.setInteger(\"bloodsave\", 20);\n                            item.getTagCompound().setTag(\"blood\", nbt); \n                    }\n                    if(player.isSneaking() && item.getTagCompound().getInteger(\"bloodsave\")<20){\n                            int damage = new Random().nextInt(10)+1;                      \n                            int save = item.getTagCompound().getInteger(\"bloodsave\");\n                            player.setHealth(player.isCreative() ? player.getHealth()-0: player.getHealth()-damage);\n                            ((EntityPlayer) player).addChatComponentMessage(new TextComponentString(\"bloodsave:\"+item.getTagCompound().getInteger(\"bloodsave\")+\"+\"+damage/2), true);\n                            item.getTagCompound().setInteger(\"bloodsave\", save + damage/2 > 20 ? 20 : save + damage/2);     \n                            player.stopActiveHand();\n}else if(player.isSneaking() && item.getTagCompound().getInteger(\"bloodsave\")==20)\n                                    ((EntityPlayer) player).addChatComponentMessage(new TextComponentString(\"bloodsave:20\"), true);\n             }\n                   return new ActionResult(EnumActionResult.SUCCESS, player.getHeldItem(handIn));\n    }\n\n注意我加了player.stopActiveHand()停止玩家手里物品的使用,这样就不会再触发onItemUseFinish方法\n毕竟如果我们这一次动作是为了扣血,而不要补血\n而在扣血指令呢里我添加了一个判断 是否为创造模式?不扣血:扣血\n\n最后我们还可以给物品添加可视化信息\n    public void addInformation(ItemStack stack, EntityPlayer playerIn, List<String> tooltip, boolean advanced) {\n        NBTTagCompound nbt = stack.getTagCompound();\n        if (nbt != null && nbt.hasKey(\"bloodsave\"))\n        tooltip.add(\"bloodsave: \" + nbt.getInteger(\"bloodsave\"));\n            super.addInformation(stack, playerIn, tooltip, advanced);\n    }\n\n这样当你鼠标移到物品上时就会有bloodsave:XX这样的信息\n\n\n\n\nggg.jpg (10.44 KB, 下载次数: 0)\n\n下载附件\n\n2017-1-16 13:27 上传\n\n\n\n\n\n\n呢么这次的教程也就到此结束了\n不过我觉得还不够完美\n我希望物品贴图因应存血量而改变\n呢么我们就留到下一章实现吧\n\n源文件\n\n\n\nsrc_教程5.rar\n(5.93 KB, 下载次数: 23)\n\n\n\n2017-1-16 13:46 上传\n点击文件名下载附件\n覆盖src文件夹\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "thestronger",
            "timestamp": 1484567640,
            "txt_content": "Good,go go go ........."
        },
        {
            "author": "OP1115",
            "timestamp": 1489447320,
            "txt_content": "我就喜欢放源码的 直接 谢了老兄 666666666666666"
        }
    ]
}