{
    "title": "如何做到让旁观者模式玩家无法穿墙？",
    "author": "_XuanFsant_",
    "replyCount": 3,
    "timestamp": 1588943820,
    "txt_content": "如题，想做一个类似观战模式的东西，但苦于玩家在旁观者模式会穿墙导致可能会暴露服里隐藏的东西,在别的服务器看到了这样的操作，但是找了很久没找到合适的方法，来求解",
    "replies": [
        {
            "author": "William_Shi",
            "timestamp": 1588945500,
            "txt_content": "我目前想到2 种思路\n但估计都不是最好的选择\n姑且发出来请大佬指正\n\n\n1，直接给玩家发视角数据包\n就是说在某个地方生成一个不能穿墙的实体\n然后发视角数据包给玩家\n让玩家误以为自己移动了\n但实际上是自己视角附着的那个实体在动\n这样做不需要让玩家进旁观模式\n\n\n2，监听move\n然后玩家位置转为向量\nraytrace一下玩家的位置向量和玩家的velocity\n再使用向量的isinaabb判断是不是玩家位置在这个方块内"
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1588955940,
            "txt_content": " 本帖最后由 疾风暗影 于 2020-5-9 00:46 编辑 \n\n靠nms发数据包欺骗客户端可以实现此效果\n下面是1.15的代码，其他版本可能有细微区别\n\n    public static void setMode(Player sender) {\n        EntityPlayer ep = ((CraftPlayer)sender).getHandle();\n        PacketPlayOutPlayerInfo info = new PacketPlayOutPlayerInfo(PacketPlayOutPlayerInfo.EnumPlayerInfoAction.UPDATE_GAME_MODE, ep);\n        try {\n            Class clazz = info.getClass();\n            Field field = clazz.getDeclaredField(\"b\");\n            \n            List<PacketPlayOutPlayerInfo.PlayerInfoData> infos = new ArrayList<>();\n            infos.add(info.new PlayerInfoData(ep.getProfile(), ep.ping, EnumGamemode.CREATIVE, ep.listName));\n            \n            field.setAccessible(true);\n            field.set(info, infos);\n            ep.playerConnection.sendPacket(info);\n            PacketPlayOutGameStateChange packet2 = new PacketPlayOutGameStateChange(3, 3f);\n            ep.playerConnection.sendPacket(packet2);\n        } catch(Exception ex) {\n            \n        }\n    }复制代码"
        },
        {
            "author": "mr2044154518",
            "timestamp": 1589037120,
            "txt_content": "nms.Entity.noclip设置为false试试，服务端应该会在穿墙的时候拉回来\n（应该不是最优解）"
        }
    ]
}