{
    "title": "Sponge插件gradle项目设置问题",
    "author": "阴阳师元素祭祀",
    "replyCount": 4,
    "timestamp": 1540617960,
    "txt_content": " 本帖最后由 阴阳师元素祭祀 于 2018-10-27 13:30 编辑 \n\n附项目地址\nhttps://github.com/euOnmyoji/NewHonor\n\n\nQuestion 1\n如何让NewHonor-Sponge的build出来的jar包含Common的资源文件\n也就是↓这玩意\nhttps://github.com/euOnmyoji/NewHonor/tree/master/NewHonor-Common/src/main/resources/\n百度多次无果(可能我不太会搜索 g**gle???(抱歉我真没梯子qwq毕竟不想让每个子项目放重复的资源文件\n附: sponge 的build.gradlehttps://github.com/euOnmyoji/New ... Sponge/build.gradle\n\nQuestion 2\nNewHonor-Sponge项目build出来jar自带的mcmod.info \n会包含奇怪的玩意\n\n\n[\n    {\n        \"modid\": \"newhonor\",\n        \"name\": \"New Honor\",\n        \"version\": \"2.4.2\",\n        \"description\": \"NewHonor plugin\",\n        \"authorList\": [\n            \"yinyangshi\"\n        ],\n        \"dependencies\": [\n            \"placeholderapi\",\n            \"spongeapi@7.1.0\",\n            \"ultimatechat\",\n            \"nucleus\"\n        ],\n        \"requiredMods\": [\n            \"spongeapi@7.1.0\"\n        ]\n    },\n    {\n        \"modid\": \"newhonor-sponge\",\n        \"name\": \"NewHonor-Sponge\",\n        \"version\": \"2.4.2-b338\"\n    }\n]\n复制代码\n\n对 就是\n{\n\"modid\": \"newhonor-sponge\",\n\"name\": \"NewHonor-Sponge\",\n\"version\": \"2.4.2-b338\"\n}\n\n\n这难道是因为子项目的name是这导致的么(\n有人知道如何去掉么 \n(gradle真难awsl \n\n\n\n\n\n\n@ustc_zzzz   \n\n\n\n\n#NewHonor-Bukkit大概可以无视掉了:D\n",
    "replies": [
        {
            "author": "gooding300",
            "timestamp": 1540618920,
            "txt_content": " 本帖最后由 gooding300 于 2018-10-27 13:47 编辑 \n\nQuestion 1\n直接在SourseSet的Resource部分加上Common目录即可，可以参考一下皮肤补丁的写法\nsourceSets {\n    main {\n        resources {\n            srcDir '../NewHonor-Common/src/main/resources'\n        }\n    }\n}复制代码\nhttps://github.com/xfl03/MCCusto ... 4/common.gradle#L66\n\nQuestion 2\n这是Sponge的Gradle插件在处理mcmod.info的时候自动加的，为了方便Sponge读取这个插件，感觉没有去掉的必要"
        },
        {
            "author": "阴阳师元素祭祀",
            "timestamp": 1540619400,
            "txt_content": " 本帖最后由 阴阳师元素祭祀 于 2018-10-27 13:54 编辑 \ngooding300 发表于 2018-10-27 13:42\nQuestion 1\n直接在SourseSet的Resource部分加上Common目录即可，可以参考一下皮肤补丁的写法\nQ1:除了设置dir还有其他办法么 毕竟setDir感觉好难看((  没有我就这样写了\n不过还是感谢\n\nQ2:行吧 只是感觉会有点问题#因为压根没插件id叫newhonor-sponge\n> Task :NewHonor-Sponge:compileJava \n注: Reading extra plugin metadata from E:\\Projects\\java\\sponge\\NewHonor\\build\\sponge\\tmp\\generateMetadata\\mcmod.info\n警告: The following extra plugin IDs were not found: [newhonor-sponge]\n注: Writing plugin metadata to E:\\Projects\\java\\sponge\\NewHonor\\build\\sponge\\tmp\\generateMetadata\\mcmod.info\n1 个警告\n\n其实是强迫症("
        },
        {
            "author": "Himmelt",
            "timestamp": 1540735260,
            "txt_content": " 本帖最后由 Himmelt 于 2018-10-28 22:04 编辑 \n\nQuestion 1：如果源代码目录是src/main/java 以及 src/main/resources 是不需要设置源代码目录的，gradle默认的就是这两个。\n你用的shadow也是可以的，但是不用shadow也能做到。\nQuestion 2：sponge 默认id 会用 gradle 项目的名称的小写，而你在注解里也写了modid，所以会出现两个modid，\n可以在sponge的build.gradle里指明id \nsponge {\n    plugin {\n        id = 'yourmodid'\n    }\n}复制代码\n\n3. 完整 build.gradle（Bukkit也可以用shade）\nimport org.ajoberstar.grgit.Grgit\n\nbuildscript {\n    repositories {\n        mavenCentral()\n        jcenter()\n    }\n    dependencies {\n        classpath 'org.ajoberstar:grgit:1.7.0'\n    }\n}\n\nplugins {\n    id 'org.spongepowered.plugin' version '0.9.0'\n    id 'ninja.miserable.blossom' version '1.0.1'\n}\n\nsponge {\n    plugin {\n        id = 'newhonor'\n    }\n}\n\nsourceCompatibility = '1.8'\ntargetCompatibility = '1.8'\n\ndefaultTasks 'clean', 'build'\n\njar {\n    manifest {\n        attributes 'Main-Class': 'com.github.euonmyoji.newhonor.Main'\n    }\n}\ngroup = 'com.github.euonmyoji.newhonor'\ndef buildNumber = \"\"\next {\n    //代码来自插件ebi中的build.gradle → : https://github.com/euOnmyoji/EpicBanItem---Sponge\n    //noinspection GrDeprecatedAPIUsage  不会用新版\n    git = Grgit.open(file(\"../.git\"))\n    parents = git.head().parentIds\n    index = 0// Offset to match CI\n    while (parents != null && !parents.isEmpty()) {\n        parents = git.getResolve().toCommit(parents.get(0)).getParentIds()\n        index++\n    }\n    //noinspection GrReassignedInClosureLocalVar\n    buildNumber = \"${index}\"\n}\n\nblossom {\n    //参考build.gradle https://github.com/ginyai/GiftCode/blob/master/build.gradle\n    replaceToken('@spongeVersion@', spongeVersion)\n}\n\nrepositories {\n    mavenCentral()\n    maven {\n        name = 'sponge'\n        url = 'https://repo.spongepowered.org/maven'\n    }\n    maven {\n        name = \"nucleus\"\n        url = \"http://repo.drnaylor.co.uk/artifactory/list/minecraft\"\n    }\n    maven { url = 'https://raw.github.com/FabioZumbi12/UltimateChat/mvn-repo/' }\n    maven { url = 'https://jitpack.io' }\n}\n\ntasks.withType(JavaCompile) {\n    options.encoding = \"UTF-8\"\n}\n\nconfigurations {\n    shade\n    compile.extendsFrom(shade)\n}\n\ndependencies {\n    compileOnly \"org.spongepowered:spongeapi:${spongeapi}\"\n    compileOnly 'br.net.fabiozumbi12.UltimateChat:UltimateChat-Sponge-5.0-6.0:1.8.6'\n    compileOnly 'com.github.rojo8399:PlaceholderAPI:master-SNAPSHOT'\n    compileOnly 'io.github.nucleuspowered:nucleus-api:1.3.9-S7.0'\n    shade 'org.bstats.bStats-Metrics:bstats-sponge:1.3'\n\n    shade project(\":NewHonor-Common\")\n}\nversion = \"${spongeVersion}-b${buildNumber}\"\n\ntask shadowJar(type: Jar) {\n    from sourceSets.main.output\n    configurations.shade.copyRecursive().setTransitive(false).each {\n        artifact -> from(zipTree(artifact))\n    }\n}\n\ntask spongeApiJar(type: Jar) {\n    manifest {\n        attributes 'Main-Class': 'com.github.euonmyoji.newhonor.Main'\n    }\n    version = \"${spongeVersion}\"\n    classifier = \"API\"\n    from sourceSets.main.output\n    include 'com/github/euonmyoji/newhonor/api/**', 'com/github/euonmyoji/newhonor/api/**'\n}\n\nartifacts {\n    archives shadowJar\n    archives spongeApiJar\n}\n\njar.setEnabled(true)\n\nbuildDir = '../build/sponge'\n复制代码\n"
        },
        {
            "author": "liach",
            "timestamp": 1541256120,
            "txt_content": "你的确应该把bukkit代码放到另一个subproject里面，因为那个sponge的gradle插件只有sponge部分真正需要。而且subproject也可以避免在sponge部分用到bukkit代码的现象。"
        }
    ]
}