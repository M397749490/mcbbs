{
    "title": "[20w16a]使用JMX来监测你的服务器",
    "author": "1139365029",
    "replyCount": 1,
    "timestamp": 1587030540,
    "txt_content": " 本帖最后由 1139365029 于 2020-4-16 22:23 编辑 \n1. 关于\n快照20w16a当中添加了JMX的支持，用于监测服务器的各项资源，\n引用帖子的原文JMX 是一种著名的监测技术，有很多现成的集成工具为其提供支持。\n所以，这么好的东西，我们为何不用呢？\n\n2. 准备工作\n安装java即可\n\n3. JVM启动项的配置\n首先按照官方的说法，我们需要设置server.properties文件中的配置项enable-jmx-monitoring=true 复制代码此时，如果你仅仅只是在本地使用JMX监控，那么配置到此处就结束了，请浏览下一部分，\n如果想要进行远程监控，请继续往下看，\n首先我们要设置远程访问的账户和密码，\n我们需要准备两个文件，一个是“jmxremote.access”，另一个是“jmxremote.password”，如下图所示：\n\n\n\n\nTIM截图20200416163917.png (8.07 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:39 上传\n\n\n\n\n\n可以直接新建，也可以在“java安装目录/jre/lib/management”下面复制出来，\n这两个文件，前者是用来控制账户权限的，后者是用来控制账户密码的，\n文件放哪里都可以，但推荐放服务端目录里面，方便管理，\n现在我们打开“jmxremote.access”文件，在里面写下：admin readonly复制代码表示添加一个叫做“admin”的只读账户，\n然后打开“jmxremote.password”，在里面写下：admin 123456复制代码表示“admin”的密码是123456，\n注意中间是用空格隔开，空格多点少点无所谓，\n建议大家不要写的跟我一样，至少密码要不一样吧\n然后最关键的一步来了，\n忽略此步启动会提示“错误: 必须限制口令文件读取访问权限”，然后服务端就关闭了，\n因为内容较长，此处折叠注意：此处说用的用户名是我电脑的用户名，大家请以服务端所用的电脑为准\n首先右键“jmxremote.password”，点开属性\n\n\n\n\n2020-4-16 16-48-2.png (8.64 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:55 上传\n\n\n\n\n\n跳转到安全选项卡，点“高级”\n\n\n\n\nTIM截图20200416164833.png (14.27 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:56 上传\n\n\n\n\n\n点击所有者旁边的更改\n\n\n\n\nTIM截图20200416164907.png (6.93 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:56 上传\n\n\n\n\n\n输入你登录电脑的ID，然后点旁边的检查名称\n\n\n\n\nTIM截图20200416164937.png (8.09 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:56 上传\n\n\n\n\n\n变成这个鬼样子的时候，点确定\n\n\n\n\nTIM截图20200416164949.png (8.28 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:57 上传\n\n\n\n\n\n至此，文件的所有者变成了你自己\n\n\n\n\nTIM截图20200416165002.png (5.34 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:57 上传\n\n\n\n\n\n然后点左下角的“禁用继承”\n\n\n\n\nTIM截图20200416165031.png (3.04 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:58 上传\n\n\n\n\n\n选择删除\n\n\n\n\nTIM截图20200416165053.png (8.37 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:58 上传\n\n\n\n\n\n至此，没有任何人能够操作这个文件了\n\n\n\n\nTIM截图20200416165122.png (4.37 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:59 上传\n\n\n\n\n\n然后点左下角的添加\n\n\n\n\nTIM截图20200416165151.png (2.03 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 16:59 上传\n\n\n\n\n\n点击上方的选择主体，将你自己添加进去，跟添加所有者是一样的操作\n\n\n\n\nTIM截图20200416165207.png (4.96 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:00 上传\n\n\n\n\n\n之后使文件只有你自己才能操作\n\n\n\n\nTIM截图20200416165231.png (5.24 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:01 上传\n\n\n\n\n接下来我们需要将JVM启动项添加到服务器的启动项中，\n用记事本打开启动脚本，添加启动参数-Dcom.sun.management.jmxremote.port=监听端口\n-Dcom.sun.management.jmxremote.ssl=false\n-Dcom.sun.management.jmxremote.authenticate=true\n-Dcom.sun.management.jmxremote.password.file=文件所在目录\\jmxremote.password\n-Dcom.sun.management.jmxremote.access.file=文件所在目录\\jmxremote.access复制代码如图：\n\n\n\n\nTIM截图20200416170544.png (9.47 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:06 上传\n\n\n\n\n\n关于启动参数的更详细的内容，请参考：https://docs.oracle.com/javase/8/docs/technotes/guides/management/agent.html\n至此，配置工作已完成，可以启动服务器了\n\n4. 开始监控\n在“java安装目录\\bin”下面，找到一个叫做“jconsole.exe”的程序，如图：\n\n\n\n\nTIM截图20200416170853.png (17.18 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:09 上传\n\n\n\n\n\n双击运行：\n\n\n\n\nTIM截图20200416171053.png (11.06 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:11 上传\n\n\n\n\n\n如果服务端也在同一台电脑上运行，可以在“本地进程”中找到进程，\n反之就选择“远程进程”，输入IP、端口、用户名以及密码：\n\n\n\n\nTIM截图20200416171417.png (5.85 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:14 上传\n\n\n\n\n\n注意：端口是你在服务端启动参数里写的那个，不一样要跟这个一样\n这里点“不安全的连接”\n\n\n\n\nTIM截图20200416171536.png (8.54 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:15 上传\n\n\n\n\n\n至此，连接成功：\n\n\n\n\nTIM截图20200416171616.png (33.99 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:16 上传\n\n\n\n\n\n\n5. 进一步使用\n界面相信大家能够看懂，这里介绍一下mojang提到的averageTickTime与tickTimes，\n转到MBean，找到那个一看就很像MC的，展开，就能看到了\n\n\n\n\nTIM截图20200416171841.png (9.35 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:19 上传\n\n\n\n\n\n点击可以在右边看到对应的值，目前还不知道这代表什么含义\n\n\n\n\nTIM截图20200416171946.png (2.73 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-16 17:20 上传\n\n\n\n\n",
    "replies": [
        {
            "author": "1759749908",
            "timestamp": 1587031020,
            "txt_content": "这个厉害，感觉以后的开服器都会用到这个办法监测服务器。"
        }
    ]
}