{
    "title": "[Bukkit][未知之域]JAVA机制-反射 通过反射调用构造函数",
    "author": "qianji20000420",
    "replyCount": 0,
    "timestamp": 1501925880,
    "txt_content": " 本帖最后由 qianji20000420 于 2017-8-5 22:33 编辑 \n\n 导读 获取class文件对象的三种方式通过反射调用无参构造并使用通过反射调用含参构造并使用通过反射调用私有构造方法并使用(更改访问权限调用) 及对IllegalAccessException的讲解\n\n\n 获取class文件对象的三种方式 什么是class文件对象？\n在第一篇已经讲了，Java在加载类时会创建一个与该类对应的字节码文件对象，这个对象是Class类的一个实例关于CLass类\n先上一波API\n\n\n\n\nQQ截图20170805100220.png (39.87 KB, 下载次数: 7)\n\n下载附件\n\n2017-8-5 12:54 上传\n\n\n\n\n\n可能大家对Class这个类不算太熟悉。但是Class这个名并不是第一次见。\n\n\n\n\nC}OSQ8ID_4]B)JZO[SQS175.png (2.61 KB, 下载次数: 9)\n\n下载附件\n\n2017-8-5 12:55 上传\n\n\n\n\n\n这个是Object类的getClass方法 可能你并没有用到过。 但是今天反射却要用到他了\n这就是我们获取class文件对象的一种方式。下面为大家总结一下获取class文件对象的三种方式\n\n当想要获取一个对象或实例或字段的class文件对象 需要用到Object类的getClass()方法当想要获取一个类的class文件对象 使用 类名.class 来获取Class类提供了forName方法 传入类的全路径来获取\n\n\n\n\n\n\nQQ截图20170805125221.png (2.85 KB, 下载次数: 6)\n\n下载附件\n\n2017-8-5 13:01 上传\n\n\n\n\n\n\n 通过反射调用无参构造并使用 \n\n\n\n\nQQ截图20170805125613.png (26.63 KB, 下载次数: 9)\n\n下载附件\n\n2017-8-5 13:05 上传\n\n\n\n\n\n这里我们先创建两个类 Demo 和 test 在test里我已经写好了无参构造 在Demo里我已经写好了主方法\n接下来在主方法中获取test类的字节码文件对象Class c = test.class;复制代码然后通过查询API得知：\n\n\n\n\nQQ截图20170805125843.png (19.36 KB, 下载次数: 3)\n\n下载附件\n\n2017-8-5 13:08 上传\n\n\n\n\n\n\n\n\nQQ截图20170805125834.png (19.51 KB, 下载次数: 0)\n\n下载附件\n\n2017-8-5 13:08 上传\n\n\n\n\n\n这四个方法是与构造方法有关的\n有没有getConstructor和getDeclaredConstructor的区别在于有Declared能获取到非公共的即无public修饰的构造方法\n接下来我会使用getDeclaredConstructor()  ps:反正带Declared的都能获取到 何乐而不为呢？(啪)\n接下来在主方法中写上Constructor cs = c.getDeclaredConstructor();复制代码getDeclaredConstructor的参数是Class类实例。也就是构造函数中参数所对应的Class对象，因为是无参的，所以这里空就可以了。Constructor的泛型先不用管它了。\n发现有异常了。 不管他先抛出 等会再讲\n\n\n\n\n09H1{B@JPK}OAHQU$YU{DP1.png (23.46 KB, 下载次数: 1)\n\n下载附件\n\n2017-8-5 17:21 上传\n\n\n\n\n\n这样就获取到了test类的无参构造对应的Constructor对象\n接下来我们要用到Constructor类下的newInstance方法 参数即为构造函数的参数\n\n\n\n\nQQ截图20170805170520.png (16.09 KB, 下载次数: 5)\n\n下载附件\n\n2017-8-5 17:14 上传\n\n\n\n\n\n这个方法的用途和 new 的用途基本相同\n也就是说在这里\ncs.newInstance() 与 new test() 是等价的test t = (test) cs.newInstance();复制代码之后我们将获取到的对象直接强转为test就获取到test的对象了\n控制台就会输出个hi 证明我们成功通过反射成功调用了test的无参构造并实例化了对应的test对象\n\n\n\n\nQQ截图20170805170836.png (58.44 KB, 下载次数: 7)\n\n下载附件\n\n2017-8-5 17:17 上传\n\n\n\n\n\n 通过反射调用含参构造并使用 用法和无参基本相同，只需要在getDeclaredConstructor及newInstance后面的参数做变化\n\n\n\n\n9E1JEB5Z)8UC]F2KWFVX]3O.png (51.31 KB, 下载次数: 6)\n\n下载附件\n\n2017-8-5 17:23 上传\n\n\n\n\ngetDeclaredConstructor的参数是class文件对象，也就是说 他应该传入的是对于构造函数参数所对应类的对应Class对象这里应该用String.classnewInstance后面的参数即为你实例化一个对象传入构造函数中的参数\n调用私有构造方法 当我们在test类中创建一个私有的构造函数\n比如\n\n\n\n\nQQ截图20170805171657.png (2.63 KB, 下载次数: 1)\n\n下载附件\n\n2017-8-5 17:25 上传\n\n\n\n\n\n然后在主方法中 将“233”随便改成一个int类型的数 我这里比如123\n并把String.class改成int.class (基本数据类型也有对应的class对象哦)\n\n\n\n\n339.png (3.31 KB, 下载次数: 6)\n\n下载附件\n\n2017-8-5 17:26 上传\n\n\n\n\n\n当我们运行时\n\n\n\n\nQQ截图20170805172655.png (77.34 KB, 下载次数: 11)\n\n下载附件\n\n2017-8-5 17:36 上传\n\n\n\n\n\n怎么报错了？？！\nIllegalAccessException 正如名字一样  非法的访问异常\n他既然是私有的，能让你轻易访问吗？\n这时我们看到了--\n\n\n\n\n{KT2}8$Y7{(9JJLA}9%M}]X.png (21.4 KB, 下载次数: 4)\n\n下载附件\n\n2017-8-5 17:30 上传\n\n\n\n\n\n\n\n\n\nGNKY16{`(S56CD`)FD2%]ZW.png (19.75 KB, 下载次数: 9)\n\n下载附件\n\n2017-8-5 17:30 上传\n\n\n\n\n\n我天，这不就容易了。 我来\n\n\n\n\nQQ截图20170805172840.png (61.95 KB, 下载次数: 12)\n\n下载附件\n\n2017-8-5 17:37 上传\n\n\n\n\n\n\n所以说 ， 私有的构造方法不是不能够被调用的。。\n\n 下一篇 反射中对成员变量的调用\n返回索引贴\n第一次做教程，如果教程中有遗漏的或说错的地方请及时指出哇。~[groupid=1181]Unknown Domain[/groupid]\n",
    "replies": []
}