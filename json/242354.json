{
    "title": "【CC】电脑mod Lua语言与程序设计 讨论帖（9月7日更新）",
    "author": "zh0996",
    "replyCount": 12,
    "timestamp": 1392909900,
    "txt_content": " 本帖最后由 zh0996 于 2014-9-11 20:42 编辑 \n\nComputerCraft Lua语言与程序设计讨论帖      这里可以讨论一切关于CC中使用Lua语言或者编程过程中你遇到的各种问题。      这些都可以拿出来讨论，我的一些程序问题也要仰仗各位大神指点，我其实学习Lua时间不是很长，只是C语言有些基础。      近期会贴出一些API讲解的源码，还有程序和CC++的源码，欢迎各位程序猿来做客~~\n      好的程序可能会被收录到教程里，望大家理解      教程索引：http://www.mcbbs.net/forum.php?mod=viewthread&tid=242148&page=1&extra=#pid4676148      欢迎大家与我交流！\n\n目录：【第二页  关于go(x)函数的一些问题的讨论】\n【第三页  自动建造程序 前瞻版 源码】\n【第四页  CC++ library文件 源码】\n\n\n\n【关于go(x)函数倒车实现问题的讨论】\n先上代码：（没有错行，望见谅！）<P>--前进函数。</P>\n<P>--1是往前走；2是往上走；3是往下走；4是“倒车”\nfunction go(k)\nif k == 1 then\nif (turtle.forward() == false) then\nif (turtle.getFuelLevel() == 0) then\nturtle.refuel(1) \nelse \nturtle.dig(k)\nend\ngo(k)\nend\nend\nif k == 2 then</P>\n<P> if (turtle.up() == false) then\nif (turtle.getFuelLevel() == 0) then\nturtle.refuel(1)\nelse\nturtle.digUp()\nend\ngo(k)\nend\nend\nif k == 3 then \nif (turtle.down() == false) then\nif (turtle.getFuelLevel() == 0) then\nturtle.refuel(1) \nelse\nturtle.digDown()\nend\ngo(k)\nend\nend </P>\n<P>if k == 4 then\nif (turtle.back() == false) then\nif (turtle.getFuelLevel() == 0) then\nturtle.refuel(1)\nelse</P>\n<P> turtle.turnLeft()</P>\n<P>turtle.turnLeft()</P>\n<P>turtle.dig()\nturtle.turnLeft()\nturtle.turnLeft()\nend\ngo(k)\nend\nend\nend</P></P>复制代码个人感觉这个4是没有必要这么复杂的，“倒车”完全可以通过掉头然后直走来实现，一次次转圈，效率较低。我也放出一段编码，大家对比看看：\n<P>if k == 4 then\n   if (turtle.back() == false) then\n      if (turtle.getFuelLevel() == 0) then\n         turtle.refuel(1)\n      else\n         turtle.turnLeft()\n         turtle.turnLeft()\n         go(1)\n      end</P>\n<P>   end\nend</P>复制代码有想法的可以回帖交流一下。\n\n\n\n【自动建造程序 前瞻版 源码】由于我一开始就决定做成开源的，所以将源代码发布如下：（时间仓促，没错行，望见谅！）1.lua1write \"hello!\\n\"\n\nn = 0\nwhile yanzhen do\nlocal yanzhen = false\nlocal yz = false\nn = n + 1\nlocal yanzhen = false\nlocal yz = yanzhen\nturtle.select(n)\nyanzhen = turtle.refuel()\nyanzhen = yanzhen and yz\nif yanzhen == false then\nwrite \"Fueling failed, please re-add fuel!\"\nsleep (5)\nend\nend\n\nn = 1\nturn = 4\nturtle.select(n)\n\nover = 0\nwhile over == 0 do\nif turn == 4 then\nturtle.up()\nturn = 0\nend\n\nwhile turn <= 3 do\ni = 0\nwhile i <= 14 do\nturtle.forward()\nturtle.placeDown()\ni = i+1\n\nshenyu = turtle.getItemCount(n)\nif shenyu == 0 then\nn = n+1\nif n > 16 then\nwrite \"There is not enough boxes, the program exits!\\n\"\nn = 1\nover = 1\ni = 15\nturn = 5\nend\nturtle.select(n)\nend\nend\nturtle.turnRight()\nturn = turn+1\nend\nend复制代码2.lua write \"hello!\\n\"\nwrite \"Enter the length, width and high,please!\\n\"\nwrite \"Format:\\nlength\\nwidth\\nhigh\\n\"\nlength,width,high = 0\nlength = tonumber(read())-1\nwidth = tonumber(read())-1\nhigh = tonumber(read())\nfangkuaihe = (length + width)*2*high\nprint (fangkuaihe)\n\nn = 0\nwhile yanzhen do\nlocal yanzhen = false\nlocal yz = false\nn = n + 1\nlocal yanzhen = false\nlocal yz = yanzhen\nturtle.select(n)\nyanzhen = turtle.refuel()\nyanzhen = yanzhen and yz\nif yanzhen == false then\nwrite \"Fueling failed, please re-add fuel!\"\nsleep (5)\nend\nend\n\nn = 0\nsySum = 0\nwhile sySum < fangkuaihe do\nwhile n ~= 16 do\nn = n + 1\nshenyu = turtle.getItemCount(n)\nsySum = sySum + shenyu\nturtle.select(n)\nend\nif sySum < fangkuaihe then\nwrite \"There is not enough boxse!\"\nsleep (10)\nend\nend\nshenyu = nil\n\nn = 1\nh = 0\nturn = 4\nturtle.select(n)\n\nover = 0\nwhile over == 0 do\nif turn == 4 then\nturtle.up()\nturn = 0\nh = h+1\nend\n\nif h > high then\nturn = 4\nover = 1\nend\n\nwhile turn <= 3 do\nte = turn%2\nif te == 0 then\nl = 0\nwhile l < length do\nturtle.forward()\nturtle.placeDown()\nl = l+1\n\nshenyu = turtle.getItemCount(n)\nif shenyu == 0 then\nn = n+1\nif n > 15 then\nwrite \"There is not enough boxes, the program exits!\\n\"\nn = 1\nover = 1\nl = length+1\nturn = 5\nend\nturtle.select(n)\nend\nend\nelseif te ~= 0 then\nw = 0\nwhile w <= width do\nturtle.forward()\nturtle.placeDown()\nw = w+1\n\nshenyu = turtle.getItemCount(n)\nif shenyu == 0 then\nn = n+1\nif n > 15 then\nwrite \"There is not enough boxes, the program exits!/n\"\nn = 1\nover = 1\nw = width+1\nturn = 5\nend\nturtle.select(n)\nend\nend\nend\n\nturtle.turnRight()\nturn = turn+1\nend\nend\nwrite \"build success!\"复制代码3.luawrite \"hello!\\n\"\nhsk.yljc()\nturtle.select(1)\n\nmoshi = 1\nif moshi == 1 then\ncs = turtle.detect()\nwhile cs == true do\nturtle.turnLeft()\ncs = turtle.detect()\nend\n\nzuoyou = 0\nzuoyou = hsk.jianchazuoyou()\nwhile zuoyou == 0 do\nwrite \"Turtle placement errors, please re-placement\\n\"\nos.reboot()\nend\n\nlocal over = 0\njs = 0\nwhile over ~= 1 do\nwhile js ~= 4 do\nlocal jiance,bzh = false,0\nwhile jiance == false do\njc = hsk.jiance()\nif jc == false then\nbzh = 1\nbreak\nend\nif bzh == 0 then\nturtle.placeDown()\nturtle.forward()\nend\njiance = turtle.detect()\nend\nturtle.placeDown()\n\nif (zuoyou == 2 and js == 0) or (zuoyou == 1 and js == 1) then\nturtle.turnRight()\npd1 = turtle.detect()\nif pd1 == false then\nturtle.forward()\nturtle.turnRight()\nelse\nwrite \"build success!\\n\"\njs = 3\nover = 1\nend\nelseif zuoyou == 3 then\nwrite \"build success!\\n\"\njs = 3\nover = 1\nelseif (zuoyou == 2 and js == 1) or (zuoyou == 1 or js == 0) then\nturtle.turnLeft()\npd2 = turtle.detect()\nif pd2 == false then\nturtle.forward()\nturtle.turnLeft()\nelse\nwrite \"build success!\\n\"\njs = 3\nover = 1\nend\nend\n\njs = js+1\nif js == 2 then\njs = 0\nend\nend\nend\nend复制代码【CC++ library文件 源码】CC++是我个人设计的API，收录了一些常用的功能封成函数，使用时可直接调用（类似C++运行库）。我的自动建筑程序正式版本将全部基于CC++编写。编程爱好者也可下载作为自己程序的运行库使用，大家想增加什么功能，都可以向我提；也欢迎自编的函数发上来，我会测试收录，谢谢大家！经过一段时间的积累，又新增了一些函数，从Bate升为Bate0.2版本新加了显示器切换，挖矿支持的函数下面是Bate0.2版的源码：part1\n<P>--这是一个侦测储物格中是否存在方块的函数。\n--被侦测的储物格如果有方块，就返回真；没有就跳到下一格，若16个格子都没有方块，就返回假\nfunction jiance()\n    n = 1\n    bzh = 0\n    local shenyu = turtle.getItemCount(n)\n    while shenyu == 0 do\n        n = n+1\n        if n > 16 then\n            write \"There is not enough boxes, the program exits!\\n\"\n            shenyu = 100\n            bzh = 1\n            return false\n        end\n        turtle.select(n)\n        shenyu = turtle.getItemCount(n)\n    end\n    if bzh ~= 1 then\n        return true\n    end\nend</P>\n<P>--这是一个检测turtle两侧是否有方块的函数。\n--若两侧都有方块，返回3；只有左侧有方块，返回2；只有右侧有方块，返回1；两侧都没有方块，返回0。\n--测试通过\nfunction jianchazuoyou()\n    local pd1,pd2 = false,false\n    turtle.turnLeft()\n    pd1 = turtle.detect()</P>\n<P>    turtle.turnRight()\n    turtle.turnRight()\n    pd2 = turtle.detect()\n    turtle.turnLeft()</P>\n<P>    if pd1 == true then\n        if pd2 == true then\n            return 3\n        else\n            return 2\n        end\n    else\n        if pd2 == true then\n            return 1\n        else\n            return 0\n        end\n    end\n    pd1,pd2 = nil\nend</P>\n<P>--这是一个自动打开电脑，掌上电脑，turtle的无线路由器的API\n--测试通过\nfunction openRednet()\n    Side = {\"front\",\"back\",\"left\",\"right\",\"top\",\"bottom\"}\n    local n = 1\n    while n < 7 do\n        True = peripheral.isPresent(Side[n])\n        if True == true then\n            side = Side[n]\n        end\n        n = n+1\n    end\n    rednet.open(side)\nend</P>\n<P>--这是一个切换显示器的函数\n--测试通过\nfunction screenOutput(sige)\nif peripheral.isPresent(sige) then\n  term.redirect(peripheral.wrap(sige))\n  term.restore()\n    else\n  write \"feiled!\"\nend\nend</P>\n<P>--turtle加油核心</P>\n<P>--这是一个用于给turtle加油的函数。\n--若加油成功，返回turn；若失败，返回fslse。\n--如果是1.4以下版本的computercraft是不需要此函数的。\n--测试通过。\nfunction jiayou()\n    local n = 0\n    local js = 0\n    local yanzhen = false\n    local yz = false\n    local t = 5</P>\n<P>    while js < 4 and yanzhen == false do\n        while n < 16 do\n            n = n+1\n            yz = yanzhen\n            turtle.select(n)\n            yanzhen = turtle.refuel(1)\n            yanzhen = yanzhen or yz\n        end</P>\n<P>        if yanzhen == false then\n            write \"Fueling failed, please re-add fuel!\\n\"\n            sleep (t)\n            t = t+1\n        end</P>\n<P>    n = 0\n    js = js+1\n    end</P>\n<P>    if yanzhen then\n        write \"add fuel sucess!\\n\"\n        return yanzhen\n    else\n        write \"Adding fuel failure, the end of the program!\\n\"\n        return yanzhen\n    end\n    turtle.select(1)\nend</P>\n<P>\n--这是侦测储油量的函数。\n--如果可移动格数小于10格，打出提示信息,并返回1.\n--如果燃料耗尽，提示重新加入，并在5秒后自动重新加入燃料。\n--如成功,返回0。\n--若三次加油均失败，打印加油失败信息，并返回2。\n--如果是1.4以下版本的computercraft是不需要此函数的。\n--测试通过\nfunction yljc()\n    local yd = turtle.getFuelLevel()\n    if yd < 15 and yd > 0 then\n        print (\"Note: The fuel is running out!\")\n  library.jiayou()\n        return 1</P>\n<P>    elseif yd == 0 then\n        local js = 0\n        local yd = 0\n        local t = 2\n        while yd < 10 and js < 4 do\n            write \"Fuel runs out!\\nPlease re-fueling\\n\"\n            sleep (t)\n            t = t+5\n   while turtle.getFuelLevel() <= 15 do\n    library.jiayou()\n   end\n            yd = turtle.getFuelLevel()\n            js = js+1\n        end</P>\n<P>        if js == 4 then\n            write \"Adding fuel failure, the end of the program!\"\n            return 2\n        else\n            return 0\n        end</P>\n<P>    else\n        return 0\n    end\nend\n</P>复制代码\npart2\n<P>--挖矿程序核心</P>\n<P>--对行走失败时的处理程序，先判断是否是方块阻塞；然后判断是否是生物阻塞；剑要放在第15物品槽中\n--测试通过。\nfunction g_obstruct() \nbl1 = turtle.dig()\nif bl1 == false then\n  turtle.select(15)\n  turtle.equipLeft()\n  turtle.attack()\n  turtle.attack()\n  turtle.attack()\n  turtle.equipLeft()\n  turtle.select(1)\nend\nend</P>\n<P>--行走函数，可以记录位置（x,y,z）和朝向（direction）；direction1,2,3,0分别代表北、东、南、西\n--燃油大于等于最小返回距离时返回true；否则返回false。\n--测试通过。\nfunction tT_go(x,y,z,direction,remind)\nrhJudge = false\ngoSuccess = turtle.forward()\nwhile goSuccess == false do \n  library.g_obstruct() \n  goSuccess = turtle.forward()\n  library.yljc()\nend\nif remind == true then\n  x,y,z = library.azimuthRecorder(x,y,z,direction,\"go\")\nend\nrhJudge = library.g_rhJudge(x,y,z)\nreturn rhJudge,x,y,z\nend</P>\n<P>--转向函数，记录朝向变化\n--返回朝向\n--测试通过。\nfunction tT_LR(mode,direction)\nif mode == 'l' then\n  turtle.turnLeft()\n  _,_,_,direction = library.azimuthRecorder(0,0,0,direction,\"turnLeft\")\nelseif mode == 'r' then\n  turtle.turnRight()\n  _,_,_,direction = library.azimuthRecorder(0,0,0,direction,\"turnRight\")\nelseif mode == 'b' then\n  direction = library.tT_LR('r',direction)\n  direction = library.tT_LR('r',direction)\nend\ndirection = direction % 4\nreturn direction\nend</P>\n<P>--方位记录器，在方位（x，y，z）和朝向发生变化时记录变化数据\n--返回方位和朝向\n--测试通过。\nfunction azimuthRecorder(x,y,z,direction,mode)\nif mode == \"turnLeft\" then\n  direction = direction - 1\nelseif mode == \"turnRight\" then\n  direction = direction + 1\nelseif mode == \"go\" then\n  if direction == 1 then\n   y = y+1\n  elseif direction == 2 then\n   x = x+1\n  elseif direction == 3 then\n   y = y-1\n  elseif direction == 0 then\n   x = x-1\n  end \nend\nreturn x,y,z,direction\nend</P>\n<P>--判断返回函数，燃油大于等于最小返回距离时返回true；否则返回false。\n--测试通过。\nfunction g_rhJudge(x,y,z)\ngH = math.abs(x)+math.abs(y)+math.abs(z)\nif gH >= turtle.getFuelLevel() - 1 then\n  return true\nend\nreturn false\nend</P>\n<P>--最快返回函数，沿最近矿道返回\n--测试通过。\nfunction tT_goHome(x,y,z,direction,beginDirection)  \nif beginDirection == 1 then\n  library.confirmDirection(3,0,x,y,z,direction)\nelseif beginDirection == 2 then\n  library.confirmDirection(1,0,x,y,z,direction)\nelseif beginDirection == 3 then \n  library.confirmDirection(1,2,x,y,z,direction)\nelseif beginDirection == 0 then\n  library.confirmDirection(3,2,x,y,z,direction)\nend\nend</P>\n<P>--方向确认函数，确认最快返回的方向并计算线路\n--测试通过。\nfunction confirmDirection(a,b,x,y,z,direction)\nabl_X = math.abs(x) % 5\nabl_Y = math.abs(y) % 5\nif abl_X >= abl_Y then\n  while direction ~= a do\n   direction = library.tT_LR('l',direction)\n  end\nelse\n  while direction ~= b do\n   direction = library.tT_LR('l',direction)\n  end\nend \n\nif direction == b then\n  if abl_X ~= 0 then\n   for i = 0,abl_X-1 do\n    _,x,y = library.tT_go(x,y,z,direction,false)\n   end   \n  end\n  direction = library.tT_LR('r',direction)\n\n  if math.abs(y) ~= 0 then\n   for i = 0,math.abs(y)-1 do\n    _,x,y = library.tT_go(x,y,z,direction,false)  \n   end   \n  end\n  direction = library.tT_LR('l',direction)\n  \n  if math.abs(x)-abl_X ~= 0 then\n   for i = 0,math.abs(x)-abl_X-1 do\n    _,x,y = library.tT_go(x,y,z,direction,false)\n   end\n  end\nelseif direction == a then\n  if abl_Y ~= 0 then\n   for i = 0,abl_Y-1 do\n    _,x,y = library.tT_go(x,y,z,direction,false)\n   end   \n  end\n  direction = library.tT_LR('l',direction)\n  \n  if math.abs(x) ~= 0 then\n   for i = 0,math.abs(x)-1 do\n    _,x,y = library.tT_go(x,y,z,direction,false)\n   end   \n  end\n  direction = library.tT_LR('r',direction)\n  \n  if math.abs(y)-abl_Y ~= 0 then\n   for i = 0,math.abs(y)-abl_Y-1 do\n    _,x,y = library.tT_go(x,y,z,direction,false)\n   end\n  end\n  direction = library.tT_LR('l',direction)\nend\ndirection = library.tT_LR('r',direction)\ndirection = library.tT_LR('r',direction)\nend</P>复制代码\n",
    "replies": [
        {
            "author": "zh0996",
            "timestamp": 1392967440,
            "txt_content": " 本帖最后由 zh0996 于 2014-9-7 22:15 编辑 \n\n这个……技术贴就这么冷吗……\n唉……\n好吧我先来抛砖引玉\n1.检测左右方块函数。\n\n<P>--这是一个检测turtle两侧是否有方块的函数。\n--若两侧都有方块，返回3；只有左侧有方块，返回2；只有右侧有方块，返回1；两侧都没有方块，返回0。</P>\n<P>--测试成功！\nfunction jianchazuoyou()\n    local pd1,pd2 = false,false\n    turtle.turnLeft()\n    pd1 = turtle.detect()\n\n    turtle.turnRight()\n    turtle.turnRight()\n    pd2 = turtle.detect()\n    turtle.turnLeft()\n\n    if pd1 == true then\n        if pd2 == true then\n            return 3\n        else\n            return 2\n        end\n    else\n        if pd2 == true then\n            return 1\n        else\n            return 0\n        end\n    end\nend</P>\n<P> </P>\n<P> </P>复制代码我很荣幸宣布，该函数测试通过！想要的同学就抄走吧。（其实也没啥大用）2.显示器输出API此问题已解决，详细代码请参见CC++源码"
        },
        {
            "author": "wangfumin1992",
            "timestamp": 1392991620,
            "txt_content": "zh0996 发表于 2014-2-21 15:24\n这个……技术贴就这么冷吗……\n唉……\n好吧我先来抛砖引玉新编的一个函数，不管两放不放方块 ...\n程序第13、14、20行if判断中的true误写成turn了 导致判断分支只有返回0的部分被触发\n\n最近没玩游戏 就没法帮你测试了"
        },
        {
            "author": "zh0996",
            "timestamp": 1392992820,
            "txt_content": "wangfumin1992 发表于 2014-2-21 22:07\n程序第13、14、20行if判断中的true误写成turn了 导致判断分支只有返回0的部分被触发\n\n最近没玩游戏 就没 ...\n太谢谢你了，最近编晕了，竟然犯这么低级的错误来这丢人，惭愧惭愧！{:10_494:}\n谢谢来访！我今晚调试"
        },
        {
            "author": "wangfumin1992",
            "timestamp": 1392993600,
            "txt_content": " 本帖最后由 wangfumin1992 于 2014-2-21 22:44 编辑 \nzh0996 发表于 2014-2-21 22:27\n太谢谢你了，最近编晕了，竟然犯这么低级的错误来这丢人，惭愧惭愧！\n谢谢来访！我今晚调试 ...\n没什么丢人的啦 即使是我们学计算机的 编程也难免犯低级错误啊\n\n互相共勉啦 哈哈~\n"
        },
        {
            "author": "wangfumin1992",
            "timestamp": 1392993900,
            "txt_content": "zh0996 发表于 2014-2-21 22:27\n太谢谢你了，最近编晕了，竟然犯这么低级的错误来这丢人，惭愧惭愧！\n谢谢来访！我今晚调试 ...\nP.S： 貌似修改后的程序里的true拼写还是错的……这是个很常见的错误啊"
        },
        {
            "author": "zh0996",
            "timestamp": 1392994500,
            "txt_content": "wangfumin1992 发表于 2014-2-21 22:45\nP.S： 貌似修改后的程序里的true拼写还是错的……这是个很常见的错误啊\n{:10_504:}\n我对我自己都无语了，好在问题解决了！\n终于解决了……{:10_528:}"
        },
        {
            "author": "zh0996",
            "timestamp": 1393123740,
            "txt_content": "这论坛里没几个程序猿吗？\n还是技术贴必沉？？\n{:10_503:}"
        },
        {
            "author": "tsubasa56",
            "timestamp": 1393296960,
            "txt_content": "其实你去编程板块可能会更好些{:10_566:}"
        },
        {
            "author": "zh0996",
            "timestamp": 1406175240,
            "txt_content": "没人气啊，死气沉沉的……\n我准备把我的API讲解的源码发到这个贴里，大家以后就在这里看源码吧\n最近还在纠结网盘的事，初步决定随大流用度娘网盘，如果找到好的网盘会考虑\n关于源码、程序的源文件也会在不久之后于此贴中贴出，敬请期待~~~\n"
        },
        {
            "author": "zh0996",
            "timestamp": 1410100320,
            "txt_content": "CC++ Bate0.2版本发布了！！[撒花~~]\n因为匆忙间调试完成，自然有不周全的地方，所以还是Bate版本\n还望大神来挑错，有奖哦~~\n谢谢大家支持！！"
        },
        {
            "author": "QAQ囧囧QAQ",
            "timestamp": 1443929160,
            "txt_content": "还以为DNCLC呢！！！！！！气屎我了"
        },
        {
            "author": "zh0996",
            "timestamp": 1443975480,
            "txt_content": "QAQ囧囧QAQ 发表于 2015-10-4 11:26\n还以为DNCLC呢！！！！！！气屎我了\nDNCLC是神马？？？"
        }
    ]
}