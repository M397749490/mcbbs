{
    "title": "当风过时的Block-GUI教程（1）-创建一个带GUI的方块",
    "author": "当风过时",
    "replyCount": 5,
    "timestamp": 1350999480,
    "txt_content": " 本帖最后由 当风过时 于 2016-2-16 22:08 编辑 \n\n看这篇教程需要一定的mod制作基础，没有什么基础的话请先去看看基础教程，把基础打好再说。http://www.mcbbs.net/thread-54579-1-1.html\n1.8.9的教程：http://www.windworkshop.cn/?p=889\n1.7.10的教程：http://www.windworkshop.cn/?p=36\n第二篇，自定义TileEntity的行为：http://www.mcbbs.net/thread-76005-1-1.html第三篇，同步客户端与服务端的数据：http://www.mcbbs.net/thread-78145-1-1.html\n说起GUI，是我心中难以磨灭的阴影。。。当初在学的时候各种坑，刚爬出来就到另外一个坑，方块GUI可以说是minecraft里面很麻烦的东西，源代码里没用可供参考的东西（那些源码中的各种displayGUI纯粹是坑爹- -），全部都得靠modloader或者forge提供的调用函数才能打开。。。如果事先没有仔细研究教程，中间漏了哪步都不行。不废话了，直接开始吧。首先创建mod文件，这个教程就以制作一个修复台为目标吧。mod文件就叫做mod_RepairTable.java吧。现在先解释一下要显示右键方块的gui需要什么东西，需要Block，Container，Gui，TileEntity，他们的职责分别是：提供方块的基本操作，GUI的内容管理，GUI的绘制，方块的数据管理。先来做Block，Block需要继承BlockContainer，BlockContainer需要返回对应的TileEntity，Block命名为rtBlockRepairTable（谨遵szszss触的教诲，开头写上mod的缩写可以大大的减少寻找文件的时间）经过eclipse的修正后如下：\npackage net.minecraft.src;\n \npublic class rtBlockRepairTable extends BlockContainer{\n \n       protected rtBlockRepairTable(int par1, int par2, Material par3Material) {\n              super(par1, par2, par3Material);\n              // TODO Auto-generated constructor stub\n       }\n \n       @Override\n       public TileEntity createNewTileEntity(World var1) {\n              // TODO Auto-generated method stub\n              return null;\n       }\n \n}复制代码\n目前这只是一个没有任何功能的方块。先来做TileEntity，新建一个类，名称为rtTileEntityRepairTable，继承TileEntity重写updateEntity()，updateEntity是更新TileEntity的函数，想让TileEntity工作全部都得依赖于它。在updateEntity中写上个输出语句吧。\npackage net.minecraft.src;\n \npublic class rtTileEntityRepairTable extends TileEntity{\n \n       @Override\n       public void updateEntity() {\n              // TODO Auto-generated method stub\n              super.updateEntity();\n              System.out.println(\"Hello GUI\");\n       }\n \n}复制代码\n然后给Block里的createNewTileEntity方法返回一个TileEntity，返回刚在写好的rtTileEntityRepairTable\n       @Override\n       public TileEntity createNewTileEntity(World var1) {\n              // TODO Auto-generated method stub\n              return new rtTileEntityRepairTable();\n       }复制代码\n这个步骤完成后还需要在mod文件中注册各种东西(因为这个是直接更换过来的，过程没有重新做，这个地方如果出现bug的话就以最终的那个为准)要引用IGuiHandler，这个接口是打开GUI的制定接口，根据接口所需的函数就能打开GUI\npackage net.minecraft.src;\n\nimport cpw.mods.fml.common.Mod;\nimport cpw.mods.fml.common.event.FMLInitializationEvent;\nimport cpw.mods.fml.common.network.IGuiHandler;\nimport cpw.mods.fml.common.network.NetworkMod;\nimport cpw.mods.fml.common.network.NetworkRegistry;\nimport cpw.mods.fml.common.registry.GameRegistry;\nimport cpw.mods.fml.common.registry.LanguageRegistry;\n\n@Mod(modid = \"RepairTable\", name = \"Repair Table\", version=\"1.0.0\")\n@NetworkMod(channels = { \"RepairTable\" }, versionBounds = \"1.4.5\", clientSideRequired = true, serverSideRequired = false)\npublic class mod_RepairTable implements IGuiHandler{\n       public Block repairTable;\n       @Mod.Instance(\"RepairTable\")\n       public static mod_RepairTable instance;\n \n       @Mod.Init\n       public void load(FMLInitializationEvent evt) {\n              // TODO Auto-generated method stub\n              repairTable = new rtBlockRepairTable(187, Block.brick.blockIndexInTexture, Material.rock)\n              .setBlockName(\"RepairTable\").setCreativeTab(CreativeTabs.tabBlock);\n              GameRegistry.registerBlock(repairTable);\n              LanguageRegistry.addName(repairTable, \"RepairTable\");\n              GameRegistry.registerTileEntity(rtTileEntityRepairTable.class, \"TileEntityRepairTable\");\n              instance = this;\n       }\n\n        @Override\n        public Object getClientGuiElement(int ID, EntityPlayer player, World world,\n                        int x, int y, int z) {\n                // TODO Auto-generated method stub\n        return null;\n        }\n\n        @Override\n        public Object getServerGuiElement(int ID, EntityPlayer player, World world,\n                        int x, int y, int z) {\n                // TODO Auto-generated method stub\n        return null;\n        }\n      \n}\n复制代码\n我暂时先用砖块的贴图来代替吧- -\n\n\n\n\n2012-10-23_19.06.33.png (130.24 KB, 下载次数: 3)\n\n下载附件\n\n2012-10-23 21:24 上传\n\n\n\n\n\n放置方块后你会看见调试窗里出现了刚才写的输出语句。 \n\n\n\n\nhello gui.png (57.9 KB, 下载次数: 3)\n\n下载附件\n\n2012-10-23 21:24 上传\n\n\n\n\n\nupdateEntity会在每个tick里调用一次，每调用一次就相当于刷新一次数据，至于刷新什么数据，这些都是由你自己定的了，一般就是燃烧时间之类的。基本的功能方块就构成了。不过这个方块还没有窗口，只具备了基本的刷新数据的功能，接下来就该做GUI了。 \n新建一个类，名字为rtGuiRepairTable，继承GuiContainer，eclipse修正一下。package net.minecraft.src;\n \npublic class rtGuiRepairTable extends GuiContainer{\n \n       public rtGuiRepairTable(Container par1Container) {\n              super(par1Container);\n              // TODO Auto-generated constructor stub\n       }\n \n       @Override\n       protected void drawGuiContainerBackgroundLayer(float var1, int var2,\n                     int var3) {\n              // TODO Auto-generated method stub\n             \n       }\n \n}复制代码这是一个没有任何东西的基本的GUI。然后再新建一个类，名字为rtContainerRepairTable，继承Container。\npackage net.minecraft.src;\n \npublic class rtContainerRepairTable extends Container{\n \n       @Override\n       public boolean canInteractWith(EntityPlayer var1) {\n              // TODO Auto-generated method stub\n              return true;\n       }\n \n}复制代码canInteractWith返回的是是否打开GUI，设定为true。 \n在gui中覆写drawGuiContainerForegroundLayer（描绘前景文字），以及在drawGuiContainerBackgroundLayer中描绘背景，最后修改一下构造函数：\npackage net.minecraft.src;\n \nimport org.lwjgl.opengl.GL11;\n \npublic class rtGuiRepairTable extends GuiContainer{\n \n       private rtTileEntityRepairTable tile;\n       public rtGuiRepairTable(rtContainerRepairTable par1Container, rtTileEntityRepairTable tileEntity) {\n              super(par1Container);\n              // TODO Auto-generated constructor stub\n              this.tile = tileEntity;\n              this.doesGuiPauseGame();\n       }\n \n             @Override复制代码\n附上描绘用的GUI窗口\n\n\n\n\nRepairTable.png (6.11 KB, 下载次数: 55)\n\n下载附件\n\n2012-10-23 21:25 上传\n\n\n\n\n\n doesGuiPauseGame是是否在打开gui的时候停止游戏。构造函数那里需要返回一个Container。为啥要返回我也不清楚- -我觉得在某些方面有些多余。\n\n接下来就是接口部分了（这个地方很多得重新做啊。。。）\n\n在mod文件中注册IGuiHandler，注册后就能在回调函数getClientGuiElement和getServerGuiElement分别获得Gui和Container，至于这两个函数怎么用，待会解释。\nNetworkRegistry.instance().registerGuiHandler(this, this);复制代码重写mod中的getClientGuiElement\n\n@Override\n        public Object getClientGuiElement(int ID, EntityPlayer player, World world,\n                        int x, int y, int z) {\n                // TODO Auto-generated method stub\n                switch(ID)\n        {\n        case 10:\n               return new rtGuiRepairTable(player.inventory, (rtTileEntityRepairTable)player.worldObj.getBlockTileEntity(x, y, z));\n        }\n        return null;\n        }\n复制代码重写mod中的getServerGuiElement\n\n@Override\n        public Object getServerGuiElement(int ID, EntityPlayer player, World world,\n                        int x, int y, int z) {\n                // TODO Auto-generated method stub\n                switch(ID)\n        {\n        case 10:\n               return new rtContainerRepairTable(player.inventory, (rtTileEntityRepairTable)player.worldObj.getBlockTileEntity(x, y, z));\n        }\n        return null;\n        }复制代码接着是重写block的onBlockActivated@Override\n       public boolean onBlockActivated(World par1World, int par2, int par3,\n                     int par4, EntityPlayer par5EntityPlayer, int par6, float par7,\n                     float par8, float par9) {\n              // TODO Auto-generated method stub\n              par5EntityPlayer.openGui(mod_RepairTable.instance, 10, par1World, par2, par3, par4);\n        return true;\n       }复制代码现在就可以来解释一下GUI的打开流程了：右键激活方块，方块调用EntityPlayer.openGui来打开回调相应端的GUI组件，第一个参数是相应mod的实例，第二个参数是gui的ID，第三个是World实例，第四个到第六个是三个数字，怎么填随你喜欢，一般是给出方块的坐标，方便通过world来查找到对应的TileEntity，由于在1.4中，服务端和客户端是整合在一块的，所以需要两个函数来管理，就是之前在mod文件中的getClientGuiElement和getServerGuiElement，通过这两个函数共同协助才能构建一个GUI，只有经过这条路径来打开的GUI才是能使用的GUI，用Modloader.openGUI来打开的GUI无法更新，只能作为提示窗口来用（基本也没什么提示作用- -）。 完成上述步骤后，你应该就能看到久违的窗口了。\n\n\n\n\n2012-10-23_20.54.34.png (103.51 KB, 下载次数: 6)\n\n下载附件\n\n2012-10-23 21:24 上传\n\n\n\n\n\n\n\n完成这个步骤后得到的代码：\nmod_RepairTable.java\n\npackage net.minecraft.src;\n\nimport cpw.mods.fml.common.Mod;\nimport cpw.mods.fml.common.event.FMLInitializationEvent;\nimport cpw.mods.fml.common.network.IGuiHandler;\nimport cpw.mods.fml.common.network.NetworkMod;\nimport cpw.mods.fml.common.network.NetworkRegistry;\nimport cpw.mods.fml.common.registry.GameRegistry;\nimport cpw.mods.fml.common.registry.LanguageRegistry;\n\n@Mod(modid = \"RepairTable\", name = \"Repair Table\", version=\"1.0.0\")\n@NetworkMod(channels = { \"RepairTable\" }, versionBounds = \"1.4.5\", clientSideRequired = true, serverSideRequired = false)\npublic class mod_RepairTable implements IGuiHandler{\n       public Block repairTable;\n       @Mod.Instance(\"RepairTable\")\n       public static mod_RepairTable instance;\n \n       @Mod.Init\n       public void load(FMLInitializationEvent evt) {\n              // TODO Auto-generated method stub\n              repairTable = new rtBlockRepairTable(187, Block.brick.blockIndexInTexture, Material.rock)\n              .setBlockName(\"RepairTable\").setCreativeTab(CreativeTabs.tabBlock);\n              GameRegistry.registerBlock(repairTable);\n              LanguageRegistry.addName(repairTable, \"RepairTable\");\n              GameRegistry.registerTileEntity(rtTileEntityRepairTable.class, \"TileEntityRepairTable\");\n              NetworkRegistry.instance().registerGuiHandler(this, this);\n              instance = this;\n       }\n\n        @Override\n        public Object getClientGuiElement(int ID, EntityPlayer player, World world,\n                        int x, int y, int z) {\n                // TODO Auto-generated method stub\n                switch(ID)\n        {\n        case 10:\n               return new rtGuiRepairTable(player.inventory, (rtTileEntityRepairTable)player.worldObj.getBlockTileEntity(x, y, z));\n        }\n        return null;\n        }\n\n        @Override\n        public Object getServerGuiElement(int ID, EntityPlayer player, World world,\n                        int x, int y, int z) {\n                // TODO Auto-generated method stub\n                switch(ID)\n        {\n        case 10:\n               return new rtContainerRepairTable(player.inventory, (rtTileEntityRepairTable)player.worldObj.getBlockTileEntity(x, y, z));\n        }\n        return null;\n        }\n      \n}复制代码 \n rtBlockRepairTable.java\npackage net.minecraft.src;\n \npublic class rtBlockRepairTable extends BlockContainer{\n \n       protected rtBlockRepairTable(int par1, int par2, Material par3Material) {\n              super(par1, par2, par3Material);\n              // TODO Auto-generated constructor stub\n       }\n \n       @Override\n       public boolean onBlockActivated(World par1World, int par2, int par3,\n                     int par4, EntityPlayer par5EntityPlayer, int par6, float par7,\n                     float par8, float par9) {\n              // TODO Auto-generated method stub\n               par5EntityPlayer.openGui(mod_RepairTable.instance, 10, par1World, par2, par3, par4);\n             \n \n        return true;\n       }\n \n       @Override\n       public TileEntity createNewTileEntity(World var1) {\n              // TODO Auto-generated method stub\n              return new rtTileEntityRepairTable();\n       }\n \n}复制代码 \nrtGuiRepairTable.java\npackage net.minecraft.src;\n \nimport org.lwjgl.opengl.GL11;\n \npublic class rtGuiRepairTable extends GuiContainer{\n \n       private rtTileEntityRepairTable tile;\n       public rtGuiRepairTable(InventoryPlayer inventory, rtTileEntityRepairTable tileEntity) {\n              super(new rtContainerRepairTable(inventory, tileEntity));\n              // TODO Auto-generated constructor stub\n              this.tile = tileEntity;\n              this.doesGuiPauseGame();\n       }\n \n       @Override\n       protected void drawGuiContainerForegroundLayer(int par1, int par2) {\n                   // TODO Auto-generated method stub\n                   super.drawGuiContainerForegroundLayer(par1, par2);\n        this.fontRenderer.drawString(StatCollector.translateToLocal(\"RepairTable\"), 65, 6, 4210752);\n        this.fontRenderer.drawString(StatCollector.translateToLocal(\"container.inventory\"), 8, this.ySize - 96 + 2, 4210752);\n       }\n \n       @Override\n       protected void drawGuiContainerBackgroundLayer(float var1, int var2,\n                     int var3) {\n              // TODO Auto-generated method stub\n              int var4 = this.mc.renderEngine.getTexture(\"/gui/RepairTable.png\");\n        GL11.glColor4f(1.0F, 1.0F, 1.0F, 1.0F);\n        this.mc.renderEngine.bindTexture(var4);\n        int var5 = (this.width - this.xSize) / 2;\n        int var6 = (this.height - this.ySize) / 2;\n        this.drawTexturedModalRect(var5, var6, 0, 0, this.xSize, this.ySize);\n       }\n \n}复制代码 \n rtContainerRepairTable.java\npackage net.minecraft.src;\n \npublic class rtContainerRepairTable extends Container{\n       private rtTileEntityRepairTable tile;\n       public rtContainerRepairTable(InventoryPlayer par1InventoryPlayer, rtTileEntityRepairTable par2TileEntityRepairTable)\n       {\n              tile = par2TileEntityRepairTable;\n       }\n       @Override\n       public boolean canInteractWith(EntityPlayer var1) {\n              // TODO Auto-generated method stub\n              return true;\n       }\n \n}复制代码\n rtTileEntityRepairTable.java\n\npackage net.minecraft.src;\n \npublic class rtTileEntityRepairTable extends TileEntity{\n \n       @Override\n       public void updateEntity() {\n              // TODO Auto-generated method stub\n              super.updateEntity();\n              System.out.println(\"Hello GUI\");\n       }\n \n}复制代码\n\n貌似有些地方跳过了- -跟着工程的代码凑合一下吧（我觉得我真心不适合教书- -）。。。第一篇就先做到这里，后面还有很多东西要说。。。\n预定的内容：自定义TileEntity的行为\n进度条的描绘\n数据的同步\n一些注意事项\n或者还有些什么突然想起的东西- -\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "zjy",
            "timestamp": 1350999600,
            "txt_content": "不会MOD的路过围观"
        },
        {
            "author": "Vidocq",
            "timestamp": 1350999600,
            "txt_content": "速度拿下SF"
        },
        {
            "author": "洛音",
            "timestamp": 1351000980,
            "txt_content": "强大啊1.4已出"
        },
        {
            "author": "hendyzone",
            "timestamp": 1351001100,
            "txt_content": "前排支持{:10_512:}  GUI和Entity 都是蛋疼的东西。。。"
        },
        {
            "author": "1440519152",
            "timestamp": 1396879680,
            "txt_content": "好屌，我要看看"
        }
    ]
}