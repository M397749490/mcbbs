{
    "title": "在你的存档中实现自定义结构并让其随机生成",
    "author": "BR★S",
    "replyCount": 4,
    "timestamp": 1583316840,
    "txt_content": " 本帖最后由 BR★S 于 2020-3-4 18:14 编辑 \n在你的存档中实现自定义结构并让其随机生成在开始前的一些必要工作\n◆ 首先你必须知道什么是Minecraft的数据包\n◆ 其次你必须对原版指令非常熟悉(比如execute)\n◆ 再者你必须深入了解结构方块的运作原理\n◆ 最后就是具备一个水含量丰富的人脑\n◆ 如果以上缺少一个那就不用往下翻了\n教程说明：以下部分内容包含本人还未实现的想法和已实现的功能,如果你有更好的方法愿意和我分享请在下方留言善意的警告：以下内容是特别针对于1.16(20w09a)编写的教程,在其他版本可能有轻微的不适用不善意的警告：本文内容大量为思路指点无代码结构如果你有冲动想尝试一下可以私下联系我,联系方式在最底部\n1.什么是结构  Structures:我们都知道Minecraft中存在许多特殊结构，比如:村庄、船骸、地牢、矿井、地狱堡垒、海底神殿、丛林遗迹、沙漠遗迹等，这些结构都被统一保存为NBT格式存放在.minecraft/versions/20w09a/20w09a.jar中，你可以用你的压缩包软件打开他并在data文件夹中能找到structures文件夹，这里面就存放了所有结构的数据。 然而当你打开这些文件你会发现是一串无规律的看上去很恶心的数字，不要怕因为我们不需要你来编写这些数字。因为你的客户端比你更聪明，他们会去解析这些数据来生成对应的结构。2.搭建&保存结构(推荐在单人游戏内进行并做好备份)利用结构方块的[数据模式]我们可以很轻松的将你想要在地图内随机生成的结构保存下来，保存下来的结构都会被存放在.minecraft/saves/存档/generated/minecraft/structures内同样的它们也是NBT格式文件。3.创建数据包    为了方便演示，我们新建一个名为testbuild的文件夹放在.minecraft/saves/存档/datapacks内在test内按顺序新建data/testbuild并在data文件夹下新建一个pack.mcmeta文件并在文件内输入以下代码：\n{\n        \"pack\": {\n                \"pack_format\": 4,\n                \"description\": \"这里写你的注释可以使用颜色字符§\"\n        }\n}复制代码紧接着在data/testbuild下新建structures(用来存放你的结构)和functions(用来存放函数文件，这个后面会讲)文件夹。接着将你在第二步中保存的结构文件复制到数据包的structures文件夹内。\n继续在data文件夹下创建一个名为minecraft的文件夹按并在其中顺序新建tags/functions文件夹(功能会在后面讲到)\n到这里你已经成功创建了一个空的数据包框架。4.随机生成概率问题先来简述一下我的两个随机生成思路：\n\n1. 利用execute的if或unless来判断玩家所处环境\n2. 当玩家满足条件时在玩家位置生成n个隐身无重力带Tag的盔甲架\n3. 在1游戏刻内立即将盔甲架通过spreadplayers扩散到一定范围内\n4. 若扩散开的盔甲架继续满足需要生成结构的条件则利用结构方块搭建结构\n5. 不满足条件的盔甲架则直接销毁\n\n1. 利用execute和predicate来判断玩家所处环境\n2. 当玩家满足predicate条件时则生成n个带有Tag的area_effect_cloud\n3. 同样在1游戏刻内spreadplayers进行扩散\n4. 重复方案一中的4.5两步\n\n我们用方案一来举个例子：\n如图假设在一个1000x1000x1000的空间内方块按如下排布(左图)\nXXXXXXXXOOOOOOOO这里X表示海洋O表示橙色黏土区\nX和O各站50%及每个格子代表62500个方块\n如图所示我们希望当玩家站在9个橙色黏土块上并且在玩家前后左右都有1个枯死的灌木时就有x%的概率在黏土山表面生成一个这样(右图)的结构。\n\n\n\n\n图片2.png (36.49 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-4 17:44 上传\n\n\n\n\n\n\n\n\n图片1.png (5.54 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-4 17:43 上传\n\n\n\n\n\n\n下面我们开始利用小学教过的古典概型公式线性回归方程,面微积分,和传染病学模型来计算概率(一些繁琐的步骤我就省掉了)：\n◆首先我们必须知道spreadplayers是如何分布的(举个例子:/spreadplayers 0 2 1 10 false @e[scores={death_count=1}])就是将以x坐标为0，z坐标为2为中心，扩散半径为10，实体间距为1，不启用队伍模式，目标为计分项death_count的键值为1的目标进行随机扩散。\n◆由于扩散只会将实体扩散至非透明方块所以水方块不计入总数这样我们的实际可扩散最大范围就是500x1000x1000，在不考虑存在洞穴的情况下，由于扩散是随机的也就是盔甲架会扩散到这些方块上的概率是均等的，假设该片黏土山上有100处这样不相连平均距离为5000格的灌木结构且玩家随便走动1000格，则该灌木结构被找到并且玩家能走道检测中心的平均概率为(1.91%)那么也就是说在这么大区域内有1.93%的概率会触发盔甲架扩散功能，假设我们有5个盔甲架被扩散且扩散半径为500平均间距为500，则以该玩家触发点为中心范围500x500内出现频率灌木结构的数量最多的为3-5个，我们假设理想状态   下每个盔甲架扩散至触发点灌木的概率依旧为1.91%，那么综上所述可能出现(*)结构的概率为p(结构生成的概率)=[(1.91%x5)x1.91%]^1.085=0.10671485082732135389582039095%(可能不准确,我用的是散点分布概率,第一型曲面微积分和传染病学模型)5.结构框架函数在了解完概率模型后我们来实现环境判定和盔甲架结构生成功能吧\n在functions文件夹下新建一个check.mcfunction,spread.mcfunction和start_build.mcfunction文件，我们先来处理环境判定模块。\n在check.mcfunction中输入以下指令：\nexecute at @p[gamemode=survival] if block ~ ~-1 ~ minecraft:orange_terracotta if block ~1 ~-1 ~ minecraft:orange_terracotta if block ~-1 ~-1 ~ minecraft:orange_terracotta if block ~ ~-1 ~1 minecraft:orange_terracotta if block ~ ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~-1 ~1 minecraft:orange_terracotta if block ~1 ~-1 ~-1 minecraft:orange_terracotta if block ~-1 ~-1 ~1 minecraft:orange_terracotta if block ~-1 ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~ ~ dead_bush if block ~-1 ~ ~ dead_bush if block ~ ~ ~1 minecraft:dead_bush if block ~ ~ ~-1 dead_bush at @p run function testbuild:spread\n#判断玩家是否处于4中图示结构内复制代码在spread.mcfunction中输入以下指令：\nexecute as @p[gamemode=survival] run summon armor_stand ~ ~ ~ {Tags:[“build_AS”],NoGravity:1b,Invisible:1b}\nexecute as @p[gamemode=survival] run summon armor_stand ~ ~ ~ {Tags:[“build_AS”],NoGravity:1b,Invisible:1b}\nexecute as @p[gamemode=survival] run summon armor_stand ~ ~ ~ {Tags:[“build_AS”],NoGravity:1b,Invisible:1b}\nexecute as @p[gamemode=survival] run summon armor_stand ~ ~ ~ {Tags:[“build_AS”],NoGravity:1b,Invisible:1b}\nexecute as @p[gamemode=survival] run summon armor_stand ~ ~ ~ {Tags:[“build_AS”],NoGravity:1b,Invisible:1b}\n#连续生成5个盔甲架\nspreadplayers ~ ~  500 500 false @e[tag=build_AS]\n#随机扩散盔甲架复制代码在build.mcfunction中输入以下指令：execute at @e[tag=build_AS] if block ~ ~-1 ~ minecraft:orange_terracotta if block ~1 ~-1 ~ minecraft:orange_terracotta if block ~-1 ~-1 ~ minecraft:orange_terracotta if block ~ ~-1 ~1 minecraft:orange_terracotta if block ~ ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~-1 ~1 minecraft:orange_terracotta if block ~1 ~-1 ~-1 minecraft:orange_terracotta if block ~-1 ~-1 ~1 minecraft:orange_terracotta if block ~-1 ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~ ~ dead_bush if block ~-1 ~ ~ dead_bush if block ~ ~ ~1 minecraft:dead_bush if block ~ ~ ~-1 dead_bush at @p run setblock ~ ~1 ~ minecraft:structure_block{mode:\"LOAD\",posX:0,posY:1,posZ:0,name:你的结构名,powered:0b}\n#判断盔甲架是否满足条件若满足则放置结构方块\nexecute at @e[tag=build_AS] if block ~ ~-1 ~ minecraft:orange_terracotta if block ~1 ~-1 ~ minecraft:orange_terracotta if block ~-1 ~-1 ~ minecraft:orange_terracotta if block ~ ~-1 ~1 minecraft:orange_terracotta if block ~ ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~-1 ~1 minecraft:orange_terracotta if block ~1 ~-1 ~-1 minecraft:orange_terracotta if block ~-1 ~-1 ~1 minecraft:orange_terracotta if block ~-1 ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~ ~ dead_bush if block ~-1 ~ ~ dead_bush if block ~ ~ ~1 minecraft:dead_bush if block ~ ~ ~-1 dead_bush at @p run setblock ~ ~ ~ minecraft:redstone_block\n#激活结构方块\nexecute at @e[tag=build_AS] if block ~ ~-1 ~ minecraft:orange_terracotta if block ~1 ~-1 ~ minecraft:orange_terracotta if block ~-1 ~-1 ~ minecraft:orange_terracotta if block ~ ~-1 ~1 minecraft:orange_terracotta if block ~ ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~-1 ~1 minecraft:orange_terracotta if block ~1 ~-1 ~-1 minecraft:orange_terracotta if block ~-1 ~-1 ~1 minecraft:orange_terracotta if block ~-1 ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~ ~ dead_bush if block ~-1 ~ ~ dead_bush if block ~ ~ ~1 minecraft:dead_bush if block ~ ~ ~-1 dead_bush at @p run setblock ~ ~1 ~ minecraft:air\nexecute at @e[tag=build_AS] if block ~ ~-1 ~ minecraft:orange_terracotta if block ~1 ~-1 ~ minecraft:orange_terracotta if block ~-1 ~-1 ~ minecraft:orange_terracotta if block ~ ~-1 ~1 minecraft:orange_terracotta if block ~ ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~-1 ~1 minecraft:orange_terracotta if block ~1 ~-1 ~-1 minecraft:orange_terracotta if block ~-1 ~-1 ~1 minecraft:orange_terracotta if block ~-1 ~-1 ~-1 minecraft:orange_terracotta if block ~1 ~ ~ dead_bush if block ~-1 ~ ~ dead_bush if block ~ ~ ~1 minecraft:dead_bush if block ~ ~ ~-1 dead_bush at @p run setblock ~ ~ ~ minecraft:air\n#结构生成成功后删除红石块和结构方块\nexecute at @e[tag=build_AS] run kill @e[tag=build_AS]\n#清空盔甲架复制代码到这里我们就完成了随机生成的核心模块但是你会发现文章并没有结束为什么呢？我们继续往下看！\n6.赫鲁晓夫的小修小补    既然已经成功生成了结构现在我们通过functions功能来继续改善我们的结构吧。\n    要想作为一个优秀的数据包开发者我们必须对各个方面都进行考虑。\n    我们肯定是不希望玩家无限地刷出该类结构并利用生成条件来做出刷结构机。\n    为了应对这种情况我们可以使用计分板功能：\n◆先设置一个计分板/scoreboard objectives add build_count\n◆随后我们启用这个计分板并赋值为0\n◆然后我们将spread.mcfunction @p中的选择器新增scores={build_count=0..500}\n◆继续在build.mcfunction中增加为该积分项增值的功能(自己去试吧)\n这样我们就实现了控制整个存档中只能有500个这样的箱子结构\n当然你也可以通过execute的子命令in来实现不同维度的不同结构7.总结◆同样的方法二也是差不多的做法但是你可以通过predicate来更精确地控制结构的刷出位置(predicate拥有更详细的判据)\n◆通过随机结构你可以实现在主世界，下届，末地生成更多好玩且充满挑战的结构，你还可以设置战利品宝箱，甚至是遗迹守护神等，这些都在等你去探索\n◆今后我会给出更多关于datapack的教程来丰富原版存档\n◆当然如果你将这个数据包弄的很完美的话他是可以在服务器上运行的\n◆具体操作你可以前往wiki寻找帮助\n◆如果你有一些奇特的想法或者是一些疑问可以通过下面这个链接和我取得联系\n跳转链接\n",
    "replies": [
        {
            "author": "aoziEOVE",
            "timestamp": 1583317740,
            "txt_content": "感谢分享 让我的服务器又可以多几种玩法了"
        },
        {
            "author": "BR★S",
            "timestamp": 1583318100,
            "txt_content": " 本帖最后由 BR★S 于 2020-3-4 18:51 编辑 \n补充:关于tick循环执行function\n\n在data/minecraft/tags/functions文件夹中新建名为tick.json的文件并按如下代码填入：\n{\n    \"values\": [\n        \"<命名空间>:<对应function>\"\n    ]\n}\n复制代码在每次/reload之后便会以每秒20次的速度执行该function此外，为了能顺利销毁掉多余的盔甲架或者是area_effect_cloud我们需要在每次reload之后强制载入区块因此我们需要手动输入指令/forceload add 0 0\n在解释一下那个最后概率总结的公式后面的指数是浮动指数\n 实在是不会排版就凑合着看看吧。"
        },
        {
            "author": "Aikini",
            "timestamp": 1583318460,
            "txt_content": "正愁整合包的自定义结构咋整呢，这么巧"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1583374020,
            "txt_content": "一般人们用as/aec来标记已生成的区块来避免重复生成，而不是限定次数，因为限定次数相应的结构也可以在一处多次生成。通过判断玩家是否在as/aec标定的一个范围内(例如一个32*32区域)来确定是否生成，也可以用例如y=0的基岩替换为其它方块(如屏障)等方式来标记。"
        }
    ]
}