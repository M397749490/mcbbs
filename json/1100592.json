{
    "title": "[结]Bukkit通过反序列化得到的ItemStack与通过游戏内物品得到的不Equals如何解..",
    "author": "月银秋",
    "replyCount": 8,
    "timestamp": 1597296300,
    "txt_content": " 本帖最后由 月银秋 于 2020-8-16 16:15 编辑 \n\n如题，我先将游戏内物品获取ItemStack，存入Yaml，随后取出，再调用Equals，最后得到的竟然是false？\n\n\n\n\nimage.png (32.69 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-13 13:19 上传\n\n\n\n\n\n\nitems是一个以ItemStack为key，int为value的一张Map，里面只有一个元素，就是反序列化取出来的。（这里只是测试，所以写的比较乱。）\n对应的输出是这样的：\n[13:17:23] [Server thread/INFO]: ItemStack{EGG x 1, UNSPECIFIC_META:{meta-type=UNSPECIFIC, display-name=Strange Egg}}\n[13:17:23] [Server thread/INFO]: {ItemStack{EGG x 1, UNSPECIFIC_META:{meta-type=UNSPECIFIC, display-name=Strange Egg}}=64}\n[13:17:23] [Server thread/INFO]: ItemStack{EGG x 1, UNSPECIFIC_META:{meta-type=UNSPECIFIC, display-name=Strange Egg}}\n[13:17:23] [Server thread/INFO]: false\n[13:17:23] [Server thread/INFO]: false复制代码\n俩ItemStack输出时都是一样的……结果Similar和Equals判断都是false……\n随后我还尝试了在Map中继续添加一个，添加成功，然后做序列化……结果……出现了两段完全一样的……\n\n\n\n\nimage.png (30.37 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-13 13:23 上传\n\n\n\n\n\n所以ItemStack使用Equals或者Similar判断是会出现问题的么……那应该用什么嘞……？？因为我要确保Meta和Material都一致。",
    "replies": [
        {
            "author": "洞穴夜莺",
            "timestamp": 1597296480,
            "txt_content": " 本帖最后由 洞穴夜莺 于 2020-8-13 13:56 编辑 \n\n我错了，对不起"
        },
        {
            "author": "月银秋",
            "timestamp": 1597296540,
            "txt_content": " 本帖最后由 月银秋 于 2020-8-13 13:34 编辑 \n洞穴夜莺 发表于 2020-8-13 13:28\nHashMap中不得以ItemStack为键\n还有这种事情……所以要解决的话是……做成list遍历？或者说不能存的原因是hash会不同，换TreeMap是不是可以解？等等……不对啊……我是取出来之后Equals也不相等鸭……"
        },
        {
            "author": "月银秋",
            "timestamp": 1597297500,
            "txt_content": "洞穴夜莺 发表于 2020-8-13 13:28\nHashMap中不得以ItemStack为键\n使用list一样如此……因为Equals……就是false……"
        },
        {
            "author": "洞穴夜莺",
            "timestamp": 1597298100,
            "txt_content": "月银秋 发表于 2020-8-13 13:45\n使用list一样如此……因为Equals……就是false……\n好吧，我查了源码，Bukkit的ItemStack是可以作为HashMap的key的，问题似乎不在这里"
        },
        {
            "author": "洞穴夜莺",
            "timestamp": 1597298580,
            "txt_content": "你去单步调试一下isSimilar哪步判断两个物品不相似吧"
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1597303380,
            "txt_content": " 本帖最后由 疾风暗影 于 2020-8-13 15:25 编辑 \n\n序列化ItemStack会调整nbt标签的顺序，表现为序列化+反序列化出来的物品跟原物品无法堆叠了，也就造成isSimilar返回false\n\n具体请看：https://hub.spigotmc.org/jira/browse/SPIGOT-3206\nmd_5的回复\nUnavoidable with the conversion from section signs and backwards\n\n也就是这是bug，但是不可修复"
        },
        {
            "author": "月银秋",
            "timestamp": 1597307160,
            "txt_content": "疾风暗影 发表于 2020-8-13 15:23\n序列化ItemStack会调整nbt标签的顺序，表现为序列化+反序列化出来的物品跟原物品无法堆叠了，也就造成isSim ...\n啊这……感谢了……"
        },
        {
            "author": "guqin",
            "timestamp": 1597333500,
            "txt_content": "MCBBS有你更精彩~"
        }
    ]
}