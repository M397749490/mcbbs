{
    "title": "CustomNpcs 1.7.10d 在删除玩家档案的时候产生严重lag的情况",
    "author": "1258032547",
    "replyCount": 7,
    "timestamp": 1580283360,
    "txt_content": "来自一个运营了4年的服务器的玩家档案，在服务器上就已经产生了这种问题。在排除其他可能原因的情况后，将saves中的customnpcs文件夹复制到了单机存档中并进行测试，问题同样发生了。\n具体表现为：当刚点开玩家档案并读取玩家档案列表时，会有很长一段时间无法显示出来，同时游戏内所有生物停止行动，放置方块的声音延后到一段时间后再同时出现，相当于游戏假死。\n这种问题也同样出现在尝试点开某个玩家的Quest list，Dialog list等等，并尝试删除任意一条对话或任务时。每进行一次操作，游戏就会有卡顿，如果在卡顿的时候连续进行多次删除操作，那么游戏就会卡很长一段时间。这段时间内，我无法对其他生物造成任何伤害，也无法对方块进行实质性的变更。\n在这种情况下我分别检查了客户端的log和customnpcsmod的log，分别为如下情况：\n可见，客户端log里出现了延迟，但不明原因。而customnpcs的log里则没有任何相关报错提示。\n\n十分严重的疑难杂症，希望有路过懂行的大神予以解答，感激不尽！\n\n\n\n\n\nQQ截图20200129153424.png\n(13.11 KB, 下载次数: 0)\n\n\n\n\n下载附件\n\n\n2020-1-29 15:35 上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nQQ截图20200129153454.png\n(14.55 KB, 下载次数: 0)\n\n\n\n\n下载附件\n\n\n2020-1-29 15:35 上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "粘兽",
            "timestamp": 1580283900,
            "txt_content": "数据太多 在读取时会卡线程导致假死\n办法有两个\n1.清理数据 减少数据体积（简单 但需牺牲部分玩家的数据）\n2.将读取数据操作改为多线程/异步（复杂 需敲代码）"
        },
        {
            "author": "1258032547",
            "timestamp": 1580291880,
            "txt_content": "粘兽 发表于 2020-1-29 15:45\n数据太多 在读取时会卡线程导致假死\n办法有两个\n1.清理数据 减少数据体积（简单 但需牺牲部分玩家的数据）\n我认为应该不是数据过多的问题……\n因为在意识到卡顿的时候我检查过playerdata，里面有1000左右个文件，在之后我已经删掉了一半多，剩下400多个对象，但依旧十分卡。\n这种卡顿应该说是突如其来的，在那天我删着删着就变得越来越卡，以至于现在的地步。在出事之前，我相信数据量远远超过了400，并保持在其上很长的时间，都没有经历过这样的卡顿。"
        },
        {
            "author": "粘兽",
            "timestamp": 1580292120,
            "txt_content": "1258032547 发表于 2020-1-29 17:58\n我认为应该不是数据过多的问题……\n因为在意识到卡顿的时候我检查过playerdata，里面有1000左右个文件， ...\n你检查的是哪个playerdata\n是cnpc的么？"
        },
        {
            "author": "1258032547",
            "timestamp": 1580294040,
            "txt_content": "粘兽 发表于 2020-1-29 18:02\n你检查的是哪个playerdata\n是cnpc的么？\n当然是的，里面放着所有玩家的对话和任务数据，我都检查过"
        },
        {
            "author": "粘兽",
            "timestamp": 1580294340,
            "txt_content": "1258032547 发表于 2020-1-29 18:34\n当然是的，里面放着所有玩家的对话和任务数据，我都检查过\n那你备份一份 把数据全部清空看看"
        },
        {
            "author": "1258032547",
            "timestamp": 1580295300,
            "txt_content": "粘兽 发表于 2020-1-29 18:39\n那你备份一份 把数据全部清空看看\n我在备份后删除掉所有数据，随后又随机抽取几个玩家的数据导入，问题仍然存在，虽然卡顿的程度不及刚才，但比起之前没事的时候仍然卡了许多许多。\n……这让我越来越感到疑惑了，到底是什么导致它变成这样的……"
        },
        {
            "author": "粘兽",
            "timestamp": 1580295720,
            "txt_content": "1258032547 发表于 2020-1-29 18:55\n我在备份后删除掉所有数据，随后又随机抽取几个玩家的数据导入，问题仍然存在，虽然卡顿的程度不及刚才， ...\n或许是每个玩家整体的数据也在变大\n你可以打开看看里面都存了些什么"
        }
    ]
}