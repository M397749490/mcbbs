{
    "title": "【技术向】Python控制BungeeCord以及Spigot服务器",
    "author": "fred913",
    "replyCount": 3,
    "timestamp": 1593759480,
    "txt_content": " 本帖最后由 fred913 于 2020-7-3 15:02 编辑 \n\n正闲着，给q3（Bilibili为@特别中二的q3君 ）服务器重写了一下官网和服务器控制系统，Python控制BungeeCord与Spigot服务器的核心代码我放在下面，为subprocess制作，服务器jar、配置需自己准备、修改，但是Python提供运行环境托管以及远程运行命令。（下方代码块里的空格被吞了qwq）\n# coding: utf-8\nimport subprocess as subp\nimport io\n\n\nclass MinecraftServer:\n    def __init__(self, jar, java=\"java\"):\n        self.jar_path = jar\n        self.java = java or \"java\"\n        self.process = None\n\n    def start(self):\n        self.process = subp.Popen(\n            [self.java, \"-jar\", self.jar_path],\n            stdin=subp.PIPE,\n            stdout=subp.PIPE,\n            stderr=subp.PIPE,\n        )\n\n    @property\n    def stdout(self) -> io.TextIOWrapper:\n        if not self.process:\n            return \"服务器未启动，请启动服务器后执行命令！\"\n        return self.process.stdout\n\n    @property\n    def stderr(self) -> io.TextIOWrapper:\n        if not self.process:\n            return \"服务器未启动，请启动服务器后执行命令！\"\n        return self.process.stderr\n\n    @property\n    def stdin(self) -> io.TextIOWrapper:\n        if not self.process:\n            return \"服务器未启动，请启动服务器后执行命令！\"\n        return self.process.stdin\n\n    def exec_command(self, command, get_output=False):\n        if not self.process:\n            return \"服务器未启动，请启动服务器后执行命令！\"\n        self.stdin.write(command)\n        self.stdin.write(\"\\n\")\n        self.stdin.flush()\n        if get_output:\n            return self.stdout.read()\n        else:\n            return None\n\n\nclass Spigot(MinecraftServer):\n    def __init__(self, jar, java=\"java\"):\n        super(self, MinecraftServer).__init__(jar, java)\n\n\nclass BungeeCord(MinecraftServer):\n    def __init__(self, jar, java=\"java\", servers=None):\n        super(self, MinecraftServer).__init__(jar, java)\n        self.servers = servers or []\n\n    def start(self):\n        for server in self.servers:\n            server.start()\n        return super(self, MinecraftServer).start()\n\n    def add_server(self, server: MinecraftServer):\n        self.servers.append(server)\n复制代码\n同时，对脚本进行二次开发也很简单，只需创建一个继承MinecraftServer的类即可。\n代码进行语法高亮如下：\n# coding: utf-8\nimport subprocess as subp\nimport io\n\n\nclass MinecraftServer:\n    def __init__(self, jar, java=\"java\"):\n        self.jar_path = jar\n        self.java = java or \"java\"\n        self.process = None\n\n    def start(self):\n        self.process = subp.Popen(\n            [self.java, \"-jar\", self.jar_path],\n            stdin=subp.PIPE,\n            stdout=subp.PIPE,\n            stderr=subp.PIPE,\n        )\n\n    @property\n    def stdout(self) -> io.TextIOWrapper:\n        if not self.process:\n            return \"服务器未启动，请启动服务器后执行命令！\"\n        return self.process.stdout\n\n    @property\n    def stderr(self) -> io.TextIOWrapper:\n        if not self.process:\n            return \"服务器未启动，请启动服务器后执行命令！\"\n        return self.process.stderr\n\n    @property\n    def stdin(self) -> io.TextIOWrapper:\n        if not self.process:\n            return \"服务器未启动，请启动服务器后执行命令！\"\n        return self.process.stdin\n\n    def exec_command(self, command, get_output=False):\n        if not self.process:\n            return \"服务器未启动，请启动服务器后执行命令！\"\n        self.stdin.write(command)\n        self.stdin.write(\"\\n\")\n        self.stdin.flush()\n        if get_output:\n            return self.stdout.read()\n        else:\n            return None\n\n\nclass Spigot(MinecraftServer):\n    def __init__(self, jar, java=\"java\"):\n        super(self, MinecraftServer).__init__(jar, java)\n\n\nclass BungeeCord(MinecraftServer):\n    def __init__(self, jar, java=\"java\", servers=None):\n        super(self, MinecraftServer).__init__(jar, java)\n        self.servers = servers or []\n\n    def start(self):\n        for server in self.servers:\n            server.start()\n        return super(self, MinecraftServer).start()\n\n    def add_server(self, server: MinecraftServer):\n        self.servers.append(server)\n\n\n\n\n",
    "replies": [
        {
            "author": "WYL0zhu",
            "timestamp": 1593759540,
            "txt_content": "你那代码根本没法用。\n为什么不发到游戏技巧版。"
        },
        {
            "author": "fred913",
            "timestamp": 1593759540,
            "txt_content": "WYL0zhu 发表于 2020-7-3 14:59\n你那代码根本没法用。\n为什么不发到游戏技巧版。\n我测试过的，python3，应该可以的啊"
        },
        {
            "author": "WYL0zhu",
            "timestamp": 1593759660,
            "txt_content": "fred913 发表于 2020-7-3 14:59\n我测试过的，python3，应该可以的啊\n刚才你那代码是乱码，现在好了。"
        }
    ]
}