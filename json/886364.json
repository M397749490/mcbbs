{
    "title": "[PCD]爷爷都看得懂的从零开始的核心代码注入教程(二)",
    "author": "弱鸡绿毛怪",
    "replyCount": 1,
    "timestamp": 1563187380,
    "txt_content": " 本帖最后由 MagicLocyDragon 于 2019-7-15 20:31 编辑 \n\n 2-1 前言 · 如果你没有看我的上一个教程，请先去看一下.\n                  >>> 点我跳转 <<<\n· 本教程所有源码都是开源的，而且你可以任意使用。\n· 上一个教程是一年前发的，鬼知道一年后我又来更新了，想不到吧\n\n 2-2 学习目标 ·通常情况下，核心注入部分代码.Jar 和 插件.Jar 是分开来写的。\n·但是，如果核心注入和插件代码放在一起，岂不美哉?用户也不用下载两个jar了，但实际上这是行不通的.\n·接下来，我们会解释一下为啥必须要这么做。\n\n 2-3 核心注入代码和插件代码必须分开的原因 · 在弄懂这个问题之前，我们必须简单了解一下一个插件是怎么加载进服务器的.\n   首先，核心会调用这个插件的主类的构造方法，众所周知，插件的主类是继承JavaPlugin的，而通常情况下，插件主类的构造方法我们是不重写的，所以就等于调用了父类JavaPlugin的构造方法.就是底下这个东西.\n\n\n\n\n\nTIM截图20190715183349.jpg (28.98 KB, 下载次数: 0)\n\n下载附件\n\n2019-7-15 18:34 上传\n\n\n\n\n\n    实际上，若一个插件和核心注入代码部分放在一起，在启用JavaAgent的时候，整个Jar的类都会加载进java的ClassLoader里去，而非上面代码第三行的PluginClassLoader.这就导致\nif (!(classLoader instanceof PluginClassLoader)) {\n这一行逻辑判断是true，就会抛出IllegalStateException，导致插件也加载不进去，迫使插件和核心注入的jar分开来写。\n\n小贴士: 如果你在核心注入的时候改了JavaPlugin的构造方法，把这段判断代码删掉，还是没用的……所以说老老实实地把核心注入的jar和插件.jar分开来打包吧\n\n本以为这章教程能写很长，鬼知道就这点[groupid=1330]PluginsCDTribe[/groupid]",
    "replies": [
        {
            "author": "呆瓜Domado",
            "timestamp": 1563192720,
            "txt_content": "教程写的不错，顶一个"
        }
    ]
}