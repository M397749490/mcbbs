{
    "title": "一个多个BungeeCord互联互通方案",
    "author": "vtscn",
    "replyCount": 7,
    "timestamp": 1583755320,
    "txt_content": " 本帖最后由 vtscn 于 2020-3-26 23:18 编辑 \n\n本文可能涉及到的内容\nBungee, RedisBungee, YinwuChat, MySQL, Redis, Haproxy\n写在前面\n\n看到有些dalao在其他帖子里问两个或多个Bungee如何整合, 这里结合我自己的经验来介绍一下.\n\n为什么要用多Bungee互联\n 我有经营一个公益服, 服务器有三个群体想要在一起玩: \n - 一个是位于欧洲的玩家群体, 人很少但是有; \n - 一个是位于大陆的玩家群体, 这是人最多的; \n - 还有一个是位于澳洲的玩家群体, 人很少, 几乎没人在线;\n这时候问题来了, 蹦一次极就能解决的问题, 为什么要蹦三次呢?\n原因是这样的, 我希望能够让这几个区域的玩家都能够在在线列表中出现, 因为这样能够显得服务器更热闹, 而且还想要不同区域的玩家的聊天信息能够互通. 单个BungeeCord是无法实现的.\n好, 那接下来就讲一下如何实现.\n实现方法\n首先搭建3个BungeeCord网络, 具体搭建方法请参考论坛内其他教程, 这里不再详述. 我们给这三个BungeeCord网络分别根据地理位置命名: CN, NL, SG.\n然后\n安装RedisBungee插件到BungeeCord\n下载RedisBungee插件: https://github.com/minecrafter/RedisBungee\n这里有个坑, 官方版的RedisBungee可能导致一些奇怪的问题, 需要自行修复. 因为RedisBungee是付费插件, 所以请自行购买后私聊我提供购买证明,我可以发给你LinTx的修复版本.\n下载完成后将RedisBungee-0.5.1.jar放置到每个BungeeCord的plugins文件夹里, 然后运行每个BungeeCord来生成初始化配置文件. 然后就可以先不用管了.\n\nRedis服务器位置的选择和安装Redis服务器\n既然用到了RedisBungee那么一定就需要Redis了:\nRedis是一個使用ANSI C編寫的開源、支援網路、基於記憶體、可選永續性的鍵值對儲存資料庫。從2015年6月開始，Redis的開發由Redis Labs贊助，而2013年5月至2015年6月期間，其開發由Pivotal贊助。在2013年5月之前，其開發由VMware贊助。\nRedis和MySQL类似, 但更简单也更轻便. 由于Redis服务器需要从各个区域进行连接, 因此在我的部署过程中我选择使用香港的服务器搭建. 建议在实际部署过程中按照自己的需求, 部署在几个BungeeCord网络的中点位置以最大化优化延迟.关于安装, 这里只提供CentOS下的安装方法, 其他操作系统下的安装方法大同小异:1. 首先SSH登入服务器, 切换到root权限;\n2. 执行\nyum install epel-release -y复制代码3. 执行\nyum install redis -y复制代码4. 启用redis服务\nsystemctl enable redis #CentOS7复制代码5. 检查启动状态(一般可以忽略), 然后编辑/etc/redis.conf文件, 找到61行:\n#bind 0.0.0.0复制代码去掉#注释来启用外部连接.\n第84行\nport 6379复制代码可以根据需要来修改监听的端口.\n第480行\nrequirepass 密码复制代码可以设定Redis连接密码, 建议设定一个高强度的密码.\n完成设定之后请确认防火墙打开了你设定的端口, 然后重启redis服务:\nservice redis restart复制代码如果都是Running或Active, 到这里就可以了.\n设定RedisBungee\n回到RedisBungee, 每个BungeeCord的plugins目录下RedisBungee的配置文件config.yml都需要按照以下内容进行修改:\n# RedisBungee configuration file.\n# PLEASE READ THE WIKI: https://github.com/minecrafter/RedisBungee/wiki\n\n# The Redis server you use.\n# Get Redis from http://redis.io/\nredis-server: 这里填你的Redis服务器IP地址或域名, 建议写IP地址\nredis-port: 这里填你的Redis服务器的端口\n# OPTIONAL: If your Redis server uses AUTH, set the password required.\nredis-password: \"这里填你的Redis密码,注意要带两边的引号\"\n# Maximum connections that will be maintained to the Redis server.\n# The default is 8. This setting should be left as-is unless you have some wildly\n# inefficient plugins or a lot of players.\nmax-redis-connections: 8\n\n# An identifier for this BungeeCord instance.\nserver-id: 这里填这台BungeeCord的代号,例如cn. 每台BungeeCord的代号不能相同.\n\n# Whether or not RedisBungee should install its version of regular BungeeCord commands.\n# Often, the RedisBungee commands are desired, but in some cases someone may wish to\n# override the commands using another plugin.\n#\n# If you are just denying access to the commands, RedisBungee uses the default BungeeCord\n# permissions - just deny them and access will be denied.\n#\n# Please note that with build 787+, most commands overridden by RedisBungee were moved to\n# modules, and these must be disabled or overridden yourself.\nregister-bungee-commands: true\n\n# A list of IP addresses for which RedisBungee will not modify the response for, useful for automatic\n# restart scripts.\nexempt-ip-addresses: []\n复制代码完成设定后保存, 然后重启每个BungeeCord, RedisBungee的设定就算完成了.\n显示完整的玩家在线列表\n完成RedisBungee的部署后, 所有的BungeeCord就可以互相通信了, 这时就可以具体安装所需要的功能了. 首先是显示玩家列表的功能, 推荐使用插件BungeeTabListPlus:\n原帖 https://www.spigotmc.org/resources/bungeetablistplus.313/ \n搬运 https://www.mcbbs.net/thread-514808-1-1.html\nTab指令补全\nTab指令补全可以在任意一个BungeeCord下自动补全出其他BungeeCord下的玩家名. 推荐使用BungeeTabComplete插件: \n原帖 https://www.spigotmc.org/resources/bungeetabcomplete.7328/\n安装方式同其他BungeeCord插件, 在插件安装好之后修改BungeeTabComplete的config.yml:\n #这里改为true复制代码然后重启BungeeCord即可.\n跨BungeeCord聊天\n要实现跨BungeeCord聊天难度很高, 目前我找到的支持RedisBungee的类似插件只有YinwuChat和另一款付费插件, 这里只介绍免费的YinwuChat:\nhttps://www.mcbbs.net/thread-836393-1-1.html\n安装和部署请参考上面的链接. 安装好之后在每个BungeeCord上安装后按照说明开启Redis支持并完成每个BungeeCord的设定:\nredisConfig:\n  openRedis: true\n  ip: '这里填写Redis服务器的IP地址(注意带引号)'\n  port: 这里填写Redis服务器的端口\n  maxConnection: 8\n  password: '这里填写Redis服务器的密码(注意带引号)'\n  selfName: 这里填写BungeeCord代号\n  forwardBcTask: true\n  forwardBcMessageToQQ: true\n  forwardBcMessageToWeb: true\n  forwardBcAtAll: true\n  forwardBcAtOne: true\n  selfPrefixFormat:\n  - message: '&8[其他群组]&r'\n    hover: 来自其他群组的消息\n    click: ''\n复制代码然后重启每个BungeeCord, 这样就可以实现多个BungeeCord的基本互通了.\n一些额外功能\n如果需要的话, 还可以考虑增加这些功能, 之后有时间我会具体来写的:\n - 背包同步: https://www.spigotmc.org/resources/mysql-player-data-bridge.8117/\n - 进服提醒,可以关掉Spigot自带的登入登出提示, 只开启这个, 实现玩家登入登出整个BungeeCord网络时才提示: https://www.spigotmc.org/resourc ... r-bungeecord.10239/\n - LuckPermsBungee, 通过LuckPerms来管理多个BungeeCord下的权限: https://www.mcbbs.net/thread-676818-1-1.html\n - BungeeAdminTools, 实现统一管理封禁名单和禁言功能: https://www.spigotmc.org/resourc ... basics-edition.444/\n结语\n多BungeeCord同步注定是一个小众的功能, 由于自己用到了这个功能但在搜索相关内容时发现资料甚少, 所以在这里将自己所了解的和自己在使用过程中遇到的坑和经验分享出来, 希望能够帮到有需要的人.\n如果有问题欢迎回复指出, 或者私信联系都可以的 :)\n\n\n",
    "replies": [
        {
            "author": "sadasq12",
            "timestamp": 1586879520,
            "txt_content": "楼主NB，MCBBS有你更精彩！"
        },
        {
            "author": "利姆露酱",
            "timestamp": 1587561540,
            "txt_content": "有没有bc均衡负载的办法.."
        },
        {
            "author": "mc@viphdf.cc",
            "timestamp": 1587992280,
            "txt_content": "利姆露酱 发表于 2020-4-22 21:19\n有没有bc均衡负载的办法..\nHaproxy 或 Nginx可以实现但楼主貌似没讲Haproxy的使用方法 我也就试过用Nginx的tcp转发来实现均衡负载"
        },
        {
            "author": "mc@viphdf.cc",
            "timestamp": 1587992520,
            "txt_content": "楼主能否吧Haproxy方面的知识也写一下"
        },
        {
            "author": "利姆露酱",
            "timestamp": 1588990860,
            "txt_content": "mc@viphdf.cc 发表于 2020-4-27 20:58\nHaproxy 或 Nginx可以实现但楼主貌似没讲Haproxy的使用方法 我也就试过用Nginx的tcp转发来实现均 ...\n能否加q交流？"
        },
        {
            "author": "mc@viphdf.cc",
            "timestamp": 1589112000,
            "txt_content": "利姆露酱 发表于 2020-5-9 10:21\n能否加q交流？\n1851890909\n提前说下我就一弱鸡"
        },
        {
            "author": "2279218256",
            "timestamp": 1593936180,
            "txt_content": "楼主写的真棒！希望能加个qq交流一下   6700150"
        }
    ]
}