{
    "title": "event.getRegistry().registerAll(xxx) 没有执行到 与 @SubscribeEvent注解问题",
    "author": "common",
    "replyCount": 1,
    "timestamp": 1564943760,
    "txt_content": " 本帖最后由 common 于 2019-8-5 03:17 编辑 \n\n刚配置完forge开发环境，按照forge文档尝试创建自己的第一个物品，构建完成后进游戏，发现找不到自己的物品，于是断点调试，发现物品对象设置属性的语句都被执行到了，但唯独最关键的注册物品语句没有被执行到。换用forge开发文档不推荐的GameRegistry.findRegistry(Item.class).register(xxx)，总算注册上了。但是我很奇怪event.getRegistry().registerAll(xxx)为什么没有被执行到，我到底是哪里写错了\n这是mod主类\n@Mod(modid = kk_mod.MODID, name = kk_mod.NAME, version = kk_mod.VERSION, acceptedMinecraftVersions = \"1.12.2\")\npublic class kk_mod\n{\n    public static final String MODID = \"kk_mod\";\n    public static final String NAME = \"kkMod\";\n    public static final String VERSION = \"1.0.0\";\n\n    @Instance(kk_mod.MODID)\n    public static kk_mod instance;\n\n    @EventHandler\n    public void preInit(FMLPreInitializationEvent event)\n    {\n            proxy.preInit(event);\n            \n        // TODO\n            ItemLoader ItemLoaderMain=new ItemLoader();//测试用，强行执行ItemLoader的构造函数\n    }\n\n    @EventHandler\n    public void init(FMLInitializationEvent event)\n    {\n            proxy.init(event);\n        // TODO\n    }\n\n    @EventHandler\n    public void postInit(FMLPostInitializationEvent event)\n    {\n            proxy.postInit(event);\n        // TODO\n    }\n    \n    @SidedProxy(clientSide = \"kk.kk_mod.ClientProxy\", \n            serverSide = \"kk.kk_mod.CommonProxy\")\n    public static CommonProxy proxy;\n}复制代码\n\n这是放置event.getRegistry().registerAll(xxx)的ItemLoader类，它在主类preInit中被强制实例化执行构造函数\n\npublic class ItemLoader\n{\n    public static ItemControlKKEnchantBook ControlKKEnchantBook;\n    ItemLoader()\n    {\n        ControlKKEnchantBook = new ItemControlKKEnchantBook();\n        ControlKKEnchantBook.setRegistryName(\"kk_mod\",\"control_kk_enchant_book\");//设置控制附魔书的注册名\n        ControlKKEnchantBook.setMaxStackSize(1);//控制附魔书不可堆叠\n        ControlKKEnchantBook.setMaxDamage(0);\n        ControlKKEnchantBook.setNoRepair();\n        ControlKKEnchantBook.setUnlocalizedName(\"control_kk_enchant_book\");\n        ControlKKEnchantBook.setCreativeTab(CreativeTabs.TOOLS);\n        GameRegistry.findRegistry(Item.class).register(ControlKKEnchantBook);\n    }\n   \n    @SubscribeEvent\n    public void registerItems(RegistryEvent.Register<Item> event)\n    {\n        event.getRegistry().registerAll(ControlKKEnchantBook);//\n       \n    }\n   \n}复制代码\n另，我注意到注解@SubscribeEvent是一个运行时保留的注解\n\n@Retention(value = RUNTIME)\n@Target(value = METHOD)\npublic @interface SubscribeEvent\n{\nEventPriority priority() default EventPriority.NORMAL;\nboolean receiveCanceled() default false;\n}复制代码\n这个注解在运行时保留，那么forge是否用它来在合适的条件下执行被它注解的函数？\n另？如何在同一个工程中开发多个mod？如何构建非混淆版本(MCP名)的mod？\n\n另，有点好奇，我注意到源代码分为minecraft和minecraftforge两个包，是不是原版MC的代码在minecraft中，forge新增代码在minecraftforge中，而event包在minecraftforge下那么这么说来原版MC没有事件系统？\n\nforge mdk版本forge-1.12.2-14.23.5.2768\n\n附录，forge文档地址 Forge文档\n\n\n",
    "replies": [
        {
            "author": "3TUSK",
            "timestamp": 1564961940,
            "txt_content": " 本帖最后由 u.s.knowledge 于 2019-8-5 07:42 编辑 \n\n事件监听器没有注册。\n事件监听器有两种注册方式。\n\n1. MinecraftForge.EVENT_BUS.register。需要在事件发布之前注册。\nMinecraftForge.EVENT_BUS.register(new ItemLoader());复制代码\n\n2. @Mod.EventBusSubscriber，需要写在类上，且监听事件的方法必须有 static 修饰。用这个方式不用担心注册监听器的时候错过注册事件的发布。\n@Mod.EventBusSubscriber(modid = \"my_mod_id\")\npublic class ItemLoader {\n  // ...\n}复制代码\n\nhttps://harbinger.covertdragon.t ... 6%E8%AE%A2%E9%98%85"
        }
    ]
}