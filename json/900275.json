{
    "title": "[已解决][nms求助] 如何读取.lang文件使生成相应的可操作类",
    "author": "1609089074",
    "replyCount": 5,
    "timestamp": 1565443980,
    "txt_content": " 本帖最后由 1609089074 于 2019-11-20 18:15 编辑 \n\n本菜在开发插件时想增加语言文本信息读取功能，正好想起mc有自己专属的语言文本格式 *.lang 文件类型，估摸着应该可以直接用 nms 帮助读取语言文件。\n我通过 mcp 导出了 nms 源码后，在包 net.minecraft.util.text.translation 下名为 LanguageMap 的类（在原nms内等同为LocaleLanguage类）发现相关的功能实现，类内有个实例字段：\nprivate final Map<String, String> languageList = Maps.<String, String>newHashMap();复制代码\n应该就是用于储存从语言文本文件内读取的 关键字（key） 和 翻译文本（value） ，但是我发现仅在该类唯一一个构造方法里往该 Map 中 put入键值，而此构造方法是无参数的，其内直接指明读取资源路径 “/assets/minecraft/lang/en_us.lang” ，不言而喻，这里自然是对应mc英文语言文本，而大家应该都是知道咱mc是自带多国语言的。以下是通过 mcp 导出的该类源码：\n\npackage net.minecraft.util.text.translation;\n\nimport com.google.common.base.Splitter;\nimport com.google.common.collect.Iterables;\nimport com.google.common.collect.Maps;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.util.IllegalFormatException;\nimport java.util.Map;\nimport java.util.regex.Pattern;\nimport org.apache.commons.io.Charsets;\nimport org.apache.commons.io.IOUtils;\n\npublic class LanguageMap\n{\n    /**\n     * Pattern that matches numeric variable placeholders in a resource string, such as \"%d\", \"%3$d\", \"%.2f\"\n     */\n    private static final Pattern NUMERIC_VARIABLE_PATTERN = Pattern.compile(\"%(\\\\d+\\\\$)?[\\\\d\\\\.]*[df]\");\n\n    /**\n     * A Splitter that splits a string on the first \"=\".  For example, \"a=b=c\" would split into [\"a\", \"b=c\"].\n     */\n    private static final Splitter EQUAL_SIGN_SPLITTER = Splitter.on('=').limit(2);\n\n    /** Is the private singleton instance of StringTranslate. */\n    private static final LanguageMap instance = new LanguageMap();\n    private final Map<String, String> languageList = Maps.<String, String>newHashMap();\n\n    /**\n     * The time, in milliseconds since epoch, that this instance was last updated\n     */\n    private long lastUpdateTimeInMilliseconds;\n\n    public LanguageMap()\n    {\n        try\n        {\n            InputStream inputstream = LanguageMap.class.getResourceAsStream(\"/assets/minecraft/lang/en_us.lang\");\n\n            for (String s : IOUtils.readLines(inputstream, Charsets.UTF_8))\n            {\n                if (!s.isEmpty() && s.charAt(0) != 35)\n                {\n                    String[] astring = (String[])Iterables.toArray(EQUAL_SIGN_SPLITTER.split(s), String.class);\n\n                    if (astring != null && astring.length == 2)\n                    {\n                        String s1 = astring[0];\n                        String s2 = NUMERIC_VARIABLE_PATTERN.matcher(astring[1]).replaceAll(\"%$1s\");\n                        this.languageList.put(s1, s2);\n                    }\n                }\n            }\n\n            this.lastUpdateTimeInMilliseconds = System.currentTimeMillis();\n        }\n        catch (IOException var7)\n        {\n            ;\n        }\n    }\n\n    /**\n     * Return the StringTranslate singleton instance\n     */\n    static LanguageMap getInstance()\n    {\n        return instance;\n    }\n\n    /**\n     * Translate a key to current language.\n     */\n    public synchronized String translateKey(String key)\n    {\n        return this.tryTranslateKey(key);\n    }\n\n    /**\n     * Translate a key to current language applying String.format()\n     */\n    public synchronized String translateKeyFormat(String key, Object... format)\n    {\n        String s = this.tryTranslateKey(key);\n\n        try\n        {\n            return String.format(s, format);\n        }\n        catch (IllegalFormatException var5)\n        {\n            return \"Format error: \" + s;\n        }\n    }\n\n    /**\n     * Tries to look up a translation for the given key; spits back the key if no result was found.\n     */\n    private String tryTranslateKey(String key)\n    {\n        String s = (String)this.languageList.get(key);\n        return s == null ? key : s;\n    }\n\n    /**\n     * Returns true if the passed key is in the translation table.\n     */\n    public synchronized boolean isKeyTranslated(String key)\n    {\n        return this.languageList.containsKey(key);\n    }\n\n    /**\n     * Gets the time, in milliseconds since epoch, that this instance was last updated\n     */\n    public long getLastUpdateTimeInMilliseconds()\n    {\n        return this.lastUpdateTimeInMilliseconds;\n    }\n}\n复制代码\n\n所以在这有个疑问，minecraft怎么把其他语言文本文件加载到这个类里的\nprivate final Map<String, String> languageList = Maps.<String, String>newHashMap()复制代码字段里的？\n以及，如果我想通过该类加载我自定义路径的*.lang语言文本文件，应该如何实现更为合适呢？\n（ps:把这个类copy到自己插件包里的操作可能看起来冗余了些，如果将插件开源，这样直接copyNMS的行为会不会造成对mojang侵权？？）\n（nms类太多了，这里作为一只辣鸡菜鸟好似大海捞针，实在翻不过来，给各位巨佬们先跪了orz~）\n\n",
    "replies": [
        {
            "author": "3TUSK",
            "timestamp": 1565446380,
            "txt_content": "Minecraft 负责本地化的类在客户端里。所以你不可能在服务器上找到任何本地化相关的内容。\n你看到的 LanguageMap 算是类似历史遗留的东西。"
        },
        {
            "author": "1609089074",
            "timestamp": 1565447100,
            "txt_content": "u.s.knowledge 发表于 2019-8-10 22:13\nMinecraft 负责本地化的类在客户端里。所以你不可能在服务器上找到任何本地化相关的内容。\n你看到的 Langua ...\n噢噢谢谢提醒！那么若从mcp导出的jar源码里copy部分对.lang文件的读写功能内容到我的插件里，这个行为可取吗（违反协议或是直接侵权，无论开不开源插件？）？"
        },
        {
            "author": "a1294790523",
            "timestamp": 1565450280,
            "txt_content": "语言文件的格式很简单，你完全可以自己实现一个读取lang文件的类啊。。。\n"
        },
        {
            "author": "吕易天",
            "timestamp": 1565450520,
            "txt_content": "1609089074 发表于 2019-8-10 22:25\n噢噢谢谢提醒！那么若从mcp导出的jar源码里copy部分对.lang文件的读写功能内容到我的插件里，这个行为可 ...\n你自己写个语言处理类不好吗"
        },
        {
            "author": "1609089074",
            "timestamp": 1565454420,
            "txt_content": "啊！老想着调用现成的东西，刚一看.lang里内容其实跟.propreties差不多，自己写个处理类确实没多大难度。。。"
        }
    ]
}