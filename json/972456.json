{
    "title": "[前置API]PlayerData——玩家数据持久化存储层[1.12+]",
    "author": "lijisoft",
    "replyCount": 1,
    "timestamp": 1582965180,
    "txt_content": " 本帖最后由 lijisoft 于 2020-2-29 20:09 编辑 \n\n注意：如果您不知道这个插件的用途，请不要安装到服务器。这个插件不提供任何用户命令、权限或更改游戏机制。\n该插件仅作为依赖使用。\n\n免责声明：持久化存储并不能保证服务器在崩溃时或在插件出错时仍能使玩家数据不受影响，本插件也（暂）不隔离插件之间的数据访问。除另行声明外，插件作者并不对任何安装此插件的服务器的数据安全和完整性负任何责任。\n\n插件源码：点击这里\n\n\n更新记录\n\n\n0.3 修复了上一个版本会尝试保存不可序列化信息的 Bug, 该更改需要手动删除插件产生的历史数据！\n\n\n0.2 首次发布\n\n\n0.1 内部测试，未发布\n\n\n\n什么是持久化存储？\n\n持久化存储即在设备断电后仍旧能保留数据的存储。在这里，我们特指在服务端重启后仍旧保留的数据存储，比如玩家的背包、位置等都属于持久化数据。通常情况下，持久化存储是通过把数据写入磁盘（如写入文件、写入数据库）实现的。\n\n为什么需要一个存储抽象层？\n\n无论是 Bukkit, Spigot 还是 PaperSpigot, 它们都不官方提供一个持久化层。插件作者必须自行管理游戏数据、自行决定文件结构、连接数据库、编写 SQL 等等，这为插件开发带来了许多不必要的麻烦。插件作者不得不同时负责**逻辑和底层逻辑，使得开发过程减慢且使得漏洞更可能出现。\n\n转而使用存储抽象层，插件作者无需担心底层具体的数据存储，可以直接编写**逻辑，大大简化开发步骤。同时，由于状态被托管到了抽象层，**逻辑可以成为纯函数，这使得插件得以通过 PlugMan 等工具安全地实现热重载而无需担心一致性被破坏，极大加速了插件的测试和部署速度。\n\n如何使用？\n\n插件的配置文件说明如下：\n\n\ndriver: file # 持久化存储引擎，默认为 file, 使用插件自带的文件存储\nautosave: 10 # 自动保存，单位为分钟\n复制代码\n\n一个使用 PlayerData 的样例插件如下：\n\n\npublic class Main extends JavaPlugin implements Listener {\n  @Override\n  public void onEnable() {\n    getServer().getPluginManager().registerEvents(this, this);\n  }\n\n  @EventHandler\n  public void onStorageReady(StorageReadyEvent e) {\n    this.storage = e.getStorage();\n  }\n\n  @EventHandler\n  public void onPlayerJoin(PlayerJoinEvent e) {\n    Player p = e.getPlayer();\n    PlayerData data = storage.get(p.getUniqueId()); // 获取玩家数据，不存在则创建\n    int joinCount = (int) data.getOrDefault(\"joinCount\", 0); // 读取内容\n    joinCount++;\n    data.set(\"joinCount\", joinCount); // 写入内容\n  }\n}\n复制代码\n\n（由于服务器负载原因，暂时不提供 maven 仓库，请下载 jar 文件并作为本地依赖。）\n\n如何添加自己的存储引擎？\n\n请参考源码中的 SimpleFileStorage.java 和 PlayerDataStorage.java, 此处不再赘述。\n\n\n关于线程安全\n\nPlayerData 对象容许多个线程同时进行访问，无需额外加锁。如果访问线程超过 16 个则可能有额外的性能损失。PlayerDataStorage 对象则由存储引擎提供线程安全，默认的 SimpleFileStorage 容许多个线程同时访问，无需额外加锁。如果访问线程超过 16 个则可能有额外的性能损失。\n\n注意：不要将 PlayerData 对象存储在插件内（即不要赋给成员）！用完丢弃即可，否则可能会破坏线程安全性。\n\n合规说明\n\n本插件所用所有代码均为原创，不存在借用/抄袭等行为。\n本插件按照 GNU LGPL v2 协议授权，任何对于源码的更改必须以相同协议授权，严禁转卖或捆绑销售。\n基于本插件开发的其他插件可以以其他协议授权或用于商业用途。\n",
    "replies": [
        {
            "author": "Enron233",
            "timestamp": 1582965300,
            "txt_content": "Oh 支持一个 这个感觉不错 玩家数据又多一层保障"
        }
    ]
}