{
    "title": "如何修改不死图腾回复的血量",
    "author": "xiaokun7",
    "replyCount": 18,
    "timestamp": 1566057660,
    "txt_content": "因为不死图腾的回复对于原版来说足够了，但是对于RPG服务器来说，就捉襟见肘了，所以想知道怎么能修改不死图腾的回复量。",
    "replies": [
        {
            "author": "3232852525",
            "timestamp": 1566079920,
            "txt_content": "原版的东西不好改吧"
        },
        {
            "author": "3TUSK",
            "timestamp": 1566084360,
            "txt_content": "楼主想写的是基于 Forge 的 Mod 还是基于 Bukkit/Sponge 的插件？"
        },
        {
            "author": "鸭蛋只吃黄",
            "timestamp": 1566088140,
            "txt_content": "如果是插件的话我建议可以监听物品消耗事件, 发生时判断一下被用掉的是不是不死图腾, 然后直接给玩家 setHealth就好了. 刚才找了一圈没找到 \"不死图腾使用的事件\""
        },
        {
            "author": "xiaokun7",
            "timestamp": 1566090600,
            "txt_content": "凋灵兔子 发表于 2019-8-18 08:29\n如果是插件的话我建议可以监听物品消耗事件, 发生时判断一下被用掉的是不是不死图腾, 然后直接给玩家 setHe ...\nEntityResurrectEvent是触发事件，我现在是在不死图腾的触发事件里开一个线程，下一个tick setHealth"
        },
        {
            "author": "鸭蛋只吃黄",
            "timestamp": 1566094140,
            "txt_content": "xiaokun7 发表于 2019-8-18 09:10\nEntityResurrectEvent是触发事件，我现在是在不死图腾的触发事件里开一个线程，下一个tick setHealth ...\n我曾经在很多提问帖中说过关于多线程的问题, 我建议在任何情况下, 都不应当使用 new Tread 的方式来创建线程, 而且只要不涉及到 IO, 我不建议使用多线程. 如果一定要用, 那就用线程池来做, 而不是自己造线程.\n\nsetHealth 并不是阻塞任务, 所以你在服务器主线程执行没有任何问题. 不要听信一些所谓的 \"多线程性能高\" 这样的谣言, Java 并发编程是一个很复杂的问题, 不是简简单单开一个线程来执行代码那么简单的.\n\n如果你一定要用这种所谓的多线程, 那可以在其他线程中调用 BukkitTask 中的同步方法, 将多线程中的代码转到服务器主线程执行. 否则按 bukkit 的设计, 多线程是不允许对玩家进行操作的."
        },
        {
            "author": "xiaokun7",
            "timestamp": 1566095280,
            "txt_content": "凋灵兔子 发表于 2019-8-18 10:09\n我曾经在很多提问帖中说过关于多线程的问题, 我建议在任何情况下, 都不应当使用 new Tread 的方式来创建 ...\n只是通过scheduleSyncDelayedTask方法把设置血量放打下一个tick执行，影响应该不大，就怕消耗和不死图腾的触发有先后，导致先消耗，后触发，如果先消耗了，我监控消耗会导致提前设置血量。那么，不死图腾触发后，血量还是原版的3-4滴血左右。就没意义了。"
        },
        {
            "author": "鸭蛋只吃黄",
            "timestamp": 1566096180,
            "txt_content": "xiaokun7 发表于 2019-8-18 10:28\n只是通过scheduleSyncDelayedTask方法把设置血量放打下一个tick执行，影响应该不大，就怕消耗和不死图腾 ...\n如果能运行的话那看上去没问题, 但是这种依靠 \"估算\" 的延时的写法并不可靠, 当并发量大时难免会出现问题.\n\n也不是不能用, 只要你知道这是一个坏习惯, 以后技术高了改正就行"
        },
        {
            "author": "xiaokun7",
            "timestamp": 1566100740,
            "txt_content": "凋灵兔子 发表于 2019-8-18 10:43\n如果能运行的话那看上去没问题, 但是这种依靠 \"估算\" 的延时的写法并不可靠, 当并发量大时难免会出现问题 ...\n嗯嗯  谢谢大佬"
        },
        {
            "author": "Le1_B",
            "timestamp": 1571555640,
            "txt_content": "请问楼主做到了吗？我的服务器也是RPG玩法，正好也需要这个功能"
        },
        {
            "author": "xiaokun7",
            "timestamp": 1571669160,
            "txt_content": "Le1_B 发表于 2019-10-20 15:14\n请问楼主做到了吗？我的服务器也是RPG玩法，正好也需要这个功能\n差不多  怎么啦？"
        },
        {
            "author": "Le1_B",
            "timestamp": 1571673420,
            "txt_content": "xiaokun7 发表于 2019-10-21 22:46\n差不多  怎么啦？\n给你私聊了"
        },
        {
            "author": "xiaokun7",
            "timestamp": 1571748840,
            "txt_content": "Le1_B 发表于 2019-10-21 23:57\n给你私聊了\n就是触发不死图腾下一个tick把血量回复到最大血上限就行了"
        },
        {
            "author": "a1294790523",
            "timestamp": 1571756940,
            "txt_content": " 本帖最后由 a1294790523 于 2019-10-22 23:12 编辑 \n/**\n * Called when an entity dies and may have the opportunity to be resurrected.\n * Will be called in a cancelled state if the entity does not have a totem\n * equipped.\n */\npublic class EntityResurrectEvent extends EntityEvent implements Cancellable {复制代码\n所以说直接cancel掉然后删除玩家的不死图腾再setHealth不行吗\n这又不是什么耗时操作，有什么安排不安排任务的\n另外多线程（指使用Bukkit的调度器）是可以的啊，只需要在调用bukkit的API时安排同步任务回去就行了"
        },
        {
            "author": "xiaokun7",
            "timestamp": 1571800860,
            "txt_content": "a1294790523 发表于 2019-10-22 23:09\n所以说直接cancel掉然后删除玩家的不死图腾再setHealth不行吗\n这又不是什么耗时操作，有什么安排不安排任 ...\n如果你把这个操作用在mm上我觉得玩家还是会死亡  你可以试试"
        },
        {
            "author": "a1294790523",
            "timestamp": 1571824620,
            "txt_content": "xiaokun7 发表于 2019-10-23 11:21\n如果你把这个操作用在mm上我觉得玩家还是会死亡  你可以试试\n经测试一切正常 玩家原地复活\nsethealth然后直接模仿不死图腾加buff即可"
        },
        {
            "author": "xiaokun7",
            "timestamp": 1571926560,
            "txt_content": "a1294790523 发表于 2019-10-23 17:57\n经测试一切正常 玩家原地复活\nsethealth然后直接模仿不死图腾加buff即可\n 是原地复活 但是复活会很大几率造成怪物血量满了  因为仇恨丢失 有时候还会造成怪物消失"
        },
        {
            "author": "a1294790523",
            "timestamp": 1571928540,
            "txt_content": " 本帖最后由 a1294790523 于 2019-10-24 22:51 编辑 \nxiaokun7 发表于 2019-10-24 22:16\n是原地复活 但是复活会很大几率造成怪物血量满了  因为仇恨丢失 有时候还会造成怪物消失 ...\n我还没测试过会不会丢失，但应该是不会的\n如果会的话....\n算了你直接监听玩家死亡事件得了\n如果符合不死图腾的触发条件cancel掉然后再模拟下不死图腾的恢复\n"
        },
        {
            "author": "xiaokun7",
            "timestamp": 1571964600,
            "txt_content": "a1294790523 发表于 2019-10-24 22:49\n我还没测试过会不会丢失，但应该是不会的\n如果会的话....\n算了你直接监听玩家死亡事件得了\n\nmm自带修正，只要是mm判断伤害大于血量，直接死亡，并且怪物仇恨丢失，血量全满，只能通过不死图腾才能避免，我试过的"
        }
    ]
}