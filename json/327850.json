{
    "title": "【重大新闻】Bukkit 1.7.10 R.01 不再支持中文配置文件！",
    "author": "HotFlow",
    "replyCount": 17,
    "timestamp": 1408826940,
    "txt_content": "今天写一个插件的时候遇到的问题，大神们可有解决方案？load()的时候还完全没问题,可是使用到save()就会自动转码了！\n",
    "replies": [
        {
            "author": "忘却的旋律",
            "timestamp": 1408828560,
            "txt_content": "这是bukkit的新特性吧    不应该说不支持中文"
        },
        {
            "author": "HotFlow",
            "timestamp": 1408828860,
            "txt_content": " 本帖最后由 HotFlow 于 2014-8-23 13:54 编辑 \n忘却的旋律 发表于 2014-8-23 13:16\n这是bukkit的新特性吧    不应该说不支持中文\n\n谢谢点击。。已修复。"
        },
        {
            "author": "HotFlow",
            "timestamp": 1408830000,
            "txt_content": " 本帖最后由 HotFlow 于 2014-8-23 13:53 编辑 \n忘却的旋律 发表于 2014-8-23 13:16\n这是bukkit的新特性吧    不应该说不支持中文\nthread closed"
        },
        {
            "author": "leavessoft",
            "timestamp": 1408837380,
            "txt_content": "哎，Mojang接手后好悲剧"
        },
        {
            "author": "BYWJ",
            "timestamp": 1408838760,
            "txt_content": "悲催吧，不过有时候学下英语也没什么不好的~"
        },
        {
            "author": "HotFlow",
            "timestamp": 1408839240,
            "txt_content": "leavessoft 发表于 2014-8-23 15:43\n哎，Mojang接手后好悲剧\n已经解决了。。"
        },
        {
            "author": "HotFlow",
            "timestamp": 1408839240,
            "txt_content": "BYWJ 发表于 2014-8-23 16:06\n悲催吧，不过有时候学下英语也没什么不好的~\n已经解决了"
        },
        {
            "author": "尘曲",
            "timestamp": 1408977240,
            "txt_content": "是你编码问题。。。一直都是这样的。。。程序里转换下String的编码就可以了"
        },
        {
            "author": "HotFlow",
            "timestamp": 1409024280,
            "txt_content": "尘曲 发表于 2014-8-25 06:34\n是你编码问题。。。一直都是这样的。。。程序里转换下String的编码就可以了 ...\n转换了，我重写了它的API，需要的我话我可以给你。"
        },
        {
            "author": "尘曲",
            "timestamp": 1409028180,
            "txt_content": "HotFlow 发表于 2014-8-26 11:38\n转换了，我重写了它的API，需要的我话我可以给你。\n那倒不用。。。多谢了"
        },
        {
            "author": "HotFlow",
            "timestamp": 1409030520,
            "txt_content": "尘曲 发表于 2014-8-25 20:43\n那倒不用。。。多谢了\n嗯，不过的确不是转码的问题，是他们修改了1.7.10的saveToString()和loadFromString()"
        },
        {
            "author": "502647092",
            "timestamp": 1422898080,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "HotFlow",
            "timestamp": 1422935160,
            "txt_content": "502647092 发表于 2015-2-2 09:28\n求解决，保存就变成Unicode了，一堆斜杠加数字字母。。。。。\n重写YamlConfiguration"
        },
        {
            "author": "502647092",
            "timestamp": 1422975660,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "HotFlow",
            "timestamp": 1422990300,
            "txt_content": " 本帖最后由 HotFlow 于 2015-2-8 03:07 编辑 \n502647092 发表于 2015-2-3 07:01\n举个例子，或者给个栗子。。。public class NewConfiguration extends YamlConfiguration\n{\n    /**\n     * 载入 config\n     * @param file 文件\n     */\n    public void loads(File file)\n    {\n        try\n        {\n            this.load(file);\n        }\n        catch (FileNotFoundException ex)\n        {\n            Main.logger.warning(Main.prefix+\" 找不到文件!\"+\"\\n\"+ex);\n        } \n        catch (IOException ex) \n        {\n            Main.logger.warning(Main.prefix+\" 文件不存在!\"+\"\\n\"+ex);\n        } \n        catch (InvalidConfigurationException ex) \n        {\n            Main.logger.warning(Main.prefix+\" 文件不为配置文件!\"+\"\\n\"+ex);\n        }\n    }\n    \n    \n  /**\n   * 保存config\n   * @param file 文件\n   * @throws IOException \n   */\n  @Override\n    public void save(File file) throws IOException\n    {\n        this.createParentDirs(file);\n\n        String data = saveToString();\n\n        FileWriter writer = new FileWriter(file);\n        try\n        {\n            writer.write(data);\n        } \n        finally \n        {\n            writer.close();\n        }\n    }\n\n  \n  /**\n   * 保存config\n   * @param file 文件路径\n   * @throws IOException \n   */\n    @Override\n    public void save(String file) throws IOException\n    {\n        save(new File(file));\n    }\n    \n    /**\n     * 载入\n     * @param file\n     * @throws java.io.FileNotFoundException\n     * @throws org.bukkit.configuration.InvalidConfigurationException\n     */\n    @Override\n    public void load(File file) throws FileNotFoundException, IOException, InvalidConfigurationException\n    {\n        load(new FileInputStream(file));\n    }\n    \n    \n    /**\n     * 载入\n     * @param stream\n     * @throws IOException\n     * @throws InvalidConfigurationException \n     */\n    @Override\n    public void load(InputStream stream) throws IOException, InvalidConfigurationException\n    {\n        InputStreamReader reader = new InputStreamReader(stream);\n        StringBuilder builder = new StringBuilder();\n        BufferedReader input = new BufferedReader(reader);\n        ArrayList<String> builders = new ArrayList<String>();\n        try\n        {\n            String line;\n            while ((line = input.readLine()) != null)\n            {\n                builders.add(line);\n                builder.append(line);\n                builder.append('\\n');\n            }\n        } \n        finally \n        {\n            input.close();\n        }\n        \n        super.loadFromString(builder.toString());\n    }\n    \n    \n    /**\n     * 载入 config\n     * @param file\n     * @throws FileNotFoundException\n     * @throws IOException\n     * @throws InvalidConfigurationException \n     */\n    @Override\n    public void load(String file) throws FileNotFoundException, IOException, InvalidConfigurationException\n    {\n        load(new File(file));\n    }\n    \n    \n    \n    /**\n     * 修复1.7.10不能为中文 \n     * @param contents\n     * @throws org.bukkit.configuration.InvalidConfigurationException\n     */\n    @Override\n    public void loadFromString(String contents) throws InvalidConfigurationException {\n        Map input;\n        try \n        {\n            input = (Map)this.yaml.load(contents);\n        } \n        catch (YAMLException e) \n        {\n            throw new InvalidConfigurationException(e);\n        } \n        catch (ClassCastException e) \n        {\n            throw new InvalidConfigurationException(\"Top level is not a Map.\");\n        }\n\n        String header = parseHeader(contents);\n        if (header.length() > 0)\n        {\n            options().header(header);\n        }\n\n        if (input != null)\n        {\n            convertMapsToSections(input, this);\n        }\n    }\n    \n    \n    /**\n     * 修复1.7.10不能为中文\n     * [url=home.php?mod=space&uid=491268]@Return[/url] \n     */\n    @Override\n    public String saveToString()\n    {\n        this.yamlOptions.setIndent(options().indent());\n        this.yamlOptions.setDefaultFlowStyle(DumperOptions.FlowStyle.BLOCK);\n        this.yamlRepresenter.setDefaultFlowStyle(DumperOptions.FlowStyle.BLOCK);\n\n        String header = buildHeader();\n        String dump = this.yaml.dump(getValues(false));\n\n        if (dump.equals(\"{}\\n\")) \n        {\n          dump = \"\";\n        }\n\n        return header + dump;\n    }\n    \n    private void createParentDirs(File file) throws IOException\n    {\n        File parent = file.getCanonicalFile().getParentFile();\n        if (parent == null)\n        {\n            return;\n        }\n        \n        parent.mkdirs();\n        \n        if (!parent.isDirectory())\n        {\n            throw new IOException(\"Unable to create parent directories of \" + file);\n        }\n    }复制代码"
        },
        {
            "author": "502647092",
            "timestamp": 1423241280,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "HotFlow",
            "timestamp": 1423391400,
            "txt_content": "502647092 发表于 2015-2-6 08:48\n那个，楼主帮个忙啊！\n什么忙？"
        }
    ]
}