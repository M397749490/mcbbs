{
    "title": "[原创][工具]NukkitScript —— 使用脚本编写Nukkit插件 [全版本]",
    "author": "xiaolu550",
    "replyCount": 9,
    "timestamp": 1582289040,
    "txt_content": " 本帖最后由 xiaolu550 于 2020-2-25 21:07 编辑 \n\nNKScript - 简化Nk插件的开发模式，使用脚本化编程，无需编译直接运行\n\nNKScript 脚本化编程方案NKScript的目的是以简化开发为主，并且更好的调试插件。\n对于项目结构和调用文件NKScript主要分为5个模块info.nsmain.nslistenercommandother\ninfo.ns类似于nukkit的plugin.yml,其内容和plugin.yml也基本类似。 其中特殊的元素为id元素，是为了防止多个插件冲突而设计的，它会作为注册文件的类根目录。 在调用脚本时，格式就是id.脚本文件名称 例如id为net.noyark,则脚本hello.ns写作class hello{\n    ///...\n}复制代码\n调用的时候import net.noyark.hello复制代码\n当然在写主类和监听器的时候，package和class可以省略 如main.ns@Override\nvoid onLoad(){\n    //...\n}复制代码\nlistener.ns@EventHandler\nvoid onJoin(PlayerJoinEvent e){\n    \n}复制代码脚本的主文件必须为main.ns,调用主文件的时候，则是import 你的id.插件名 如插件名为Hello,id为net.noyark//导入主类\nimport net.noyark.Hello复制代码info.ns书写\n\ninfo{\n      name \"Hello\" //插件名称,必须有\n      version \"1.0.0\" //版本，可不写，不写默认为1.0.0\n      author \"MagicLu\" //作者名 可不写\n      listeners [\"listener.ns\"] //注册的监听器 如果没有可不写\n      commandsMap [\"command.ns\"] //注册的指令 如果没有可不写\n      id \"net.noyark.www\" //id号，意义如同前面所讲 \n      description \"\" //介绍，可不写\n      permissions ([\n           \"FirstPlugin.fp\" : [\n                  description : \"\",\n                  default : \"op\"\n           ]\n      ]) //和nk插件的plugin.yml结构相同\n      commands ([\n          fp : [\n              \"usage\" : \"/fp help\",\n              \"description\" : \"指令介绍\",\n              \"permission\" : \"FirstPlugin.fp\"\n          ]\n      ]) //和nk插件的plugin.yml结构相同\n}\ndepends{ //依赖\n    softDepend ([])\n    depend ([])\n    loadBefore([])\n}复制代码\n\n具体使用方法参见README.md\n基本和NK相同，采用groovy语法，并且支持java的写法，注册监听器和指令同样可以 使用原来的方法。 默认的指令则是使用了SimpleCommand,使用可以参见example文件\n\n脚本的文件夹直接丢到NKScript的配置文件夹下即可加载\n其他问题:Groovy脚本效率很低怎么办？您可以抛弃动态类型，因为Groovy依然是强类型的，它可以使用@CompileStatic注解使得您的代码静态编译，但是需要您抛弃动态类型,类似于这样@Command(name = \"hello\",description = \"233\",usageMessage = \"/hello\")\n@Arguments(max = 10,min = 0)\n@CompileStatic\nboolean onHelloCommand(CommandSender sender, String label, String[] args){\n    //这里写指令处理代码\n    base.logger.info(\"hello,world\")\n    return true\n}复制代码\n\n\n更新 v1.0.1\n支持脚本前置，修复大量bug，且其他类可以省略包名，支持预加载类\n参见 https://github.com/MagicLu550/nkscript/releases/tag/1.0.1\n更新 v1.0.2\n支持自动主类注入和默认静态对象方法，具体参见README新增\n参见 https://github.com/MagicLu550/nkscript/releases/tag/1.0.2\n更新 v1.0.3\n参见 https://github.com/MagicLu550/nkscript/releases/tag/1.0.3\n在脚本根文件夹下libs文件夹下添加jar包即可被加载，具体参见README\n更新 v1.0.4\n使用了静态编译，插件运行效率提高: @CompileStatic\n参见 https://github.com/MagicLu550/nkscript/releases/tag/1.0.4\n更新 v1.0.5\n对于命令.ns和监听器.ns支持了自动包名检测\n参见 https://github.com/MagicLu550/nkscript/releases/tag/1.0.4\n更新 v1.0.6\ninfo.retain设置为true，可以对主类不进行套壳编译。\n参见 https://github.com/MagicLu550/nkscript/releases/tag/1.0.6\n\n\n\n\n\n\n\n\n\n\n\n\n[groupid=1708]Pioneer Group[/groupid]",
    "replies": [
        {
            "author": "Kenneth_z",
            "timestamp": 1582299360,
            "txt_content": "很强大的工具 方便开发者"
        },
        {
            "author": "xiaolu550",
            "timestamp": 1582381500,
            "txt_content": "1.0.2更新\nhttps://github.com/MagicLu550/nkscript/releases/tag/1.0.2\n\n原生getInstance和注入赋值\n主文件默认带一个静态的getInstance方法，可以直接获得当前的对象 如listener.ns,如果我的插件名称是HelloWorld,id是net.noyark.www\n\nimport net.noyark.www.HelloWorld\n\nimport cn.nukkit.event.EventHandler\nimport cn.nukkit.event.player.PlayerJoinEvent\n\n@EventHandler\nvoid onPlayerJoin(PlayerJoinEvent e){\n    //getInstance()是HelloWorld的自带方法\n    PluginBase base = HelloWorld.getInstance()\n    \n}复制代码\n自动化赋值 您可以通过@MainPlugin直接获得主类对象，当然只能使用于主类，监听器类，命令类 如listener.ns\n\nimport net.noyark.www.HelloWorld\n\nimport cn.nukkit.event.EventHandler\nimport cn.nukkit.event.player.PlayerJoinEvent\n\n@MainPlugin\nPluginBase base\n\n@EventHandler\nvoid onPlayerJoin(PlayerJoinEvent e){\n    base.logger.info(\"hello,world\") //这里可以直接调用\n    \n}复制代码"
        },
        {
            "author": "VichainLee",
            "timestamp": 1582383600,
            "txt_content": "ohhhhh前排支持黑科技"
        },
        {
            "author": "xiaolu550",
            "timestamp": 1582384440,
            "txt_content": "VichainLee 发表于 2020-2-22 23:00\nohhhhh前排支持黑科技\n谢谢支持！"
        },
        {
            "author": "Kenneth_z",
            "timestamp": 1582430160,
            "txt_content": "恭喜优秀"
        },
        {
            "author": "xiaolu550",
            "timestamp": 1582431120,
            "txt_content": "更新v1.0.3 在脚本根文件夹下libs文件夹下添加jar包即可被加载\n开发者可能多少会被ClassNotFound给烦到，脚本支持了第三方库直接导入。\n即在脚本根文件夹下直接放入jar包，这样，您的jar包默认视为被导入。\n具体参见README.md第三方库导入部分"
        },
        {
            "author": "xiaolu550",
            "timestamp": 1582507440,
            "txt_content": "更新v1.0.4 提高运行效率\n\n在这里顺提一下，如果groovy效率比较低，您可以使用@CompileStatic注解在您方法上，这样您编译后的字节码几乎和java的相似，效率不会有很大衰减"
        },
        {
            "author": "xiaolu550",
            "timestamp": 1582636020,
            "txt_content": "更新v1.0.6 支持info.retain\nnfo.retain设置为true，可以对主类不进行套壳编译。\n\ninfo.ns\n\ninfo{\n      name \"Game\"\n      version \"1.0.0\"\n      author \"MagicLu\"\n      listeners ([\"PlayerListener.ns\"])\n      retain true\n      id \"net.noyark.www\"\n      description \"\"\n      permissions ([\n           \"FirstPlugin.fp\" : [\n                  description : \"\",\n                  default : \"op\"\n           ]\n      ])\n      commands ([\n          fp : [\n              \"usage\" : \"/fp help\",\n              \"description\" : \"指令介绍\",\n              \"permission\" : \"FirstPlugin.fp\"\n          ]\n      ])\n}复制代码\nmain.ns只能写成\n\nclass Game extends PluginBase{\n    void onLoad(){\n        this.logger.info(\"MagicLu's script example02,the simple pvp game\")\n    }\n\n    void onEnable(){\n        this.logger.info(\"插件已经加载\")\n    }\n\n    void onDisable(){\n\n    }\n}复制代码\n设计这个的意义: 有些人可能为了使用ide的补全功能，可以开启它"
        },
        {
            "author": "DouYu-FengYe",
            "timestamp": 1589099460,
            "txt_content": "可以可以                                   "
        }
    ]
}