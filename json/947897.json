{
    "title": "【LAY Studio|CAM开发随笔】如何用datapack更好的模拟原版工作台【21/2/13更新】",
    "author": "CR_019",
    "replyCount": 14,
    "timestamp": 1580285640,
    "txt_content": " 本帖最后由 CR_019 于 2021-2-19 09:42 编辑 \n\n\n前言\n一年过后，我把这个包提取出来，对一些上一版存在的缺陷进行了修复和改进，并且发布。\n    在CNC发布之际，有必要把新增与修改的功能讲解一遍。\n    适合有一定命令和数据包开发基础的玩家阅读。\n    与上一版重复的部分不作提示。\n正文\n加载时运行函数：\ncnc/functions/machine/crafting_table/load:scoreboard objectives add CNC_crafterror dummy\nscoreboard objectives add CNC_table_count dummy\nscoreboard objectives add CNC_output dummy\nscoreboard objectives add CNC_clear dummy\nscoreboard objectives add CNC_shiftdealt dummy\nscoreboard objectives add CNC_shiftcount dummy\nscoreboard objectives add CNC_player_count dummy\nscoreboard objectives add CNC_bottlecount dummy\nscoreboard objectives add CNC_item_trigger dummy\nscoreboard objectives add CNC_shift_muti dummy\nscoreboard objectives add CNC_shapeless dummy\nscoreboard objectives add CNC_SLtemp dummy\nscoreboard objectives add CNC_SLout dummy\nscoreboard objectives add CNC_craftag dummy\nscoreboard objectives add CNC_rclick dummy\nscoreboard objectives add CNC_rclick_sub dummy\nscoreboard objectives add CNC_rclick_suc dummy\nscoreboard objectives add CNC_rclick_sub2 dummy\nscoreboard objectives add CNC_rclick_sub3 dummy复制代码\n加载数据包用到的计分板。\n每刻运行函数：\ncnc/functions/machine/crafting_table/tick: #开头基础处理：物品处理 初始化变量\nkill @e[nbt={Item:{tag:{CNC_bg:1b}}}]\nexecute store result score @a CNC_crafterror run clear @a minecraft:firework_star{CNC_bg:1b} 0\nexecute as @a store result score @s CNC_bottlecount run clear @a #nbt_crafting:cam_recipes 0\n\n#放置与破坏处理\nexecute as @e[type=minecraft:armor_stand,tag=cnc_crafting] at @s align xyz if block ~ ~ ~ minecraft:crafting_table run function cnc:machine/crafting_table/replace\nexecute as @e[type=minecraft:armor_stand,tag=cnc_crafting,tag=CNC_craft_enable] at @s unless block ~ ~ ~ minecraft:barrel run function cnc:machine/crafting_table/clear\nexecute as @e[type=minecraft:armor_stand,tag=cnc_crafting,tag=CNC_craft_enable] run data modify entity @s Fire set value 32767s\nexecute as @e[type=minecraft:armor_stand,tag=cnc_crafting,tag=CNC_craft_enable] at @s run function cnc:machine/crafting_table/gui\n\n#功能\n\n#Shift键处理\nexecute as @a[nbt={Inventory:[{tag:{Output:1b}}]}] run tag @s add CNC_shiftcheck\nexecute if entity @a[tag=CNC_shiftcheck] as @e[type=minecraft:armor_stand,tag=cnc_crafting,tag=CNC_craft_enable] at @s unless data block ~ ~ ~ {Items:[{Slot:16b}]} run function cnc:machine/crafting_table/shiftcheck\n#配方处理\nexecute as @e[type=minecraft:armor_stand,tag=cnc_crafting,tag=CNC_craft_enable] at @s run function cnc:machine/crafting_table/recipe\n#输出标签处理\nexecute as @a[nbt={Inventory:[{tag:{Output:1b}}]}] at @s run function cnc:machine/crafting_table/inventory\n#误放入处理\nexecute as @e[type=minecraft:armor_stand,tag=cnc_crafting,tag=CNC_craft_enable] at @s run function cnc:machine/crafting_table/check\n#Shift键处理 初始化tag\ntag @a remove CNC_shiftcheck\n\n\n#结尾基础处理：物品处理 初始化变量\nclear @a firework_star{CNC_bg:1b}\nscoreboard players reset $temp CNC_rclick_suc\nscoreboard players reset @a CNC_rclick复制代码\n#开头基础处理 #放置与破坏处理\n\n#开头基础处理：物品处理 初始化变量：清除带有CAM_bg标签的物品，将有关误放入处理模块的计分板重置#放置与破坏处理:第1条:检测放置合成台（配合进度），第2条:检测破坏合成台第3条：防止盔甲架变黑\n第4条：防止位于0槽位的gui被移动\n\n\n#功能见子页面\n#配方处理：#配方处理\nexecute as @e[type=minecraft:armor_stand,tag=cnc_crafting,tag=CNC_craft_enable] at @s run function cnc:machine/crafting_table/recipe复制代码cnc/functions/machine/crafting_table/recipe：#获取已占槽位\nfunction cnc:machine/crafting_table/recipes/count\n#右键侦测前置\nexecute as @a store result score @s CNC_rclick run clear @s #uin:tech/all{Output:1b} 0\nexecute as @a store result score @s CNC_rclick_sub run clear @s #uin:tech/all{Output:1b,CNC_bg:1b} 0\nexecute as @a run scoreboard players operation @s CNC_rclick -= @s CNC_rclick_sub\nexecute at @s if data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b,CNC_bg:1b}}]} store result score @s CNC_rclick_sub3 run data get block ~ ~ ~ Items[{Slot:16b}].Count\nexecute as @s run scoreboard players operation @s CNC_rclick_sub2 -= @s CNC_rclick_sub3\nscoreboard players operation @s 6 = @s CNC_rclick_sub2\n#清除合成区物品\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} if entity @s[tag=!CNC_not_to_clear] run function cnc:machine/crafting_table/recipes/clear\ntag @s remove CNC_not_to_clear\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CNC_bg:1b}}]} run tag @s add CNC_not_to_clear\nexecute at @s if data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b,CNC_bg:1b}}]} unless score @s CNC_rclick_sub2 matches 0 if entity @a[sort=nearest,limit=1,scores={CNC_rclick=1..},distance=..5] run function cnc:machine/crafting_table/rightclick\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} run replaceitem block ~ ~ ~ container.16 minecraft:air\nexecute if data block ~ ~ ~ {Items:[{Slot:16b}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} at @s run function cnc:machine/crafting_table/replace/16_spe\nexecute if data block ~ ~ ~ {Items:[{Slot:16b}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} at @s run clear @a[sort=nearest,limit=1,scores={CNC_rclick=1..},distance=..5] #uin:tech/all{Output:1b}\n#配方检测\nfunction #cnc:recipes\n#右键侦测前置\nexecute at @s if data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b,CNC_bg:1b}}]} store result score @s CNC_rclick_sub2 run data get block ~ ~ ~ Items[{Slot:16b}].Count\n#初始化变量\nscoreboard players reset @s CNC_table_count\n#shift处理相关\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} run scoreboard players add @s CNC_shiftdealt 1复制代码\n#获取已占槽位：\n为配方的判定做准备，判定有多少个合成槽位有物品，以防止多放物品的情况无法被检测到；\n使用计分板处理。\ncnc/functions/machine/crafting_table/recipes/count：execute if data block ~ ~ ~ Items[{Slot:1b}] run scoreboard players add @s CNC_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:2b}] run scoreboard players add @s CNC_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:3b}] run scoreboard players add @s CNC_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:10b}] run scoreboard players add @s CNC_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:11b}] run scoreboard players add @s CNC_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:12b}] run scoreboard players add @s CNC_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:19b}] run scoreboard players add @s CNC_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:20b}] run scoreboard players add @s CNC_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:21b}] run scoreboard players add @s CNC_table_count 1复制代码\n #清除合成区物品：\n检测输出物品被拿取时，将合成区物品数量-1；\n检测的方式是这样的：\n在输出栏（槽位16）空置时，占位物品有两个标签：\"CNC_bg:1b\"和\"Output:1b\"\n输出栏有输出物品时，该物品有一个标签：\"Output:1b\"\n而当玩家拿出输出栏物品后，有一个短暂的“真空期”，即在输出栏没有物品。\n这里根据这三种状态的不同来判定玩家是否拿出输出栏物品。但是这种方法不能检测出右键拿取物品的行为。\n#清除合成区物品（截取模块）\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} if entity @s[tag=!CNC_not_to_clear] run function cnc:machine/crafting_table/recipes/clear\ntag @s remove CNC_not_to_clear\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CNC_bg:1b}}]} run tag @s add CNC_not_to_clear\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} run replaceitem block ~ ~ ~ container.16 minecraft:air\n复制代码cnc/functions/machine/crafting_table/recipes/clear： function cnc:machine/crafting_table/recipes/clear/1\nfunction cnc:machine/crafting_table/recipes/clear/2\nfunction cnc:machine/crafting_table/recipes/clear/3\nfunction cnc:machine/crafting_table/recipes/clear/10\nfunction cnc:machine/crafting_table/recipes/clear/11\nfunction cnc:machine/crafting_table/recipes/clear/12\nfunction cnc:machine/crafting_table/recipes/clear/19\nfunction cnc:machine/crafting_table/recipes/clear/20\nfunction cnc:machine/crafting_table/recipes/clear/21复制代码\n\n这是一个穷举模块，在清除合成栏物品的同时，对药水、蜂蜜瓶等物品进行特殊处理。展示其中一个函数，其余类推，下同；\ncnc/functions/machine/crafting_table/recipes/clear/1：execute if data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:honey_bottle\"}]} unless data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:honey_bottle\",Count:1b}]} run give @a[scores={CNC_bottlecount=1..},limit=1,sort=nearest] glass_bottle 1 \nexecute if data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:honey_bottle\",Count:1b}]} run replaceitem block ~ ~ ~ container.1 minecraft:glass_bottle 2\nexecute as @s unless data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:potion\"}]} unless data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:honey_bottle\",Count:1b}]} store result block ~ ~ ~ Items[{Slot:1b}].Count byte 0.99 run data get block ~ ~ ~ Items[{Slot:1b}].Count复制代码\n#右键侦测：#右键侦测（截取模块）\n#右键侦测前置\nexecute as @a store result score @s CNC_rclick run clear @s #uin:tech/all{Output:1b} 0\nexecute as @a store result score @s CNC_rclick_sub run clear @s #uin:tech/all{Output:1b,CNC_bg:1b} 0\nexecute as @a run scoreboard players operation @s CNC_rclick -= @s CNC_rclick_sub\nexecute at @s if data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b,CNC_bg:1b}}]} store result score @s CNC_rclick_sub3 run data get block ~ ~ ~ Items[{Slot:16b}].Count\nexecute as @s run scoreboard players operation @s CNC_rclick_sub2 -= @s CNC_rclick_sub3\nscoreboard players operation @s 6 = @s CNC_rclick_sub2\n#清除合成区物品\nexecute at @s if data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b,CNC_bg:1b}}]} unless score @s CNC_rclick_sub2 matches 0 if entity @a[sort=nearest,limit=1,scores={CNC_rclick=1..},distance=..5] run function cnc:machine/crafting_table/rightclick\nexecute if data block ~ ~ ~ {Items:[{Slot:16b}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} at @s run clear @a[sort=nearest,limit=1,scores={CNC_rclick=1..},distance=..5] #uin:tech/all{Output:1b}\n#右键侦测前置\nexecute at @s if data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b,CNC_bg:1b}}]} store result score @s CNC_rclick_sub2 run data get block ~ ~ ~ Items[{Slot:16b}].Count\n复制代码\n当一个配方的产物数量大于1时，玩家在输出栏点击右键，会拿取其中的一半物品，此时不能检测到输出栏物品被拿取，合成栏物品不会被清除，而在下一刻配方处理模块会将输出栏物品的数量复位，导致可以无限刷物品，这也是上一个版本中较为严重的一个问题。\n这里设计这个模块来防止。\n\n#开头的右键侦测前置：\n分两部分，第一部分为前三条命令，判定手上拿着输出物品（含有\"Output:1b\"标签，该标签在玩家物品栏中会被清除）的玩家；\n第二部分为后两条命令，与结尾的右键侦测前置一起，原来规避一种重大问题，在讲结尾前置的时候一并提及。\n#右键侦测主命令：\n合成台侦测周围有手上拿着输出物品的玩家，且自己的输出栏内仍有输出物品，则判定为玩家使用右键拿取了物品，触发右键操作函数\ncnc/functions/machine/crafting_table/rightclick:#清除手里的物品\nclear @a[sort=nearest,limit=1,scores={CNC_rclick=1..},distance=..5] #uin:tech/all{Output:1b}\n#重载配方\nreplaceitem block ~ ~ ~ container.16 air\nfunction #cnc:recipes\n#物品给予\nsetblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\nexecute if data block ~ ~ ~ Items[{Slot:16b}] run data modify block ~ 255 ~ Items[0] set from block ~ ~ ~ Items[{Slot:16b}]\nexecute unless data block ~ ~ ~ Items[{Slot:16b}] run data modify block ~ 255 ~ Items[0] set value {Slot:0b,id:\"minecraft:air\",Count:1b}\nexecute as @e[sort=nearest,limit=1,scores={CNC_rclick=1..},distance=..5] store result score $temp CNC_rclick_suc run loot give @s mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}\nsetblock ~ 255 ~ air\n#清除合成区物品\nexecute if score $temp CNC_rclick_suc matches 1.. run function cnc:machine/crafting_table/recipes/clear\n复制代码\n             该操作先清除手中拿取的物品，然后重新载入配方，使输出栏物品数量恢复，然后使用rua影盒技术（误）将输出栏物品放到玩家物品栏中,最后清除合成区物品。\n#结尾的右键侦测前置：        这么处理还有一个严重的问题，就是当用左键拿出物品后，在下一刻，合成台执行了配方模块函数，把配方复位后，就能够满足“右键侦测”条件，从而把物品复制到玩家物品栏中。表现上为左键和右键行为一样。        因此，在这一刻的结尾（经配方模块复位）执行获取输出栏的物品数量，在下一刻的开头（玩家操作后）再执行一次，并比较两者是否相同。若相同，则表示玩家未使用右键，不触发右键操作，反之亦然。\n                在清除合成区物品和右键侦测模块中还有这么一行：execute if data block ~ ~ ~ {Items:[{Slot:16b}]} unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} at @s run function cnc:machine/crafting_table/replace/16_spe复制代码这是误放入处理的特殊处理，适用于在槽位16有输出物品的时候的处理，到误放入处理时讲解。\n#配方检测\n检测自定义的配方，见自定义配方的操作方法。\n#shift处理相关：见Shift处理。\n\n\n#输出标签处理：\n#输出标签处理\nexecute as @a[nbt={Inventory:[{tag:{Output:1b}}]}] at @s run function cnc:machine/crafting_table/inventory复制代码\ncnc/functions/machine/crafting_table/inventory:setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\n\nexecute if data entity @s {Inventory:[{Slot:0b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/0\nexecute if data entity @s {Inventory:[{Slot:1b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/1\nexecute if data entity @s {Inventory:[{Slot:2b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/2\nexecute if data entity @s {Inventory:[{Slot:3b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/3\nexecute if data entity @s {Inventory:[{Slot:4b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/4\nexecute if data entity @s {Inventory:[{Slot:5b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/5\nexecute if data entity @s {Inventory:[{Slot:6b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/6\nexecute if data entity @s {Inventory:[{Slot:7b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/7\nexecute if data entity @s {Inventory:[{Slot:8b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/8\nexecute if data entity @s {Inventory:[{Slot:9b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/9\nexecute if data entity @s {Inventory:[{Slot:10b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/10\nexecute if data entity @s {Inventory:[{Slot:11b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/11\nexecute if data entity @s {Inventory:[{Slot:12b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/12\nexecute if data entity @s {Inventory:[{Slot:13b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/13\nexecute if data entity @s {Inventory:[{Slot:14b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/14\nexecute if data entity @s {Inventory:[{Slot:15b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/15\nexecute if data entity @s {Inventory:[{Slot:16b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/16\nexecute if data entity @s {Inventory:[{Slot:17b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/17\nexecute if data entity @s {Inventory:[{Slot:18b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/18\nexecute if data entity @s {Inventory:[{Slot:19b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/19\nexecute if data entity @s {Inventory:[{Slot:20b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/20\nexecute if data entity @s {Inventory:[{Slot:21b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/21\nexecute if data entity @s {Inventory:[{Slot:22b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/22\nexecute if data entity @s {Inventory:[{Slot:23b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/23\nexecute if data entity @s {Inventory:[{Slot:24b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/24\nexecute if data entity @s {Inventory:[{Slot:25b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/25\nexecute if data entity @s {Inventory:[{Slot:26b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/26\nexecute if data entity @s {Inventory:[{Slot:27b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/27\nexecute if data entity @s {Inventory:[{Slot:28b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/28\nexecute if data entity @s {Inventory:[{Slot:29b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/29\nexecute if data entity @s {Inventory:[{Slot:30b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/30\nexecute if data entity @s {Inventory:[{Slot:31b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/31\nexecute if data entity @s {Inventory:[{Slot:32b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/32\nexecute if data entity @s {Inventory:[{Slot:33b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/33\nexecute if data entity @s {Inventory:[{Slot:34b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/34\nexecute if data entity @s {Inventory:[{Slot:35b,tag:{Output:1b}}]} run function cnc:machine/crafting_table/inventory/35\n\n\n\nsetblock ~ 255 ~ air复制代码\ncnc/functions/machine/crafting_table/inventory/0:data modify block ~ 255 ~ Items[0].id set from entity @s Inventory[{Slot:0b}].id\ndata modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{Slot:0b}].Count\ndata modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{Slot:0b}].tag\ndata remove block ~ 255 ~ Items[0].tag.Output\nloot replace entity @s hotbar.0 1 mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}复制代码\n使用穷举的方法，结合rua影盒技术，除去在玩家物品栏的输出物品的输出标签\"Output\"\n注意用loot replace 和replaceitem 时注意快捷栏是hotbar0~8对应Inventory中Slot的0~8，inventory的0~26对应Inventory中的9~35。注意用loot replace 和replaceitem 时注意快捷栏是hotbar0~8对应Inventory中Slot的0~8，loot命令中inventory的0~26对应Inventory中的9~35。\n#误放入处理#误放入处理\nexecute as @e[type=minecraft:armor_stand,tag=cnc_crafting,tag=CNC_craft_enable] at @s run function cnc:machine/crafting_table/check复制代码cnc/functions/machine/crafting_table/check:execute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:0b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/0\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{Output:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/16\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:4b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/4\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:5b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/5\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:6b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/6\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:7b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/7\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:8b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/8\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:9b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/9\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:13b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/13\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:14b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/14\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:15b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/15\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:17b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/17\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:18b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/18\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:22b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/22\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:23b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/23\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:24b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/24\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:25b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/25\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:26b,tag:{CNC_bg:1b}}]} positioned ~ ~ ~ run function cnc:machine/crafting_table/replace/26复制代码cnc/functions/machine/crafting_table/replace/0:setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\ndata modify block ~ 255 ~ Items[0] set from block ~ ~ ~ Items[0]\ndata modify block ~ ~ ~ Items[0] set value {id:\"minecraft:firework_star\",Count:1b,Slot:0b,tag:{CustomModelData:9102024,display:{Name:\"{\"translate\":\"item.cnc.crafting_table\"}\"},CNC_bg:1b}}\nexecute as @e[sort=nearest,limit=1,scores={CNC_crafterror=1..}] run loot give @s mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}\nexecute at @s run setblock ~ 255 ~ air复制代码\ncnc/functions/machine/crafting_table/replace/16_spe:setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\nexecute if data block ~ ~ ~ Items[{Slot:16b}] run data modify block ~ 255 ~ Items[0] set from block ~ ~ ~ Items[{Slot:16b}]\nexecute unless data block ~ ~ ~ Items[{Slot:16b}] run data modify block ~ 255 ~ Items[0] set value {Slot:0b,id:\"minecraft:air\",Count:1b}\nexecute as @e[sort=nearest,limit=1,scores={CNC_rclick=1..},distance=..5] run loot give @s mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}\nsetblock ~ 255 ~ air复制代码\n使用穷举，判定误放入合成台背景或输出栏的物品，并返还给玩家。\n输出栏有物品的情况由配方检测处的那一条命令处理。\n\n\n#shift键处理：\n重头戏。#Shift键处理\nexecute as @a[nbt={Inventory:[{tag:{Output:1b}}]}] run tag @s add CNC_shiftcheck\nexecute if entity @a[tag=CNC_shiftcheck] as @e[type=minecraft:armor_stand,tag=cnc_crafting,tag=CNC_craft_enable] at @s unless data block ~ ~ ~ {Items:[{Slot:16b}]} run function cnc:machine/crafting_table/shiftcheck复制代码首先检测背包里有标签\"Output:1b\"物品的玩家，给这个玩家加上CAM_shiftcheck的tag，然后检测是否有此tag的玩家，如有则以第16槽位为“真空”的合成台为执行者执行命令通过这两个（红字）条件，可判定玩家是否使用了shift，具体原因见SPGoding在该问题中的解答:单纯左键：该物品立刻消失，直到玩家再次左键放下前，检测不到该物品。Shift + 左键：该物品立刻消失并立刻出现在玩家物品栏内。\n\nshift检测：cnc/functions/machine/crafting_table/shiftcheck:#初始化变量和tag\nscoreboard players set @s CNC_shiftdealt 2\nscoreboard players set @a CNC_player_count 37\nscoreboard players reset @a CNC_item_trigger\n#检测玩家剩余槽位数和当前物品最大可堆叠数量，以及计分板数据转移\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} as @e[tag=CNC_shiftcheck] at @s run function cnc:machine/crafting_table/shift_player\nscoreboard players operation @s CNC_player_count = @e[tag=CNC_shiftcheck] CNC_player_count\nfunction cnc:machine/crafting_table/shift_data_get\nscoreboard players operation @s CNC_player_count *= @s CNC_item_trigger\nexecute store result score @s CNC_shift_muti run clear @a[tag=CNC_shiftcheck] #uin:tech/all{Output:1b} 0\nscoreboard players operation @s CNC_shiftdealt *= @s CNC_shift_muti\n#模拟执行合成操作，以确定可执行的最大合成次数\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} if entity @e[tag=CNC_shiftcheck] run function cnc:machine/crafting_table/shifttest\nexecute if data block ~ ~ ~ {Items:[{Slot:16b}]} unless score @s CNC_shiftdealt < @s CNC_player_count run function cnc:machine/crafting_table/recipes/clear\nscoreboard players operation @s CNC_shiftdealt /= @s CNC_shift_muti\n#补偿机制相关\nexecute as @e[tag=CNC_comp] run scoreboard players remove @s CNC_shiftdealt 1\n#清除输出栏\nreplaceitem block ~ ~ ~ container.16 minecraft:air\n#（辅助）给予次数运算\nscoreboard players remove @s CNC_shiftdealt 2\n#计分板数据转移\nscoreboard players operation @e[tag=CNC_shiftcheck] CNC_shiftdealt = @s CNC_shiftdealt\n#给予玩家物品\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} as @e[tag=CNC_shiftcheck] at @s run function cnc:machine/crafting_table/shiftdealt\n#输出栏处理\nexecute if entity @e[tag=CNC_shiftcheck] run replaceitem block ~ ~ ~ container.16 minecraft:firework_star{CustomModelData:9102025,display:{Name:\"{\"translate\":\"item.cnc.crafting_table_output\"}\"},CNC_bg:1b,Output:1b}\n#初始化\ntag @s remove CNC_comp复制代码\n里面所谓的计分板数据转移是因为命令的执行者不同：玩家或合成台（即在合成台位置的盔甲架）而计算时把数据放在一起会省事一点。\n\n#检测玩家剩余槽位数：\n第一版有一个重大的问题，就是当物品给予数量超过玩家物品栏可容下的最大数量时，仍会尝试将合成台里的原料消耗完，而物品却并没有多给，这是我们不想要的。因此在这里使用穷举方法，通过CNC_player_count计分板数据来获取玩家剩余槽位，以限制模拟合成的执行次数。cnc/functions/machine/crafting_table/shift_player：execute if data entity @s Inventory[{Slot:0b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:1b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:2b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:3b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:4b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:5b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:6b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:7b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:8b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:9b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:10b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:11b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:12b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:13b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:14b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:15b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:16b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:17b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:18b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:19b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:20b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:21b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:22b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:23b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:24b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:25b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:26b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:27b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:28b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:29b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:30b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:31b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:32b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:33b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:34b}] run scoreboard players remove @s CNC_player_count 1\nexecute if data entity @s Inventory[{Slot:35b}] run scoreboard players remove @s CNC_player_count 1复制代码\n#检测当前物品最大可堆叠数量：cnc/functions/machine/crafting_table/shift_data_get：execute as @e[tag=CNC_shiftcheck,limit=1,sort=nearest] run scoreboard players set @s CAM_item_trigger 0\nexecute as @e[tag=CNC_shiftcheck,limit=1,sort=nearest] store result score @s CNC_item_trigger run clear @s #cnc:1x{Output:1b} 0\nexecute if score @e[tag=CNC_shiftcheck,limit=1,sort=nearest] CNC_item_trigger matches 1.. run scoreboard players set @s CNC_item_trigger 1\nexecute as @e[tag=CNC_shiftcheck,limit=1] store result score @s CNC_item_trigger run clear @s #cnc:16x{Output:1b} 0\nexecute if score @e[tag=CNC_shiftcheck,limit=1,sort=nearest] CNC_item_trigger matches 1.. run scoreboard players set @s CNC_item_trigger 16\nexecute if score @e[tag=CNC_shiftcheck,limit=1,sort=nearest] CNC_item_trigger matches ..0 run scoreboard players set @s CNC_item_trigger 64复制代码首先侦测输出物品是否为不可堆叠物品,如果是，将计分板数据设置为1，接下来检测是否为以16个为一组的物品，如都不是，则默认为以64个为一组的物品。便于下面的计算。\n#模拟合成：cncfunctions/machine/crafting_table/shifttest:scoreboard players operation @s CNC_shiftdealt /= @s CNC_shift_muti\nreplaceitem block ~ ~ ~ container.16 minecraft:air\nfunction cnc:machine/crafting_table/recipe\nscoreboard players operation @s CNC_shiftdealt *= @s CNC_shift_muti\nexecute if data block ~ ~ ~ {Items:[{Slot:16b}]} if score @s CNC_shiftdealt > @s CNC_player_count run tag @a[tag=CNC_shiftcheck] add CNC_comp\nexecute if data block ~ ~ ~ {Items:[{Slot:16b}]} if score @s CNC_shiftdealt < @s CNC_player_count run function cnc:machine/crafting_table/shifttest复制代码\n\n模拟合成有两个限制：原料和玩家物品栏。原料限制可以由配方函数控制，而玩家物品栏限制则为计算（括号内为对应计分板名）：首先将玩家所剩槽位数（CNC_player_count）乘以其最大可堆叠数（CNC_item_trigger），即为玩家最多可获得的物品数，记为a；然后将单次可合成数（CNC_shift_muti）乘以已模拟执行合成次数（CNC_shiftdealt）,即为已经“合成”出的物品数量，记为b；将两数对比，若b大于a，则证明模拟合成次数达到了上限，停止模拟合成操作。为了少用几个计分板，这里面还有一些琐碎的小计算，这里不再赘述，都在代码里面。\n\n但是我们要注意一种常见的情形：在某次执行中，b小于a，可再递归执行一次，但是执行完以后b却大于了a，导致过量合成。因此我们要将开始的shiftdealt变量调高一个，到后面减去即可。这样操作很方便，但有一个问题，就是如果合成的量正好为整组，如此操作会使实际合成的物品量少一个配方的输出物品数量。\n\n#物品给予模块cnc/functions/machine/crafting_table/shiftdealt:setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\ndata modify block ~ 255 ~ Items[0].id set from entity @s Inventory[{tag:{Output:1b}}].id\ndata modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{tag:{Output:1b}}].Count\ndata modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{tag:{Output:1b}}].tag\nexecute as @s store result score @s CNC_shiftcount run data get block ~ 255 ~ Items[0].Count\nscoreboard players operation @s CNC_shiftcount *= @s CNC_shiftdealt\nfunction cnc:machine/crafting_table/sub_shiftdealt\nsetblock ~ 255 ~ air复制代码\ncnc/functions/machine/crafting_table/sub_shiftdealt:execute if score @s CNC_shiftcount matches 64.. run data modify block ~ 255 ~ Items[0].Count set value 64\nexecute as @s if score @s CNC_shiftcount matches 1..64 store result block ~ 255 ~ Items[0].Count byte 1 run scoreboard players get @s CNC_shiftcount\nexecute as @s if score @s CNC_shiftcount matches 1.. run loot give @s mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}\nscoreboard players remove @s CNC_shiftcount 64\nexecute if score @s CNC_shiftcount matches 1.. run function cnc:machine/crafting_table/sub_shiftdealt\nexecute if score @s CNC_shiftcount matches ..0 run data remove block ~ 255 ~ Items[0]复制代码\n译：1、-放置rua影盒2、-复制玩家合成出的物品数据    -如果要合成的物品数量大于64，将盒中物品数量设为64    -如果数量介于0与64之间，将盒中物品数量设为要合成的物品数量3、-将盒中物品给予玩家4、-将数量减去64    -若变量小于0，则停止    -若变量大于0，则继续从第二步执行5、清除rua影盒注：这里直接使用64个的原因是容器中，物品的数量不受该物品堆叠最大数量限制，最高可达127；而在rua影盒技术中使用的loot命令会把内含的物品正确堆叠。用64而不用127的原因是为了兼顾性能和稳定性。\n\n\n自定义配方的操作方法（在cnc/functions/machine/crafting_table/recipes/sample中）：\n自定义配方使用execute命令，分为两部分，检测部分（if）和输出部分（run replaceitem）\n#有序合成：#有序合成：在检测方块时注明Slot（合成区Slot：由上到下，由左到右依次为：1b,2b,3b;10b,11b,12b;19b,20b,21b）\n#镜像合成穷举一遍\n#示例：铁斧\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:20b,id:\"minecraft:stick\"},{Slot:11b,id:\"minecraft:stick\"},{Slot:1b,id:\"minecraft:iron_ingot\"},{Slot:2b,id:\"minecraft:iron_ingot\"},{Slot:10b,id:\"minecraft:iron_ingot\"}]} if entity @s[scores={CNC_table_count=5}] unless data block ~ ~ ~ {Items:[{id:\"minecraft:iron_sword\",tag:{id:\"cam:chain_blade\"}}]} run replaceitem block ~ ~ ~ container.16 minecraft:iron_axe\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:20b,id:\"minecraft:stick\"},{Slot:11b,id:\"minecraft:stick\"},{Slot:3b,id:\"minecraft:iron_ingot\"},{Slot:2b,id:\"minecraft:iron_ingot\"},{Slot:12b,id:\"minecraft:iron_ingot\"}]} if entity @s[scores={CNC_table_count=5}] unless data block ~ ~ ~ {Items:[{id:\"minecraft:iron_sword\",tag:{id:\"cam:chain_blade\"}}]} run replaceitem block ~ ~ ~ container.16 minecraft:iron_axe复制代码\n#无序合成：#无重复的物品的无序合成：不注明Slot即可\n#无序合成与有序合成可以混用（如一部分材料限定位置，另一部分不限定）\n#示例：末影之眼\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{id:\"minecraft:blaze_powder\"},{id:\"minecraft:ender_pearl\"}]} if entity @s[scores={CNC_table_count=2}] run replaceitem block ~ ~ ~ container.16 ender_eye复制代码\n#同种多物品无序合成：#有重复物品的无序合成：先用exe if辅助判断一下需要的重复物品的个数,列入检测即可\n#示例：书的合成\n\n#无序合成模块\nexecute store result score @s CNC_SLout if data block ~ ~ ~ Items[{id:\"minecraft:paper\"}]\n#主命令\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{id:\"minecraft:paper\"},{id:\"minecraft:leather\"}]} if entity @s[scores={CNC_table_count=4,CNC_SLout=3}] run replaceitem block ~ ~ ~ container.16 book\n复制代码\n这里一开始我准备使用计分板计算的方法，后来@VCS-Official提醒我可以用execute if 简便地解决，在此致谢\n#tag合成：\n这里运用了穷举的办法获取物品是否符合断言，使得自定义该种配方的操作较为繁琐。由于需要动态的断言名称，暂时想不到很好的内建的方案。\n来源于@晴路卡在该问题中的解答，进行了一定的修改。在此致谢。#含有tag的配方比较复杂，要先设置一个断言，并在这里引用，穷举每一个合成区的物品，检测其是否符合该断言。在下方该tag处，不要键入id。建议直接复制这里的代码\n#断言路径：cnc:crafting_table/planks\n#示例：碗的合成\n\n#初始化\nscoreboard players reset @s CAM_craftag\n#检测tag\ndata modify entity @s ArmorItems[2] set value {id:\"minecraft:stone\",Count:1b}\ndata modify entity @s ArmorItems[2].id set from block ~ ~ ~ Items[{Slot:1b}].id\nexecute if entity @s[predicate=cnc:crafting_table/planks] run scoreboard players add @s CAM_craftag 1\ndata modify entity @s ArmorItems[2] set value {id:\"minecraft:stone\",Count:1b}\ndata modify entity @s ArmorItems[2].id set from block ~ ~ ~ Items[{Slot:2b}].id\nexecute if entity @s[predicate=cnc:crafting_table/planks] run scoreboard players add @s CAM_craftag 1\ndata modify entity @s ArmorItems[2] set value {id:\"minecraft:stone\",Count:1b}\ndata modify entity @s ArmorItems[2].id set from block ~ ~ ~ Items[{Slot:3b}].id\nexecute if entity @s[predicate=cnc:crafting_table/planks] run scoreboard players add @s CAM_craftag 1\ndata modify entity @s ArmorItems[2] set value {id:\"minecraft:stone\",Count:1b}\ndata modify entity @s ArmorItems[2].id set from block ~ ~ ~ Items[{Slot:10b}].id\nexecute if entity @s[predicate=cnc:crafting_table/planks] run scoreboard players add @s CAM_craftag 1\ndata modify entity @s ArmorItems[2] set value {id:\"minecraft:stone\",Count:1b}\ndata modify entity @s ArmorItems[2].id set from block ~ ~ ~ Items[{Slot:11b}].id\nexecute if entity @s[predicate=cnc:crafting_table/planks] run scoreboard players add @s CAM_craftag 1\ndata modify entity @s ArmorItems[2] set value {id:\"minecraft:stone\",Count:1b}\ndata modify entity @s ArmorItems[2].id set from block ~ ~ ~ Items[{Slot:12b}].id\nexecute if entity @s[predicate=cnc:crafting_table/planks] run scoreboard players add @s CAM_craftag 1\ndata modify entity @s ArmorItems[2] set value {id:\"minecraft:stone\",Count:1b}\ndata modify entity @s ArmorItems[2].id set from block ~ ~ ~ Items[{Slot:19b}].id\nexecute if entity @s[predicate=cnc:crafting_table/planks] run scoreboard players add @s CAM_craftag 1\ndata modify entity @s ArmorItems[2] set value {id:\"minecraft:stone\",Count:1b}\ndata modify entity @s ArmorItems[2].id set from block ~ ~ ~ Items[{Slot:20b}].id\nexecute if entity @s[predicate=cnc:crafting_table/planks] run scoreboard players add @s CAM_craftag 1\ndata modify entity @s ArmorItems[2] set value {id:\"minecraft:stone\",Count:1b}\ndata modify entity @s ArmorItems[2].id set from block ~ ~ ~ Items[{Slot:21b}].id\nexecute if entity @s[predicate=cnc:crafting_table/planks] run scoreboard players add @s CAM_craftag 1\n#主命令\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:1b},{Slot:11b},{Slot:3b}]} if entity @s[scores={CNC_table_count=3,CAM_craftag=3}] run replaceitem block ~ ~ ~ container.16 bowl\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:10b},{Slot:20b},{Slot:12b}]} if entity @s[scores={CNC_table_count=3,CAM_craftag=3}] run replaceitem block ~ ~ ~ container.16 bowl复制代码\n其中引用的断言文件：    {\n      \"condition\": \"minecraft:entity_properties\",\n      \"entity\": \"this\",\n      \"predicate\": {\n        \"equipment\": {\n          \"chest\": {\n            \"tag\": \"minecraft:planks\"\n          }\n        }\n      }\n    }复制代码replaceitem指令也可以用loot replace取代。\n\n楼下会不会看到某位（来了呢\n前言      经过近一个月的开发，我把上一版的部分内容，特别是shift处理的部分进行了优化。虽然照例是有一个视频的，但是我没空剪。就这样吧。    为了让这个帖子凉的更快一点，我决定只放干货。毕竟水的比热容大一点。。。    由于基于我的数据包，因此内部的计分板和tag均带有本数据包标志“CAM”，见谅。    开始。    data/cam/functions/machine/crafting_table/tick: #开头基础处理：物品处理 初始化变量\nkill @e[nbt={Item:{tag:{CAM_bg:1b}}}]\nexecute store result score @a CAM_crafterror run clear @a minecraft:firework_star{CAM_bg:1b} 0\nexecute as @a store result score @s CAM_bottlecount run clear @a #cam:cam_recipes 0\n\n#放置与破坏处理\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting] at @s align xyz if block ~ ~ ~ minecraft:petrified_oak_slab run function cam:machine/crafting_table/replace\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s unless block ~ ~ ~ minecraft:barrel run function cam:machine/crafting_table/clear\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] run data modify entity @s Fire set value 32767s\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s run function cam:machine/crafting_table/gui\n\n#功能\n#Shift键处理\nexecute as @a[nbt={Inventory:[{tag:{CAM_output:1b}}]}] run tag @s add CAM_shiftcheck\nexecute if entity @a[tag=CAM_shiftcheck] as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s unless data block ~ ~ ~ {Items:[{Slot:16b}]} run function cam:machine/crafting_table/shiftcheck\n#配方处理\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s run function cam:machine/crafting_table/recipe\n#输出标签处理\nexecute as @a[nbt={Inventory:[{tag:{CAM_output:1b}}]}] at @s run function cam:machine/crafting_table/inventory\n#误放入处理\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s run function cam:machine/crafting_table/check\n#Shift键处理 初始化tag\ntag @a remove CAM_shiftcheck复制代码#开头基础处理 #放置与破坏处理    没有变化。下面是复制的内容。\n#开头基础处理：物品处理 初始化变量：清除带有CAM_bg标签的物品，将有关误放入背景物品返还模块玩家确定的计分板重置\n #放置与破坏处理:第1条:检测放置工作台（配合进度（就是视频里的advancement，用于调试的）），\n第2条:检测破坏合成台\n 3：防止盔甲架变黑\n#功能同第一版一样由于运用到recipes，shift放到后面讲。#配方处理 data/cam/functions/machine/crafting_table/recipe：#获取已占槽位\nfunction cam:machine/crafting_table/recipes/count\n#清除合成区物品\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} if entity @s[tag=!CAM_not_to_clear] run function cam:machine/crafting_table/recipes/clear\ntag @s remove CAM_not_to_clear\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_bg:1b}}]} run tag @s add CAM_not_to_clear\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_output:1b}}]} run replaceitem block ~ ~ ~ container.16 minecraft:air\n#配方检测\nfunction cam:machine/crafting_table/recipes/bamboo_sword\nfunction cam:machine/crafting_table/recipes/red_string\nfunction cam:machine/crafting_table/recipes/weedstew\nfunction cam:machine/crafting_table/recipes/honey_apple\nfunction cam:machine/crafting_table/recipes/erosion_arrow\n#初始化变量\nscoreboard players reset @s CAM_table_count\n#shift处理相关\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_output:1b}}]} run scoreboard players add @s CAM_shiftdealt 1复制代码变化不大。\n#获取已占槽位：为配方的判定做准备，判定有多少个合成槽位有物品\n data/cam/functions/machine/crafting_table/recipes/count:execute if data block ~ ~ ~ Items[{Slot:1b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:2b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:3b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:10b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:11b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:12b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:19b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:20b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:21b}] run scoreboard players add @s CAM_table_count 1复制代码\n\n    #清除合成区物品：检测输出物品被拿取时，将合成区物品数量-1，  #清除合成区物品\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} if entity @s[tag=!CAM_not_to_clear] run function cam:machine/crafting_table/recipes/clear\ntag @s remove CAM_not_to_clear\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_bg:1b}}]} run tag @s add CAM_not_to_clear\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_output:1b}}]} run replaceitem block ~ ~ ~ container.16 minecraft:air复制代码\ncam/functions/machine/crafting_table/recipes/clear：function cam:machine/crafting_table/recipes/clear/1\nfunction cam:machine/crafting_table/recipes/clear/2\nfunction cam:machine/crafting_table/recipes/clear/3\nfunction cam:machine/crafting_table/recipes/clear/10\nfunction cam:machine/crafting_table/recipes/clear/11\nfunction cam:machine/crafting_table/recipes/clear/12\nfunction cam:machine/crafting_table/recipes/clear/19\nfunction cam:machine/crafting_table/recipes/clear/20\nfunction cam:machine/crafting_table/recipes/clear/21复制代码\n这是一个穷举索引，下面展示其中一个：cam/functions/machine/crafting_table/recipes/clear/1：execute if data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:honey_bottle\"}]} unless data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:honey_bottle\",Count:1b}]} run give @a[scores={CAM_bottlecount=1..},limit=1,sort=nearest] glass_bottle 1 \nexecute if data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:honey_bottle\",Count:1b}]} run replaceitem block ~ ~ ~ container.1 minecraft:glass_bottle 2\nexecute as @s unless data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:potion\"}]} unless data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:honey_bottle\",Count:1b}]} store result block ~ ~ ~ Items[{Slot:1b}].Count byte 0.99 run data get block ~ ~ ~ Items[{Slot:1b}].Count</font>\nexecute if data block ~ ~ ~ {Items:[{Slot:1b,id:\"minecraft:potion\",Count:1b}]} run replaceitem block ~ ~ ~ container.1 minecraft:glass_bottle复制代码红字为主要实现的指令，其余为药水和蜂蜜瓶的特殊处理。由于我懒得翻译了，自己看吧。反正我针对的对象也不是完全不会命令的复制一下检测清除的翻译：              原理：从第4行开始（前一刻）\n                       1、如果输出栏（Slot：16）是“空的”（透明材质的占位符），将所在位置盔甲架加上tag；\n                       2、清除16号位物品（使合成栏变动时消除输出物品，拒绝白嫖）\n                       3、运行配方检测（若满足则在16号位放上物品）\n                       4、 运行到check指令时，如16号位真空，将空的16号位加上占位符\n                            否则无变化\n                         （后一刻）\n                       5、如果16号位真空，即check未填补（被配方占据），而此时输出物被拿走，检测tag（即玩家是否误点了占位符），若否，则将输入                栏物品数量-1\n                       6、移除tag，进行下一刻检测                       这样就达到了输入、输出两边同时存在，但只能取一边的目的。\n#配方检测：展示其中一个配方：                 data/cam/functions/machine/crafting_table/recipes/bamboo_sword:（其中一个配方）\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:19b,tag:{id:\"cam:red_string\"}},{Slot:11b,id:\"minecraft:bamboo\"},{Slot:3b,id:\"minecraft:bamboo\"}]} if entity @s[scores={CAM_table_count=3}] run replaceitem block ~ ~ ~ container.16 wooden_sword{display:{Name:\"{\"translate\":\"item.cam.bamboo_sword\",\"italic\":\"false\"}\"},CustomModelData:9102019,CAM_output:1b}\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:21b,tag:{id:\"cam:red_string\"}},{Slot:11b,id:\"minecraft:bamboo\"},{Slot:1b,id:\"minecraft:bamboo\"}]} if entity @s[scores={CAM_table_count=3}] run replaceitem block ~ ~ ~ container.16 wooden_sword{display:{Name:\"{\"translate\":\"item.cam.bamboo_sword\",\"italic\":\"false\"}\"},CustomModelData:9102019,CAM_output:1b}复制代码有序合成：指定Slot和物品属性，用CAM_table_count计分板确定已占槽位数，以达到多占槽位即判定不通过的目的；\n无序合成：基本同上，不指定Slot\n#误放入处理 #结尾基础处理\n没有变化。复制一下第一版内容：\n#误放入处理：             \n data/cam/functions/machine/crafting_table/check:execute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:0b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/0\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_output:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/16\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:4b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/4\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:5b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/5\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:6b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/6\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:7b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/7\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:8b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/8\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:9b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/9\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:13b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/13\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:14b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/14\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:15b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/15\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:17b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/17\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:18b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/18\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:22b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/22\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:23b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/23\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:24b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/24\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:25b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/25\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:26b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/26复制代码              同样是一个穷举索引               data/cam/functions/machine/crafting_table/replace/0:\nsetblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\ndata modify block ~ 255 ~ Items[0] set from block ~ ~ ~ Items[0]\ndata modify block ~ ~ ~ Items[0] set value {id:\"minecraft:firework_star\",Count:1b,Slot:0b,tag:{CustomModelData:9102024,display:{Name:\"{\"translate\":\"item.cam.crafting_table\"}\"},CAM_bg:1b}}\nexecute as @e[sort=nearest,limit=1,scores={CAM_crafterror=1..}] run loot give @s mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}\nexecute at @s run setblock ~ 255 ~ air复制代码\n               原理：若在箱子里检测到没有CAM_bg标签（因为在tick里高频清除了玩家和地面的该种物品，所以可以由此判断玩家放入了其他物品），则将其复制到潜影盒里，返还给玩家（本来想精确到特定slot，但因难度太大放弃了）。具体实现方法见[技巧] 修改玩家背包物品信息(免穷举 #结尾基础处理：清除玩家物品栏内的带CAM_bg:1b的物品,重置有关shift处理计分板。\n以下为大改内容：#shift键处理：#Shift键处理\nexecute as @a[nbt={Inventory:[{tag:{CAM_output:1b}}]}] run tag @s add CAM_shiftcheck\nexecute if entity @a[tag=CAM_shiftcheck] as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s unless data block ~ ~ ~ {Items:[{Slot:16b}]} run function cam:machine/crafting_table/shiftcheck\n翻译：首先检测背包里有标签CAM_output:1b物品的玩家，给这个玩家加上CAM_shiftcheck的tag，然后检测是否有此tag的玩家，如有则以第16槽位为“真空”的合成台为执行者执行命令通过这两个（红字）条件，可判定玩家是否使用了shift，具体原因见SPGoding在该问题中的解答 shift检测：data/cam/functions/machine/crafting_table/shiftcheck:#初始化变量和tag\nscoreboard players set @s CAM_shiftdealt 2\nscoreboard players set @a CAM_player_count 37\nscoreboard players reset @a CAM_item_trigger\n#检测玩家剩余槽位数和当前物品最大可堆叠数量，以及版权（划掉）计分板数据转移\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} as @e[tag=CAM_shiftcheck] at @s run function cam:machine/crafting_table/shift_player\nscoreboard players operation @s CAM_player_count = @e[tag=CAM_shiftcheck] CAM_player_count\nfunction cam:machine/crafting_table/shift_data_get\nscoreboard players operation @s CAM_player_count *= @s CAM_item_trigger\nexecute store result score @s CAM_shift_muti run clear @a[tag=CAM_shiftcheck] #cam:cam_recipes{CAM_output:1b} 0\nscoreboard players operation @s CAM_shiftdealt *= @s CAM_shift_muti\n#模拟执行合成操作，以确定可执行的最大合成次数\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} if entity @e[tag=CAM_shiftcheck] run function cam:machine/crafting_table/shifttest\nexecute if data block ~ ~ ~ {Items:[{Slot:16b}]} unless score @s CAM_shiftdealt < @s CAM_player_count run function cam:machine/crafting_table/recipes/clear\nscoreboard players operation @s CAM_shiftdealt /= @s CAM_shift_muti\n#补偿机制相关\nexecute as @e[tag=CAM_comp] run scoreboard players remove @s CAM_shiftdealt 1\n#清除输出栏\nreplaceitem block ~ ~ ~ container.16 minecraft:air\n#（辅助）给予次数运算\nscoreboard players remove @s CAM_shiftdealt 2\n#计分板数据转移\nscoreboard players operation @e[tag=CAM_shiftcheck] CAM_shiftdealt = @s CAM_shiftdealt\n#给予玩家物品\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} as @e[tag=CAM_shiftcheck] at @s run function cam:machine/crafting_table/shiftdealt\n#输出栏处理\nexecute if entity @e[tag=CAM_shiftcheck] run replaceitem block ~ ~ ~ container.16 minecraft:firework_star{CustomModelData:9102025,display:{Name:\"{\"translate\":\"item.cam.crafting_table_output\"}\"},CAM_bg:1b,CAM_output:1b}\n#初始化\ntag @s remove CAM_comp复制代码\n其中有一些条件已经不需要了，但是因为我懒，所以没有删除里面所谓的计分板数据转移是因为命令的执行者不同：玩家或合成台（即在合成台位置的盔甲架）而计算时把数据放在一起会省事一点。#检测玩家剩余槽位数：上个版本有一个重大的问题，就是当物品给予数量超过玩家物品栏可容下的最大数量时，仍会尝试将合成台里的原料消耗完，这是我们不想要的。因此在这里通过CAM_player_count计分板数据来获取玩家剩余槽位，以限制模拟合成的执行次数。data/cam/functions/machine/crafting_table/shift_player：execute if data entity @s Inventory[{Slot:0b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:1b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:2b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:3b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:4b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:5b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:6b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:7b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:8b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:9b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:10b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:11b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:12b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:13b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:14b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:15b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:16b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:17b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:18b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:19b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:20b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:21b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:22b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:23b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:24b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:25b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:26b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:27b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:28b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:29b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:30b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:31b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:32b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:33b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:34b}] run scoreboard players remove @s CAM_player_count 1\nexecute if data entity @s Inventory[{Slot:35b}] run scoreboard players remove @s CAM_player_count 1复制代码没什么好看的，就是穷举。#检测当前物品最大可堆叠数量：没什么好解释的吧execute as @e[tag=CAM_shiftcheck,limit=1] store result score @s CAM_item_trigger run clear @s #cam:64x{CAM_output:1b} 0\nexecute if score @e[tag=CAM_shiftcheck,limit=1] CAM_item_trigger matches 1.. run scoreboard players set @s CAM_item_trigger 64\nexecute as @e[tag=CAM_shiftcheck,limit=1] store result score @s CAM_item_trigger run clear @s #cam:16x{CAM_output:1b} 0\nexecute if score @e[tag=CAM_shiftcheck,limit=1] CAM_item_trigger matches 1.. run scoreboard players set @s CAM_item_trigger 16\nexecute as @e[tag=CAM_shiftcheck,limit=1] store result score @s CAM_item_trigger run clear @s #cam:1x{CAM_output:1b} 0\nexecute if score @e[tag=CAM_shiftcheck,limit=1] CAM_item_trigger matches 1.. run scoreboard players set @s CAM_item_trigger 1复制代码#模拟合成：\ndata/cam/functions/machine/crafting_table/shifttest:\nscoreboard players operation @s CAM_shiftdealt /= @s CAM_shift_muti\nreplaceitem block ~ ~ ~ container.16 minecraft:air\nfunction cam:machine/crafting_table/recipe\nscoreboard players operation @s CAM_shiftdealt *= @s CAM_shift_muti复制代码该模拟合成有两个限制：原料和玩家物品栏。原料限制可以由配方函数控制，而玩家物品栏限制则为计算（括号内为对应计分板名）：首先将玩家所剩槽位数（CAM_player_count）乘以其最大可堆叠数（CAM_item_trigger），即为玩家最多可获得的物品数，记为a；然后将单次可合成数（CAM_shift_muti）乘以已模拟执行合成次数（CAM_shiftdealt）,即为已经“合成”出的物品数量，记为b；将两数对比，若b大于a，则证明模拟合成次数达到了上限，停止模拟合成操作。为了少用几个计分板，这里面还有一些琐碎的小计算，这里不再赘述，都在代码里面。\n但是我们要注意一种常见的情形：在某次执行中，b小于a，可再递归执行一次，但是执行完以后b却大于了a，导致过量合成。因此需要使用补偿模块，以防止此类事件的发生。我是写了一个补偿模块，但是写这篇帖子的时候突然发现完全不需要，只要将开始的shiftdealt变量调高一个，到后面减去即可。以上段落足以证明我是一个sb\n#物品给予模块data/cam/functions/machine/crafting_table/shiftdealt:setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\ndata modify block ~ 255 ~ Items[0].id set from entity @s Inventory[{tag:{CAM_output:1b}}].id\ndata modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{tag:{CAM_output:1b}}].Count\ndata modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{tag:{CAM_output:1b}}].tag\nexecute as @s store result score @s CAM_shiftcount run data get block ~ 255 ~ Items[0].Count\nscoreboard players operation @s CAM_shiftcount *= @s CAM_shiftdealt\nfunction cam:machine/crafting_table/sub_shiftdealt\nsetblock ~ 255 ~ air复制代码data/cam/functions/machine/crafting_table/sub_shiftdealt:execute if score @s CAM_shiftcount matches 64.. run data modify block ~ 255 ~ Items[0].Count set value 64\nexecute as @s if score @s CAM_shiftcount matches 1..64 store result block ~ 255 ~ Items[0].Count byte 1 run scoreboard players get @s CAM_shiftcount\nexecute as @s if score @s CAM_shiftcount matches 1.. run loot give @s mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}\nscoreboard players remove @s CAM_shiftcount 64\nexecute if score @s CAM_shiftcount matches 1.. run function cam:machine/crafting_table/sub_shiftdealt\nexecute if score @s CAM_shiftcount matches ..0 run data remove block ~ 255 ~ Items[0]复制代码翻译：1、-放置rua影盒2、-复制玩家合成出的物品数据    -如果要合成的物品数量大于64，将盒中物品数量设为64    -如果数量介于0与64之间，将盒中物品数量设为要合成的物品数量3、-将盒中物品给予玩家4、-将数量减去64    -若变量小于0，则停止    -若变量大于0，则继续从第二步执行5、清除rua影盒至此，有关shift的处理讲解结束。\n#输出标签处理：极其辛酸的部分，因为这个东西我卡了十来天。\n\n先讲解吧，事故现场后面放。事故现场丢了\ndata/cam/functions/machine/crafting_table/inventory:\netblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\n\nexecute if data entity @s {Inventory:[{Slot:0b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/0\nexecute if data entity @s {Inventory:[{Slot:1b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/1\nexecute if data entity @s {Inventory:[{Slot:2b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/2\nexecute if data entity @s {Inventory:[{Slot:3b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/3\nexecute if data entity @s {Inventory:[{Slot:4b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/4\nexecute if data entity @s {Inventory:[{Slot:5b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/5\nexecute if data entity @s {Inventory:[{Slot:6b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/6\nexecute if data entity @s {Inventory:[{Slot:7b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/7\nexecute if data entity @s {Inventory:[{Slot:8b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/8\nexecute if data entity @s {Inventory:[{Slot:9b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/9\nexecute if data entity @s {Inventory:[{Slot:10b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/10\nexecute if data entity @s {Inventory:[{Slot:11b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/11\nexecute if data entity @s {Inventory:[{Slot:12b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/12\nexecute if data entity @s {Inventory:[{Slot:13b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/13\nexecute if data entity @s {Inventory:[{Slot:14b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/14\nexecute if data entity @s {Inventory:[{Slot:15b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/15\nexecute if data entity @s {Inventory:[{Slot:16b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/16\nexecute if data entity @s {Inventory:[{Slot:17b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/17\nexecute if data entity @s {Inventory:[{Slot:18b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/18\nexecute if data entity @s {Inventory:[{Slot:19b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/19\nexecute if data entity @s {Inventory:[{Slot:20b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/20\nexecute if data entity @s {Inventory:[{Slot:21b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/21\nexecute if data entity @s {Inventory:[{Slot:22b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/22\nexecute if data entity @s {Inventory:[{Slot:23b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/23\nexecute if data entity @s {Inventory:[{Slot:24b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/24\nexecute if data entity @s {Inventory:[{Slot:25b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/25\nexecute if data entity @s {Inventory:[{Slot:26b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/26\nexecute if data entity @s {Inventory:[{Slot:27b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/27\nexecute if data entity @s {Inventory:[{Slot:28b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/28\nexecute if data entity @s {Inventory:[{Slot:29b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/29\nexecute if data entity @s {Inventory:[{Slot:30b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/30\nexecute if data entity @s {Inventory:[{Slot:31b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/31\nexecute if data entity @s {Inventory:[{Slot:32b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/32\nexecute if data entity @s {Inventory:[{Slot:33b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/33\nexecute if data entity @s {Inventory:[{Slot:34b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/34\nexecute if data entity @s {Inventory:[{Slot:35b,tag:{CAM_output:1b}}]} run function cam:machine/crafting_table/inventory/35\n\n\n\nsetblock ~ 255 ~ air复制代码穷举玩家含有CAM_output:1b的物品槽位并通过rua影盒处理之：\ndata/cam/functions/machine/crafting_table/inventory/0:\ndata modify block ~ 255 ~ Items[0].id set from entity @s Inventory[{Slot:0b}].id\ndata modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{Slot:0b}].Count\ndata modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{Slot:0b}].tag\ndata remove block ~ 255 ~ Items[0].tag.CAM_output\nloot replace entity @s hotbar.0 1 mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}复制代码data/cam/functions/machine/crafting_table/inventory/9:\ndata modify block ~ 255 ~ Items[0].id set from entity @s Inventory[{Slot:9b}].id\ndata modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{Slot:9b}].Count\ndata modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{Slot:9b}].tag\ndata remove block ~ 255 ~ Items[0].tag.CAM_output\nloot replace entity @s inventory.0 1 mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}复制代码注意用loot replace 和replaceitem 时注意快捷栏是hotbar0~8对应Inventory中Slot的0~8，inventory的0~26对应Inventory中的9~35。\n\n至此，讲解完全完成。\n\n\n\n\n以下为第一版        事情是这样的，在开发我的原版模组时，想做一个合成NBT物品的合成台，于是我就去教程学习了一下有关内容，同时下载了更多的合成数据包\n以拆解学习，但是我没能成功的把合成器拆出来，而且发现了几个小问题（有些是真的让人蛋疼。。。）          问题1、秘技：gui消失术！          \n\n\n\n\n2020-01-29_11.59.21.png (302.44 KB, 下载次数: 0)\n\n下载附件\n\n2020-1-29 13:49 上传\n\n\n\n\n\n\n\n\n2020-01-29_11.59.36.png (335.26 KB, 下载次数: 0)\n\n下载附件\n\n2020-1-29 13:49 上传\n\n\n\n\n         只要在第一个槽位放入一个物品即可。很让人无语的一个问题。         问题2：创造模式下，破坏机器仍然会掉落。         \n\n\n\n\n2020-01-29_13.52.50.png (262.32 KB, 下载次数: 0)\n\n下载附件\n\n2020-1-29 13:53 上传\n\n\n\n\n        3（其实这个应该算个特性）：发现符合条件的配方立即转化，手残党的噩梦。。。\n\n        \n\n\n\n\nfile_1580277333000.jpg (97.29 KB, 下载次数: 0)\n\n下载附件\n\n2020-1-29 13:55 上传\n\n\n\n\n\n\n\n\nfile_1580277333000.jpg (94.63 KB, 下载次数: 0)\n\n下载附件\n\n2020-1-29 13:55 上传\n\n\n\n\n\n       于是，我决定自己写。       /2000 years later.jpg        经过4天的艰苦卓绝的开发，我成功把这个玩意搞出来了！        下面是展示视频                                     https://www.bilibili.com/video/av85551813/\n\n\n\n\n        问题1        由于该模块较为复杂，我先在这里展示一下tick函数结构：         data/cam/functions/machine/crafting_table/tick:\n#开头基础处理：物品处理 初始化变量\nkill @e[nbt={Item:{tag:{CAM_bg:1b}}}]\nexecute store result score @a CAM_crafterror run clear @a minecraft:firework_star{CAM_bg:1b} 0\n\n#放置与破坏处理\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting] at @s align xyz if block ~ ~ ~ minecraft:petrified_oak_slab run function cam:machine/crafting_table/replace\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s unless block ~ ~ ~ minecraft:barrel run function cam:machine/crafting_table/clear\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] run data modify entity @s Fire set value 32767s\n\n#功能\n#Shift键处理\nexecute as @a[nbt={Inventory:[{tag:{CAM_output:1b}}]}] run tag @s add CAM_shiftcheck\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s run function cam:machine/crafting_table/shiftcheck\n#配方处理\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s run function cam:machine/crafting_table/recipe\n#输出标签处理\nexecute as @a[nbt={Inventory:[{tag:{CAM_output:1b}}]}] at @s run function cam:machine/crafting_table/inventory\n#误放入处理\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s run function cam:machine/crafting_table/check\n#Shift键处理 初始化tag\ntag @a remove CAM_shiftcheck\n\n#结尾基础处理：物品处理 初始化变量\nclear @a firework_star{CAM_bg:1b}\nscoreboard players reset @e CAM_shiftdealt复制代码\n\n\n               我在教程里发现了这么一段：\n\n\n\n\n\nBJQ0JN01XP~7N{{W21Q1@5F.png (163.65 KB, 下载次数: 0)\n\n下载附件\n\n2020-1-29 16:11 上传\n\n\n\n\n\n\n              然而，数据包里好像并没有应用到。。。              于是我就设计了这个check函数：              data/cam/functions/machine/crafting_table/check:execute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:0b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/0\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_output:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/16\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:4b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/4\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:5b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/5\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:6b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/6\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:7b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/7\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:8b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/8\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:9b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/9\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:13b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/13\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:14b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/14\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:15b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/15\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:17b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/17\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:18b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/18\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:22b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/22\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:23b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/23\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:24b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/24\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:25b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/25\nexecute as @s at @s unless data block ~ ~ ~ {Items:[{Slot:26b,tag:{CAM_bg:1b}}]} positioned ~ ~ ~ run function cam:machine/crafting_table/replace/26复制代码\n               data/cam/functions/machine/crafting_table/replace/0: \nsetblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\ndata modify block ~ 255 ~ Items[0] set from block ~ ~ ~ Items[0]\ndata modify block ~ ~ ~ Items[0] set value {id:\"minecraft:firework_star\",Count:1b,Slot:0b,tag:{CustomModelData:9102024,display:{Name:\"{\"translate\":\"item.cam.crafting_table\"}\"},CAM_bg:1b}}\nexecute as @e[sort=nearest,limit=1,scores={CAM_crafterror=1..}] run loot give @s mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}\nexecute at @s run setblock ~ 255 ~ air复制代码              check函数里的18条命令其实是一条命令，这里运用了穷举。\n               原理：若在箱子里检测到没有CAM_bg标签（因为在tick里高频清除了玩家和地面的该种物品，所以可以由此判断玩家放入了其他物品），则将其复制到潜影盒里，返还给玩家（本来想精确到特定slot，但因难度太大放弃了）。具体实现方法见[技巧] 修改玩家背包物品信息(免穷举\n               至此，解决。\n\n\n               问题2\n         这个就简单了。\n         如果通过战利品表来实现，还是有难度的，但是我们可以用Bugjang特性来解决\n               既然创造模式打掉方块不掉方块本体，而生存模式会掉，那我们为什么不利用这一特性呢？\n               这就是这里的思路了。\n\n data/cam/functions/machine/crafting_table/clear:\n<blockquote>execute at @s if entity @e[type=item,nbt={Item:{id:\"minecraft:barrel\"}},distance=..2] run loot spawn ~ ~ ~ loot minecraft:blocks/cam_crafting_table复制代码              \n\n\n        总体梳理              注意：本部分包含了大量代码，不想看的同志们可以离开了。可以回到第二页观看短视频。\n                    我只是想把我的合成台做得更人性化一点，也更像原版一点，于是把它优化了            亿      点       点\n            现在开始梳理\n            首先，再次展示一下tick：\n              data/cam/functions/machine/crafting_table/tick:\n#开头基础处理：物品处理 初始化变量\nkill @e[nbt={Item:{tag:{CAM_bg:1b}}}]\nexecute store result score @a CAM_crafterror run clear @a minecraft:firework_star{CAM_bg:1b} 0\n\n#放置与破坏处理\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting] at @s align xyz if block ~ ~ ~ minecraft:petrified_oak_slab run function cam:machine/crafting_table/replace\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s unless block ~ ~ ~ minecraft:barrel run function cam:machine/crafting_table/clear\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] run data modify entity @s Fire set value 32767s\n\n#功能\n#Shift键处理\nexecute as @a[nbt={Inventory:[{tag:{CAM_output:1b}}]}] run tag @s add CAM_shiftcheck\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s run function cam:machine/crafting_table/shiftcheck\n#配方处理\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s run function cam:machine/crafting_table/recipe\n#输出标签处理\nexecute as @a[nbt={Inventory:[{tag:{CAM_output:1b}}]}] at @s run function cam:machine/crafting_table/inventory\n#误放入处理\nexecute as @e[type=minecraft:armor_stand,tag=cam_crafting,tag=CAM_craft_enable] at @s run function cam:machine/crafting_table/check\n#Shift键处理 初始化tag\ntag @a remove CAM_shiftcheck\n\n#结尾基础处理：物品处理 初始化变量\nclear @a firework_star{CAM_bg:1b}\nscoreboard players reset @e CAM_shiftdealt复制代码\n\n\n               #开头基础处理：物品处理 初始化变量：清除带有CAM_bg标签的物品，将有关误放入背景物品返还模块玩家确定的计分板重置\n               #放置与破坏处理:第1条:检测放置工作台（配合进度（就是视频里的advancement，用于调试的）），\n                                         第2条:检测破坏合成台\n                                            3：防止盔甲架变黑\n\n\n            #功能：\n             #Shift键处理：本人最自豪的部分之一，由于涉及到下方函数，原理先放一下。\n             #配方处理：\n             先亮代码：\n             data/cam/functions/machine/crafting_table/recipe:\nfunction cam:machine/crafting_table/recipes/count\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} if entity @s[tag=!CAM_not_to_clear] run function cam:machine/crafting_table/recipes/clear\ntag @s remove CAM_not_to_clear\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_bg:1b}}]} run tag @s add CAM_not_to_clear\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_output:1b}}]} run replaceitem block ~ ~ ~ container.16 minecraft:air\nfunction cam:machine/crafting_table/recipes/bamboo_sword\nfunction cam:machine/crafting_table/recipes/red_string\nscoreboard players reset @s CAM_table_count\nexecute if data block ~ ~ ~ {Items:[{Slot:16b,tag:{CAM_output:1b}}]} run scoreboard players add @s CAM_shiftdealt 1复制代码              （这里的CAM_shiftdealt计分板就是有关shift处理的）\n                 data/cam/functions/machine/crafting_table/recipes/count:\nexecute if data block ~ ~ ~ Items[{Slot:1b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:2b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:3b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:10b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:11b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:12b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:19b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:20b}] run scoreboard players add @s CAM_table_count 1\nexecute if data block ~ ~ ~ Items[{Slot:21b}] run scoreboard players add @s CAM_table_count 1复制代码\n\n                 data/cam/functions/machine/crafting_table/recipes/bamboo_sword:（其中一个配方）\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:19b,tag:{id:\"cam:red_string\"}},{Slot:11b,id:\"minecraft:bamboo\"},{Slot:3b,id:\"minecraft:bamboo\"}]} if entity @s[scores={CAM_table_count=3}] run replaceitem block ~ ~ ~ container.16 wooden_sword{display:{Name:\"{\"translate\":\"item.cam.bamboo_sword\",\"italic\":\"false\"}\"},CustomModelData:9102019,CAM_output:1b}\nexecute if block ~ ~ ~ minecraft:barrel{Items:[{Slot:21b,tag:{id:\"cam:red_string\"}},{Slot:11b,id:\"minecraft:bamboo\"},{Slot:1b,id:\"minecraft:bamboo\"}]} if entity @s[scores={CAM_table_count=3}] run replaceitem block ~ ~ ~ container.16 wooden_sword{display:{Name:\"{\"translate\":\"item.cam.bamboo_sword\",\"italic\":\"false\"}\"},CustomModelData:9102019,CAM_output:1b}复制代码              data/cam/functions/machine/crafting_table/recipes/clear:（清除合成栏物品）\nexecute as @s store result score @s CAM_clear run data get block ~ ~ ~ Items[{Slot:1b}].Count\nscoreboard players remove @s CAM_clear 1\nexecute store result block ~ ~ ~ Items[{Slot:1b}].Count byte 1 run scoreboard players get @s CAM_clear\n\nexecute as @s store result score @s CAM_clear run data get block ~ ~ ~ Items[{Slot:2b}].Count\nscoreboard players remove @s CAM_clear 1\nexecute store result block ~ ~ ~ Items[{Slot:2b}].Count byte 1 run scoreboard players get @s CAM_clear\n\nexecute as @s store result score @s CAM_clear run data get block ~ ~ ~ Items[{Slot:3b}].Count\nscoreboard players remove @s CAM_clear 1\nexecute store result block ~ ~ ~ Items[{Slot:3b}].Count byte 1 run scoreboard players get @s CAM_clear\n\nexecute as @s store result score @s CAM_clear run data get block ~ ~ ~ Items[{Slot:10b}].Count\nscoreboard players remove @s CAM_clear 1\nexecute store result block ~ ~ ~ Items[{Slot:10b}].Count byte 1 run scoreboard players get @s CAM_clear\n\nexecute as @s store result score @s CAM_clear run data get block ~ ~ ~ Items[{Slot:11b}].Count\nscoreboard players remove @s CAM_clear 1\nexecute store result block ~ ~ ~ Items[{Slot:11b}].Count byte 1 run scoreboard players get @s CAM_clear\n\nexecute as @s store result score @s CAM_clear run data get block ~ ~ ~ Items[{Slot:12b}].Count\nscoreboard players remove @s CAM_clear 1\nexecute store result block ~ ~ ~ Items[{Slot:12b}].Count byte 1 run scoreboard players get @s CAM_clear\n\nexecute as @s store result score @s CAM_clear run data get block ~ ~ ~ Items[{Slot:19b}].Count\nscoreboard players remove @s CAM_clear 1\nexecute store result block ~ ~ ~ Items[{Slot:19b}].Count byte 1 run scoreboard players get @s CAM_clear\n\nexecute as @s store result score @s CAM_clear run data get block ~ ~ ~ Items[{Slot:20b}].Count\nscoreboard players remove @s CAM_clear 1\nexecute store result block ~ ~ ~ Items[{Slot:20b}].Count byte 1 run scoreboard players get @s CAM_clear\n\nexecute as @s store result score @s CAM_clear run data get block ~ ~ ~ Items[{Slot:21b}].Count\nscoreboard players remove @s CAM_clear 1\nexecute store result block ~ ~ ~ Items[{Slot:21b}].Count byte 1 run scoreboard players get @s CAM_clear\n#（命令重复9遍）复制代码             原理：从第4行开始（前一刻）\n                       1、如果输出栏（Slot：16）是“空的”（透明材质的占位符），将所在位置盔甲架加上tag；\n                       2、清除16号位物品（使合成栏变动时消除输出物品，拒绝白嫖）\n                       3、运行配方检测（若满足则在16号位放上物品）\n                       4、 运行到check指令时，如16号位真空，将空的16号位加上占位符\n                            否则无变化\n                         （后一刻）\n                       5、如果16号位真空，即check未填补（被配方占据），而此时输出物被拿走，检测tag（即玩家是否误点了占位符），若否，则将输入                栏物品数量-1\n                       6、移除tag，进行下一刻检测                       这样就达到了输入、输出两边同时存在，但只能取一边的目的。\n              配方：                                                                   有序合成：指定Slot和物品属性，用CAM_table_count计分板确定已占槽位数，以达到多占槽位清除的目的；\n                       无序合成：基本同上，不指定Slot\n\n                 #输出标签处理：由于输出栏物品都带有CAM_output的标签，以侦测玩家是否误放入输出栏物品及防止做出配方，将配方保存在台子里，然后通过破坏方块的方式来非法达到“我全都要”的目的（见解决问题2时函数的最后一行），因此设计了这一函数。\n\n\n                 原理就是通过潜影盒改变玩家物品，用穷举确定玩家物品栏Slot，代码较多，又长又臭，就不拿出来恶心大家了。                 #误放入处理：就是上面解决问题1时用到的check函数，不再赘述；\n                 #结尾基础处理：清除玩家物品栏内的带CAM_bg:1b的物品,重置有关shift处理计分板。\n     Shift处理原理\n           最好的当然要放在最后。\n               我们知道，mc原版工作台在你按下shift时，会把可合成的最大数量物品一次性合成出来。可惜，容器做不到这一点。\n               因此我就搞了这么一手。\n               上代码！\n              data/cam/functions/machine/crafting_table/shiftcheck:\nscoreboard players set @s CAM_shiftdealt 1\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} if entity @e[tag=CAM_shiftcheck] run function cam:machine/crafting_table/shifttest\nscoreboard players operation @e[tag=CAM_shiftcheck] CAM_shiftdealt = @s CAM_shiftdealt\nexecute unless data block ~ ~ ~ {Items:[{Slot:16b}]} as @e[tag=CAM_shiftcheck] at @s run function cam:machine/crafting_table/shiftdealt复制代码             data/cam/functions/machine/crafting_table/shifttest:\n\nreplaceitem block ~ ~ ~ container.16 minecraft:air\nfunction cam:machine/crafting_table/recipe\nexecute if data block ~ ~ ~ {Items:[{Slot:16b}]} run function cam:machine/crafting_table/shifttest\n复制代码               data/cam/functions/machine/crafting_table/shiftdealt:setblock ~ 255 ~ shulker_box{Items:[{Slot:0b,id:\"minecraft:stone\",Count:1b}]}\ndata modify block ~ 255 ~ Items[0].id set from entity @s Inventory[{tag:{CAM_output:1b}}].id\ndata modify block ~ 255 ~ Items[0].Count set from entity @s Inventory[{tag:{CAM_output:1b}}].Count\ndata modify block ~ 255 ~ Items[0].tag set from entity @s Inventory[{tag:{CAM_output:1b}}].tag\ndata remove block ~ 255 ~ Items[0].tag.CAM_output\nexecute as @s store result score @s CAM_shiftcount run data get block ~ 255 ~ Items[0].Count\nscoreboard players operation @s CAM_shiftcount *= @s CAM_shiftdealt\nexecute if score @s CAM_shiftcount matches 65.. run function cam:machine/crafting_table/sub_shiftdealt\nexecute as @s store result block ~ 255 ~ Items[0].Count byte 1 run scoreboard players get @s CAM_shiftcount\nloot give @s mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}\nsetblock ~ 255 ~ air复制代码              data/cam/functions/machine/crafting_table/sub_shiftdealt:\nloot replace block ~ 255 ~ container.1 mine ~ 255 ~ minecraft:diamond_pickaxe{isShulkerMarker:1b}\ndata modify block ~ 255 ~ Items[-1].Count set value 64\nscoreboard players remove @s CAM_shiftcount 64\nexecute if score @s CAM_shiftcount matches 65.. run function cam:machine/crafting_table/sub_shiftdealt复制代码              首先，这么区分Shift+左键和单纯左键？\n            版主大大@SPGoding 是这么回复的：\n               \n\n\n\n\n6RST(N96J@F1(TB9RW}RFYM.png (12.36 KB, 下载次数: 0)\n\n下载附件\n\n2020-1-29 15:29 上传\n\n\n\n\n。           OK，可以开始搞事了！\n           原理：首先，对物品栏内有带CAM_output:1b的物品的玩家（先于输出物品处理）加上CAM_shiftcheck的标签进行检测；\n            然后，检测此时有没有输出栏内为真空的合成台（此时recipe暂未执行，所有合成台内均为输出品或占位符），如有则说明玩家使用了shift（我想至少现在没有能在1/20秒内完成左键选中+移动+左键放置的玩家吧），执行shift测试指令。\n           shift测试指令：通过循环执行配方指令+清除输出栏物品来达到对配方还能使用次数的计数，看到配方函数最后一行的计分板命令了吗？就是为这里准备的。\n           由于此时执行对象还是盔甲架，因此我们要把盔甲架上的分数转移到玩家上。\n           然后选定玩家为执行者，进行处理（因为shiftcheck函数每刻执行，所以条件决不能省（我就因为这个调试了大半个小时）（视频里还有这个bug）)\n           shift处理函数：将玩家物品栏内物品数据复制到潜影盒上，把该数据复制到计分板CAM_shiftcount，把这个数据乘以CAM_shiftdealt上的数（即执行配方的次数），复制回潜影盒，再掉包给玩家，这回不用确定槽位了，因为shift和loot give指令一样，是自动整理的。\n           但有时会出现乘完后数目大于64的情况，我不知道是否要处理，但我还是设计了以上shift辅助处理函数（sub_shiftdealt）：\n           将潜影盒内物品数量向后复制一位（比如原来0槽位的复制到1号位，1号到2号，但0号位不变，这样潜影盒物品所占槽位数量就多了一个），再把最后的一个物品项数量改为64，然后计分板减去64，若其还多，循环执行。\n           （亲测有效）\n\n\n\n\n\n后记\n这是我在开发自己的综合类原版模组时的一点心得，也是可能算是创新的一点优化。看起来还真凉了。。。。。报应啊目前问题\n1、右键侦测暂无，建议我目前没有合成多个物品的配方，暂不考虑制作，因为可能要重写系统，如果这样我肯定不会更\n2、因为使用了输出标签，所以一开始合成出来的东西不可堆叠，所以背包内至少要留一个空位3、同样因为使用了输出标签，导致按下shift前若背包内有合成的物品，也不可堆叠，，视为已被占满的槽位\n下载\n该数据包已经被提取出来，命名为CNC，现已发布\n【LAY Studio|原版模组|CNC】NBT合成台\n\n\n\n鸣谢：\nruhuasiyu：原版模组教程\nruhuasiyu：原版模组《更多的合成》\nSPGoding在该问题中的解答\n@Medi*******(应本人要求匿名)对物品给予方面的优化建议\n@不笑君  对清除合成区物品清除方面优化的建议\n@VCS-Official 对多个重复物品合成的建议\n@晴路卡 对tag合成问题的解答\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "CR_019",
            "timestamp": 1580286000,
            "txt_content": " 本帖最后由 chaoren019 于 2020-2-25 17:20 编辑 \n\n有疑问或改进建议可在评论区提出"
        },
        {
            "author": "CR_019",
            "timestamp": 1580286780,
            "txt_content": " 本帖最后由 chaoren019 于 2020-1-31 20:38 编辑 \n\n这个东西的已知缺点：\n1、右键侦测没做。。。现在会出现错误\n2、因为使用了输出标签，所以一开始合成出来的东西不可堆叠，所以背包内至少要留一个空位（那我可以删除回复吗）\n"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1580349960,
            "txt_content": "gui的处理我在1.10版本已经做了，不过还没发布，检测gui发生改变我是用断言来检测的，教程里可能漏写了。"
        },
        {
            "author": "CR_019",
            "timestamp": 1580355840,
            "txt_content": " 本帖最后由 chaoren019 于 2020-2-25 17:21 编辑 \nruhuasiyu 发表于 2020-1-30 10:06\ngui的处理我在1.10版本已经做了，不过还没发布，检测gui发生改变我是用断言来检测的，教程里可能漏写了。 ...\n话说1.10什么时候发布？期待一下（又可以抄代码了（误））\n\n(为什么我这边断言就不管用呢。。。)\n\n"
        },
        {
            "author": "wshycaa",
            "timestamp": 1580367120,
            "txt_content": "楼主自己造轮子ing……"
        },
        {
            "author": "Summer621",
            "timestamp": 1580383680,
            "txt_content": "6666666666666666666666666"
        },
        {
            "author": "不笑君",
            "timestamp": 1580467260,
            "txt_content": "啊!!我想要单品.能给我一份吗"
        },
        {
            "author": "凌空的猫",
            "timestamp": 1580471100,
            "txt_content": "我也做过这东西(自己造轮子)，和你的差不多，但真的没想到怎么检测Shift，果然是大佬QUQ"
        },
        {
            "author": "CR_019",
            "timestamp": 1580471460,
            "txt_content": " 本帖最后由 chaoren019 于 2020-2-26 09:05 编辑 \n不笑君 发表于 2020-1-31 18:41\n啊!!我想要单品.能给我一份吗\n可以给一个没处理过的粗糙版本，只要你可以忍受我数据包自带的“CAM_”前缀。。。尽量自己改改吧。。。（提示：没改全会出现bug）\n已将单品链接上线，见第3页"
        },
        {
            "author": "woaibaihu",
            "timestamp": 1594692360,
            "txt_content": "额鹅鹅鹅鹅鹅鹅饿鹅鹅鹅鹅鹅鹅饿"
        },
        {
            "author": "12tianxun",
            "timestamp": 1596013320,
            "txt_content": "所以说，这么多都是帮rua修bug？（rua，出来找打）@ruhuasiyu"
        },
        {
            "author": "worid.",
            "timestamp": 1609427940,
            "txt_content": " 新人好祝新人2021年快乐"
        },
        {
            "author": "Biondo",
            "timestamp": 1611797940,
            "txt_content": "你这个是检测箱子类内部的物品吗\n发射器之类的也可以吧~"
        },
        {
            "author": "CR_019",
            "timestamp": 1613211180,
            "txt_content": " 本帖最后由 CR_019 于 2021-2-13 18:14 编辑 \nBiondo 发表于 2021-1-28 09:39\n你这个是检测箱子类内部的物品吗\n发射器之类的也可以吧~\n发射器也可以，但是发射器只有9个槽位，不够这里需要的功能\n利用发射器做合成台的看这里https://www.mcbbs.net/forum.php? ... ortid%26sortid%3D38\n\n"
        }
    ]
}