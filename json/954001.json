{
    "title": "使用ASM修改代码发生错误",
    "author": "Hueihuea",
    "replyCount": 3,
    "timestamp": 1581054000,
    "txt_content": " 本帖最后由 Hueihuea 于 2020-2-7 14:42 编辑 \n\n错误内容:\n\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 0\n        at org.objectweb.asm.Frame.merge(Frame.java:1501)\n        at org.objectweb.asm.Frame.merge(Frame.java:1478)\n        at org.objectweb.asm.MethodWriter.visitMaxs(MethodWriter.java:1516)\n        at org.objectweb.asm.tree.MethodNode.accept(MethodNode.java:835)\n        at org.objectweb.asm.tree.MethodNode.accept(MethodNode.java:727)\n        at org.objectweb.asm.tree.ClassNode.accept(ClassNode.java:412)\n代码:\n\n                            InsnList list = new InsnList();\n                            list.add(new FieldInsnNode(Opcodes.GETSTATIC, \"mchhui/saosd/SAOSD\", \"EVENT_BUS\",\n                                    \"Lnet/minecraftforge/fml/common/eventhandler/EventBus;\"));\n                            list.add(new TypeInsnNode(Opcodes.NEW, \"mchhui/saosd/api/event/ItemRenderedEvent\"));\n                            list.add(new InsnNode(Opcodes.DUP));\n                            list.add(new VarInsnNode(Opcodes.ALOAD, 0));\n                            list.add(new VarInsnNode(Opcodes.ALOAD, 1));\n                            list.add(new VarInsnNode(Opcodes.ALOAD, 2));\n                            list.add(new MethodInsnNode(Opcodes.INVOKESPECIAL,\n                                    \"mchhui/saosd/api/event/ItemRenderedEvent\", \"<init>\",\n                                    \"(Lnet/minecraft/client/renderer/RenderItem;Lnet/minecraft/item/ItemStack;Lnet/minecraft/client/renderer/block/model/IBakedModel;)V\",\n                                    false));\n                            list.add(new MethodInsnNode(Opcodes.INVOKEVIRTUAL,\n                                    \"net/minecraftforge/fml/common/eventhandler/EventBus\", \"post\",\n                                    \"(Lnet/minecraftforge/fml/common/eventhandler/Event;)Z\", false));\n                            /*node为调用popMatrix方法*/\n                            method.instructions.insertBefore(node, list);\n复制代码\n\n\n\n\n\nTXH]GGKOG~95@2ZC`@UU75I.png (9.45 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-7 13:40 上传\n\n\n\n\n\n修改的类net.minecraft.client.renderer.RenderItem\n方法:renderItem(Lnet/minecraft/item/ItemStack;Lnet/minecraft/client/renderer/block/model/IBakedModel;)V\n\n已自行解决\n最后记得pop即可\n\n",
    "replies": [
        {
            "author": "杜永康",
            "timestamp": 1581057900,
            "txt_content": "一脸懵逼。。水个楼。"
        },
        {
            "author": "火车撞鸟",
            "timestamp": 1581058380,
            "txt_content": "\n\nlist.add(new MethodInsnNode(Opcodes.INVOKEVIRTUAL,\n                                    \"net/minecraftforge/fml/common/eventhandler/EventBus\", \"post\",\n                                    \"(Lnet/minecraftforge/fml/common/eventhandler/Event;)Z\", false));\n复制代码\n\n执行完这个之后栈里还有一个boolean类型的值\n如果不使用，你需要把它弹出\nlist.add(new InsnNode(Opcodes.POP));复制代码\n"
        },
        {
            "author": "飞翔之歌",
            "timestamp": 1581122580,
            "txt_content": "我表示我什么都看不懂。弱弱的问一句：ASM是什么？我理解的是汇编语言。"
        }
    ]
}