{
    "title": "击中一个目标后位附近实体增加生命怎么写最节省资源",
    "author": "鸭蛋只吃黄",
    "replyCount": 6,
    "timestamp": 1457523540,
    "txt_content": " 本帖最后由 凋灵兔子 于 2016-3-9 19:45 编辑 \n          当一个玩家击中一个实体后，为附近一定范围内所有的Player补满血量。楼主的思路是先获得附近所有的实体，然后遍历一个一个检测是不是Player，是的话就加血，不是就忽略...然而在电脑上设置的时候发现如果范围设置的比较大（比如50万）会卡到死（楼主电脑CPU i7，内存16G.应该跟硬件关系不大...吧），但是又想到只有我一个人在线，加载的区块也不是很多，所以检查区块数量实际并不是很多。但是攻击了之后过了大概半秒多才加上血有明显的卡顿感。就想问问楼主的思路是不是很消耗资源，有没有什么轻量的写法。附上代码（可读性为0）附的代码失败了...不知怎么只显示了一行...= =，截图发上来吧\n\n",
    "replies": [
        {
            "author": "云闪",
            "timestamp": 1457543580,
            "txt_content": " 本帖最后由 splt 于 2016-3-10 01:16 编辑 \n\n我只想说_(:_」∠)_50w的话你直接用Bukkit.getOnlinePayers不行吗_(:_」∠)_\n\n好吧如果你的需求真的很特殊不能用上面那个方法，那么你可以：\n一，如果你的范围需要球体，就直接遍历在线玩家，用数学的知识(空间中两点坐标距离)，判断玩家坐标和触发补血那个玩家的坐标距离是否小于等于50w，是就补血\n二，如果你可以使用正方体的范围，那么直接将触发补血的玩家的坐标的xyz分别加50w，然后遍历在线玩家判断xyz是否比上面那个要小，这个方法的速度比第一个要快很多，因为每个玩家只需要比较至少一次至多三次数字的大小，而方法一却还需要计算平方和开方\n\n遍历玩家在没有高要求的应用一般是可行的，因为大多数服务器最多也就遍历100多次，\n而你去50w范围内实体的方法，首先遍历获取实体就非常耗时了，因为要遍历世界中所有实体然后判断距离(如同方法一，但是遍历的数量次方法一多十几甚至几十倍)，然后你还要将获取到的实体在遍历一次，所以会浪费了大量的资源，时间也会耗费更多_(:_」∠)_至于为啥只有你一人在线还需要那么久，我猜是因为它每个区块都要判断是否加载然后判断是否有实体(首先区块就要判断n多次)，不过区块是长方体而直线距离的范围是球体，估计还要进行更多的判断，具体的你要反编译它的代码看看才知道了_(:_」∠)_"
        },
        {
            "author": "雨de印记",
            "timestamp": 1457571120,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "q549365815",
            "timestamp": 1457583840,
            "txt_content": "直接循环遍历不就好了吗\n50万...那么大\n\nfor(Player p:.getServer().getOnlinePlayers())\n{\n    #触发\n}\n\n我觉得这样比较节省资源"
        },
        {
            "author": "andylizi",
            "timestamp": 1457608560,
            "txt_content": "给沙发的补充：\n判断两点直接的距离可以直接使用Location的distance方法。我以前傻乎乎的自己写算法，完成后才发现。。"
        },
        {
            "author": "coderzeng",
            "timestamp": 1459269360,
            "txt_content": "容我挖个坟.....NPC你可以自己维护一个表，枚举实体太不明智了"
        },
        {
            "author": "yeziqie",
            "timestamp": 1459352520,
            "txt_content": "吐槽一句 entitys是什么鬼 英语老师大失败"
        }
    ]
}