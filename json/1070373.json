{
    "title": "1.12自己写的插件让服务端报错",
    "author": "aa0307bb",
    "replyCount": 4,
    "timestamp": 1593531600,
    "txt_content": "\n\n（根据https://www.mcbbs.net/forum.php?mod=viewthread&tid=568714仿写）\n代码：\n\nimport org.bukkit.entity.Player;\nimport org.bukkit.plugin.java.JavaPlugin;\n\nimport com.comphenix.protocol.PacketType;\nimport com.comphenix.protocol.ProtocolLibrary;\nimport com.comphenix.protocol.ProtocolManager;\nimport com.comphenix.protocol.events.ListenerOptions;\nimport com.comphenix.protocol.events.ListenerPriority;\nimport com.comphenix.protocol.events.PacketAdapter;\nimport com.comphenix.protocol.events.PacketContainer;\nimport com.comphenix.protocol.events.PacketEvent;\nimport com.comphenix.protocol.injector.GamePhase;\n\npublic class PluginMain extends JavaPlugin {\n\n        ProtocolManager pm;\n                \n        @Override\n        public void onEnable() {\n                pm = ProtocolLibrary.getProtocolManager();//pm放入对象\n                \n                System.out.println(\"【PLIB】监听器开始创建\");\n                //创建数据包监听器\n                pm.addPacketListener(\n                                new PacketAdapter(\n                                                PacketAdapter.params()\n                                                .plugin(this)//必须\n                                                .clientSide()\n                                                .serverSide()\n                                                .listenerPriority(ListenerPriority.NORMAL)\n                                                .gamePhase(GamePhase.PLAYING)\n                                                .optionAsync()\n                                                .options(ListenerOptions.SKIP_PLUGIN_VERIFIER)\n                                                .types(PacketType.Play.Server.TITLE, //必须\n                                                                PacketType.Play.Client.FLYING\n                                                )\n                                \n                                ) {\n                                        @Override\n                                        public void onPacketReceiving(PacketEvent event) {\n                                                PacketContainer packet = event.getPacket();\n                                                PacketType packetType = event.getPacketType();\n                                                \n                                                //PacketType.Play.Client.FLYING = net.minecraft.server.XXX.PacketPlayInFlying 类\n                                                Player player = event.getPlayer();\n                                                \n                                                if(packetType.equals(PacketType.Play.Client.FLYING)) {\n                                                        \n                                                        double x = packet.getDoubles().getValues().get(0);\n                                                        double y = packet.getDoubles().getValues().get(1);\n                                                        double z = packet.getDoubles().getValues().get(2);\n                                                        \n                                                        float yaw = packet.getFloat().getValues().get(0);\n                                                        float pitch = packet.getFloat().getValues().get(1);\n                                                        \n                                                        boolean onGround = packet.getBooleans().getValues().get(0);\n                                                        boolean hasPos = packet.getBooleans().getValues().get(1);\n                                                        boolean hasLook = packet.getBooleans().getValues().get(2);\n                                                        player.sendMessage(\"x:\"+x+\" y:\"+y+\" z:\"+z);\n                                                        player.sendMessage(\"yaw:\"+yaw+\" pitch\"+pitch);\n                                                        player.sendMessage(\"onGround:\"+onGround+\" hasPos:\"+hasPos+\" hasLook:\"+hasLook);\n                                                }\n                                                \n                                                \n                                        }\n                                        @Override\n                                        public void onPacketSending(PacketEvent event) {\n                                                PacketContainer packet = event.getPacket();\n                                                PacketType packetType = event.getPacketType();\n                                                Player player = event.getPlayer();\n                                        }\n                                }\n                );\n                \n                System.out.println(\"【PLIB】监听器创建完毕\");\n                \n        }\n        \n        \n        \n        \n        \n                \n}复制代码\n\n报错原因：\n[23:30:06] [Netty Server IO #1/WARN]: Failed to initialize a channel. Closing: [id: 0x0b35f21f, L:/192.168.1.104:25564 - R:/192.168.1.104:9386]\njava.lang.NoSuchMethodError: com.google.common.base.Objects.toStringHelper(Ljava/lang/Object;)Lcom/google/common/base/Objects$ToStringHelper;\n        at com.comphenix.protocol.events.ListeningWhitelist.toString(ListeningWhitelist.java:241) ~[?:?]\n        at java.lang.String.valueOf(Unknown Source) ~[?:1.8.0_211]\n        at java.lang.StringBuilder.append(Unknown Source) ~[?:1.8.0_211]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printValue(PrettyPrinter.java:273) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printObject(PrettyPrinter.java:246) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printObject(PrettyPrinter.java:251) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printValue(PrettyPrinter.java:285) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printValue(PrettyPrinter.java:257) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printIterables(PrettyPrinter.java:144) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printValue(PrettyPrinter.java:277) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printObject(PrettyPrinter.java:246) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printObject(PrettyPrinter.java:124) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printObject(PrettyPrinter.java:102) ~[?:?]\n        at com.comphenix.protocol.reflect.PrettyPrinter.printObject(PrettyPrinter.java:89) ~[?:?]\n        at com.comphenix.protocol.error.DetailedErrorReporter.getStringDescription(DetailedErrorReporter.java:480) ~[?:?]\n        at com.comphenix.protocol.error.DetailedErrorReporter.reportDetailed(DetailedErrorReporter.java:369) ~[?:?]\n        at com.comphenix.protocol.error.DelegatedErrorReporter.reportDetailed(DelegatedErrorReporter.java:63) ~[?:?]\n        at com.comphenix.protocol.error.DelegatedErrorReporter.reportDetailed(DelegatedErrorReporter.java:87) ~[?:?]\n        at com.comphenix.protocol.injector.netty.ProtocolInjector$1.initChannel(ProtocolInjector.java:149) ~[?:?]\n        at io.netty.channel.ChannelInitializer.initChannel(ChannelInitializer.java:113) [ChannelInitializer.class:?]\n        at io.netty.channel.ChannelInitializer.handlerAdded(ChannelInitializer.java:105) [ChannelInitializer.class:?]\n        at io.netty.channel.DefaultChannelPipeline.callHandlerAdded0(DefaultChannelPipeline.java:597) [DefaultChannelPipeline.class:?]\n        at io.netty.channel.DefaultChannelPipeline.addLast(DefaultChannelPipeline.java:226) [DefaultChannelPipeline.class:?]\n        at io.netty.channel.DefaultChannelPipeline.addLast(DefaultChannelPipeline.java:392) [DefaultChannelPipeline.class:?]\n        at io.netty.channel.DefaultChannelPipeline.addLast(DefaultChannelPipeline.java:379) [DefaultChannelPipeline.class:?]\n        at com.comphenix.protocol.injector.netty.ProtocolInjector$2.initChannel(ProtocolInjector.java:159) [%5B前置-架构%5DProtocolLib.jar:4.0.1-b291]\n        at io.netty.channel.ChannelInitializer.initChannel(ChannelInitializer.java:113) [ChannelInitializer.class:?]\n        at io.netty.channel.ChannelInitializer.handlerAdded(ChannelInitializer.java:105) [ChannelInitializer.class:?]\n        at io.netty.channel.DefaultChannelPipeline.callHandlerAdded0(DefaultChannelPipeline.java:597) [DefaultChannelPipeline.class:?]\n        at io.netty.channel.DefaultChannelPipeline.access$000(DefaultChannelPipeline.java:44) [DefaultChannelPipeline.class:?]\n        at io.netty.channel.DefaultChannelPipeline$PendingHandlerAddedTask.execute(DefaultChannelPipeline.java:1387) [DefaultChannelPipeline$PendingHandlerAddedTask.class:?]\n        at io.netty.channel.DefaultChannelPipeline.callHandlerAddedForAllHandlers(DefaultChannelPipeline.java:1122) [DefaultChannelPipeline.class:?]\n        at io.netty.channel.DefaultChannelPipeline.invokeHandlerAddedIfNeeded(DefaultChannelPipeline.java:647) [DefaultChannelPipeline.class:?]\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.register0(AbstractChannel.java:506) [AbstractChannel$AbstractUnsafe.class:?]\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.access$200(AbstractChannel.java:419) [AbstractChannel$AbstractUnsafe.class:?]\n        at io.netty.channel.AbstractChannel$AbstractUnsafe$1.run(AbstractChannel.java:478) [AbstractChannel$AbstractUnsafe$1.class:?]\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163) [AbstractEventExecutor.class:?]\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:403) [SingleThreadEventExecutor.class:?]\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:442) [NioEventLoop.class:?]\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858) [SingleThreadEventExecutor$5.class:?]\n        at java.lang.Thread.run(Unknown Source) [?:1.8.0_211]\n\n复制代码\n\n",
    "replies": [
        {
            "author": "天辉胡萝卜",
            "timestamp": 1593531600,
            "txt_content": "protocollib与mc版本不兼容\n高度怀疑你下载了latest dev build，这个构筑版本只兼容1.16.1\n\n直接下载https://github.com/dmulloy2/ProtocolLib/releases/tag/4.5.1"
        },
        {
            "author": "aa0307bb",
            "timestamp": 1593536640,
            "txt_content": "疾风暗影 发表于 2020-6-30 23:40\nprotocollib与mc版本不兼容\n高度怀疑你下载了latest dev build，这个构筑版本只兼容1.16.1\n的确是版本不匹配……\n顺带问一下，PacketType.Play.Client.FLYING\n这个是监听什么事件？\n只要玩家处于飞行状态就会触发？\n（可是我的这三行↓语句始终没有被发到玩家聊天框中）\n player.sendMessage(\"x:\"+x+\" y:\"+y+\" z:\"+z);\n                                                        player.sendMessage(\"yaw:\"+yaw+\" pitch\"+pitch);\n                                                        player.sendMessage(\"onGround:\"+onGround+\" hasPos:\"+hasPos+\" hasLook:\"+hasLook);复制代码"
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1593538800,
            "txt_content": "aa0307bb 发表于 2020-7-1 01:04\n的确是版本不匹配……\n顺带问一下，\n这个是监听什么事件？\n这个就是监测飞行事件的，应该是玩家飞行状态改变时触发"
        },
        {
            "author": "aa0307bb",
            "timestamp": 1593539220,
            "txt_content": "疾风暗影 发表于 2020-7-1 01:40\n这个就是监测飞行事件的，应该是玩家飞行状态改变时触发\nemmmm\n但是测过，无论是创造模式下 飞行变落地，落地变飞行\n还是生存模式下 落地变鞘翅飞行 还是 鞘翅飞行变落地 还是创造飞行变生存落地\n%^&*(*&^\n几乎都不触发\n（唯一一次触发是在生存模式下不知道干了什么就触发了...）"
        }
    ]
}