{
    "title": "MCmod制作 1.11(11.新的药水效果 及 事件系统 及 新的伤害效果)",
    "author": "zkm00323",
    "replyCount": 3,
    "timestamp": 1485265140,
    "txt_content": " 本帖最后由 zkm00323 于 2017-3-4 20:45 编辑 \n\n虽然说是药水效果,像是凋零效果和饥饿效果不一定可以用喝药水获得,呢我们就开始吧\n\n\n\n\n\n1.新建potion文件\n新建一包,在里面新建一个class\n\n\n\n\nQQ截图20170124134415.png (7.36 KB, 下载次数: 0)\n\n下载附件\n\n2017-1-24 13:47 上传\n\n\n\n\n\n\n\n在PotionFrostbiye里输入\npublic class PotionFrostbite extends Potion{        \n        public PotionFrostbite() {\n                super(true,0x99FFFF);\n                //super(true,new Color(88,178,220).getRGB());\n        }\n}\n\nsuper(是否为坏效果(关系到状态HUD显示位置),效果颜色(关系到粒子特效的颜色))\n\n药水颜色这里输入一个flex16进制颜色(像是:0x99FFFF)\n你也可以用 new Color(88,178,220).getRGB()\n通过输入RGB颜色获取 flex16进制颜色\n\n可以参考这个网站获取 RGB颜色 http://nipponcolors.com\n可以参考这个网站获取 flex16进制颜色 http://www.cnblogs.com/lost-1987/articles/3024191.html\n\n接下来我们要设置注册名和本地名\n        public PotionFrostbite() {\n                super(true, new Color(88,178,220).getRGB());\n                this.setPotionName(\"effect.frostbite\");\n                this.setRegistryName(Name.MOD_ID, \"frostbite\");\n        }\n\n\n本地名用于lang文件\n注册名用于/effect @a MOD_ID:注册名\n\n之后我们要设置自定义贴图.在PotionFrostbiye接着写\n        public static final ResourceLocation icon = new ResourceLocation(Name.MOD_ID,\"textures/potion/frostbite.png\");\n        \n        @SideOnly(Side.CLIENT)\n        @Override\n        public void renderInventoryEffect(int x, int y, PotionEffect effect, Minecraft \n                mc.getTextureManager().bindTexture(icon);\n                Gui.drawModalRectWithCustomSizedTexture(x + 6, y + 7, 0, 0, 18, 18, 18, \n        }\n        \n        @SideOnly(Side.CLIENT)\n        @Override\n        public void renderHUDEffect(int x, int y, PotionEffect effect, Minecraft mc, float alpha) {\n                mc.getTextureManager().bindTexture(icon);\n                Gui.drawModalRectWithCustomSizedTexture(x + 3, y + 3, 0, 0, 18, 18, 18, 18);\n        }\n\n\nicon就是你的贴图文件路径\n\n\n\n\nfrostbite.png (678 Bytes, 下载次数: 14)\n\n下载附件\n\n2017-1-24 21:28 上传\n\n\n\n\n←附上贴图\n参数里+6+7+3其实就是把贴图对焦到正确的位置\n不需要做什么修改,不过你想了解一下这是干嘛的改一下也是可以\n\n\n\n\n\n2.注册potion\n没错现在1.11,potion需要注册了,不注册\n的话不会显示HUD也不能通过指令获取效果但是仍然可以用EntityLivingBase.isPotionActive(ModPotion.XXX)\n来获取生物是否有这个效果,所以想做一个隐藏buff似乎也是个方法\n我们在init里面新建一个class\n\n\n\n\nQQ截图20170124160410.png (8.73 KB, 下载次数: 1)\n\n下载附件\n\n2017-1-24 16:06 上传\n\n\n\n\n\n\n在里面输入\npublic class ModPotion {\n        public static Potion frostbite = new PotionFrostbite();\n        \n        public static void init(){\n                GameRegistry.register(frostbite);\n        }\n}\n\n在Main里呼叫init方法\n        @EventHandler\n        public void preInit(FMLPreInitializationEvent event){\n                ModPotion.init();\n                ModItems.init();\n                ModEntity.init();\n                ModAchivenent.init();\n                proxy.init();\n        }\n\n\n现在进入游戏输入\n/effect @a soa:frostbite\n就可以看到效果了\n\n\n\n\nQQ截图20170124160945.png (190.73 KB, 下载次数: 4)\n\n下载附件\n\n2017-1-24 16:13 上传\n\n\n\n\n\n\n\n\n\n\nQQ截图20170124161000.png (79.46 KB, 下载次数: 0)\n\n下载附件\n\n2017-1-24 16:13 上传\n\n\n\n\n\n\n\n虽然身上是有状态了,但是没有任何效果\n接下来我们就要用event来让他有效果\n写法1.通过onEntityUpdate事件查阅玩家buff状态来给效果\n优点:无副作用\n缺点:使用onUpdate事件耗能大\n接着在ModPotion里写\npublic class ModPotion {\n        public static Potion frostbite = new PotionFrostbite();\n        \n        public static void init(){\n                GameRegistry.register(frostbite);\n\n                new ModPotion();\n        }\n        \n        public ModPotion () {\n                MinecraftForge.EVENT_BUS.register(this);\n        }\n        \n        @SubscribeEvent\n        public void onEntityUpdate(LivingUpdateEvent event){\n                EntityLivingBase player = event.getEntityLiving();\n                if(player.isPotionActive(ModPotion.frostbite)){\n                        //在这里写效果\n                }\n        }\n}\nonEntityUpdate事件应该是每1tick都会执行一次\n我们检查玩家身上是否有frostbite效果\n并由此给玩家施加效果\n\n我们在效果里写\nif(player.isSprinting()){\n        float Damage = ((float)(1+player.getActivePotionEffect(ModPotion.frostbite).getAmplifier())/4);\n        player.attackEntityFrom(ModDamagecause.causeFrostbiteDamage(player, null), Damage);\n}       \n\n\n\n\n写法2.通过自建PotionEffect的onUpdate实现效果\n优点:没有能耗浪费,且可设置初始参数\n缺点:如果用mc原版指令给生物buff将不会有任何效果(虽然会显示HUD只能通过EntityLivingBase.addPotionEffect(new EffectFrostbite(XXX,XXX,X...));\n来给buff\n新建一个PotionEffect\n\n\n\n\nqq.jpg (15.88 KB, 下载次数: 0)\n\n下载附件\n\n2017-3-4 19:47 上传\n\n\n\n\n\n\n\npublic class EffectFrostbite extends PotionEffect{\n        \n    public EffectFrostbite(EntityLivingBase entity){\n        this(entity, 0);\n    }\n    \n    public EffectFrostbite(EntityLivingBase entity, int durationIn){\n        this(entity, durationIn, 0);\n    }\n\n\n    public EffectFrostbite(EntityLivingBase entity, int durationIn, int amplifierIn){\n        this(entity, durationIn, amplifierIn, false, true);\n    }\n    \n    public EffectFrostbite(EntityLivingBase entity, int durationIn, int amplifierIn, boolean ambientIn, boolean showParticlesIn){\n        super(ModPotion.frostbite, durationIn, amplifierIn, ambientIn, showParticlesIn);\n\n        //这里可以利用输入的EntityLivingBase做一些事情,会在玩家在刚受到这个buff的时候触发\n    }\n\n}\n\n复写一下构造函数,做了一些修改,\n我们直接回传ModPotion.frostbite,\n所以再不需要Potion这个输入参数\n新加了一个输入参数EntityLivingBase\n如果你不需要在//呢里做什么事情\n的话,可以不加这个输入参数\n然后我们复写onUpdate方法,并在里面写上效果\n    @Override\n    public boolean onUpdate(EntityLivingBase entity) {\n                if(entity instanceof EntityPlayer){\n                        EntityPlayer player = (EntityPlayer)entity;\n                        if(player.isSprinting()){\n                                float Damage = ((float)(1+player.getActivePotionEffect(ModPotion.frostbite).getAmplifier())/4);\n                                player.attackEntityFrom(ModDamagecause.causeFrostbiteDamage(player, null), Damage);\n                        }      \n                }\n            return super.onUpdate(entity);\n    }\n\nModDamagecause.causeFrostbiteDamage会报错因为我没还没创建这个伤害效果\n这2句的用意如果玩家受到了冻伤效果\n还疾跑的话就然呢扣血,扣血量按照冻伤效果等级决定,等级越高伤害越强\n+1是因为效果的等级是从0开始算的,看HUD显示1级,其实在参数里他是0\n\n好我们来补上这个伤害效果\n新建一个class\n\n\n\n\nQQ截图20170124210133.png (8.77 KB, 下载次数: 3)\n\n下载附件\n\n2017-1-24 20:50 上传\n\n\n\n\n\n\n\n在里面输入\npublic class ModDamagecause {\n    public static DamageSource causeFrostbiteDamage(Entity source, @Nullable Entity indirectEntityIn){\n        return (new EntityDamageSourceIndirect(\"Frostbite\", source, indirectEntityIn)).setDamageBypassesArmor();\n    }\n}\n\n\n这是一个不会因为附魔保护效果而减少伤害的伤害,简而言之就是真实伤害\n\n自定伤害来源的详细介绍请看这里\nhttps://fmltutor.ustc-zzzz.net/2 ... B1%BB%E5%9E%8B.html\n事件系统的详细介绍请看这里\nhttp://blog.hakugyokurou.net/?p=225\n(既然有前人种树,我们就后人乘凉\n不废话了两位大大都写的很详细了)\n\n\n\n\n\n我们进游戏看看\n\n\n\n\nQQ截图20170124211107.png (343.28 KB, 下载次数: 2)\n\n下载附件\n\n2017-1-24 21:03 上传\n\n\n\n\n\n\n跑起来就会扣血\n\nPS.如果用方法2的\n\n我们到ItemIceicon加一行代码才能感受效果(因为用指令不会有任何效果)\n        @Override\n        public ActionResult<ItemStack> onItemRightClick(World world, EntityPlayer player, EnumHand hand) {\n            ItemStack item = player.getHeldItemMainhand();\n            player.addStat(ModAchivenent.iceSkillslist[item.getMetadata()]);\n            \n            if(!world.isRemote){\n                    switch (item.getMetadata()) {\n                        case 0:\n                            EntityIcebullet icebullet = new EntityIcebullet(world, player);\n                        icebullet.setHeadingFromThrower(player, player.rotationPitch, player.rotationYaw, 0.0F, 1.5F, 1.0F);\n                    world.spawnEntityInWorld(icebullet);\n                                break;\n                        case 1:\n                                player.addPotionEffect(new EffectFrostbite(player,30*20,0));\n                                break;\n                        case 2:\n                                break;\n                        case 3:\n                                break;\n                        case 4:                \n                                break;\n                        case 5:\n                                break;\n                        default:\n                                break;\n                        }\n            }\n                return super.onItemRightClick(world, player, hand);\n        }\n这样我们右键2号图标就会给自己附加buff咯\n\n\n好下一章我们把之前的冰弹给完善.毕竟现在即使被射到也不会有任何\n效果,而且没有什么特效,呢我们12章见咯\n源代码\n\n\n\nsrc_教程11(改).rar\n(40.3 KB, 下载次数: 23)\n\n\n\n2017-3-4 20:39 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "zkm00323",
            "timestamp": 1485508920,
            "txt_content": "其实我写这篇的时候是找不到如何改变玩家移动速度\n所以才想出了跑步扣血的方法,但现在找到了\nEntityPlayer.capabilities.setPlayerWalkSpeed(0.1f);        \n这个可以设置玩家移动速度\n所有mob的默认移动速度在这里\nhttp://minecraft.gamepedia.com/Attribute"
        },
        {
            "author": "qq7794200",
            "timestamp": 1487012580,
            "txt_content": "大神。我发现总说我MAin 错误是咋回事 第一张"
        },
        {
            "author": "zkm00323",
            "timestamp": 1487076540,
            "txt_content": "qq7794200 发表于 2017-2-14 03:03\n大神。我发现总说我MAin 错误是咋回事 第一张\n呢就是你Main里面有文法没写对"
        }
    ]
}