{
    "title": "【Forge Modding】【1.5.2】教你动手制作你的第一个方块GUI！",
    "author": "DeathWolf96",
    "replyCount": 6,
    "timestamp": 1371466140,
    "txt_content": " 本帖最后由 DeathWolf96 于 2013-6-17 19:14 编辑 \n\n    大家好，我是WeAthFoLD，一个接触Mod制作大概有三四个月的家伙吧=。=\n    最近一直写代码写代码，也渐渐的对Forge和MCMod的编写有了一定的了解，所以就萌生了一个制作一篇Mod教程的想法。\n    由于在国内没有看到特别好的GUI教程，所以主题就选为GUI啦~当初第一次写GUI的时候咱表示真是被虐了一脸，各种混乱的说…所以希望在这里写一下自己对GUI编写的感想和见解，如果有什么写的不好的地方还请大家指出咯~\n    P.S. 宣传下咱目前正在制作的Mod Project http://www.mcbbs.net/thread-115882-1-1.html\n    那么不废话了，以下正题：\n\n1、    GUI是什么？\nGUI=Graphic User Interface，即图形用户界面。\n你在MC中所看到的\ni.    主菜单和各个菜单界面\nii.    方块界面，比如合成表、酿造台、熔炉\niii.    物品界面，如放置告示牌时显示的编辑界面，拿着书右键打开的阅读界面\n都属于GUI。\n\nGUI的编写因其具体功能具有相当大的差异，在本篇文章中，主要介绍方块的GUI。\n-MC GUI编写的基本常识\n--我该如何下手呢？这一般是GUI编写遇到的第一个问题。\nMC的GUI编写内容很繁杂琐碎，尤其是方块GUI，要涉及到GUI Handler、TileEntity的存取等等，所以我们从一个基础Mod的搭建到GUI方块完成的过程，来一起体验一次GUI制作的方法。\n\nI、初步准备\n\n1、Mod类的构建\n不详述0 0如果这里都不会的话先去看教程吧\n代码如下\npackage guiexample.core;\n\n/**\n * 主Mod类。在这里进行基本的注册，你懂的\n * @author WeAthFolD\n */\n@Mod(modid=\"gexp\",name=\"Gui Example Mod\",version=\"0.0.1\")\n@NetworkMod(clientSideRequired=true,serverSideRequired=false)\npublic class GuiExampleMod {\n\n    //静态实例\n    @Instance(\"gexp\")\n    public static GuiExampleMod instance;\n    \n    //加载代理，目前Proxy和ClientProxy皆只有一个空的init()函数\n    @SidedProxy(clientSide=\"guiexample.core.proxy.ClientProxy\",serverSide=\"guiexample.core.proxy.Proxy\")\n    public static guiexample.core.proxy.Proxy proxy;\n    \n    //预加载\n    @PreInit\n    public void preInit(FMLPreInitializationEvent Init)\n    {\n    }\n\n    //正式加载\n    @Init\n    public void init(FMLInitializationEvent Init){\n        //proxy类你懂的，里面暂时就一个空函数而已=w=\n        proxy.init();\n    }\n\n    //加载后的清理\n    @PostInit\n    public void postInit(FMLPostInitializationEvent Init){\n    }\n\n    //服务端加载\n    @ServerStarting\n    public void serverStarting(FMLServerStartingEvent event) {\n    }\n\n}\n复制代码\n\n2、预备：Gui Handler\n在Forge中，打开GUI的行为是和Mod链接起来的。也就是说，当我们尝试用自己的mod打开GUI时，必须有一个处理类来恰当的处理我们的请求。\npackage guiexample.core;\n\n/**\n * 在Mod中打开GUI的统一处理类。\n * @author WeAthFolD\n */\npublic class GuiHandler implements IGuiHandler {\n\n    @Override\n    /**\n     * 返回服务器端的GUI元素，对于方块GUI，返回一个Container子类。\n     */\n    public Object getServerGuiElement(int ID, EntityPlayer player, World world,\n            int x, int y, int z) {\n        return null;\n    }\n\n    @Override\n    /**\n     * 返回客户端的GUI元素。对于方块GUI，返回一个GuiContainer子类。\n     */\n    public Object getClientGuiElement(int ID, EntityPlayer player, World world,\n            int x, int y, int z) {\n        // TODO Auto-generated method stub\n        return null;\n    }\n}\n复制代码\n在写完GuiHandler类以后，在你的主类Init中注册这个Gui Handler.\n\nNetworkRegistry.instance().registerGuiHandler(this, new GuiHandler());\n复制代码\n\nII.基本的方块GUI\n\n3、开始构建~\\(≧▽≦)/~！- 一个可以打开GUI的空方块\n在做完以上的工作后，我们对于打开方块的GUI就有了初步的准备。现在，我们可以开始写方块了。\n作为可以打开GUI的特殊方块，我们需要一个实现了IInventory类的TileEntity依附其上。\n（其实只有你需要在其中存放物品的时候才需要XD，这里因为后期要加入的原因就直接继承←实现了）\n\n-方块代码\n\npackage guiexample.blocks;\n\n/**\n * 可以打开一个空GUI的方块。由于需要TileEntity，继承BlockContainer。\n * @author WeAthFolD\n */\npublic class BlockExample extends BlockContainer {\n\n    /**\n     * 在构造器中对方块属性进行设置。\n     * @param par1 方块ID\n     */\n    public BlockExample(int par1) {\n        super(par1, Material.rock);\n        this.setHardness(2.0F);\n        this.setUnlocalizedName(\"misaka\"); //不要吐槽\n        this.setCreativeTab(CreativeTabs.tabDecorations);\n    }\n    \n    /**\n     * 注册贴图。\n     */\n    @SideOnly(Side.CLIENT)\n    public void registerIcons(IconRegister par1IconRegister)\n    {\n        this.blockIcon = par1IconRegister.registerIcon(\"guiexample:empty\");\n    }\n    \n    @Override\n    public boolean onBlockActivated(World world, int x, int y, int z,\n                    EntityPlayer player, int idk, float what, float these, float are) {\n            TileEntity tileEntity = world.getBlockTileEntity(x, y, z);\n            //如果TileEntity没有被加载或者玩家在潜行，则不打开GUI。\n            if (tileEntity == null || player.isSneaking()) {\n                    return false;\n            }\n            //在这里打开GUI：参数1为Mod实例类，参数2为GUI的ID（在主类中声明），后面的参数分别是世界和坐标\n            player.openGui(GuiExampleMod.instance, GuiExampleMod.GUI_ID_SAMPLE, world, x, y, z);\n            return true;\n    }\n    \n    @Override\n    //返回block对应的TileEntity.\n    public TileEntity createNewTileEntity(World world) {\n        return new TileExample();\n    }\n\n}\n复制代码\n\n-TileEntity代码\n\npackage guiexample.blocks;\n/**\n * 空的Inventory TileEntity，在稍后我们为它添加功能。\n * @author WeAthFolD\n */\npublic class TileExample extends TileEntity implements IInventory{\n\n    public TileExample() {\n    }\n\n    @Override\n    public int getSizeInventory() {\n        return 0;\n    }\n\n    @Override\n    public ItemStack getStackInSlot(int i) {\n        return null;\n    }\n\n    @Override\n    public ItemStack decrStackSize(int i, int j) {\n        return null;\n    }\n\n    @Override\n    public ItemStack getStackInSlotOnClosing(int i) {\n        return null;\n    }\n\n    @Override\n    public void setInventorySlotContents(int i, ItemStack itemstack) {\n    }\n\n    @Override\n    public String getInvName() {\n        return \"example\";\n    }\n\n    @Override\n    public boolean isInvNameLocalized() {\n        return false;\n    }\n\n    @Override\n    public int getInventoryStackLimit() {\n        return 64;\n    }\n\n    @Override\n    public boolean isUseableByPlayer(EntityPlayer entityplayer) {\n        return entityplayer.getDistanceSq(xCoord + 0.5, yCoord + 0.5,\n                zCoord + 0.5) <= 64;\n    }\n\n    @Override\n    public void openChest() {}\n\n    @Override\n    public void closeChest() {}\n\n    @Override\n    public boolean isStackValidForSlot(int i, ItemStack itemstack) {\n        return true;\n    }\n\n}\n复制代码\nQ:好累啊QAQ终于写好了，那么我现在就可以打开GUI了么？\nA:你是笨蛋么怎么可能就完了！继续看下去！\n\n那么Block和TileEntity的构建已经完成了，但是这只是GUI的基本基本，根本没有真正开始哟www\n好戏还在后头呢 所以还请耐心看下去~\n回忆一下，现在我们构建了一个基本Mod和一个GUI Handler，还完成了一个基本的Block和空的Inventory TileEntity。\n接下来，我们要为Block激活时打开GUI的请求作出正确的处理，在GUI Handler中给出正确的处理。\n\n首先构建Container和GUI类：\n\npackage guiexample.gui;\n\n/**\n * 空的Container类，我们稍后为它添加功能。\n * @author WeAthFolD\n */\npublic class ContainerExample extends Container {\n\n    //在Container中放TileEntity句柄方便访问\n    private TileExample theTile;\n    \n    public ContainerExample(TileExample tileEntity, InventoryPlayer invPlayer) {\n        bindTileSlots(tileEntity);\n        bindPlayerSlots(invPlayer);\n        theTile = tileEntity;\n    }\n    \n    /**\n     * 绑定TileEntity的物品槽。\n     * @param t\n     */\n    private void bindTileSlots(TileExample t){}\n    \n    /**\n     * 绑定玩家物品栏。\n     * @param inv\n     */\n    private void bindPlayerSlots(InventoryPlayer inv){}\n\n    @Override\n    /**\n     * 判定它能否被使用，在这里调用TileEntity中的判读函数。\n     */\n    public boolean canInteractWith(EntityPlayer entityplayer) {\n        return theTile.isUseableByPlayer(entityplayer);\n    }\n\n}\n复制代码\n\npackage guiexample.gui;\n/**\n * 终于到传说中的GUI类了。\n * @author WeAthFolD\n */\npublic class GuiExample extends GuiContainer {\n\n    public GuiExample(TileExample tile, InventoryPlayer inv) {\n        //为该Container GUI制定正确的Container，也就是BlockExample的Container。\n        super(new ContainerExample(tile, inv));\n    }\n\n    /**\n     * 这里是GUI背景的绘制，先空着。\n     */\n    @Override\n    protected void drawGuiContainerBackgroundLayer(float f, int i, int j) {\n        GL11.glPushMatrix();\n        GL11.glPopMatrix();\n    }\n}\n复制代码\n\n好了> >至此GUI的构建全部完成了，最后我们在GUI Handler和Mod类中注册下我们写的东西：\nat GuiHandler.java:\n\n    @Override\n    /**\n     * 返回服务器端的GUI元素，对于方块GUI，返回一个Container子类，或null。\n     */\n    public Object getServerGuiElement(int ID, EntityPlayer player, World world,\n            int x, int y, int z) {\n        if(ID == GuiExampleMod.GUI_ID_SAMPLE) {\n            TileEntity tileEntity = world.getBlockTileEntity(x, y, z);\n            //简单的错误检查\n            if(tileEntity == null || !(tileEntity instanceof TileExample))\n                return null;\n            return new ContainerExample((TileExample)tileEntity, player.inventory);\n        }\n        return null;\n    }\n\n    @Override\n    /**\n     * 返回客户端的GUI元素。对于方块GUI，返回一个Gui子类。\n     */\n    public Object getClientGuiElement(int ID, EntityPlayer player, World world,\n            int x, int y, int z) {\n        if(ID == GuiExampleMod.GUI_ID_SAMPLE) {\n            TileEntity tileEntity = world.getBlockTileEntity(x, y, z);\n            //简单的错误检查\n            if(tileEntity == null || !(tileEntity instanceof TileExample))\n                return null;\n            return new GuiExample((TileExample)tileEntity, player.inventory);\n        }\n        return null;\n    }\n复制代码\n\nat GUIExampleMod.java:\n    \n\n    //Mod类定义域内\n    public static final int GUI_ID_SAMPLE = 0;\n    \n    //正式加载\n    @Init\n    public void init(FMLInitializationEvent Init){\n        NetworkRegistry.instance().registerGuiHandler(this, new GuiHandler());\n        exampleBlock = new BlockExample(400);\n        //注册方块和TileEntity\n        ModLoader.registerBlock(exampleBlock);\n        ModLoader.registerTileEntity(TileExample.class, \"tile_example\");\n        LanguageRegistry.addName(exampleBlock, \"GUI什么的讨厌死了！哼> <\");\n    \n        proxy.init();\n    }\n复制代码\n\n打开游戏试试效果吧！\n恭喜你 完成了！你现在拥有了一个【毫无功能】的能打开一个【空GUI】的方块。准备好进行下一步的学习了么？\n（所以GUI是大坑，慎入慎入啊……）\n\n唔，表示由于目前在准备期末考试，所以可能更新会比较慢，在几周内把这个坑填完吧>3<\n\n\n\nguiExample_版本1_src.zip\n(10.34 KB, 下载次数: 36)\n\n\n\n2013-6-17 18:56 上传\n点击文件名下载附件\n一个空的方块GUI的源代码 233\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "cnmndysb",
            "timestamp": 1371466680,
            "txt_content": "夏娜酱。。。。。。"
        },
        {
            "author": "222889",
            "timestamp": 1371466980,
            "txt_content": "板凳留名~~"
        },
        {
            "author": "hendyzone",
            "timestamp": 1371467940,
            "txt_content": "喜闻乐见的教程"
        },
        {
            "author": "我是43",
            "timestamp": 1575102360,
            "txt_content": "谢谢你教我"
        },
        {
            "author": "华夏D冬天",
            "timestamp": 1575183120,
            "txt_content": "这- -有点东西"
        },
        {
            "author": "zhaokeao",
            "timestamp": 1577449200,
            "txt_content": "顶顶~~~~~~~"
        }
    ]
}