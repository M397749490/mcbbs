{
    "title": "[IEM]关于近期整合包出现不明原因文件损坏问题，个人的一点小建议",
    "author": "ItIsEnderman",
    "replyCount": 7,
    "timestamp": 1580524320,
    "txt_content": " 本帖最后由 ItIsEnderman 于 2020-2-2 08:35 编辑 \n\n\n关于近期整合包出现不明原因文件损坏问题，个人的一点小建议\n\n\n想必近期不少玩家遇到这种奇怪问题：原本完全正常的整合包突然无法做启动，查看日志发现出现了形似“无法找到库文件或Mod的类”类型的报错。但是，库文件却仍然存在于指定位置，比原来瘦身了几个KB（甚至是字节，但是通常很少有人会注意到库文件大小这一点）。\n\n以下为三个实例：\n\n实例1：asm库文件类无法找到，但是asm的jar文件仍然存在，比原来瘦身了几个KB（这个是自己遇到的）\n[12:47:06] [main/ERROR] [FML/]: An error occurred trying to configure the minecraft home at D:\\Minecraft\\1.7.10\\.\\.minecraft\\versions\\1.7.10-Forge10.13.4.1614-1.7.10 for Forge Mod Loader\njava.lang.NoClassDefFoundError: org/objectweb/asm/ClassVisitor\n        at cpw.mods.fml.relauncher.CoreModManager.discoverCoreMods(CoreModManager.java:314) ~[forge-1.7.10-10.13.4.1614-1.7.10.jar:?]\n        at cpw.mods.fml.relauncher.CoreModManager.handleLaunch(CoreModManager.java:221) ~[forge-1.7.10-10.13.4.1614-1.7.10.jar:?]\n        at cpw.mods.fml.relauncher.FMLLaunchHandler.setupHome(FMLLaunchHandler.java:90) [forge-1.7.10-10.13.4.1614-1.7.10.jar:?]\n        at cpw.mods.fml.relauncher.FMLLaunchHandler.setupClient(FMLLaunchHandler.java:67) [forge-1.7.10-10.13.4.1614-1.7.10.jar:?]\n        at cpw.mods.fml.relauncher.FMLLaunchHandler.configureForClientLaunch(FMLLaunchHandler.java:34) [forge-1.7.10-10.13.4.1614-1.7.10.jar:?]\n        at cpw.mods.fml.common.launcher.FMLTweaker.injectIntoClassLoader(FMLTweaker.java:126) [forge-1.7.10-10.13.4.1614-1.7.10.jar:?]\n        at net.minecraft.launchwrapper.Launch.launch(Launch.java:115) [launchwrapper-1.12.jar:?]\n        at net.minecraft.launchwrapper.Launch.main(Launch.java:28) [launchwrapper-1.12.jar:?]\nCaused by: java.lang.ClassNotFoundException: org.objectweb.asm.ClassVisitor\n        at java.net.URLClassLoader.findClass(Unknown Source) ~[?:1.8.0_221]\n        at java.lang.ClassLoader.loadClass(Unknown Source) ~[?:1.8.0_221]\n        at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source) ~[?:1.8.0_221]\n        at java.lang.ClassLoader.loadClass(Unknown Source) ~[?:1.8.0_221]\n        ... 8 more\n复制代码\n\n实例2：commons-compress库文件根本打不开（这个也是自己遇到的）\n[15:25:26] [Client thread/WARN] [FML/]: Zip file commons-compress-1.8.1.jar failed to read properly, it will be ignored\njava.util.zip.ZipException: error in opening zip file\n        at java.util.zip.ZipFile.open(Native Method) ~[?:1.8.0_231]\n        at java.util.zip.ZipFile.<init>(Unknown Source) ~[?:1.8.0_231]\n        at java.util.zip.ZipFile.<init>(Unknown Source) ~[?:1.8.0_231]\n        at java.util.jar.JarFile.<init>(Unknown Source) ~[?:1.8.0_231]\n        at java.util.jar.JarFile.<init>(Unknown Source) ~[?:1.8.0_231]\n        at cpw.mods.fml.common.discovery.JarDiscoverer.discover(JarDiscoverer.java:41) [JarDiscoverer.class:?]\n        at cpw.mods.fml.common.discovery.ContainerType.findMods(ContainerType.java:42) [ContainerType.class:?]\n        at cpw.mods.fml.common.discovery.ModCandidate.explore(ModCandidate.java:71) [ModCandidate.class:?]\n        at cpw.mods.fml.common.discovery.ModDiscoverer.identifyMods(ModDiscoverer.java:131) [ModDiscoverer.class:?]\n        at cpw.mods.fml.common.Loader.identifyMods(Loader.java:364) [Loader.class:?]\n        at cpw.mods.fml.common.Loader.loadMods(Loader.java:489) [Loader.class:?]\n        at cpw.mods.fml.client.FMLClientHandler.beginMinecraftLoading(FMLClientHandler.java:208) [FMLClientHandler.class:?]\n        at net.minecraft.client.Minecraft.func_71384_a(Minecraft.java:480) [bao.class:?]\n        at net.minecraft.client.Minecraft.func_99999_d(Minecraft.java:878) [bao.class:?]\n        at net.minecraft.client.main.Main.main(SourceFile:148) [Main.class:?]\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_231]\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) ~[?:1.8.0_231]\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) ~[?:1.8.0_231]\n        at java.lang.reflect.Method.invoke(Unknown Source) ~[?:1.8.0_231]\n        at net.minecraft.launchwrapper.Launch.launch(Launch.java:135) [launchwrapper-1.12.jar:?]\n        at net.minecraft.launchwrapper.Launch.main(Launch.java:28) [launchwrapper-1.12.jar:?]\n复制代码\n\n实例3：vecmath库文件类无法找到，直接导致启动失败（来自https://www.mcbbs.net/thread-949459-1-1.html，一些可能涉及敏感信息的字段已移除）\n[08:40:32] [main/ERROR] [LaunchWrapper]: Unable to launch\njava.lang.reflect.InvocationTargetException: null\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_201]\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) ~[?:1.8.0_201]\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) ~[?:1.8.0_201]\n        at java.lang.reflect.Method.invoke(Unknown Source) ~[?:1.8.0_201]\n        at net.minecraft.launchwrapper.Launch.launch(Launch.java:135) [launchwrapper-1.12.jar:?]\n        at net.minecraft.launchwrapper.Launch.main(Launch.java:28) [launchwrapper-1.12.jar:?]\nCaused by: java.lang.NoClassDefFoundError: javax/vecmath/Tuple4f\n        at net.minecraft.client.Minecraft.<init>(Minecraft.java:335) ~[bib.class:?]\n        at net.minecraft.client.main.Main.main(SourceFile:123) ~[Main.class:?]\n        ... 6 more\nCaused by: java.lang.ClassNotFoundException: javax.vecmath.Tuple4f\n        at java.net.URLClassLoader.findClass(Unknown Source) ~[?:1.8.0_201]\n        at net.minecraft.launchwrapper.LaunchClassLoader.findClass(LaunchClassLoader.java:117) ~[launchwrapper-1.12.jar:?]\n        at java.lang.ClassLoader.loadClass(Unknown Source) ~[?:1.8.0_201]\n        at java.lang.ClassLoader.loadClass(Unknown Source) ~[?:1.8.0_201]\n        at net.minecraft.client.Minecraft.<init>(Minecraft.java:335) ~[bib.class:?]\n        at net.minecraft.client.main.Main.main(SourceFile:123) ~[Main.class:?]\n        ... 6 more\n复制代码\n\n其他的实例还有：游戏本体文件损坏的，LaunchWrapper打不开的（某些启动器下会惨到连日志都不会有记录），突然解压不了Natives库文件、并提示缺失文件末端的，等等。\n\n\n上述三个错误可能自从Minecraft添加了对他们的需求后就有，但最近两天突然爆发式出现，具体原因不很明确。据个人观察，这种错误多是库文件的文件末端缺失所致（也就是所谓的没有终止符，库文件“无穷大”）。有关成因，可能需要进一步调查，有兴趣的可以试一试。\n\n目前个人的解决方案：\n\n第一步：定位损坏的文件\n以WinRAR为例，首先，选定客户端整合包的.minecraft文件夹、或者服务端的根目录，点击“测试”按钮，等待WinRAR完成压缩文件批量测试。\n由于natives库文件几乎都是从libraries文件夹下的jar文件中解压出来的，所以如果出现启动器解压不了Natives库文件、并提示缺失文件末端的情况，解决方案仍然与此相同。\n\n下图是对于客户端整合包的测试，同时也展示出了测试结果。\n\n\n第二步：对损坏的文件进行操作\n根据测试结果，我们快速找到了损坏的文件所在的位置。对于不同类型的损坏文件操作不同。以下为几种常见类型的处理：\n1.库文件（存放于\\.minecraft\\libraries文件夹以及\\.fabric\\remappedJars文件夹以及paper端的cache文件夹中的可执行jar文件）\n    解决方案：直接删除\n2.Mod（存放于mods文件夹中的可执行jar文件）\n    解决方案：根据文件末尾的版本号，到curseforge上重新下载安装。\n3.Bukkit插件（存放于plugins文件夹中的可执行jar文件，客户端不会有）\n    解决方案：和mod几乎相同，删除损坏的版本，下载正常的。\n4.客户端游戏本体（存放于\\.minecraft\\versions\\版本号 中，文件名和版本号文件夹同名）\n    解决方案：视作库文件，直接删除即可。\n5.服务端本体（bat文件指向的jar文件）\n    解决方案：手动重新下载，或者重新构建\n\n\n接下来的步骤（仅针对库文件和本体核心文件），服务器和客户端就有些不同了。\n\n对于客户端库文件以及游戏本体：\n\n检查启动器“检查完整性”功能是否已打开，如果没有，那就将其打开。然后，将文件下源设置成官方源。（如果官方源失败，则选择BMCLAPI）\n这里以HMCL为例：\n\n\n\n\n确保这个功能已打开后，直接启动游戏。\n\n对于服务端的库文件：\nFabric（也就是Carpet端）会检查它的唯一一个库文件intermediary-server.jar（其实是使用yarn mapping的核心文件）是否存在、并且在该文件缺失时自动补全，所以删掉之后就没事了。\n\n纯净的Bukkit/Spigot没有特定的文件夹存放库文件，根本不用管库文件损坏问题。\n\nPaper端中的cache文件夹存放有两个体积较大的文件，但是paper会自动补全缺失文件，所以删除即可。\n\nForge/SpongeForge/KC的B事很多，它不会补全缺失的库文件，但是libraries文件夹结构和一般的客户端相同，删除损坏的库文件后，需要从同版本客户端或者其他服务端复制一套库文件过去。\n\nCatServer简直是给懒人设计的，删除损坏的库文件之后，它自己就会给你下好。\n\n对于服务端本体：\n唯一的解决方法是到原帖重新下载或构建。\n\n\n\n对于Mod或者插件，直接重下即可，前面已经讲过了，就不再多说。对于zip整合包，唯一的解决办法还是到原帖重下，除非原帖给了一个故障整合。\n\n也可以直接下载成品整合包（不单指客户端整合，照样可用于服务端整合包），然后直接从中提取库文件或Mod或插件来覆盖已损坏成分。\n\n以上解决方案仅针对已损坏的文件，不关未损坏的文件任何B事，请不要对每个库文件或者mods/plugins等进行上述操作，请只针对检测出的损坏文件进行上述操作！\n\n这种问题很可能与启动器下载的节点相关，请注意。\n\n（由于ZipFile和ClassLoader的一些机制是写在非Java代码的地方的，所以基本很难通过仅反编译Java代码来确定异常处理机制）\n\n本篇教程按照CC BY-SA 4.0国际许可协议进行许可。\n[groupid=1306]Bone Studio[/groupid]",
    "replies": [
        {
            "author": "xmdhs",
            "timestamp": 1580524560,
            "txt_content": "同样还有安装整合包是出现的，error in opening zip file 的问题。。\n\n因为从 bmclaip 那下载 forge 时，资源 404 了。。 目测是文件没有保存到服务器\n\nhttps://bmclapi2.bangbang93.com/ ... nstaller&format=jar\n\n听说泥潭赞助了服务器，但是 404 是怎么回事。。"
        },
        {
            "author": "lizixuan1998",
            "timestamp": 1580525400,
            "txt_content": "太强了 qwq"
        },
        {
            "author": "恋",
            "timestamp": 1580562180,
            "txt_content": "我记得以前也遇到过 本来整合好的包 过几个月后启动就启动器就会下载补全文件 如果补全不了的话会启动不了  "
        },
        {
            "author": "xmdhs",
            "timestamp": 1580562960,
            "txt_content": " 本帖最后由 xmdhs 于 2020-2-1 21:24 编辑 \n\n原因我好像找到了。\n\n我删除了我的 .minecraft/libraries/org/apache/maven  文件夹，然后看 hmcl 补全，从 bmclapi 下载文件。\n\n\n\n\nimage.png (119.64 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-1 21:16 上传\n\n\n\n\n\n\n然后这里下载的文件却是个损坏的。。。\nhttps://bmclapi2.bangbang93.com/ ... -artifact-3.5.3.jar\n\n\n\n\n\nimage.png (13.56 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-1 21:17 上传\n\n\n\n\n\n\n关键是，储存的文件就是这样，文件名和 md5 一致。。\n\n谁去告诉 bangbang93 一声，让他把文件换一下。\n\n其他的报错估计原因一致。"
        },
        {
            "author": "ItIsEnderman",
            "timestamp": 1580564280,
            "txt_content": "xmdhs 发表于 2020-2-1 21:16\n原因我好像找到了。\n\n我删除了我的 .minecraft/libraries/org/apache/maven  文件夹，然后看 hmcl 补全，从 ...\n\n\n\n\n批注 2020-02-01 213739.png (107.63 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-1 21:37 上传\n\n\n\n\n\n\n啊？我没发现虫子……"
        },
        {
            "author": "xmdhs",
            "timestamp": 1580564580,
            "txt_content": "ItIsEnderman 发表于 2020-2-1 21:38\n啊？我没发现虫子……\n节点的问题？\n\n\n\n\nimage.png (122.37 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-1 21:39 上传\n\n\n\n\n\n\n\n\n\n\nimage.png (159.94 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-1 21:42 上传\n\n\n\n\n\n\n本机和一台香 港的机器下载的文件的 sha256 是相同的，和你的不同 "
        },
        {
            "author": "1a2s3d4f1",
            "timestamp": 1580616840,
            "txt_content": " 本帖最后由 1a2s3d4f1 于 2020-2-2 12:18 编辑 \n\n.fabric是fabric自动混淆的文件（打错打成了不是），fabric的库完整就可以生成\nforge也有这种文件，但是如果损坏并不会自动补全\n损坏这个是真的奇怪，我为了快点启动关闭自检，现在也没损坏文件崩溃？\n难道是启动器下载了损坏的文件？(我这里的bmclapi会下载损坏的zip文件，我连的是官方源所以没下到损坏的文件\n"
        }
    ]
}