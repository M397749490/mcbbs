{
    "title": "升级核心后，TPS爆低",
    "author": "q1030290917",
    "replyCount": 20,
    "timestamp": 1588231920,
    "txt_content": " 本帖最后由 q1030290917 于 2020-5-1 11:44 编辑 \n\n服务端从windows系统的1.8.9 paperspigot核心升级到Linux系统的1.12.2paperspigot的核心之后TPS恢复了。但是现在问题是一按tab键补全命令 就会被闪退踢出，后台显示\nM_ILK lost connection: Internal Exception: io.netty.channel.unix.Errors$NativeIoException: syscall:read(..) failed: 连接被对方重设 java.lang.IllegalStateException: Asynchronous Async Chunk Load! Blocking thread until it returns \n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.MCUtil.ensureMain(MCUtil.java:54)\n[11:43:16 WARN]:        at org.bukkit.craftbukkit.v1_12_R1.chunkio.ChunkIOExecutor.syncChunkLoad(ChunkIOExecutor.java:18)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.ChunkProviderServer.getChunkAt(ChunkProviderServer.java:170)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.ChunkProviderServer.getChunkAt(ChunkProviderServer.java:153)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.ChunkProviderServer.getChunkAt(ChunkProviderServer.java:149)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.World.getChunkAt(World.java:357)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.World.getChunkAtWorldCoords(World.java:353)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.World.q(World.java:1453)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.EntityPlayer.getSpawnPoint(EntityPlayer.java:140)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.EntityPlayer.<init>(EntityPlayer.java:105)\n[11:43:16 WARN]:        at net.craftersland.data.bridge.utils.nms.Version_1_12_R1.loadPlayer(Version_1_12_R1.java:135)\n[11:43:16 WARN]:        at net.craftersland.data.bridge.events.PlayerDisconnect$1.run(PlayerDisconnect.java:39)\n[11:43:16 WARN]:        at org.bukkit.craftbukkit.v1_12_R1.scheduler.CraftTask.run(CraftTask.java:64)\n[11:43:16 WARN]:        at org.bukkit.craftbukkit.v1_12_R1.scheduler.CraftAsyncTask.run(CraftAsyncTask.java:52)\n[11:43:16 WARN]:        at com.destroystokyo.paper.ServerSchedulerReportingWrapper.run(ServerSchedulerReportingWrapper.java:22)\n[11:43:16 WARN]:        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n[11:43:16 WARN]:        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n[11:43:16 WARN]:        at java.lang.Thread.run(Thread.java:748)\n\n\n\n\n",
    "replies": [
        {
            "author": "apacheii",
            "timestamp": 1588231920,
            "txt_content": "问题解决了没？\n你用的是原版paper核心吗？\n我仔细看了一下错误日志，发现问题应该是出自net.craftersland.data.bridge.utils.nms这个包里面的东西。\n但paper核心里没有这个东西。要么就是某个插件，这个命名规则扎实看不懂是什么插件的，网上搜也只能搜到一些乱七八糟的信息。\n如果问题还没解决，请与我私聊。"
        },
        {
            "author": "凛夜丶雨月",
            "timestamp": 1588232820,
            "txt_content": " 本帖最后由 凜夜丶雨月 于 2020-4-30 15:48 编辑 \n\n[优化]LaggRemover —— 智能降低延迟★优化TPS&内存【汉化】[1.7-1.14]\nhttps://www.mcbbs.net/thread-603072-1-1.html\n(出处: Minecraft(我的世界)中文论坛)\n[管理|整地][SCT]ClearLagg——扫地大妈全新内核汉化版! [1.7.10-1.12.x]\nhttps://www.mcbbs.net/thread-781034-1-1.html\n(出处: Minecraft(我的世界)中文论坛)[安全|优化]ClearMob —— 功能全面的异步实体控制与区块优化[1.10-1.14]\nhttps://www.mcbbs.net/thread-915272-1-1.html\n(出处: Minecraft(我的世界)中文论坛)\n[优化]Simple Anti-Mob Lag —— 冻结生物以缓解卡服|已兼容至1.15[1.9-1.15]\nhttps://www.mcbbs.net/thread-874306-1-1.html\n(出处: Minecraft(我的世界)中文论坛)\n试试这4个"
        },
        {
            "author": "结城希亚",
            "timestamp": 1588233240,
            "txt_content": " 本帖最后由 结城希亚 于 2020-4-30 15:56 编辑 \n\n低版本优化本来就非常好\n你升到高版本就要体验tps低下的快乐\n\n      46.02%          78.84%        156.53 s            39.42 ms         1.0               4.0k            dp3 - tickEntities\n       6.50%          11.14%         22.11 s             5.57 ms         1.0               4.0k            craft - tickEntities\n       4.31%           7.38%         14.66 s             3.69 ms         1.0               4.0k            Plugin SchedulerLearn More\n       2.63%           4.51%          8.95 s             2.25 ms         1.0               4.0k            fb1 - tickEntities\n看了下你的timings\n主要是地皮世界的实体导致的卡顿\n\n[优化|管理|修复] Aegis Clear —— 高版本优化 | 清理 | 管理插件 [全版本]\nhttps://www.mcbbs.net/thread-918981-1-1.html\n(出处: Minecraft(我的世界)中文论坛)\n\n[优化|管理|功能]ClearEntity —— 定时清理实体[1.6+]\nhttps://www.mcbbs.net/thread-723356-1-1.html\n(出处: Minecraft(我的世界)中文论坛)\n\n其他都很正常\n估计就是你机器不行了，建议升级\n\n如果需要可以试试按着修改配置文件\n\n1、在bukkit.yml里\n（1）spawn-limits值设为\n  monsters: 20\n  animals: 4\n  water-animals: 1\n  ambient: 1\n（2）chunk-gc\nperiod-in-ticks设为300\n（3）ticks-per.monster-spawns设为6\n2、在spigot.yml里\n（1）save-user-cache-on-stop-only改为true\n（2）max-tick-time数值改为5或者3000\n（3）mob-spawn-range设为3\n（4）entity-activation-range分别改为8、6、12、2\n（5）tick-inactive-villagers改为false\n（6）merge-radius都设置为64\n（7）nerf-spawner-mobs改为true\n（8）arrow-despawn-rate改为400\n（9）view-distance改为2\n\n"
        },
        {
            "author": "小张up",
            "timestamp": 1588234980,
            "txt_content": "加一下优化插件吧。高版本肯定卡。\n像laggremover就很不错。\n建议给服务商砸钱，加配置"
        },
        {
            "author": "深拥v",
            "timestamp": 1588235460,
            "txt_content": "用paperspigot核心\n楼上说的也不算太对，因为优化插件是维护服务器良好状态的\n但你这很明显，，tps都到10了，不是加几个插件就能解决的hhh\n所以：\n优化做好了吗，另外用worldborder加载一遍世界，再查查插件资源占用\n基本就能找到问题"
        },
        {
            "author": "gfjhf",
            "timestamp": 1588236600,
            "txt_content": "高版本自然更吃配置\n安装优化插件能起到的作用有限，而且会影响玩家体验，当然适度安装合理配置也是有效果的\n最主要的还是升级配置或者分服"
        },
        {
            "author": "雪之空_",
            "timestamp": 1588244760,
            "txt_content": "高版本吃配置比较多，加点优化插件。或者升个i9 9900k qwq"
        },
        {
            "author": "apacheii",
            "timestamp": 1588248900,
            "txt_content": "给你两个建议：\n一是换用Paper核心，它在spigot上做了非常多的优化，效果最显著的是异步区块加载。\n二是调整漏斗的参数（因为根据你的timings报告，漏斗的开销占第一）：\n打开spigot.yml\nhopper-transfer: 20 # 是指每多少tick传输一次，20tick=1秒，设置成1秒让使用漏斗计时器的玩家更容易计算\nhopper-check: 4 # 每多少tick检查一下上面是否有物品可吸取，这个数字关系到漏斗灵敏度，建议不要超过4，但不要设置为1.\nhopper-amount: 4 # 漏斗每次传送多少个，根据所有物品的最大堆栈数量，设置为4是最合适的。\n根据以上设置，漏斗每秒传送4个物品，不影响漏斗计时器，又能减少漏斗的性能开销。"
        },
        {
            "author": "q1030290917",
            "timestamp": 1588259940,
            "txt_content": "apacheii 发表于 2020-4-30 20:15\n给你两个建议：\n一是换用Paper核心，它在spigot上做了非常多的优化，效果最显著的是异步区块加载。\n二是调 ...\n换成paper核心了，但是一tab补全命令 就会被闪退踢出，后台显示\nM_ILK lost connection: Internal Exception: io.netty.channel.unix.Errors$NativeIoException: syscall:read(..) failed: 连接被对方重设"
        },
        {
            "author": "炫宙菌",
            "timestamp": 1588302420,
            "txt_content": "https://www.mcbbs.net/thread-1020516-1-1.html 注意二楼"
        },
        {
            "author": "q1030290917",
            "timestamp": 1588302660,
            "txt_content": "炫宙菌 发表于 2020-5-1 11:07\nhttps://www.mcbbs.net/thread-1020516-1-1.html 注意二楼\nTPS好了，但现在问题是一按tab键补全命令 就会被闪退踢出，后台显示\nM_ILK lost connection: Internal Exception: io.netty.channel.unix.Errors$NativeIoException: syscall:read(..) failed: 连接被对方重设"
        },
        {
            "author": "炫宙菌",
            "timestamp": 1588302720,
            "txt_content": "q1030290917 发表于 2020-5-1 11:11\nTPS好了，但现在问题是一按tab键补全命令 就会被闪退踢出，后台显示\nM_ILK lost connection: Internal Ex ...\nspigot找到tab-complete: 改成4"
        },
        {
            "author": "q1030290917",
            "timestamp": 1588303260,
            "txt_content": " 本帖最后由 q1030290917 于 2020-5-1 11:24 编辑 \n炫宙菌 发表于 2020-5-1 11:12\nspigot找到tab-complete: 改成4\n不行，再tab还是闪退，我设置成-1也是闪退"
        },
        {
            "author": "apacheii",
            "timestamp": 1588326420,
            "txt_content": "q1030290917 发表于 2020-5-1 11:21\n不行，再tab还是闪退，我设置成-1也是闪退\n闪退时服务端的报错信息发来看看？"
        },
        {
            "author": "q1030290917",
            "timestamp": 1588326900,
            "txt_content": "apacheii 发表于 2020-5-1 17:47\n闪退时服务端的报错信息发来看看？我在Windows本地测试的时候，不会tab闪退，但是在Linux系统后台开，就会按Tab补全闪退\nM_ILK lost connection: Internal Exception: io.netty.channel.unix.Errors$NativeIoException: syscall:read(..) failed: 连接被对方重设 java.lang.IllegalStateException: Asynchronous Async Chunk Load! Blocking thread until it returns\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.MCUtil.ensureMain(MCUtil.java:54)\n[11:43:16 WARN]:        at org.bukkit.craftbukkit.v1_12_R1.chunkio.ChunkIOExecutor.syncChunkLoad(ChunkIOExecutor.java:18)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.ChunkProviderServer.getChunkAt(ChunkProviderServer.java:170)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.ChunkProviderServer.getChunkAt(ChunkProviderServer.java:153)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.ChunkProviderServer.getChunkAt(ChunkProviderServer.java:149)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.World.getChunkAt(World.java:357)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.World.getChunkAtWorldCoords(World.java:353)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.World.q(World.java:1453)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.EntityPlayer.getSpawnPoint(EntityPlayer.java:140)\n[11:43:16 WARN]:        at net.minecraft.server.v1_12_R1.EntityPlayer.<init>(EntityPlayer.java:105)\n[11:43:16 WARN]:        at net.craftersland.data.bridge.utils.nms.Version_1_12_R1.loadPlayer(Version_1_12_R1.java:135)\n[11:43:16 WARN]:        at net.craftersland.data.bridge.events.PlayerDisconnect$1.run(PlayerDisconnect.java:39)\n[11:43:16 WARN]:        at org.bukkit.craftbukkit.v1_12_R1.scheduler.CraftTask.run(CraftTask.java:64)\n[11:43:16 WARN]:        at org.bukkit.craftbukkit.v1_12_R1.scheduler.CraftAsyncTask.run(CraftAsyncTask.java:52)\n[11:43:16 WARN]:        at com.destroystokyo.paper.ServerSchedulerReportingWrapper.run(ServerSchedulerReportingWrapper.java:22)\n[11:43:16 WARN]:        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n[11:43:16 WARN]:        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n[11:43:16 WARN]:        at java.lang.Thread.run(Thread.java:748)"
        },
        {
            "author": "apacheii",
            "timestamp": 1588327320,
            "txt_content": " 本帖最后由 apacheii 于 2020-5-1 18:04 编辑 \nq1030290917 发表于 2020-5-1 17:55\n我在Windows本地测试的时候，不会tab闪退，但是在Linux系统后台开，就会按Tab补全闪退\nM_ILK lost connecti ...\npaper.yml里：\nsuggest-player-names-when-null-tab-completions: true\n改成\nsuggest-player-names-when-null-tab-completions: false\n试试。\n如果还是不行：\nserver.properties里的\nuse-native-transport=false  <- 这一项改一改试试"
        },
        {
            "author": "Matrixchung",
            "timestamp": 1588342980,
            "txt_content": "java.lang.IllegalStateException: Asynchronous Async Chunk Load!\n这似乎是某个低版本插件触发了同步锁导致的问题？"
        },
        {
            "author": "q1030290917",
            "timestamp": 1588345620,
            "txt_content": "Matrixchung 发表于 2020-5-1 22:23\n这似乎是某个低版本插件触发了同步锁导致的问题？\n能帮我具体看一下吗 发一下您的QQ"
        },
        {
            "author": "q1030290917",
            "timestamp": 1588345680,
            "txt_content": "apacheii 发表于 2020-5-1 18:02\npaper.yml里：\nsuggest-player-names-when-null-tab-completions: true\n改成\n还是不行"
        },
        {
            "author": "q1030290917",
            "timestamp": 1588647300,
            "txt_content": "apacheii 发表于 2020-5-3 00:55\n问题解决了没？\n你用的是原版paper核心吗？\n我仔细看了一下错误日志，发现问题应该是出自net.craftersland. ...\n能发下您QQ吗"
        }
    ]
}