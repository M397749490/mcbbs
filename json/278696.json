{
    "title": "我的插件工程计划 [ServerManager]",
    "author": "Johnny.R",
    "replyCount": 7,
    "timestamp": 1400857320,
    "txt_content": "我的ServerManager想要包括Essentials的全部功能并包括登陆等等\n包括插件管理enable和disable\n目前的工程是插件管理已经全部完成\n登陆基本完成\nMail系统正在编写\nRedfoxMail:\n支持邮递物品和经验值，邮递动物还有困难，我慢慢来\n\n登陆插件的基本指令都存在了:\nregister login unregister cpw等等等等\n\n注:\n我增加了一个EventListener来修改了stop指令执行时所发生的事情,这个指令将指向\"shutdown\"和\"_stop\",后者即将会删除\nreload也被重载了\n如果要调用原来的stop和reload请用\"bkp_stop\",reload暂不提供因为不正确的reload方式会导致玩家被踢出游戏被要求重新登录\n\"因为我的用户信息都出存在一个HashMap中\" reload会创建一个标志来载入当前玩家的Database来防止HashMap重置所导致的登录信息丢失\n\n有想法就跟我提出来吧 :D !\n\n我是初一的学生，平时时间比较紧，我的QQ是2213300958有想法可以来找我哟 :P\n(这是个大坑，毕竟只有我一个人，据说随时弃坑 :P)",
    "replies": [
        {
            "author": "可口可乐dseg",
            "timestamp": 1400857740,
            "txt_content": "这是神马东西，咱是电脑小白"
        },
        {
            "author": "shukui06",
            "timestamp": 1400858040,
            "txt_content": "大神，+俺扣扣。俺有问题的话就问问你"
        },
        {
            "author": "Johnny.R",
            "timestamp": 1400858700,
            "txt_content": " 本帖最后由 Johnny.R 于 2014-5-23 23:27 编辑 \n        public synchronized void load() throws IOException, DataFormatException\n        {\n                if(!file.exists())\n                {\n                        file.createNewFile();\n                        operator = new RandomAccessFile(file, \"rw\");\n                        operator.writeLong(0);\n                        operator.writeByte(0);\n                        return;\n                }\n                else\n                {\n                        if(operator.length()==0)\n                                return;\n                        \n                        long byte_length = operator.readLong();\n                        if(byte_length==0)\n                                return;\n                        \n                        ByteArrayOutputStream superbuffer = new ByteArrayOutputStream();\n                        long amount = 0;\n                        while(true)\n                        {\n                                if(amount>=byte_length)\n                                        break;\n                                \n                                byte[] buffer = new byte[1024];\n                                int len = (byte_length-amount>1024)?1024:(int)(byte_length-amount);\n                                operator.read(buffer, 0, len);\n                                superbuffer.write(buffer, 0, len);\n                                \n                                amount += len;\n                        }\n                        \n                        ByteArrayInputStream stream = new ByteArrayInputStream(superbuffer.toByteArray());\n                        InflaterInputStream inflater = new InflaterInputStream(stream);\n                        FileConfiguration config = YamlConfiguration.loadConfiguration(inflater);\n                        this.config = config;\n                        \n                        for(int i = 0; config.contains(\"mail.mark.\"+i); i++)\n                        {\n                                int type = config.getInt(\"mail.\"+i+\".data.type\");\n                                if(!config.getBoolean(\"mail.mark.\"+i))\n                                {\n                                        config.set(\"mail.mark.\"+i, null);\n                                        config.set(\"mail.\"+i+\"data.time\", null);\n                                        config.set(\"mail.\"+i+\"data.sender\", null);\n                                        config.set(\"mail.\"+i+\"data.message\", null);\n                                        switch(type)\n                                        {\n                                        case DataInstance.ItemPacket:\n                                                config.set(\"mail.\"+i+\".data.item.number\", null);\n                                                config.set(\"mail.\"+i+\".data.item.amount\", null);\n                                                config.set(\"mail.\"+i+\".data.item.enchants\", null);\n                                                config.set(\"mail.\"+i+\".data.item.lores\", null);\n                                                config.set(\"mail.\"+i+\".data.item.display\", null);\n                                                break;\n                                                \n                                        case DataInstance.ExpPacket:\n                                                config.set(\"mail.\"+i+\".data.exp.amount\", null);\n                                                break;\n                                        }\n                                }\n                                \n                                if(!config.contains(\"mail.\"+i+\".data.sender\"))\n                                        throw new DataLostedException(\"<SenderHead&\"+i+\">\");\n                                String sender = config.getString(\"mail.\"+i+\".data.sender\");\n                                \n                                if(!config.contains(\"mail.\"+i+\".data.message\"))\n                                        throw new DataLostedException(\"<Message&\"+i+\">\");\n                                String message = config.getString(\"mail.\"+i+\".data.message\");\n                                \n                                String time = \"unknown\";\n                                if(config.contains(\"mail.\"+i+\".data.time\"))\n                                        time = config.getString(\"mail.\"+i+\".data.time\");\n                                \n                                switch(type)\n                                {\n                                case DataInstance.MessageOnly:\n                                        store.putMail(new MessagePacket(sender, message, time));\n                                        break;\n                                        \n                                case DataInstance.ItemPacket:\n                                        if(!config.contains(\"mail.\"+i+\"data.item.number\"))\n                                                throw new DataLostedException(\"<ItemNumber&\"+i+\">\");\n                                        String item_number = config.getString(\"mail.\"+i+\".data.item.number\");\n                                        \n                                        int item_amount = 1;\n                                        if(config.contains(\"mail.\"+i+\".data.item.amount\"))\n                                                item_amount = config.getInt(\"mail.\"+i+\".data.item.amount\");\n                                        \n                                        ItemStack item = new ItemStack(Material.getMaterial(item_number), item_amount);\n                                        if(config.contains(\"mail.\"+i+\".data.item.enchants\"))\n                                        {\n                                                ItemMeta meta = item.getItemMeta();\n                                                List<String> enchants = config.getStringList(\"mail.\"+i+\".data.item.enchants\");\n                                                for(String str : enchants)\n                                                {\n                                                        String[] args = str.split(\"\\u00A7\");\n                                                        Enchantment enchantment = Enchantment.getByName(args[0]);\n                                                        int level = Integer.parseInt(args[1]);\n                                                        meta.addEnchant(enchantment, level, true);\n                                                }\n                                                \n                                                item.setItemMeta(meta);\n                                        }\n                                        \n                                        if(config.contains(\"mail.\"+i+\".data.item.lores\"))\n                                        {\n                                                ItemMeta meta = item.getItemMeta();\n                                                ArrayList<String> lores = (ArrayList<String>)config.getStringList(\"mail.\"+i+\".data.item.lores\");\n                                                meta.setLore(lores);\n                                                \n                                                item.setItemMeta(meta);\n                                        }\n                                        \n                                        if(config.contains(\"mail.\"+i+\".data.item.display\"))\n                                        {\n                                                ItemMeta meta = item.getItemMeta();\n                                                String display = config.getString(\"mail.\"+i+\".data.item.display\");\n                                                meta.setDisplayName(display);\n                                                \n                                                item.setItemMeta(meta);\n                                        }\n                                        \n                                        store.putMail(new ItemPacket(sender, message, item, time));\n                                        \n                                        break;\n                                        \n                                case DataInstance.ExpPacket:\n                                        if(!config.contains(\"mail.\"+i+\"data.exp.amount\"))\n                                                throw new DataLostedException(\"<ExpAmount&\"+i+\">\");\n                                        int exp = config.getInt(\"mail.\"+i+\".data.exp.amount\");\n                                        \n                                        store.putMail(new ExpPacket(sender, message, exp, time));\n                                        \n                                        break;\n                                        \n                                default:\n                                        throw new UnknownHeadException(\"<<HeadType&\"+type+\">&\"+i+\">\");\n                                }\n                        }\n                        \n                        if(operator.readByte()!=End)\n                                throw new DataEndNotFoundException(operator.getFilePointer());\n                }\n        }复制代码MailDatabase类的部分源码,load方法 :P\n\n缺点是这种邮件系统绝对不能发送MOD里的物品"
        },
        {
            "author": "zero28",
            "timestamp": 1400901480,
            "txt_content": "首先对一个如此庞大的工程给予鼓励。\n然而在我看来，这种工程拿来练练手，或者自己的服务器使用是一个不错的尝试。\n然而，这样糅合了多种功能的插件，在设计的方面感觉不是一个初一的学生能驾驭得了的。\n开发不仅仅要考虑能不能开发出来，还要考虑可维护性等问题。\n如果不能做到很好的解耦，你的插件一出致命bug估计你就要弃坑了。\n当然现在的小朋友是越来越厉害了╮(╯▽╰)╭所以如果你是很厉害的小朋友就无视我吧。\n以上。"
        },
        {
            "author": "咸鱼气功王",
            "timestamp": 1401369120,
            "txt_content": "zero28 发表于 2014-5-24 11:18\n首先对一个如此庞大的工程给予鼓励。\n然而在我看来，这种工程拿来练练手，或者自己的服务器使用是一个不错 ...\n再同意不过了。希望楼主加油"
        },
        {
            "author": "CQ987654",
            "timestamp": 1401369900,
            "txt_content": "authme的一个email系统很好，注册时输入邮箱地址，忘记密码发送过去。。所以我建议lz研究下"
        },
        {
            "author": "Csgbshgf",
            "timestamp": 1405080960,
            "txt_content": "这太巧了\n我写的一个群组管理软件居然和你重名了\n= ="
        }
    ]
}