{
    "title": "[Java/Spigot]求助大佬",
    "author": "1252251361",
    "replyCount": 2,
    "timestamp": 1584425640,
    "txt_content": "先放代码吧：代码有点长，还请大佬们耐心看一下！\nFormatClass：\npublic static List<String> parse(List<String> sort, List<String> text, String formatData) {\n        List<String> vsort = sort;\n        String vtext = destroyStringList(\"|\",text);\n\n        int formatSplitCount = 0;\n\n        Map<String,String> map = new HashMap<>();\n        if (formatData.contains(\"|\")) {\n            String[] formatsplit = formatData.split(\"\\\\|\");\n            for (int i=0;i<formatsplit.length;i++) {\n                String[] a = formatsplit[i].split(\":\");\n                map.put(a[0],a[1]);\n            }\n            formatSplitCount = formatsplit.length;\n        }else {\n            String[] a = formatData.split(\":\");\n            map.put(a[0],a[1]);\n            formatSplitCount = 1;\n        }\n\n        for (Map.Entry<String,String> entry : map.entrySet()) {\n            for (int i=0;i<vsort.size();i++) {\n                if (vsort.get(i).equalsIgnoreCase(entry.getKey())) {\n                    vsort.set(i,entry.getValue());\n                }\n            }\n        }\n        String[] strings = vsort.toArray(new String[10]);\n        vtext = String.format(vtext, (Object[]) strings);\n\n        if (text.size() == 1) {\n            return new ArrayList<>(Collections.singletonList(vtext));\n        }else {\n            return reBuildStringList(\"\\\\|\",vtext);\n        }\n\n    }\n    public static String destroyStringList(String split, List<String> object) {\n        String cache = \"\";\n        for (int i=0;i<object.size();i++) {\n            if (i == object.size()-1) {\n                cache = cache + object.get(i);\n            }else {\n                cache = cache + object.get(i) + split;\n            }\n        }\n        return cache;\n    }\n    public static List<String> reBuildStringList(String split, String text) {\n        String[] sp = text.split(split);\n        return new ArrayList<>(Arrays.asList(sp));\n    }复制代码主类onEnable()：\nSystem.out.println(ParseFormat.parse(RedPackMain.dataStorage.getPublic_rptimer_sort(),RedPackMain.dataStorage.getPublic_rptimer(),\"[timer]:3\"));\nSystem.out.println(ParseFormat.parse(RedPackMain.dataStorage.getPublic_rptimer_sort(),RedPackMain.dataStorage.getPublic_rptimer(),\"[timer]:2\"));复制代码getPublic_rptimer_sort()与RedPackMain.dataStorage.getPublic_rptimer()获取出来的是List<String>对应下面的配置文件：\npublic_rptimer:\n    sort:\n      - '[timer]'\n    msg:\n      - '++++++倒计时！%s'复制代码\n代码如上，运行到onEnable里时，并不是输出++++++倒计时！3/2/1 而是3次++++++倒计时！3\n检查过了，parse方法的sort还是第一次的，并没有被重置。\n不知道是不是我的代码有问题，先在此谢谢大佬的回答！\n\n\n\n",
    "replies": [
        {
            "author": "a1294790523",
            "timestamp": 1584430620,
            "txt_content": " 本帖最后由 a1294790523 于 2020-3-17 15:39 编辑 \n\n虽然不知道你这堆代码不知道想要干嘛，但是原因是很清楚的\n方法传入的时候传入的是实例的引用，所以你修改的时候也会修改实例本身\n所以在开始的时候把传入的list复制一份即可，就像这样：\nList<String> vsort = new ArrayList<>(sort);复制代码\n另外请不要在循环内使用+连接字符串，而是使用stringBuilder的append的方法进行连接，因为编译的时候会自动使用stringbuilder优化字符串连接的性能，而且这在循环里会引发性能问题：\njava内字符串是不可变对象，当你用+连接字符串的时候会创建新的字符串对象，所以会在编译期自动使用stringbuilder连接来优化例如下面代码的性能：\nString str=\"这\"+\"是\"+\"连接\"+\"字符串\"复制代码\n会变成\nString str=   new StringBuilder(\"这\").append(\"是\").append(\"连接\").append(\"字符串\").toString();复制代码\n但是编译器并不聪明，当你在循环里面用+操作的时候会是这样的：\n    \nList<String> strList=Arrays.asList(\"这\",\"是\",\"连接\",\"字符串\");\nString cache = \"\";\n        for (int i = 0; i < strList.size(); i++) {\n            cache = cache + strList.get(i);\n }\n复制代码\n会变成\n    \nList<String> strList=Arrays.asList(\"这\",\"是\",\"连接\",\"字符串\");\nString cache = \"\";\n        for (int i = 0; i < strList.size(); i++) {\n            cache =new StringBuilder(cache).append(strList.get(i)).toString();\n }\n复制代码\n这会重复创建对象，造成性能问题，所以请手动使用StringBuilder"
        },
        {
            "author": "1252251361",
            "timestamp": 1584458700,
            "txt_content": "a1294790523 发表于 2020-3-17 15:37\n虽然不知道你这堆代码不知道想要干嘛，但是原因是很清楚的\n方法传入的时候传入的是实例的引用，所以你修改 ...\n解决啦，谢谢大佬的回复！"
        }
    ]
}