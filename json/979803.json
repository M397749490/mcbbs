{
    "title": "关于对1.15.2的优化 寻求帮助",
    "author": "梦~",
    "replyCount": 6,
    "timestamp": 1583642340,
    "txt_content": " 本帖最后由 Menzor 于 2020-3-8 13:28 编辑 \n\n在这里想对我服务器的优化寻求帮助。\n服务器用的是 1.15.2 的paper端 目前是最新构建版 #129\n主机采用的是 I9 9900K 独立主机 目前开了6个端 生存2个 大厅1个 地皮1个 资源1个 BC1个\n很让我奇怪的是在 60人在线时 我服CPU占用居然能高达 80% 有时能把CPU吃满\n当时看到有人说 1.15.2 的优化会比1.15.1做得好\n我以为可能是我paper端的版本太低 于是我就把服务器从1.15.1 版本提升到了1.15.2\n也就是构建版本从#61提到了#129 但是我发现我CPU占用并没有什么变化...\n很让我好奇的就是 我朋友开了三个端 分别是 大厅 空岛 BC 相同配置他20人在线居然CPU占用仅6-10% （基本没高于10%过）\n我对比了一下我们Bukkit spigot paper 三个文件设定我很多都比他设置的低...但是CPU占用却是他8倍\n原因我是真的没找到... 很让我头疼\n希望能得到各位友人的一些帮助...\n\n附带一些配置文件\n\n\n\nserver.yml\n(1004 Bytes, 下载次数: 1)\n\n\n\n2020-3-8 12:33 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n\nspigot.yml\n(3.53 KB, 下载次数: 4)\n\n\n\n2020-3-8 12:32 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n\npaper.yml\n(5.18 KB, 下载次数: 1)\n\n\n\n2020-3-8 12:32 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n\nbukkit.yml\n(1.03 KB, 下载次数: 4)\n\n\n\n2020-3-8 12:32 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n生存1区\ntimings https://timings.aikar.co/?id=56f30463772a43cdad3d838828230556\nspark https://sparkprofiler.github.io/#jpOlkds9zT\n\n生存二区\ntimings https://timings.aikar.co/?id=501ed6de1329415bbef1c03d504b9b8f\nspark https://sparkprofiler.github.io/#PXsNLxBJBl\n再加一个二区timings\nhttps://timings.aikar.co/?id=1e3ec1375e2d4899beca12d3c14c30fe\n\n\n（这个timings 是全服人数在40左右测试的 可能没有什么太大用处 我会在人数到峰值时重新测量并上传 ）\n\n\n",
    "replies": [
        {
            "author": "EmptyLava",
            "timestamp": 1583642340,
            "txt_content": " 本帖最后由 EmptyLava 于 2020-3-8 13:06 编辑 \n\n\n\n我知道楼主想问为何cpu占用那么高，但是影响cpu占用的原因有很多种，主要目的难道不是为了tps高，让玩家获得更好的游戏体验吗?而现在tps是20,不就满足了要求吗\n\ncpu占用率的对比没有意义，占用率高而tps满反而能说明性能利用率高\n\n\n我只能帮你分析原因\n生存1区:\n1.这个一方面是区块卸载的监听事件\n2.另一方面是实体(主要为烈焰人)\n生存2区:\n1.QuantumRPG的事件占用\n2.玩家交互事件(主要是PacketPlayInUseEntity)，生存1服也有这个事件而且占用也很严重，基本上限制不了\n优化建议:\n1.选择linux系统吧，linux的利用率更高，cpu可能会降\n\n"
        },
        {
            "author": "梦~",
            "timestamp": 1583644320,
            "txt_content": " 本帖最后由 Menzor 于 2020-3-8 13:15 编辑 \nEmptyLava 发表于 2020-3-8 12:48\n我知道楼主想问为何cpu占用那么高，但是影响cpu占用的原因有很多种，主要目的难道不是为了tps高，让玩家 ...\nemmm... 我目前的状况是 CPU占用率很高 且 TPS 人数多的时候会变低\n例如 60人在线 二服tps会在12-15波动 然后CPU占用都不满....\n这点就很头疼 想降低CPU占用率主要是想开三服分流 怕开了三服CPU占用满了= = 更卡\n\n请问有推荐的限制实体的插件吗 我现在用是SAML和 MobFarmManager\n之前也买过其他方面优化插件 比如 Lagassist 装上去感觉是负优化又卸载了\n感觉目前的配置完全足够我带动服务器 可是不知道问题出在哪里\n目前视距是 5 感觉不能再低了 再低对玩家就不够友好了\n\nhttps://timings.aikar.co/?id=1e3ec1375e2d4899beca12d3c14c30fe\n这是我刚刚测试的 2服timings 这时TPS已经开始波动了 希望能帮忙看看"
        },
        {
            "author": "xmdhs",
            "timestamp": 1583647140,
            "txt_content": "Menzor 发表于 2020-3-8 13:12\nemmm... 我目前的状况是 CPU占用率很高 且 TPS 人数多的时候会变低\n例如 60人在线 二服tps会在12-15波动  ...\n调低 server.properties 中 network-compression-threshold 的数字试试呢"
        },
        {
            "author": "EmptyLava",
            "timestamp": 1583647740,
            "txt_content": " 本帖最后由 EmptyLava 于 2020-3-8 14:12 编辑 \nMenzor 发表于 2020-3-8 13:12\nemmm... 我目前的状况是 CPU占用率很高 且 TPS 人数多的时候会变低\n例如 60人在线 二服tps会在12-15波动  ...\n\n1.15.2暂时没有很好的插件来优化实体，而且我觉得你服务器内的实体优化很不错了，但是漏斗这种方块实体还需要优化(pct tick大概18%,有生物占用的一半多了),如果你真的需要实体优化插件可能我只能推荐Yasui了\n\n我觉得占用还是主要来自这个事件\n\nMinecraft::Packet - PacketPlayInUseEntity\ncount(2988)  \n\n但是这似乎是个玩家交互事件...没有什么好方法来降低\n另外此时的tps虽然波动了一点但还是很高\n\n你可以向spigot开发者询问这个事件，另外spigot官网的event list应该解释了这个事件\n"
        },
        {
            "author": "GiNYAi",
            "timestamp": 1583691780,
            "txt_content": "启动的脚本（主要是GC的部分）有对比过么"
        },
        {
            "author": "梦~",
            "timestamp": 1583757660,
            "txt_content": "xmdhs 发表于 2020-3-8 13:59\n调低 server.properties 中 network-compression-threshold 的数字试试呢\nemmm... 因为的BC用的内网 所以那个设置的是-1"
        }
    ]
}