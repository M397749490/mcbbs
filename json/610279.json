{
    "title": "插件VariableTriggers实例讲解",
    "author": "tiz",
    "replyCount": 9,
    "timestamp": 1469558700,
    "txt_content": " 本帖最后由 tiz 于 2016-8-1 14:04 编辑 \n\n插件地址：bukkit  下载地址本帖仅适用于插件版本v2.0之前的版本（不包括v2.0），即游戏版本1.8之前的版本（不包括1.8）。\n原因是v2.0之后的版本更新了指令的格式，以及在实际测试时出现了或大或小的bug。\n\n\n\n\n简单介绍\n\n    这个插件可以说是ScriptBlock的更加灵活的版本，增加了更多的触发方式、判定和脚本。当然相对来说使用难度也提升了很多。\n    也就是通过创建一些触发器来执行脚本。我这里只做一些简单的介绍，以及对实例中用到的东西做稍微详细的介绍。更详细的内容请查阅插件的bukkit页面\n\n\n    触发器的触发方式包括\n        敲击某个方块(click)【/vtc [脚本行]】来创建\n        经过某个方块(walk)【/vtw [脚本行]】来创建\n        进入或离开某个区域(area)【/vta [区域名] [enter或exit] [脚本行]】来创建（已创建vt区域的前提下）\n        输入一条自定义的指令(command)【/vtcmd  [指令] [脚本行]】来创建\n        发生了某个事件(event) --包括玩家进入游戏 离开游戏 死亡 重生 破坏方块 放置方块 生物死亡等【/vte [事件] [脚本行]】来创建\n\n    脚本的种类就非常多了，比如\n        传送到坐标0 65 5，并且面朝北仰角45°（@TP 0,65,5 180 -45），\n        在坐标0 64 0设置一个岩浆（@SETBLOCK 11 0,64,0），\n        在触发该脚本的玩家的公屏上显示一行字（@PLAYER &e这个破服一点意思都没有对吧？），\n        公告一条信息（@BROADCAST &6这个世界需要更多英雄！所以本破服即将永久关闭，各位小王八蛋们再见！），\n        以OP的权限执行一条指令（@CMDOP save-all）\n        以控制台执行一条指令（@CMDCON stop）\n        最为强大的条件判断脚本（@IF @OR @AND,@ELSE, @ENDIF）\n        十分方便的执行后台编辑的脚本文件中的脚本（@CALL ）后台yml文件建议使用notepad++打开\n\n    占位符可以在脚本里面用于\n        代替一串字符str（比如玩家名<playername>所在世界名<worldname>），例：创建了一个脚本【@PLAYER 你叫<playername>，你在<worldname>】 一个叫magicbear的玩家，在主世界触发了这个脚本的话，他就会得到一条【你叫magicbear，你在world】这样的信息。\n        或者代替数字int（比如玩家血量<health:>，从0到114中随机一个数字<random0to:114>，从1到514中随机一个数字<random1to:514>），\n        或者代替位置数（也是属于一串字符str）（比如玩家所在的坐标<playerloc>，触发器的坐标<triggerloc>），\n        或者代替真假判断的结果，也叫bool值（比如玩家触发这个脚本时是不是按住shift行走<issneaking:>，触发这个脚本的玩家身上够不够四百五并拿走\n<takemoney:<playername>:450>）\n\n    自定义变量  格式为$obj.var \n        一个变量也是包含三种格式的值（str int bool），主要配合一些控制变量的脚本使用在条件判断脚本中。\n        当一个变量的值没有被设定的时候，str默认为null，int默认为0，bool默认为false。   \n\n\n\n\n\n实例介绍：深受bilicraft玩家喜爱的(并不)  玩梗系统\n\n功能介绍：没有什么实际用途，仅仅是让玩家输入一条由管理自定义的指令，来播放一条恶搞公告的娱乐功能。\n        虽然比较简单，不过为了方便管理，设置了各种各样的使用条件\n        【设置了一个总开关，设置了仅在主世界(world)才能使用的判定，设置了带有提示的冷却(插件自身的@COOLDOWN脚本是不带有提示的)】\n        所以也用到了简单的条件判定语句，以及后台编辑脚本文件的方法。这两点是本帖主要想介绍的功能\n        除了玩梗的指令以外，还设置了一些便于管理和查阅梗的指令。\n\n\n用到的创建触发器的指令：\n    /vtcmd [指令] [脚本行]   \n    创建一个指令触发器  \n    例：/vtcmd test @PLAYER 这是一条测试指令。\n    创建一个指令为test的指令触发器，触发后执行的内容是给触发者一条“这是一条测试指令”的信息\n    再输入/test就能看到\n    \n    上面会出现一条Unknown command.的原因是，vt创建的指令，默认是与服务器原有指令共同存在的，当然我们也可以用下面一条指令把它去掉。\n\n    /vtcmdo [指令] [true或false] \n    设置一个已创建的指令是否覆盖服务器原有指令  \n    例：/vtcmdo test true\n    把服务器原有指令覆盖掉，再输入/test就能看到上面一条指令就能看到已经不会再出现未知指令的提示了。    后面的讲解中不在赘述。\n    \n\n    /vtcmdv [指令]\n    查看一条创建的指令执行的所有脚本行\n\n    /vtcmde [指令] [序号] [脚本行]    修改一条创建的指令中的某一条脚本行\n\n    /vtcmdr [指令]\n    删除一个指令触发器  \n    例：/vtcmdr test  删除test指令\n\n    /vtcmdp [指令] [节点]\n    设置一个已创建的指令所需要的权限节点 （名字也是随便起），不设置的话默认为所有人都可以使用该指令。\n    例：/vtcmdp test bilicraft.test\n    为test指令设置一个权限节点 bilicraft.test 。配合groupmanager【/manuaddp 玩家id bilicraft.test】或者pex【/pex user add bilicraft.test】都可以进行管理。当然这个节点也被【bilicraft.*】节点以及【*】节点所包含。\n\n\n用到的脚本\n    【@PLAYER [文本内容]】----------给触发者一条信息。\n    【@BROADCAST [文本内容]】----公告一条信息。\n    【@PAUSE [秒数]】----------------暂停一定时间后再继续执行脚本\n    【@IF、@ELSE、@ENDIF】-------条件判定脚本\n    【@CMD [指令内容]】-------------以触发者自身现有的权限执行一条指令\n    【@SETBOOL】---------------------设置一个变量的bool值 （用法：@SETBOOL [$obj.var] [true或false]）\n    【@CALL】 -------------------------读取脚本文件中的脚本（用法：@CALL [文件名:脚本名]）\n    【@PRINT [文本内容]】---------可以在控制台上写上一行内容，主要用于记录。\n\n\n用到的占位符\n    <playername>   代替触发者的名字 str值\n    <worldname>    代替所在世界的名字 str值\n    <cmdarg:1>      仅用于指令触发器 str值  代替一条复数的指令中紧跟着第一个指令的指令(绕)，例：/res tp a2这条指令中，<cmdarg:1>=tp，<cmdarg:2>=a2\n    <cmdargcount> 仅用于指令触发器 int值 代替一条复数指令中后面跟了几条指令，用上面的例子来说tp是1个，a2是1个，所以这里的<cmdargcount>=2\n    <var:$obj.var>  在条件判定脚本和控制变量脚本中可以直接使$obj.var，除此以外的脚本中，需要给变量套一个<var:>的马甲才能代替里面的值。str值或int值\n\n\n\n\n实例操作\n在bilicraft中，设置了3个条件。【玩家是否在主世界(world)，禁用开关是否打开，是否处于冷却】有3个条件的话就较为复杂了，先从简单的开始讲起。\n\n抛开这3个条件的话，创建一个指令来触发一个公告的脚本是非常简单的，只需要1个脚本行就可以实现。\n拿一个今年年初还比较火的一个梗来举例：\n\n\n\n\n这里我们用dmxs作为指令，说的话也照搬，/vtcmd dmxs @BROADCAST &2<playername>&e「我即使是死了，钉在棺材里了，也要在墓里，用这腐朽的声带喊出：冬马小三！！！」复制代码再使用/vtcmdo dmxs true复制代码\n把覆盖设置为true，用来解决出现Unknown command.的提示。就可以输入/dmxs来看一下效果了。\n\n\n这样一个简单的玩梗指令就完成了。\n\n条件判断\n我们仍然先讲在游戏内直接输入指令来创建触发器添加脚本的方法。如果要使用一个完整的条件判断的话，一个触发器将会最少拥有5个脚本行。在讲这个之前，如果你跟着上面的讲解一起试着做了一遍也创建了一个dmxs的指令的话，就要先把这个指令移除/vtcmdr dmxs复制代码因为触发器执行脚本是按顺序进行的，而且这个【顺序】是与输入指令添加脚本的顺序相同的。\n所以如果要使用带有条件判断的脚本的话，基本上都是先给触发器添加一个@IF的脚本作为开头。\n\n拿一个完整的条件判断脚本【触发时玩家所在的世界是否为主世界world】作为示例来讲，创一个这样的脚本需要5条指令：/vtcmd dmxs @IF s <worldname> = world\n/vtcmd dmxs @BROADCAST &2<playername>&e「我即使是死了，钉在棺材里了，也要在墓里，用这腐朽的声带喊出：冬马小三！！！」\n/vtcmd dmxs @ELSE\n/vtcmd dmxs @PLAYER 玩梗只能在主世界使用。\n/vtcmd dmxs @ENDIF\n\n查看dmxs这个指令包含了哪些脚本/vtcmdv dmxs复制代码\n\n\n一个完整的条件判断脚本，需要包含@IF @ELSE @ENDIF\n@IF的格式为 @IF [s/i/b] [一个值] [>/</=/>=/<=/><] [另一个值]\n其中  [s/i/b]是指要判断的值的属性 s=str值 i=int值 b=bool值\n         [>/</=/>=/<=/><] 两个值的关系(不是颜文字)，除了大于小于等于以外也可以用【不小于(大于等于)】【不大于(小于等于)】【不等于】\n也可以简单的理解为 @IF [要判断的值的属性] [一个式子]\n当这个式子成立的时候，将会执行【@IF】与【@ELSE】之间的脚本(可以是多个脚本行)，如上图的【2】\n当这个式子不成立的时候，将会执行【@ELSE】与【@ENDIF】之间的脚本(可以是多个脚本行)，如上图的【4】\n\n\n在这个示例中就是：判断所在的世界是不是world，是就执行公告，不是的话就提示玩家这里不可以。(感觉好色情)\n\n\n跑去地狱试一下\n\n\n\n这样一个完整的条件判断脚本就完成了。\n\n对于一些比较简单的不需要经常修改的脚本，完全可以在游戏内使用指令完成。\n但是对于一些比较复杂的，条件判断用的比较多导致脚本行非常多的脚本，一旦出现漏打一行脚本的失误，可能就要修改大部分脚本行甚至重新输入。\n而且mc本身输入栏的长度有限，万一需要输入超过输入栏长度的脚本行的话，就不能通过在游戏内直接输入指令的方法来添加脚本。\n这时候就要用到后台编辑脚本文件的方法。\n\n\n\n编辑脚本文件\nv1版本的vt插件在安装之后生成的VariableTriggers文件夹中，会生成一个example.script.yml文件，（使用notepad++打开)\n这是一个脚本文件的示例。里面有2个示例脚本，以及说明文字和一些注意事项。建议看一下里面的注意事项。\n\n要创建一个自己的脚本文件的话，推荐的方法是复制example.script.yml这个文件，并把它重命名为[脚本名.script.yml]。\n这里我们拿玩梗系统来做示例，重命名为 geng.script.yml  。\n再把里面【#】开头的说明文字全部删除，修改脚本并保留带有最低限度的脚本和脚本内容\n完成之后可以将其保存，再复制一份更名为sample.script.yml作为样本，这样以后创建新的脚本文件时直接复制样本就可以了。\n\n当然也可以创建一个txt文件，将其改名为xxx.script.yml，再把上面的内容严格按照相同的格式输入到里。\n但是如果这个框架部分输入的格式有一点微小的偏差的话，就会导致整个脚本文件无法被服务器读取。\n所以比较推荐上面的复制example.script.yml的方法。\n\n注意事项：在要增加脚本行的时候，由于notepad++默认是有一个自动缩进的功能，然而自动缩进会导致格式出错。解决方法是要么在设置里把自动缩进功能关闭，要么每次换行之后按一下退格键把自动缩进的那段给删掉再敲4个空格到与上一行对齐。\n\n下面来看两个玩梗系统中两个完整实例\n\n（顺便一提，碧玺是指BiliCraft，BiliCraft→BC→碧玺，碧玺是由B站提供服务器，玩家自主运营管理的服务器）\n\n最上面的【nianshi】是脚本名，为了方便观察和管理操作，建议把脚本名直接命名为指令名称。（游戏内想用/nianshi的话，这里就取名nianshi）\n在这个脚本中的红色框框标示的部分可以看出，一个完整的条件判断脚本是可以插入到别的条件判断脚本中的，\n而且这个被插入的脚本还可以再插入别的脚本中。（百！人！连！体！）\n前提是，必须是一个完整的条件判断脚本，要注意如果漏掉了@ELSE或者@ENDIF，就会导致关系错乱，达不到想要的效果。\n每个脚本行开头的【-】和【'】之间的空格数量是没有要求的，这里使用空格调整缩进距离是为了方便观察。\n\n\nnianshi脚本中，最内的红色框框内是一个冷却时间的脚本。这里有个小技巧，使用的自定义变量是$gengcd.<playername>以玩家名来创建的变量。\n这样每个玩家计算冷却用的变量都是这个玩家特有的，也就是说每个玩家各自计算自己的冷却时间。\n【@PAUSE <var:$geng.cd>】这一行其实完全可以直接写一个数字上去【@PAUSE 10】，\n    但是为了方便在游戏内就可以随时管理，就使用了变量。游戏内可以使用指令【/vt setint [obj] [var] [数字]】来管理，这里我们用\n/vt setint geng cd 10复制代码这是通过vt自带的指令去修改变量，而不是通过脚本来控制。\n同理，也可以直接使用指令来修改$geng.jinyong的bool值，【/vt setbool [obj] [var] [true或false]】\n如果觉得指令长输入起来很麻烦，也可以创建一个简化操作的脚本。这里就是使用脚本来控制变量了。\n\n\n这两是属于管理用的指令，为了避免不必要的麻烦，创建指令后务必要给此类指令设置一个权限节点。比如：\n/vtcmdp gengkaiguan vt.gengkaiguan复制代码设置了权限节点的指令，op以及*权限都是默认拥有这些权限的。\n另外，由于这些脚本本身不会在控制台做出记录，所以使用@PRINT来记录谁在什么时候使用了这些指令。也是为了避免不必要的麻烦。\n\n\n\n脚本文件编辑完成后，保存，输入/vt reloadscripts（简化：/vt rs）可以重载脚本文件，让新更改的脚本生效。\n如果顺利加载，服务器控制台会提示xx Scripts from xx files loaded.\n如果你编辑的脚本格式有误的话，会提示你某某文件第几行出现了错误，认真排查修正保存再尝试重载就可以了。\n\n顺利重载之后，在游戏内只需要一个【@CALL [文件名:脚本名]】就可以读取这个脚本了。\n这个实例中，文件名只需要取其中的【geng】，脚本名【nianshi】即可\n/vtcmd nianshi @CALL geng:nianshi复制代码\n当然也可以制作一个简化操作的脚本。\n\n\n\n这两个也是属于管理用的指令，为了避免不必要的麻烦，创建指令后务必要给此类指令设置一个权限节点。比如：\n/vtcmdp addgeng vt.addgeng复制代码\n另外关于【shuaidao】这个脚本，是一个衍生的玩法，将<cmdarg:1>添加到公告中，增加了灵活性。\n由于没有对<cmdarg:1>的内容做限制，所以你可以随意输入你觉得有趣的内容。比如【/shuaidao 妹妹的大鸡鸡】\n\n有兴趣的可以仔细看一下，相信上面讲的这些如果能明白的话，肯定都能看懂的。如果有不懂的地方可以回复。\n\n最后，我们再制作一个/genglist就完成了。\n\n\n要添加新的梗的话，也只需要把上面这些实例当成模板复制一下改里面的内容就可以了。\n除了一些常见的二刺缘梗以外，如果你的服务器特有文化比较出众的话，也都是可以随意加到梗里面的。\n比如：\nBiliCraft和**bbs服中都可以用：XXXX高喊着「我为[碧玺/**BBS]立过功！我为[碧玺/**BBS]流过血！你们不能这样对我！我要见熊姐！我要见熊姐！」\n*川中可以用：23****A又在群里发了一个可观的红包，可惜XXX只抢到了0.01元。\nct****rk中可以用：Li*tleB**r抛弃了r*m带着他的服务器跑啦！XXX没有办法只好拿建筑抵工资！\n\n以上就是BiliCraft玩梗系统的全貌啦！\n\n本帖主要通过介绍vt插件的一个非常奇葩的玩法，来介绍它的基本用法。\n正常来讲，这个插件是做一些传送，兑换，商店，任务，rpg副本之类。\n比如一个迷宫的终点有一个门，进去之后需要判断条件是否满足才能传送到下一关的区域，不满足就传送到起点。\n这个条件可以是在迷宫某处触发一个按钮，或者获得了某个物品……\n还可以在迷宫内随便找几个点做一些概率的定向传送，或者随机往某几个点中的一个点传送……\n以后有时间有心情可能会更新别的详细点的实例。\n\n总之这个插件非常灵活，你可以到插件的bukkit页面去了解更多的脚本及其用法。\n\n如果你有什么有趣的实例也欢迎在本帖分享。\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "147125403",
            "timestamp": 1469653860,
            "txt_content": "你好我想请问一下VT2.0版本之后的event怎么使用，貌似是需要/vte add xxx 但是我看了一下文件里的格式完全不同了，event完全不会使用了.."
        },
        {
            "author": "KTR",
            "timestamp": 1469670060,
            "txt_content": "貌似比搬运帖写的要更加贴切，此贴应该会火，希望楼主继续更新！"
        },
        {
            "author": "tiz",
            "timestamp": 1469894820,
            "txt_content": "147125403 发表于 2016-7-28 05:11\n你好我想请问一下VT2.0版本之后的event怎么使用，貌似是需要/vte add xxx 但是我看了一下文件里的格式完全 ...\nv2版本的我还没试过event   其他4个感觉无效的脚本很多，直接放弃了。 还有添加的触发器莫名其妙消失，cmd的override失效，各种各样的问题  只能等插件更新了。"
        },
        {
            "author": "tiz",
            "timestamp": 1470039600,
            "txt_content": "20160801更新。"
        },
        {
            "author": "Xiongmaos",
            "timestamp": 1470062340,
            "txt_content": "方舟小熊护卫大队小分队队长前来向你讨命！"
        },
        {
            "author": "147125403",
            "timestamp": 1470160260,
            "txt_content": "tiz 发表于 2016-7-31 00:07\nv2版本的我还没试过event   其他4个感觉无效的脚本很多，直接放弃了。 还有添加的触发器莫名其妙消失，cm ...\n之前有人告诉过我方法来着..证明是很好用的，而且除了<playername>，其他的也可以多次嵌套了.."
        },
        {
            "author": "qq307198081",
            "timestamp": 1475329680,
            "txt_content": "更新之前学了好几天才学会，\n\n更新之后更完蛋了，触发器不会用了。。。。求教\n\n我想设置一个 击杀怪物触发脚本的触发器 但是一直不行，是这样输入的指令\n\n/vte add EntityDeath ceshi:ceshi1\n\n我有一个写好的脚本叫ceshi，脚本行叫ceshi1  这样在我击杀怪物后并不能执行。\n\n我用/vt run ceshi:ceshi1就能执行，求教~！！"
        },
        {
            "author": "tiz",
            "timestamp": 1477146660,
            "txt_content": "qq307198081 发表于 2016-10-1 21:48\n更新之前学了好几天才学会，\n\n更新之后更完蛋了，触发器不会用了。。。。求教\n是不是少了个@CALL...\n/vte add EntityDeath @call ceshi:ceshi1"
        },
        {
            "author": "qq307198081",
            "timestamp": 1477189680,
            "txt_content": "tiz 发表于 2016-10-22 22:31\n是不是少了个@CALL...\n/vte add EntityDeath @call ceshi:ceshi1\n试过这个指令，依然不能被触发"
        }
    ]
}