{
    "title": "█某(并不)正经的BungeeCord插件开发教程█ 3",
    "author": "erry64",
    "replyCount": 3,
    "timestamp": 1534487040,
    "txt_content": " 本帖最后由 berry64 于 2018-8-26 00:33 编辑 \n\n进入目录\n\nChapter 3CustomPayload, PluginMessage, 以及BC&服务端插件之间的通讯 Part II\n\n发送PluginMessage的正确姿势在上一个章节中我介绍了监听PluginMessage的方法和注册频道的方法，所以在本篇里将介绍从bc里向一个指定频道发送消息。\n和读取byte[]信息同理，我们这里发送的也是byte[]信息，而且在java里有很多种方法可以转化我们的信息至字节组，但是为了方便操作这里我们将会继续使用Google Guava 的ByteArrayDataOutput类来进行操作\n\n在上篇里介绍过了Server和ServerInfo类，也解释了类里的一部分方法，而感谢BC对于PluginMessage的支持，我们如果要发送一条PluginMessage到指定服务器只需要这样操作:\n首先，先创建一个ByteArrayDataOutput:ByteArrayDataOutput data = ByteStreams.newDataOutput();复制代码之后再用各种方法写入这个数组.... 至于具体怎么写入，需要看这个PluginMessage的目的\n\n之后用我们获取的ServerInfo来直接发送:ServerInfo.sendData(\"频道\", data.toByteArray());复制代码是不是超级简单? =w=\n\n关于如何以正确姿势写入ByteArrayDataOutput:\n[spoiler] 首先，你需要确定你需要发送的数据和该数据类型，然后再使用适应的方法写入data。\n数据类型方法UTF字符串data.writeUTF(String);Int数字data.writeInt(int);double数组data.writeDouble(double);boolean值data.writeBoolean(bool);float数字data.writeFloat(float);以此类推\n\n举个栗子:\n这里我们的数据包需要包含以下数据:  玩家名字 玩家编号 玩家坐标x,y,z\n, 那么假设这个玩家的名字叫Steve, 玩家编号为0，坐标依次为123.0, 72.5, -120.32\n那么我们可以这样写数组: 代码:                                                                - □ ╳ServerInfo si = BungeeCord.getInstance().getPlayer(\"Steve\").getServer().getInfo();       \n//获取玩家所在的服务器的serverinfo\ndouble posx, posy, posz;        //假设这里都定义好了\nByteArrayDataOutput data = ByteStreams.newDataOutput();\ndata.writeUTF(\"Steve\");          //先写入玩家的名字，以utf编码\ndata.writeInt(0);                    //再写入玩家的数字id\n\ndata.writeDouble(posx);\ndata.writeDouble(posy);\ndata.writeDouble(posz);\n//注意这里的位置和顺序是有关系的\n\n//之后我们直接发送\nsi.sendData(\"MyChannel\", data.toByteArray());\n> _这样，我们的一个包就发送完毕了\n\n\n接收PluginMessage的正确姿势在上一章节中，我介绍了如何在各个核心接受数据，那么相信看了上面的各种write方式大概也能猜出来上一章节中所写到的ByteArrayDataInput data如何使用了吧。\n比如如果我们确定发送的时候第一行数据是UTF格式的字符串，那么我们就可以直接使用data.readUTF();复制代码来获取这个值，其他类型的也同理，说的简单点就是你发送数据的时候是 write[什么] 读取的时候就是 read[什么]\n\n同楼上的栗子： 代码:                                                                - □ ╳ByteArrayDataInput data = ByteStreams.newDataInput(message);\n\nString PLAYER_NAME = data.readUTF();\nint PLAYER_ID = data.readInt();\ndouble PLAYER_X = data.readDouble();\ndouble PLAYER_Y = data.readDouble();\ndouble PLAYER_Z = data.readDouble(); \n\n/*这时候你可能发现了为什么这三个都是一样的，不会读错吗？这是因为他们的顺序，在我们发送数据的时候依次是x,y,z 所以接受的时候也保留了这个顺序，所以像这样读取会读取出三个不同的double*/\n> _至此，你应该学会了基本BC与子服的通讯，剩下的能用这些数据包干♂出什么事就是你自己发挥了\n如果本教程有帮到你请考虑给个好评评价/回复一下本帖，P.S. 给人气不会损失金币的哦\n\n\n进入目录",
    "replies": [
        {
            "author": "lliiooll",
            "timestamp": 1534545480,
            "txt_content": "找了半天终于找到了"
        },
        {
            "author": "C__C",
            "timestamp": 1545652320,
            "txt_content": "教程很好  希望楼主经常更新一下教程进度  小伙伴都很期待下面的教程"
        },
        {
            "author": "GhostGuJI_Dada",
            "timestamp": 1548595500,
            "txt_content": "感谢berry64大佬的教程~"
        }
    ]
}