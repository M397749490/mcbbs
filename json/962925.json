{
    "title": "服务器timing分析和优化建议",
    "author": "喵丶呜",
    "replyCount": 11,
    "timestamp": 1582011480,
    "txt_content": " 本帖最后由 喵丶呜 于 2020-2-18 15:41 编辑 \n\n服务器非常的卡。配置是4核8Gvps，2667v2，catpro\n以下是两次的timing1.https://timings.spigotmc.org/?url=niyemuwixo\n2.https://timings.spigotmc.org/?url=ubarapemen\n服务器现在日常保持在7~11tps,人数是日在线稳定20人\n一个星期前日在线30人都保持在15tps以上\n优化已经做好，视距拉到极限只有2，漏斗60tick，配置文件优化是没有问题的\n因为昨天更改tiles改成1000后服务器爆卡，掉到8tps以下，已改到30\n求一个优化建议，lagassist，saml，ac优化插件有装，不打算装其他优化插件了。\n如果用bc将生存和地皮分成两个子服会不会好转？\n另外服务器人少的时候也会出现正常20tps突然爆卡掉到5~8tps，一两秒后恢复20tps\n以下是服务器gc和MOD列表\n\n\n\n\nD}OQ5SVIBJ2EU%5WA_`6HY1.png (283.53 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-18 15:32 上传\n\n\n\n\n\n\n\n\n\nOD]LLE$C((EG4R74{0LRU.png (59.47 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-18 15:32 上传\n\n\n\n\n\n艾特两个活跃在问答版和MOD问答的大佬@MC_tingfeng @xmdhs \n除去bc端还有更好的解决方案可以加Q3283905690细聊\n若实施有效可有偿\n",
    "replies": [
        {
            "author": "EmptyLava",
            "timestamp": 1582011900,
            "txt_content": " 本帖最后由 EmptyLava 于 2020-2-18 15:51 编辑 \n\n卡顿原因主要是漏斗与pipeholder(应该是mod里面的管道运输?)\n可以选择降低它们的传输速度以增加tps\n另外可以将javaw.exe的优先级设置为最高,这可以增加一定的CPU利用率,但服务器每次重启都要重新设置\n(服务器不是8G内存吗,为何设置最大内存只有4G多)"
        },
        {
            "author": "RINNDA",
            "timestamp": 1582013340,
            "txt_content": "突然间卡一下可能是服务器的地图备份 可以把地图备份关了"
        },
        {
            "author": "喵丶呜",
            "timestamp": 1582013580,
            "txt_content": "RINNDA 发表于 2020-2-18 16:09\n突然间卡一下可能是服务器的地图备份 可以把地图备份关了\n每隔4~7秒卡一下，应该不是地图备份"
        },
        {
            "author": "稳定c",
            "timestamp": 1582015140,
            "txt_content": "我看你的titles很高，我之前看见过一个贴\n\n众所周知的某优化贴中明确表示tiles+entity小于30能显著提升tps，如果你是纯净，那么这是对的，如果你是mod服，那么问题很严重\n这里entity不需要过多解释，能耐心看到这的应该都明白，关键是看tiles，tiles到底是什么！\n原版中：tiles指箱子熔炉一类\nmod服中：抛开原版的之外，任意一个mod能放置到地上东西几乎都是tiles（为什么是几乎呢，比如植物魔法的火花能放置，但是他是entity）\n当一个mod开了一段时间后，tiles都会变得很大，10万20万都很常见\n实际测试中发现，thermos包括后来的优化版铀端，sponge，catserver在默认的情况下tiles和entity都是1000\n拿thermos举例，当我把tiles和entity限制到20时，tps并没有提高且同时发现服务器机器处理速度显著变慢，比如mek的熔炼工厂\n而当tiles在1000时，tps依旧比较低，但是机器处理速度显著变高\n那么从tps和max-tick-time的解释中，我是否可以这么理解，一个加载的tiles需要cpu运算一次，20万个就是20万次，而且这20万次是需要在1/20秒内完成，也就是一秒钟cpu需要运算400万次，再结合cpu频率，换算过来400万次=4MHz？显然这里的换算关系不对，只是这样可能方便理解\n回到tps上来说，1/20秒内服务器无法处理完这20万个tiles，卡顿就发生了，如果设置tiles为20，那么每一秒都有大量的tiles等待处理或者被跳过处理，这对玩家的体验来说显然是很不愉快的\n所以当我有一个4.0GHz主频的CPU时，我是否可以把tiles和entity设置的更高呢，比如2000\n\n\n原帖链接:https://www.mcbbs.net/thread-835520-1-1.html"
        },
        {
            "author": "MC_tingfeng",
            "timestamp": 1582015200,
            "txt_content": "谢邀，已经有一段时间不活跃了。  从timings看楼上说的漏斗和bc管道确实占用了一些，但并不是主要卡顿原因。建议排查玩家地皮的单个卡服物品，如工业的电动分拣机，ae的超大CPU等"
        },
        {
            "author": "夜夜夜、",
            "timestamp": 1582027020,
            "txt_content": "啊 ? max tick time 我认为还是越低越好 除了会降低速率 \n看了看了楼主的timing  喏：  解决方法就是降低服务端配置文件tileentities配置文件中的  \nTileEntityFasterHopper   \nTilePipeHolder\n这俩物品 默认是1 改成5或者8有明显挺高 还有你sc世界有点不正常 先降低这俩物品在尝试"
        },
        {
            "author": "喵丶呜",
            "timestamp": 1582027860,
            "txt_content": "夜夜夜、 发表于 2020-2-18 19:57\n啊 ? max tick time 我认为还是越低越好 除了会降低速率 \n看了看了楼主的timing  喏：  解决方法就是降低服 ...\n没有找到你说的配置文件，是否能指明配置文件的文件名。\n若你说的是限制漏斗处理速度那已经是限制的了。"
        },
        {
            "author": "夜夜夜、",
            "timestamp": 1582027920,
            "txt_content": "喵丶呜 发表于 2020-2-18 20:11\n没有找到你说的配置文件，是否能指明配置文件的文件名。\n若你说的是限制漏斗处理速度那已经是限制的了。 ...\nNONONO 我记得猫端应该有  tileentities.yml  这个文件吧 这是修改具体某个物品的tick的配置文件"
        },
        {
            "author": "喵丶呜",
            "timestamp": 1582028640,
            "txt_content": " 本帖最后由 喵丶呜 于 2020-2-18 20:25 编辑 \n夜夜夜、 发表于 2020-2-18 20:12\nNONONO 我记得猫端应该有  tileentities.yml  这个文件吧 这是修改具体某个物品的tick的配置文件 ...\n\n\n\n\nNL5VXB2@D)9N0KODA2G8JTW.png (94.52 KB, 下载次数: 0)\n\n下载附件\n\n2020-2-18 20:24 上传\n\n\n\n\n\n并没有你说的文件\n"
        },
        {
            "author": "yyxzzlove",
            "timestamp": 1582033020,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "夜夜夜、",
            "timestamp": 1582071000,
            "txt_content": " 本帖最后由 夜夜夜、 于 2020-2-19 08:11 编辑 \n喵丶呜 发表于 2020-2-18 20:24\n并没有你说的文件\n头疼 降低max tick time的tiles改成10几 然后查询一下我上面发的那两个物品分别是什么 你说的漏斗好像只限制的是原版并不是模组里面的"
        }
    ]
}