{
    "title": "一个简单的插件实例",
    "author": "q513902026",
    "replyCount": 5,
    "timestamp": 1392015420,
    "txt_content": " 本帖最后由 q513902026 于 2014-2-10 16:10 编辑 \n\n为各位新手入门有个参考 代码分享 一个简单的增强血量还有怪物和玩家本身增强（恶趣味）的插件\n\nHelloTest.java:\npackage com.hopeasd.test;\n\nimport java.io.File;\nimport java.util.Random;\nimport java.util.logging.Level;\nimport java.util.logging.Logger;\n\nimport org.bukkit.Bukkit;\nimport org.bukkit.command.Command;\nimport org.bukkit.command.CommandExecutor;\nimport org.bukkit.command.CommandSender;\nimport org.bukkit.configuration.file.FileConfiguration;\nimport org.bukkit.entity.Entity;\nimport org.bukkit.entity.EntityType;\nimport org.bukkit.entity.LivingEntity;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.entity.EntityDamageByEntityEvent;\nimport org.bukkit.event.player.PlayerExpChangeEvent;\nimport org.bukkit.event.player.PlayerJoinEvent;\nimport org.bukkit.event.player.PlayerLevelChangeEvent;\nimport org.bukkit.plugin.java.JavaPlugin;\nimport org.bukkit.potion.PotionEffect;\nimport org.bukkit.potion.PotionEffectType;\n\npublic final class HelloTest extends JavaPlugin implements Listener\n{\n        public Logger logger;\n        public FileConfiguration configuration;\n\n        public int level;\n        public double healthArg;\n        public double damagerArg;\n        public boolean damager;\n\n        @Override\n        public void onEnable()\n        {\n\n                logger = this.getLogger();\n                setConfig();\n                ConfigGet(configuration);\n\n                registerEvent();\n\n                logger.info(\"HelloTest插件已经启动！\");\n        }\n\n        public void registerEvent()\n        {\n                this.getServer().getPluginManager().registerEvents(this, this);\n                this.getServer().getPluginManager()\n                                .registerEvents(new PlayerListener(), this);\n                if (damager)\n                {\n                        this.getServer().getPluginManager()\n                                        .registerEvents(new EntityAttackListener(this), this);\n                }\n                this.getCommand(\"setLevel\").setExecutor(new CommandSetLevel(this));\n                logger.info(\"HelloTest事件注册完毕!\");\n        }\n\n        public void ConfigGet(FileConfiguration config)\n        {\n                healthArg = config.getDouble(\"Health\");\n                damagerArg = config.getDouble(\"Damage\");\n                damager = config.getBoolean(\"isDamager\");\n                level = config.getInt(\"LevelTop\");\n                logger.info(\"HelloTest配置获取完毕！\");\n        }\n\n        public void setConfig()\n        {\n                logger.info(\"HelloTest开始创建配置！\");\n                File configFile = new File(this.getDataFolder(), \"config.yml\");\n                configuration = this.getConfig();\n                if (!configFile.exists())\n                {\n                        configuration.addDefault(\"LevelTop\", (int) 10);\n                        configuration.addDefault(\"Damage\", 0.75D);\n                        configuration.addDefault(\"Health\", 1.5D);\n                        configuration.addDefault(\"isDamager\", false);\n                        configuration.options().copyDefaults(true);\n                        saveConfig();\n                        logger.info(\"HelloTest配置创建完毕！\");\n                }\n        }\n\n        @Override\n        public void onDisable()\n        {\n                logger.info(\"HelloTest插件已经关闭!\");\n        }\n\n        @EventHandler\n        public void PlayerJoin(PlayerJoinEvent event)\n        {\n                Player aPlayer = event.getPlayer();\n                int aPlayerLevel = aPlayer.getLevel();\n                if (aPlayerLevel >= 0 && aPlayerLevel < level)\n                {\n                        aPlayer.setHealthScale(aPlayerLevel * healthArg + 10);\n                } else if (aPlayerLevel >= level)\n                {\n                        aPlayer.setHealthScale(level * healthArg + 10);\n                }\n                aPlayer.sendMessage(\"欢迎进入游戏 根据你等级开始变更血量\");\n        }\n\n        @EventHandler\n        public void PlayerLevelChanager(PlayerLevelChangeEvent event)\n        {\n                Player aPlayer = event.getPlayer();\n                int aPlayerLevel = aPlayer.getLevel();\n\n                if (aPlayerLevel >= 0 && aPlayerLevel < level)\n                {\n                        aPlayer.setHealthScale(aPlayerLevel * healthArg + 10);\n                } else if (aPlayerLevel >= level)\n                {\n                        aPlayer.setHealthScale(level * healthArg + 10);\n\n                }\n                aPlayer.sendMessage(\"你的等级已经变化，血量上限已经更新\");\n        }\n\n        @EventHandler\n        public void PlayerExpChanager(PlayerExpChangeEvent event)\n        {\n                Player aPlayer = event.getPlayer();\n                int aPlayerLevel = aPlayer.getLevel();\n                if (aPlayerLevel >= 0 && aPlayerLevel < level)\n                {\n                        aPlayer.setHealthScale(aPlayerLevel * healthArg + 10);\n                } else if (aPlayerLevel >= level)\n                {\n                        aPlayer.setHealthScale(10 * healthArg + 10);\n\n                }\n        }\n//这里是加强僵尸和小黑的攻击 攻击百分百使被攻击者获得致盲效果1s\n        @EventHandler\n        public void EntityAttackEvent(EntityDamageByEntityEvent event)\n        {\n                Entity damager = event.getDamager();\n                if (damager.getType() == EntityType.ZOMBIE\n\n                || damager.getType() == EntityType.ENDERMAN)\n                {\n                        LivingEntity victim = (LivingEntity) event.getEntity();\n                        victim.addPotionEffect(new PotionEffect(PotionEffectType.CONFUSION,\n                                        20, 1));\n                }\n\n        }\n}\n复制代码PlayerListener.java\npackage com.hopeasd.test;\n\nimport java.util.Random;\n\nimport org.bukkit.Material;\nimport org.bukkit.entity.EntityType;\nimport org.bukkit.entity.LivingEntity;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.entity.EntityDamageByEntityEvent;\nimport org.bukkit.potion.PotionEffect;\nimport org.bukkit.potion.PotionEffectType;\n//这个监听器的效果就是 当你攻击的时候 如果手持金剑则有一定几率获得加速效果，一定几率使被攻击者获得减速效果\npublic class PlayerListener implements Listener\n{\n        @EventHandler\n        public void onPlayerInterface(EntityDamageByEntityEvent et)\n        {\n                if (et.getEntity() instanceof Player)\n                {\n                        Player aPlayer = (Player) et.getEntity();\n                        if (aPlayer.getItemInHand().getType() == Material.GOLD_SWORD)\n                        {\n                                Random aRandom = new Random();\n                                if (aRandom.nextInt(100) < 50)\n                                {\n\n                                        aPlayer.addPotionEffect(new PotionEffect(\n                                                        PotionEffectType.SPEED, 10, 1));\n                                } else if (aRandom.nextInt(10) < 4)\n                                {\n                                        aPlayer.addPotionEffect(new PotionEffect(\n                                                        PotionEffectType.SLOW, 15, 1));\n                                }\n                        }\n                }\n        }\n}\n复制代码\nEntityAttackListener.java\npackage com.hopeasd.test;\n\nimport org.bukkit.entity.Entity;\nimport org.bukkit.entity.EntityType;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.entity.EntityDamageByEntityEvent;\n//这个监听器的效果 是加强攻击力 不管是怪物还是玩家 默认是关闭的\npublic class EntityAttackListener implements Listener\n{\n        public HelloTest jp;\n\n        public EntityAttackListener(HelloTest jp)\n        {\n                this.jp = jp;\n        }\n\n        @EventHandler\n        public void EntityChangerDamageEvent(EntityDamageByEntityEvent event)\n        {\n                final Entity damager = event.getDamager();\n                final double tempDamager = event.getDamage();\n                if (damager.getType() == EntityType.PLAYER)\n                {\n                        event.setDamage(tempDamager * 2 * jp.damagerArg);\n                } else\n                {\n                        event.setDamage(tempDamager * (1 + jp.damagerArg));\n                }\n\n        }\n}\n复制代码\n\nCommandSetLevel.java\n\npackage com.hopeasd.test;\n\nimport org.bukkit.command.Command;\nimport org.bukkit.command.CommandExecutor;\nimport org.bukkit.command.CommandSender;\nimport org.bukkit.entity.Player;\n\npublic class CommandSetLevel implements CommandExecutor\n{\n        public HelloTest jp;\n\n        public CommandSetLevel(HelloTest jp)\n        {\n                this.jp = jp;\n        }\n\n        @Override\n        public boolean onCommand(CommandSender arg0, Command arg1, String arg2,\n                        String[] arg3)\n        {\n                if (arg1.getName().equalsIgnoreCase(\"setLevel\"))\n                {\n                        if (arg3.length != 1)\n                        {\n                                return false;\n                        }\n                        if (arg0 instanceof Player)\n                        {\n\n                                Player aPlayer = (Player) arg0;\n                                try\n                                {\n                                        aPlayer.setLevel(Integer.parseInt(arg3[0]));\n                                        jp.logger.info(\"玩家\" + aPlayer.getName() + \"的等级变更为\"\n                                                        + Integer.parseInt(arg3[0]));\n                                } catch (NumberFormatException exception)\n                                {\n                                        exception.printStackTrace();\n                                }\n                        } else\n                        {\n                                jp.logger.info(\"你必须是个玩家\");\n                        }\n                        return true;\n                }\n                return false;\n        }\n}\n复制代码\nplugin.yml\n\nname: HelloTest\nmain: com.hopeasd.test.HelloTest\nauthors: [HopeAsd, 米糕]\nversion: 0.0.1\n\ncommands:\n  setLevel:\n    description: This is a SetLevel Command\n    usage: /<command> [level]\n    permission: hello.level.set\n    permission-message: You don't have <permission>\n\npermissions:\n  hello.level.set:\n    description: Set Level\n    default: op\n复制代码 \n插件及源码下载:\nhttp://pan.baidu.com/s/1eQ9TCxs[groupid=350]CTHUWORK[/groupid]",
    "replies": [
        {
            "author": "尘曲",
            "timestamp": 1392016260,
            "txt_content": "= =仅仅是增强血量，怎么有那么多伤害监听"
        },
        {
            "author": "q513902026",
            "timestamp": 1392016320,
            "txt_content": "因为有一些是增强怪物的 和增强玩家本身的"
        },
        {
            "author": "尘曲",
            "timestamp": 1392017520,
            "txt_content": "q513902026 发表于 2014-2-10 15:12\n因为有一些是增强怪物的 和增强玩家本身的\n= =但是我看源码是增加伤害，和手持物品时获得药水效果"
        },
        {
            "author": "q513902026",
            "timestamp": 1392017700,
            "txt_content": "尘曲 发表于 2014-2-10 15:32\n= =但是我看源码是增加伤害，和手持物品时获得药水效果\n增加伤害的默认关闭  药水效果 你可以理解为我恶趣味的增加类似LOL的小冰锤效果 \n怪物的话就增强了僵尸和小黑  让他们攻击使被攻击者获得失明\n以上都是恶趣味发作的结果"
        },
        {
            "author": "尘曲",
            "timestamp": 1392018060,
            "txt_content": "q513902026 发表于 2014-2-10 15:35\n增加伤害的默认关闭  药水效果 你可以理解为我恶趣味的增加类似LOL的小冰锤效果 \n怪物的话就增强了僵尸和 ...\n的确是。。。恶趣味。。。最好加点说明吧。。。不然新手(比如我)怎么能知道。。。"
        }
    ]
}