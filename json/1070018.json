{
    "title": "Bukkit的插件的多页背包和自定义配置文件",
    "author": "AlbertBlue",
    "replyCount": 0,
    "timestamp": 1593486180,
    "txt_content": " 本帖最后由 AlbertBlue 于 2020-6-29 15:19 编辑 \n\n相信很多人开发一些插件的时候需要用到除了config.yml之外的自定义配置文件或者需要翻页的多页GUI界面\n写起来不是特别复杂但是感觉很麻烦而且头疼，这里我分享下自己写的几个类(代码均为原创)\n\nCustomConfig.java - 自定义配置文件\nimport org.bukkit.configuration.InvalidConfigurationException;\nimport org.bukkit.configuration.file.FileConfiguration;\nimport org.bukkit.configuration.file.YamlConfiguration;\nimport org.bukkit.plugin.Plugin;\n\nimport java.io.File;\nimport java.io.IOException;\n\npublic class CustomConfig {\n\n    private String filename;\n    private FileConfiguration config;\n    private File configFile;\n    private Plugin plugin;\n\n    public String getFilename() {\n        return filename;\n    }\n\n    public CustomConfig(String name, Plugin plugin){\n        this.plugin = plugin;\n        this.filename = name;\n        this.config = create(name);\n    }\n\n    public void save(){\n        try {\n            config.save(configFile);\n        } catch (IOException ignored) {\n\n        }\n        this.config = create(filename);\n    }\n\n    public void reload(){\n        this.config = create(filename);\n    }\n\n    private FileConfiguration create(String file) {\n        File ConfigFile = new File(plugin.getDataFolder(), file);\n        if (!ConfigFile.exists()) {\n            ConfigFile.getParentFile().mkdirs();\n            plugin.saveResource(file, false);\n        }\n        YamlConfiguration Config = new YamlConfiguration();\n        try {\n            Config.load(ConfigFile);\n            this.configFile = ConfigFile;\n        }\n        catch (IOException | InvalidConfigurationException ignored) {\n\n        }\n        return Config;\n    }\n\n    public FileConfiguration getConfig() {\n        return config;\n    }\n\n    public File getConfigFile() {\n        return configFile;\n    }\n\n}\n复制代码\n用法举例:\nprivate static CustomConfig data;\n    @Override\n    public void onEnable(){\n        data = new CustomConfig(\"data.yml\",this);\n        getLogger().info(\"Loaded\");\n    }复制代码data.getConfig即可获取配置文件data.yml (不要忘记在你的插件项目内提前创建一个data.yml文件并且设置打包到jar)\ndata.save 即可保存\ndata.reload即可重载 非常方便\n其他类 Main.getData即可获取这个自定义的配置文件\n\n多页背包\n智能识别页数添加上一页下一页按钮,采用InventoryHolder判断是否为插件的背包,并且可在GUI标题显示当前页数\nitems: 所有你要添加进此背包的物品 player: 玩家 page: 需要打开的页数 即可打开背包\n本人数学很差这玩意调了半天才试出来没问题，目前写了几个插件用了几个月没有任何问题,如果有用的话麻烦给点评分谢谢\n\nimport org.bukkit.Bukkit;\nimport org.bukkit.Material;\nimport org.bukkit.entity.Player;\nimport org.bukkit.inventory.Inventory;\nimport org.bukkit.inventory.ItemStack;\nimport org.bukkit.inventory.meta.ItemMeta;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\n\npublic class PagedInv {\n    public static void open(ArrayList<ItemStack> items, Player p, int page){\n        Inventory inventory = Bukkit.createInventory(\n                new MyHolder(page),54,\"§4多页背包 \"+(page+1)+\"/\"+(int)Math.ceil((float)items.size()/45)\n        );\n        List<ItemStack> item2 = items.size() > (page+1)*45 ? items.subList(page*45,page*45+45) : items.subList(page*45,items.size());\n        for (int i = 0;i<45 && i < item2.size();i++){\n            inventory.setItem(i,item2.get(i));\n        }\n        if (page != 0){\n            inventory.setItem(inventory.getSize()-9,getPage(\"上一页\"));\n        }\n        if (items.size()/45 > page){\n            inventory.setItem(inventory.getSize()-1,getPage(\"下一页\"));\n        }\n        p.openInventory(inventory);\n    }\n\n    private static ItemStack getPage(String name){\n        ItemStack is = new ItemStack(Material.ARROW);\n        ItemMeta meta = is.getItemMeta();\n        meta.setDisplayName(\"§f\"+name);\n        meta.setLore(Collections.singletonList(\"§8点击切换至 \"+name));\n        is.setItemMeta(meta);\n        return is;\n    }\n}复制代码\n上方的为实时运算输出一个页面的,适合单个玩家的仓库信息什么的\n下方的多页背包为一次性运算输出一个inventory数组，适合服务器公共传送点什么的\npublic static ArrayList<Inventory> getInvs(ArrayList<ItemStack> items,String title){\n        ArrayList<Inventory> invs = new ArrayList<>();\n        int size = (int)Math.ceil((float)items.size()/45);\n        int t = 0;\n        for (int i = 0;i<size;i++){\n            Inventory inv = Bukkit.createInventory(new MyHolder(),54,title+(i+1)+\"/\"+size);\n            for (int i2 = 0;i2<45;i2++){\n                if (t >= items.size()){\n                    break;\n                }\n                inv.addItem(items.get(t));\n                t++;\n            }\n            if (i != 0)\n                inv.setItem(45,ItemUtil.make(Material.ARROW,\"§8上一页\"));\n            if (i<size-1)\n                inv.setItem(53,ItemUtil.make(Material.ARROW,\"§8下一页\"));\n            invs.add(inv);\n        }\n        return invs;\n    }复制代码\n\nMyHolder: InventoryHolder类,多页背包的\nimport org.bukkit.inventory.Inventory;\nimport org.bukkit.inventory.InventoryHolder;\n\npublic class MyHolder implements InventoryHolder {\n    private int page;\n\n    public EnderHolder(int page){\n        this.page = page;\n    }\n    @Override\n    public Inventory getInventory() {\n        return null;\n    }\n\n    public int getPage() {\n        return page;\n    }\n}复制代码\nItemUtil 快速创建或修改物品名字和lore类\n传入物品或material ,名称 , lore(可选) 即可快速创建或修改物品\nimport org.bukkit.Material;\nimport org.bukkit.inventory.ItemStack;\nimport org.bukkit.inventory.meta.ItemMeta;\n\nimport java.util.Arrays;\nimport java.util.List;\n//author Albert\npublic class ItemUtil {\n    public static ItemStack make(ItemStack is,String name,String... lore){\n        ItemMeta meta = is.getItemMeta();\n        meta.setDisplayName(name);\n        meta.setLore(Arrays.asList(lore));\n        is.setItemMeta(meta);\n        return is;\n    }\n    public static ItemStack make(Material material,String name,String... lore){\n        ItemStack is = new ItemStack(material);\n        ItemMeta meta = is.getItemMeta();\n        meta.setDisplayName(name);\n        meta.setLore(Arrays.asList(lore));\n        is.setItemMeta(meta);\n        return is;\n    }\n    public static ItemStack make(Material material,String name,List<String> lore){\n        ItemStack is = new ItemStack(material);\n        ItemMeta meta = is.getItemMeta();\n        meta.setDisplayName(name);\n        meta.setLore(lore);\n        is.setItemMeta(meta);\n        return is;\n    }\n\n    public static ItemStack make(ItemStack is, String name, List<String> lore){\n        ItemMeta meta = is.getItemMeta();\n        meta.setDisplayName(name);\n        meta.setLore(lore);\n        is.setItemMeta(meta);\n        return is;\n    }\n}复制代码\n多页背包翻页监听举例(实时运算的,一次性的不用说了,就是inventory在输出数组中的index+1 -1)\n@EventHandler\n    public void onClick(InventoryClickEvent e){\n        if (e.getInventory() == null){\n            return;\n        }\n        if (e.getInventory().getHolder() instanceof MyHolder){\n            e.setCancelled(true);\n        }\n        if (e.getClickedInventory() == null){\n            return;\n        }\n        if (e.getClickedInventory().getHolder() instanceof MyHolder){ ;\n            if (e.getCurrentItem() == null || e.getCurrentItem().getType().equals(Material.AIR)){\n                return;\n            }\n                        MyHolder holder = (MyHolder) e.getClickedInventory().getHolder();\n                        Player p = (Player) e.getWhoClicked();\n                        //翻页监听\n                        if (e.getCurrentItem() != null && e.getCurrentItem().getType().equals(Material.ARROW)){\n                            if (e.getSlot() == 45){\n                                PagedInv.open(您的物品数组,p,holder.getPage()-1);\n                            }\n                            if (e.getSlot() == 53){\n                                PagedInv.open(您的物品数组,p,holder.getPage()+1);\n                            }\n                        }复制代码\n最后不要忘记在插件onDisable 方法内\n写上关闭所有玩家开启的本插件的背包(防止卡出物品)\n@Override\n    public void onDisable(){\n        for (Player p : Bukkit.getOnlinePlayers()){\n            if (p.getOpenInventory().getTopInventory().getHolder() instanceof MyHolder){\n                p.closeInventory();\n            }\n        }\n        getLogger().info(\"Unloaded\");\n    }复制代码\n\n\n\n",
    "replies": []
}