{
    "title": "Paper1.14.4服务器tps贼低",
    "author": "贺兰兰",
    "replyCount": 4,
    "timestamp": 1569595020,
    "txt_content": "我怎么又来mcbbs问问题了....金粒都没辽\n我不敢相信1.14.4他5个人玩tps能降到9.5\n\n服务器是1.14.4，Paper#195\n\n以下提供了Spark和Timings的性能分析\n\nSpark:https://sparkprofiler.github.io/#CEjijHnM5l\nTimings:https://timings.aikar.co/?id=8b1d4b03982544b396fcccb72c35332f\n\n",
    "replies": [
        {
            "author": "Salt_lovely",
            "timestamp": 1569595020,
            "txt_content": " 本帖最后由 Salt_lovely 于 2019-9-28 01:24 编辑 \n贺兰星辰 发表于 2019-9-28 01:04\n确实不是一个时间段查的\n以及CPU是E5-2680V2，我觉得还好吧\n首先是bukkit：\n把生物刷新上限改成\n怪物：50或者更低动物：15或者更低水生动物：10或者更低，如果还是卡顿，就改成5蝙蝠：我习惯改成1\n推荐使用bukkit自带的自动保存而不是插件的\n\n\n\n\n\n然后是spigot：mob-spawn-range: 怪物刷新的区块距离，我习惯改成4，总之最好不要超过6，bukkit里面的怪物上限越小，这个越小，但是改成2的话玩家游戏体验很差\n\n    entity-activation-range:\n      animals: 24\n      monsters: 32\n      raiders: 36\n      misc: 12\n      tick-inactive-villagers: true\n生物AI活动的最远距离，距离玩家超过这个阈值的时候，实体会停  止  思  考（也就是暂时停止AI）\n我是这个配置，你觉得卡顿的话，设置得更小一些也没问题，注意：misc最好不要低于3\n\n    merge-radius:\n      item: 3.0\n      exp: 4.5\n掉落物与经验球的合并距离，我是这个配置，如果掉落物/经验球卡服，请改的更大，但是掉落物合并距离最好不要超过4\n\n\n\n\n\n最后是paper.yml：\n\n    keep-spawn-loaded: true    keep-spawn-loaded-range: 0\n出生点区块会占用内存，里面的实体会占用内存和CPU，不过如果玩家经常前往主城，那还是开着这个功能为好\n\n    grass-spread-tick-rate: 2 除非是空岛服、海岛服需要调整为1，否则2-3就行\n\n    container-update-tick-rate: 2 一般来讲2-3就行，太大了物品栏什么的会鬼畜\n\n    max-entity-collisions: 8 调整得越小越不容易造成密集实体卡服，我的配置是8，改成4的话，想怎么密集养殖就怎么养殖（然后实体太多卡爆服务器）\n\n    despawn-ranges:\n      soft: 32\n      hard: 128\n推荐soft改成24-32之间，hard改成32-64之间，推荐配置32|64 、32|56 、28|56（hard最好50以上，因为有一个成就叫做狙击手的对决）\n\n\n\n\n\n大概就是这些，优化总归是有用的，虽然你的问题主要是插件太多了（吐槽一句我看到好几个付费插件，羡慕大户人家）\n\n\n"
        },
        {
            "author": "Salt_lovely",
            "timestamp": 1569602520,
            "txt_content": " 本帖最后由 Salt_lovely 于 2019-9-28 00:48 编辑 \n\nspark里面： org.dynmap.bukkit.DynmapPlugin$BukkitServer$6.call()32.85%\ndynmap？这个插件印象中占用资源少到几乎不计，怎么占用那么高？\n你中途用了渲染地图的指令了吗，还是有人在跑图？\n\n而在timings里面，dynmap的资源占用很正常，TPS也一直保持高水平\n你的spark和timings是不是不同时间收集的数据？\n\ntimings和spark给出的结果的共通点是你的插件装太多导致大量运算花在插件上\n\n亲身体验，2C4GB的服务器在1.14的负优化下是可以被5个玩家卡到服务端崩溃（out of memory或者失去响应）的，timings里面看得到你没有对服务端配置作任何优化，有可能是受到了该版本反向优化的影响。另外请检查一下CPU主频，1.14吃CPU比之前的版本厉害。。"
        },
        {
            "author": "贺兰兰",
            "timestamp": 1569603840,
            "txt_content": "Salt_lovely 发表于 2019-9-28 00:42\nspark里面： org.dynmap.bukkit.DynmapPlugin$BukkitServer$6.call()32.85%\ndynmap？这个插件印象中占用资 ...\n确实不是一个时间段查的\n以及CPU是E5-2680V2，我觉得还好吧\n\n具体有什么可以用的优化方案吗2333，听说1.14改spigot.yml和paper.ym不好使\n"
        },
        {
            "author": "贺兰兰",
            "timestamp": 1569605100,
            "txt_content": "Salt_lovely 发表于 2019-9-28 01:17\n首先是bukkit：\n把生物刷新上限改成\n非常感谢，我先去试了，最佳答案先给你设置上23333\n"
        }
    ]
}