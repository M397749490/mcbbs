{
    "title": "线程异常不知哪个问题导致tps瞬间被吃光",
    "author": "mazd666",
    "replyCount": 3,
    "timestamp": 1568073300,
    "txt_content": "\n原本星期日时与稍早之前算还稳定持续开了很长一段时间(基本能开24H以上在重启）\n\n星期一更新了cmi与Brewery后下午也没事情但晚上6.7点到12点之间大约每半小到一小时都会发生突发性TPS瞬间被吃到1-2\n\n把CMI与Brewery降版本了也持续一样的问题实在不明白怎了\nTPS被吃完到1-2后会卡线程好一断时间后基本没救重启\n\n\n\n再次来论坛请教个位高手希望可以帮忙\n\n19:45:08] [Paper Watchdog Thread/ERROR]: --- DO NOT REPORT THIS TO PAPER - THIS IS NOT A BUG OR A CRASH  - git-Paper-186 (MC: 1.14.4) --- [19:45:08] [Paper Watchdog Thread/ERROR]: The server has not responded for 10 seconds! Creating thread dump [19:45:08] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:08] [Paper Watchdog Thread/ERROR]: Server thread dump (Look for plugins here before reporting to Paper!): [19:45:08] [Paper Watchdog Thread/ERROR]: The server is waiting on these chunks: [] [19:45:08] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:08] [Paper Watchdog Thread/ERROR]: Current Thread: Server thread [19:45:08] [Paper Watchdog Thread/ERROR]:         PID: 26 | Suspended: false | Native: false | State: RUNNABLE [19:45:08] [Paper Watchdog Thread/ERROR]:         Stack: [19:45:08] [Paper Watchdog Thread/ERROR]:                 java.util.HashMap.putIfAbsent(Unknown Source) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerChunkMap$EntityTracker.updatePlayer(PlayerChunkMap.java:1644) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerChunkMap.movePlayer(PlayerChunkMap.java:1280) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.ChunkProviderServer.movePlayer(ChunkProviderServer.java:725) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerConnection.a(PlayerConnection.java:1132) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PacketPlayInFlying.a(SourceFile:126) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PacketPlayInFlying.a(SourceFile:8) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerConnectionUtils.lambda$ensureMainThread$0(PlayerConnectionUtils.java:23) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerConnectionUtils$$Lambda$4140/1802324812.run(Unknown Source) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.TickTask.run(SourceFile:18) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandler.executeTask(IAsyncTaskHandler.java:136) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandlerReentrant.executeTask(SourceFile:23) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandler.executeNext(IAsyncTaskHandler.java:109) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.aX(MinecraftServer.java:1013) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.executeNext(MinecraftServer.java:1006) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandler.executeAll(IAsyncTaskHandler.java:95) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.a(MinecraftServer.java:1135) [19:45:08] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.run(MinecraftServer.java:919) [19:45:08] [Paper Watchdog Thread/ERROR]:                 java.lang.Thread.run(Unknown Source) [19:45:08] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:08] [Paper Watchdog Thread/ERROR]: --- DO NOT REPORT THIS TO PAPER - THIS IS NOT A BUG OR A CRASH --- [19:45:08] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:11] [Server thread/INFO]: BeboCoCo issued server command: /home [19:45:13] [pool-10-thread-1/WARN]: [io.sentry.dsn.Dsn] *** Couldn't find a suitable DSN, Sentry operations will do nothing! See documentation: https://docs.sentry.io/clients/java/ *** [19:45:13] [pool-10-thread-1/WARN]: [io.sentry.DefaultSentryClientFactory] No 'stacktrace.app.packages' was configured, this option is highly recommended as it affects stacktrace grouping and display on Sentry. See documentation: https://docs.sentry.io/clients/j ... cation-stack-frames [19:45:13] [pool-10-thread-1/WARN]: Exception in thread \"pool-10-thread-1\" java.lang.RuntimeException: java.util.NoSuchElementException: packet_handler [19:45:13] [pool-10-thread-1/WARN]:         at org.inventivetalent.packetlistener.channel.INCChannel$1.run(INCChannel.java:33) [19:45:13] [pool-10-thread-1/WARN]:         at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) [19:45:13] [pool-10-thread-1/WARN]:         at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [19:45:13] [pool-10-thread-1/WARN]:         at java.lang.Thread.run(Unknown Source) [19:45:13] [pool-10-thread-1/WARN]: Caused by: java.util.NoSuchElementException: packet_handler [19:45:13] [pool-10-thread-1/WARN]:         at io.netty.channel.DefaultChannelPipeline.getContextOrDie(DefaultChannelPipeline.java:1119) [19:45:13] [pool-10-thread-1/WARN]:         at io.netty.channel.DefaultChannelPipeline.addBefore(DefaultChannelPipeline.java:260) [19:45:13] [pool-10-thread-1/WARN]:         at io.netty.channel.DefaultChannelPipeline.addBefore(DefaultChannelPipeline.java:249) [19:45:13] [pool-10-thread-1/WARN]:         at com.comphenix.protocol.injector.netty.PipelineProxy.addBefore(PipelineProxy.java:66) [19:45:13] [pool-10-thread-1/WARN]:         at com.comphenix.protocol.injector.netty.ChannelInjector$3$1.addBefore(ChannelInjector.java:269) [19:45:13] [pool-10-thread-1/WARN]:         at org.inventivetalent.packetlistener.channel.INCChannel$1.run(INCChannel.java:31) [19:45:13] [pool-10-thread-1/WARN]:         ... 3 more [19:45:13] [Server thread/INFO]: Akihocookie lost connection: You logged in from another location [19:45:13] [Server thread/INFO]: Akihocookie left the game [19:45:13] [Server thread/INFO]: Akihocookie[/150.117.222.142:51446] logged in with entity id 15798 at ([world]-196.78511973702817, 67.16778954333512, 329.68528028581164) [19:45:20] [Server thread/INFO]: Nicole_OuO issued server command: /tps [19:45:26] [Paper Watchdog Thread/ERROR]: --- DO NOT REPORT THIS TO PAPER - THIS IS NOT A BUG OR A CRASH  - git-Paper-186 (MC: 1.14.4) --- [19:45:26] [Paper Watchdog Thread/ERROR]: The server has not responded for 10 seconds! Creating thread dump [19:45:26] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:26] [Paper Watchdog Thread/ERROR]: Server thread dump (Look for plugins here before reporting to Paper!): [19:45:26] [Paper Watchdog Thread/ERROR]: The server is waiting on these chunks: [] [19:45:26] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:26] [Paper Watchdog Thread/ERROR]: Current Thread: Server thread [19:45:26] [Paper Watchdog Thread/ERROR]:         PID: 26 | Suspended: false | Native: false | State: RUNNABLE [19:45:26] [Paper Watchdog Thread/ERROR]:         Stack: [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerChunkMap.movePlayer(PlayerChunkMap.java:1280) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.ChunkProviderServer.movePlayer(ChunkProviderServer.java:725) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerConnection.a(PlayerConnection.java:1132) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PacketPlayInFlying.a(SourceFile:126) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PacketPlayInFlying.a(SourceFile:8) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerConnectionUtils.lambda$ensureMainThread$0(PlayerConnectionUtils.java:23) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerConnectionUtils$$Lambda$4140/1802324812.run(Unknown Source) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.TickTask.run(SourceFile:18) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandler.executeTask(IAsyncTaskHandler.java:136) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandlerReentrant.executeTask(SourceFile:23) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandler.executeNext(IAsyncTaskHandler.java:109) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.aX(MinecraftServer.java:1013) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.executeNext(MinecraftServer.java:1006) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandler.executeAll(IAsyncTaskHandler.java:95) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.a(MinecraftServer.java:1135) [19:45:26] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.run(MinecraftServer.java:919) [19:45:26] [Paper Watchdog Thread/ERROR]:                 java.lang.Thread.run(Unknown Source) [19:45:26] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:26] [Paper Watchdog Thread/ERROR]: --- DO NOT REPORT THIS TO PAPER - THIS IS NOT A BUG OR A CRASH --- [19:45:26] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:31] [Paper Watchdog Thread/ERROR]: --- DO NOT REPORT THIS TO PAPER - THIS IS NOT A BUG OR A CRASH  - git-Paper-186 (MC: 1.14.4) --- [19:45:31] [Paper Watchdog Thread/ERROR]: The server has not responded for 15 seconds! Creating thread dump [19:45:31] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:31] [Paper Watchdog Thread/ERROR]: Server thread dump (Look for plugins here before reporting to Paper!): [19:45:31] [Paper Watchdog Thread/ERROR]: The server is waiting on these chunks: [] [19:45:31] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:31] [Paper Watchdog Thread/ERROR]: Current Thread: Server thread [19:45:31] [Paper Watchdog Thread/ERROR]:         PID: 26 | Suspended: false | Native: false | State: RUNNABLE [19:45:31] [Paper Watchdog Thread/ERROR]:         Stack: [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerChunkMap$EntityTracker.updatePlayer(PlayerChunkMap.java:1619) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerChunkMap.movePlayer(PlayerChunkMap.java:1280) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.ChunkProviderServer.movePlayer(ChunkProviderServer.java:725) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerConnection.a(PlayerConnection.java:1132) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PacketPlayInFlying.a(SourceFile:126) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PacketPlayInFlying.a(SourceFile:8) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerConnectionUtils.lambda$ensureMainThread$0(PlayerConnectionUtils.java:23) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.PlayerConnectionUtils$$Lambda$4140/1802324812.run(Unknown Source) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.TickTask.run(SourceFile:18) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandler.executeTask(IAsyncTaskHandler.java:136) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandlerReentrant.executeTask(SourceFile:23) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandler.executeNext(IAsyncTaskHandler.java:109) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.aX(MinecraftServer.java:1013) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.executeNext(MinecraftServer.java:1006) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.IAsyncTaskHandler.executeAll(IAsyncTaskHandler.java:95) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.a(MinecraftServer.java:1135) [19:45:31] [Paper Watchdog Thread/ERROR]:                 net.minecraft.server.v1_14_R1.MinecraftServer.run(MinecraftServer.java:919) [19:45:31] [Paper Watchdog Thread/ERROR]:                 java.lang.Thread.run(Unknown Source) [19:45:31] [Paper Watchdog Thread/ERROR]: ------------------------------ [19:45:31] [Paper Watchdog Thread/ERROR]: --- DO NOT REPORT THIS TO PAPER - THIS IS NOT A BUG OR A CRASH --- [19:45:31] [Paper Watchdog Thread/ERROR]: ------------------------------\n\ntimings:\nhttps://timings.aikar.co/?id=fa1bfb0cbde8437c8cec879a8d7a4c72\nhttps://timings.aikar.co/?id=31835ec7ffac4e6b8396aa69e1975d5e\nhttps://timings.aikar.co/?id=ef2ea526d2ca4517affef73fa8a19bc3\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1568072647361.jpg\n(45.81 KB, 下载次数: 0)\n\n\n\n\n下载附件\n\n\n2019-9-10 07:44 上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "吕易天",
            "timestamp": 1568073300,
            "txt_content": "PacketListener这东西有问题"
        },
        {
            "author": "mazd666",
            "timestamp": 1568100120,
            "txt_content": "吕易天 发表于 2019-9-10 12:54\nPacketListener这东西有问题\n感谢 目前先拔除测试看看"
        },
        {
            "author": "mazd666",
            "timestamp": 1568484180,
            "txt_content": " 本帖最后由 mazd666 于 2019-9-15 02:17 编辑 \n吕易天 发表于 2019-9-10 07:55\nPacketListener这东西有问题\n原本删了测试后正常好一段时间不想到后面又开始不正常tps飙低卡死服务器研究许久后也在paper的discord看人讨论类似情形目前找到一个可能造成原因\n\n可能有玩家装了某种mod或mod有問題会大量发送packet spam \n\n造成服务器一些插件或线程因此会卡死\n\n目前装了Packet Limiter后还真的抓到一名玩家发送过量packet 被踢出服务器请他移除后就正常且服務器稳定好一阵子了\n--------------------------------------------------------------------------------------------------------------------------------------------------\n\n想回覆帮注一下可能让也遇到此问题的服主，看到去尝试看看能不能解决偶发性卡线程崩服\n\nspigot搜寻Packet Limiter 1.0.1应该就能此數據包限制插件\n我有使用Bungee，裝子服即可，我使用作者原配置目前尚无遇到正常玩家被踢\n只有那装了不明MOD被我请他删除的玩家被插件踢出\n\ntimings看到 Minecraft :: Packet  -  PacketPlayInFlying占线程很高时候可能就是遇到packet spam \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        }
    ]
}