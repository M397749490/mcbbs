{
    "title": "【CBL|SYL】关于引号转义的探讨",
    "author": "sylqiuyifeng",
    "replyCount": 22,
    "timestamp": 1431164100,
    "txt_content": " 本帖最后由 贰逼 于 2015-5-9 19:12 编辑 \n\n首先说明一下，这帖子并不是新手教程也不是适合新人阅读的教程，所以别再回复什么看不懂了，看起来好高大上之类的回复了\n\n只是对一个重要的，在命令总中使用的机制——转义的探讨\n这次是关于多重转义的发现\n\n转义简介\n转义：转变意义\n转义最重要的功能就是告诉系统，双引号\"究竟是属于哪一层的值的\n为了避免系统混淆，值内所使用的引号需要转义，在格式要求严格的JSON中体现甚多\n比如：\n我需要tellraw显示\"hello world\"\n而格式为/tellraw @a {text:\"[值]\"}复制代码\n\n那么为了在值的部分输入引号，我们需要使用：\n/tellraw @a {text:\"\"hello world\"\"}复制代码\n\n如果没有转义（\\\"）的话\n系统会认为命令是\"\n/tellraw @a {text:\"\"}复制代码这部分已经完结了text的值（空值），然后后面的全部不符合JSON格式\n会出现\n无效的json：Unterminated object at line 1 column 10复制代码的提示\n这就是对转义的简单解释\n一切都是系统蠢惹的祸，我们必须清清楚楚告诉他\n\"hello world\"中的引号，属于第二层的引号（第一层是text部分的引号）\n那样系统就不会搞乱\n\n转义探讨\n然而我们组内在探讨2b组长：关于原版内输入格式符§的发现\n对于出现的\\\\\\\"疑惑不解\n当初我只是以为是转义的另一个写法\n事实证明了用\\\"会导致命令错误\n\n错误示范\n2b的发现很重要一步，就是通过设置牌子的CE，/blockdata某个命令方块，其中包含格式符的unicode，突破程序的限制\n以下是例子（并不涉及到格式符部分，只是类似步骤的命令）：\n/blockdata ~ ~1 ~ {Text1:\"{text:\"test\",clickEvent:{action:run_command,value:\"/blockdata 109 56 326 {Command:\"say \"hi\"\"}\"}}\"}复制代码命令本意是想修改上方的牌子，让牌子拥有blockdata掉某个命令方块的CE，使命令变成/say \"hi\"\n但效果变成了这个：\n\n右键以后也没有效果\n\n经过一轮排除测试后，发现问题出现在value部分的blockdata命令，还有里面的command NBT tag\n虽然不采用规范化书写能够排除这个问题，但是本着探讨的心，对转义系统进行了研究\n该命令最大的问题在于引号的层级和嵌套导致系统无法正确识别\n我们发现，转义也是具有层级性的\n就是说，在已转义部分，或者说在一个值里面，还需要使用引号的话，那么必须进行二次转义\n让系统不会混淆\n\n我们来分析以上错误命令\nvalue:\"/blockdata 109 56 326 {Command:\"say \"hi\"\"}\"复制代码\n问题出在这一块，value:\\\"\\\"部分没有问题，他在text1内，属于第一层转义，使用\\\"是正确的\n问题在于Command:\"\"部分，还有say \"hi\"部分的引号\nCommand后方的引号处在一层的value内，应该属于第二层\nsay \"hi\"同理，属于第三层\n所以一概使用\\\"必然会出现错误\n\n那么有着\\\\\\\"这个发现的前提下，我们发现了转义内转义的规律\n每一次转义，都必须在已经出现的\\和\"前添加多一个\\\n所以第零层的\"\n第一层的是\\\"（\"前+\\）(1个\\)\n第二层的是\\\\\\\"（基于第二层的\\\",添加多两个\\）（3个\\）\n第三层的是\\\\\\\\\\\\\\\"（添加多4个\\）（7个\\）\n如此类推\n就是说，每一层的斜杠数量都是前面的2倍+1个 \n或者使用以下公式计算\n2^n-1复制代码2的n次方-1个（n代表目前层）\n\n按照这个规律来做的话，以上命令的正确写法为：\n/blockdata ~ ~1 ~ {Text1:\"{text:\"test\",clickEvent:{action:run_command,value:\"/blockdata 109 56 326 {Command:\\\\\"say \\\\\\\\\\\\\"hi\\\\\\\\\\\\\"\\\\\"}\"}}\"}复制代码value是第一层，用\\\"\ncommand是第二层，用\\\\\\“\nsay部分的引号是第三层，用\\\\\\\\\\\\\\\"\n效果如下：\n\n\n右键之后，目标命令方块内：\n\n\n\n补充说明\n最后一点要注意的是，并不是说引号内的引号一定就是下一层的\n例如我要tellraw输出\"\"hello world\"\"\n那么命令是\n/tellraw @a {text:\"\"\"hello world\"\"\"}复制代码\n而不是\n\n/tellraw @a {text:\"\"\\\\\"hello world\\\\\"\"\"}复制代码因为他们同属text的值内的引号，是第一层转义\n所以同样使用\\\"系统就能识别了，反而第二个写法输出有误\n变成了:\n\n\n\n总结：\n1.转义使用的\\数量为：\n2^n-1复制代码2的n次方-1个（n代表目前层）\n\n2.同样层级下的转义使用同样数量的\\\n\n（终极吐槽：我看了看2b的命令，发现根本不需要多重转义……因为他是不规范格式邪教2333）\n[groupid=546]Command Block Logic[/groupid]",
    "replies": [
        {
            "author": "乾.坤",
            "timestamp": 1431164340,
            "txt_content": "cbl神教逆天233"
        },
        {
            "author": "simon3000",
            "timestamp": 1431164400,
            "txt_content": "请不要在论坛继续损害他人的自尊心和脑子了\n干得漂亮"
        },
        {
            "author": "C-青皮君",
            "timestamp": 1431164460,
            "txt_content": "\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"2\\\\\\\\\\\\\\\"333\\\\\\\"333\\\"3\\\"333\\\\\\\"333\\\\\\\\\\\\\\\"333\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\""
        },
        {
            "author": "pca006132",
            "timestamp": 1431164520,
            "txt_content": "拜见大神{:10_512:}，小弟想问问\n是不是json里面所有的转移都是同一层级的，只是NBT里面的需要多层转移？\n我路过所以就水个回复了233333{:10_496:}"
        },
        {
            "author": "simon3000",
            "timestamp": 1431164580,
            "txt_content": "今天发了好多东西?\n高产啊\n\n貌似和我以前再用Bat输出另外一个文档的时候不知道怎么输出\"(好像)的类似问题的解决办法"
        },
        {
            "author": "ufof",
            "timestamp": 1431164700,
            "txt_content": "先让我在读几遍"
        },
        {
            "author": "sylqiuyifeng",
            "timestamp": 1431164760,
            "txt_content": "pca006132 发表于 2015-5-9 17:42\n拜见大神，小弟想问问\n是不是json里面所有的转移都是同一层级的，只是NBT里面的需要多层转移？\n ...\n……\n反正就是如果是一个值内套一个值的话\n就是+一层的转义"
        },
        {
            "author": "sylqiuyifeng",
            "timestamp": 1431165000,
            "txt_content": " 本帖最后由 贰逼 于 2015-5-9 19:15 编辑 \nsimon3000 发表于 2015-5-9 17:43\n今天发了好多东西?\n高产啊\n233\n其实我这探讨是受2b帖子的启发\n但我回首一看的时候\n发现不规范书写其实根本不需要这科技……\n结果就是无中生有了的感觉"
        },
        {
            "author": "lzs1234",
            "timestamp": 1431167220,
            "txt_content": "系统本来就蠢…（有人说这是为了系统准确…）\n在value里打带引号的NBT真是令人发疯…\n（为什么这么多人看不懂，很简单嘛…）"
        },
        {
            "author": "sylqiuyifeng",
            "timestamp": 1431167280,
            "txt_content": "lzs1234 发表于 2015-5-9 18:27\n系统本来就蠢…（有人说这是为了系统准确…）\n在value里打带引号的NBT真是令人发疯…\n（为什么这么多人看不 ...\n这就是这次探讨出现的原因了"
        },
        {
            "author": "huanghongxun",
            "timestamp": 1431168060,
            "txt_content": "MC的代码比较蠢。。\n写的转义比较坑\n一切都是Dinnerbone的锅"
        },
        {
            "author": "sylqiuyifeng",
            "timestamp": 1431168060,
            "txt_content": "huanghongxun 发表于 2015-5-9 18:41\nMC的代码比较蠢。。\n写的转义比较坑\n一切都是Dinnerbone的锅\n1，3，7，15，31个/\n想想都觉得恐怖……\n虽然我觉得能用到7个的时候已经是很过分的命令了233"
        },
        {
            "author": "huanghongxun",
            "timestamp": 1431168240,
            "txt_content": "sylqiuyifeng 发表于 2015-5-9 18:41\n1，3，7，15，31个/\n想想都觉得恐怖……\n虽然我觉得能用到7个的时候已经是很过分的命令了233 ...\nmc指令长度好像是有限制的"
        },
        {
            "author": "sylqiuyifeng",
            "timestamp": 1431168840,
            "txt_content": " 本帖最后由 sylqiuyifeng 于 2015-5-9 19:00 编辑 \nhuanghongxun 发表于 2015-5-9 18:44\nmc指令长度好像是有限制的\n聊天栏打是100个\n如果是CB里面是32767\n不过还是那句……\n你用这么多层转义是干什么鬼啊……经过计算\n到了15层转义的时候刚刚好需要用32767个/，连引号都放不进去\n如果算两边开关和两个引号的话，一共能套13层，用32764个字，还有3个空位留给你，真贴心"
        },
        {
            "author": "⭐✔️",
            "timestamp": 1431169200,
            "txt_content": "尿了 错误示范后面突然提到我的名字以为我错了"
        },
        {
            "author": "sylqiuyifeng",
            "timestamp": 1431169380,
            "txt_content": "贰逼 发表于 2015-5-9 19:00\n尿了 错误示范后面突然提到我的名字以为我错了\n你的命令确实是错误示范啊\n规范化书写的错误示范233"
        },
        {
            "author": "⭐✔️",
            "timestamp": 1431169500,
            "txt_content": "sylqiuyifeng 发表于 2015-5-9 19:03\n你的命令确实是错误示范啊\n规范化书写的错误示范233\nFAQ很羞耻\n而且规范个卵，能用就行"
        },
        {
            "author": "⭐✔️",
            "timestamp": 1431169620,
            "txt_content": "sylqiuyifeng 发表于 2015-5-9 19:07\n虽然我也赞成这个说法\n能用至上教派\n真要这样写转义不如让我死了算吧233\n换个名字"
        },
        {
            "author": "sylqiuyifeng",
            "timestamp": 1431169620,
            "txt_content": "贰逼 发表于 2015-5-9 19:05\nFAQ很羞耻\n而且规范个卵，能用就行\n虽然我也赞成这个说法\n能用至上教派\n真要这样写转义不如让我死了算吧233"
        },
        {
            "author": "PotatoMaster101",
            "timestamp": 1431172140,
            "txt_content": "今天是CBL黑科技发布会吗"
        },
        {
            "author": "chyx",
            "timestamp": 1431301500,
            "txt_content": "\\' 中得\\变成\\\\\n'变成\\'\n连起来就是\\\\\\'么？"
        },
        {
            "author": "sylqiuyifeng",
            "timestamp": 1431336540,
            "txt_content": "chyx 发表于 2015-5-11 07:45\n\\' 中得\\变成\\\\\n'变成\\'\n连起来就是\\\\\\'么？\n是的\n这就是转换规律"
        }
    ]
}