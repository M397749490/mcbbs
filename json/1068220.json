{
    "title": "1.16.1fabric服务端, 如何实现自动备份?",
    "author": "Qiucraft",
    "replyCount": 4,
    "timestamp": 1593169560,
    "txt_content": "1.16.1fabric服务端, 如何实现自动备份?\n要求可以实现每天4点备份一次, 备份数量超过7个的话先删除最早的备份再开始下一个备份.",
    "replies": [
        {
            "author": "蕾米洛伊",
            "timestamp": 1593169560,
            "txt_content": " 本帖最后由 蕾米洛伊 于 2020-6-26 23:44 编辑 \n\nhttps://www.mcbbs.net/forum.php?mod=viewthread&tid=512486\n这个插件支持指定备份时间 备份归档上限等\nhttps://www.mcbbs.net/forum.php?mod=viewthread&tid=781871\n这个也可以，支持全版本\n\n虽然是插件应用，但是我想说，Python，永远滴神。\n20分钟写完的，测试基本功能无残废，插件找不到可以试试这个。\n(不知道会不会被发卡跑题)\n\n#coding=utf-8\n\nimport os, time\nfrom zipfile import ZipFile,ZIP_DEFLATED\nfrom threading import Thread\n\n# 要备份哪个文件夹下的数据\nZipPath = \"1\"\n# 归档保存在哪\nSavePath = \"2\"\n# 多长时间检查一次小时\nMin = 1\n\ndef save_timer():\n    while True:\n        r = []\n        # 最老的文件时间戳\n        l = time.time()*100000\n        # 最老的文件文件名\n        ln = \"\"\n        for path,dirnames,fs in os.walk(SavePath):\n            for f in fs:\n                r.append(f)\n                file_creation_time = int(os.stat(os.path.join(path,f)).st_mtime*100000)\n                if(file_creation_time < l):\n                    l = file_creation_time\n                    ln = f\n        if(len(r)>7):\n            # 删除最老文件\n            os.remove(os.path.join(SavePath, ln))\n            print(\"归档超过7个，删除了最早备份 \"+os.path.join(SavePath, ln))\n\n        if(time.localtime().tm_hour == 23):\n            backup()\n\n        time.sleep(Min*60)\n\ndef zipDir(dirpath,outFullName):\n    zip = ZipFile(outFullName,\"w\",ZIP_DEFLATED)\n    for path,dirnames,filenames in os.walk(dirpath):\n        fpath = path.replace(dirpath,'')\n        for filename in filenames:\n            zip.write(os.path.join(path,filename),os.path.join(fpath,filename))\n    zip.close()\n\ndef backup():\n    global ZipPath, SavePath\n    pathname = str(os.path.join(SavePath,\"备份-\" + (time.strftime(\"%Y-%m-%d@%H-%M-%S\", time.localtime()) + \".zip\")))\n    zipDir(ZipPath.replace(\"\\\\\",\"/\"), pathname)\n    print(\"备份完成 (归档路径:{0})\".format(pathname))\n\nsave_timer()"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1593171240,
            "txt_content": "你不是可以自己写插件嘛\n不难实现啊"
        },
        {
            "author": "Qiucraft",
            "timestamp": 1593172200,
            "txt_content": "南柯郡守 发表于 2020-6-26 19:34\n你不是可以自己写插件嘛\n不难实现啊\n学校的电脑没有安装IDEA, 我得放假后在家里才能写插件.\n而且这类插件应该是有现成的吧, 再造一个就没什么必要了."
        },
        {
            "author": "南柯郡守",
            "timestamp": 1593172260,
            "txt_content": "18276415926 发表于 2020-6-26 19:50\n学校的电脑没有安装IDEA, 我得放假后在家里才能写插件.\n而且这类插件应该是有现成的吧, 再造一个就没什么 ...\n知道有现成的推荐\nsite:mcbbs.net 自动保存\n\n没有满意的=没有现成的"
        }
    ]
}