{
    "title": "【speelf】插件开发中",
    "author": "Hineven",
    "replyCount": 10,
    "timestamp": 1416715200,
    "txt_content": " 本帖最后由 胡晨晓 于 2015-2-4 13:44 编辑 \n\n自己写的第一个插件。\n就是挖雪球的小游戏插件\n由于是第一次写插件\n经验不足\n各位大大可以来指出不足的地\n源代码：Speelf:\npackage plugin;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.util.List;\nimport java.util.logging.Logger;\n\nimport org.bukkit.Bukkit;\nimport org.bukkit.ChatColor;\nimport org.bukkit.Location;\nimport org.bukkit.World;\nimport org.bukkit.block.Sign;\nimport org.bukkit.command.Command;\nimport org.bukkit.command.CommandSender;\nimport org.bukkit.configuration.file.FileConfiguration;\nimport org.bukkit.configuration.file.YamlConfiguration;\nimport org.bukkit.entity.Player;\nimport org.bukkit.plugin.java.JavaPlugin;\n\nimport sign.SignHandler;\nimport sign.SignManager;\nimport sign.types.JoinSign;\nimport arena.Arena;\nimport arena.ArenaManager;\nimport arena.data.ArenaSize;\nimport arena.data.ArenaStatus;\nimport arena.data.PlayerData;\nimport arena.listeners.Protector;\nimport arena.listeners.GameController;\nimport arena.messages.Message;\nimport arena.reset.map.MapHandler;\n\npublic class Speelf extends JavaPlugin {\n\n        Logger logger;\n        int arena_num = 0;\n        File config_file = null;\n        ArenaManager arenaManager = null;\n        SignManager signManager = null;\n        boolean mod=false;\n        Protector protector=null;\n\n        FileConfiguration ckeckConfig(File f) {\n                if (!f.exists()) {\n                        try {\n                                f.createNewFile();\n                        } catch (IOException e) {\n                                e.printStackTrace();\n                        }\n                }\n                return YamlConfiguration.loadConfiguration(f);\n        }\n\n        public ArenaManager getArenas() {\n                return arenaManager;\n        }\n\n        public SignManager getSignManager() {\n                return signManager;\n        }\n\n        public void loadData() {//TODO \n                File configFile = new File(getDataFolder()+File.separator+\"arenas.yml\");\n                FileConfiguration fc = ckeckConfig(configFile);\n                int arenanum = fc.getInt(\"arenas\");\n                for (int l = 0; l < arenanum; l++) {\n                        String aname = fc.getString(\"\" + l + \".Name\");\n                        logger.info(\"Loading arena: \" + aname + \".\");\n                        World arenaw = Bukkit.getWorld(fc.getString(\"\" + l + \".Tp.World\"));\n                        double arenaatx = fc.getDouble(\"\" + l + \".Tp.X\");\n                        double arenaaty = fc.getDouble(\"\" + l + \".Tp.Y\");\n                        double arenaatz = fc.getDouble(\"\" + l + \".Tp.Z\");\n                        Location tploc = new Location(arenaw, arenaatx, arenaaty, arenaatz);\n\n                        World tpbat = Bukkit.getWorld(fc\n                                        .getString(\"\" + l + \".TpBack.World\"));\n                        double tpbatx = fc.getDouble(\"\" + l + \".TpBack.X\");\n                        double tpbaty = fc.getDouble(\"\" + l + \".TpBack.Y\");\n                        double tpbatz = fc.getDouble(\"\" + l + \".TpBack.Z\");\n                        Location tpbloc = new Location(tpbat, tpbatx, tpbaty, tpbatz);\n\n                        World szaw = Bukkit\n                                        .getWorld(fc.getString(\"\" + l + \".Size.H.World\"));\n                        double szax = fc.getDouble(\"\" + l + \".Size.H.X\");\n                        double szay = fc.getDouble(\"\" + l + \".Size.H.Y\");\n                        double szaz = fc.getDouble(\"\" + l + \".Size.H.Z\");\n                        Location sza = new Location(szaw, szax, szay, szaz);\n\n                        World szbw = Bukkit\n                                        .getWorld(fc.getString(\"\" + l + \".Size.L.World\"));\n                        double szbx = fc.getDouble(\"\" + l + \".Size.L.X\");\n                        double szby = fc.getDouble(\"\" + l + \".Size.L.Y\");\n                        double szbz = fc.getDouble(\"\" + l + \".Size.L.Z\");\n                        Location szb = new Location(szbw, szbx, szby, szbz);\n\n                        int maxPlayer = fc.getInt(\"\" + l + \".MaxPlayer\");\n\n                        MapHandler mhd = new MapHandler(this, null);\n                        Arena loadingArena = new Arena(aname, maxPlayer, tploc, mhd);\n                        mhd.setHandleArena(loadingArena);\n                        loadingArena.copySize(new ArenaSize(sza, szb).sort());\n                        GameController ghd = new GameController(this, loadingArena);\n                        loadingArena.setGameRuleHandler(ghd);\n                        loadingArena.copyTeleportBackLocation(tpbloc);\n\n                        int jsCount = fc.getInt(\"\" + l + \".JoinSign.Num\");\n                        for (int i = 0; i < jsCount; i++) {\n                                World jsw = Bukkit.getWorld(fc.getString(\"\" + l + \".JoinSign.\"\n                                                + i + \".World\"));\n                                int jsx = fc.getInt(\"\" + l + \".JoinSign.\" + i + \".X\");\n                                int jsy = fc.getInt(\"\" + l + \".JoinSign.\" + i + \".Y\");\n                                int jsz = fc.getInt(\"\" + l + \".JoinSign.\" + i + \".Z\");\n                                Location jsloc = new Location(jsw, jsx, jsy, jsz);\n                                JoinSign js = new JoinSign(loadingArena, (Sign) jsloc\n                                                .getBlock().getState());\n                                loadingArena.addJoinSign(js);\n                                signManager.regist(js);\n                        }\n                        arenaManager.addArena(loadingArena);\n                        loadingArena.setStatus(ArenaStatus.WaitForPlayer);\n                        loadingArena.paintAllSigns();\n                        logger.info(\"Loaded arena: \" + aname + \".\");\n                }\n        }\n\n        @Override\n        public boolean onCommand(CommandSender cmdsd, Command cmd, String label,\n                        String args[]) {\n\n                if (args.length == 0 && label.equalsIgnoreCase(\"speelf\")) {\n\n                        if (cmdsd.isOp() || !(cmdsd instanceof Player))\n                                cmdsd.sendMessage(ChatColor.GRAY + \"[Speelf] by Hineven\\n\"\n                                                + \"/speelf leave [roomname](not finish yet)\\n\"\n                                                + \"/speelf join [roomname](not finish yet)\\n\"\n                                                + \"/speelf creatnewarena [arenanamename] [maxplayer]\\n\"\n                                                + \"/speelf load [name](not finish yet)\\n\"\n                                                + \"/speelf quit [name](not finish yet)\\n\"\n                                                + \"/speelf delete [arenaname]\\n\" + \"/speelf help\\n\"\n                                                + \"/speelf setTpBackLocation [arenaname]\\n\"\n                                                + \"/speelf setWorking [arenaname] [true/false]\\n\"\n                                                + \"/speelf sizea [arenaname]\\n\"\n                                                + \"/speelf sizeb [arenaname]\\n\"\n                                                + \"/speelf reset [arenaname]\\n\" + \"/speelf list\\n\"\n                                                + \"/speelf start [arenaname](for test)\\n\"\n                                                + \"/speelf clean [arenaname]\\n\"\n                                                + \"/speelf sts [arenaname](removed)\\n\"\n                                                + \"version: beta UT6\");\n                        else\n                                cmdsd.sendMessage(\"§r[Speelf] by Hineven\\n\"\n                                                + \"/speelf leave [roomname]\\n\"\n                                                + \"/speelf join [roomname]\\n\" + \"/speelf help\");\n\n                        return true;\n                }\n\n                if (cmdsd instanceof Player && cmdsd.hasPermission(\"speelf.cde\")) {\n\n                        if (args[0].equalsIgnoreCase(\"createnewarena\")) {\n                                if (args.length != 3) {\n                                        cmdsd.sendMessage(\"§c/speelf createnewarena [name] [maxplayer]\");\n                                        return true;\n                                }\n                                try {\n                                        Arena arena = null;\n                                        MapHandler mh = new MapHandler(this, arena);\n                                        arena = new arena.Arena(args[1], Integer.parseInt(args[2]),\n                                                        ((Player) cmdsd).getLocation(), mh);\n                                        mh.setHandleArena(arena);\n        \n                                        GameController hd = new GameController(this, arena);\n                                        arena.setGameRuleHandler(hd);\n                                        cmdsd.sendMessage(Message.finish);\n                                        cmdsd.sendMessage(ChatColor.RED\n                                                        + \"You must set tpback point\"\n                                                        + \"and the size of this arena \" + \"and the status \"\n                                                        + \"before play in it!\\n\"\n                                                        + \"Use /speelf setTpBackPoint [arenaname] and\"\n                                                        + \"/speelf sizea [arenaname] ,\"\n                                                        + \"/speelf sizeb [arenaname] ,\"\n                                                        + \"/speelf setworking [true/false] to set them.\");\n                                        arenaManager.addArena(arena);\n                                        return true;\n\n                                } catch (Exception e) {\n                                        e.printStackTrace();\n                                        cmdsd.sendMessage(\"Wrong args!\");\n                                }\n\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"list\")) {\n                                int n = arenaManager.getArenaNum();\n                                for (int i = 0; i < n; i++) {\n                                        cmdsd.sendMessage(ChatColor.YELLOW + \"\" + (i + 1) + \".\"\n                                                        + arenaManager.get(i).getName() + \" \"\n                                                        + arenaManager.get(i).getStatus().toString());\n                                }\n                                cmdsd.sendMessage(ChatColor.GRAY + \"=====Finish=====\");\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"setworking\")) {\n                                if (args.length != 3) {\n                                        cmdsd.sendMessage(\"§c/speelf setworking [arenaname] [true/false]\");\n                                        return true;\n                                }\n                                Arena are = arenaManager.get(args[1]);\n                                if (are == null) {\n                                        cmdsd.sendMessage(Message.arenaNotFound);\n                                        return true;\n                                }\n                                ArenaStatus as = ArenaStatus.OpEdit;\n                                boolean bool = false;\n                                try {\n                                        bool = Boolean.parseBoolean(args[2]);\n                                } catch (NumberFormatException e) {\n                                        cmdsd.sendMessage(Message.wrongArgs);\n                                        return true;\n                                }\n                                if (bool)\n                                        as = ArenaStatus.WaitForPlayer;\n                                are.setStatus(as);\n                                are.paintAllSigns();\n                                cmdsd.sendMessage(Message.finish);\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"start\")) {\n                                if (args.length != 3) {\n                                        cmdsd.sendMessage(\"§a/speelf start [name] [true/false]\");\n                                        return true;\n                                }\n                                Arena arena = arenaManager.get(args[1]);\n                                if (arena == null) {\n                                        cmdsd.sendMessage(Message.arenaNotFound);\n                                        return true;\n                                }\n                                arena.setStatus(ArenaStatus.InGame);\n                                arena.paintAllSigns();\n                                cmdsd.sendMessage(Message.finish);\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"reset\")) {\n                                if (args.length != 2) {\n                                        cmdsd.sendMessage(\"§a/speelf reset [name]\");\n                                        return true;\n                                }\n                                Arena arena = arenaManager.get(args[1]);\n                                if (arena == null) {\n                                        cmdsd.sendMessage(Message.arenaNotFound);\n                                        return true;\n                                }\n                                arena.message(Message.arenaCleanedByOp);\n                                GameController.endRound(arena);\n                                arena.setStatus(ArenaStatus.WaitForPlayer);\n                                arena.paintAllSigns();\n                                cmdsd.sendMessage(Message.finish);\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"delete\")) {\n                                if (args.length != 2) {\n                                        cmdsd.sendMessage(ChatColor.RED + \"/speelf delete [name]\");\n                                        return true;\n                                }\n                                Arena arena = arenaManager.get(args[1]);\n                                if (arena == null) {\n                                        cmdsd.sendMessage(Message.arenaNotFound);\n                                        return true;\n                                }\n                                arena.message(Message.arenaCleanedByOp);\n                                GameController.endRound(arena);\n                                List<JoinSign> js = arena.getJoinSigns();\n                                for (JoinSign j : js)\n                                        signManager.unLoad(j);\n                                arenaManager.deleteArena(arena);\n                                cmdsd.sendMessage(Message.finish);\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"clean\")) {\n                                if (args.length != 2) {\n                                        cmdsd.sendMessage(ChatColor.RED + \"/speelf clean [name]\");\n                                        return true;\n                                }\n                                Arena arena = arenaManager.get(args[1]);\n                                if (arena == null) {\n                                        cmdsd.sendMessage(Message.arenaNotFound);\n                                        return true;\n                                }\n                                arena.message(Message.arenaCleanedByOp);\n                                List<PlayerData> pl = arena.getPlayers();\n                                for (PlayerData i : pl) {\n                                        i.getPlayer().teleport(arena.getReturnLocation());\n                                }\n                                arena.clear();\n                                arena.paintAllSigns();\n                                cmdsd.sendMessage(Message.finish);\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"setTpBackLocation\")) {\n                                if (args.length != 2) {\n                                        cmdsd.sendMessage(ChatColor.RED\n                                                        + \"/speelf setTpBackLocation [name]\");\n                                        return true;\n                                }\n                                Arena arena = arenaManager.get(args[1]);\n                                if (arena == null) {\n                                        cmdsd.sendMessage(Message.arenaNotFound);\n                                        return true;\n                                }\n                                arena.copyTeleportBackLocation(((Player) cmdsd).getLocation());\n                                arena.paintAllSigns();\n                                cmdsd.sendMessage(Message.finish);\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"sizea\")) {\n                                if (args.length != 2) {\n                                        cmdsd.sendMessage(ChatColor.RED + \"/speelf sizea [name]\");\n                                        return true;\n                                }\n                                Arena arena = arenaManager.get(args[1]);\n                                if (arena == null) {\n                                        cmdsd.sendMessage(Message.arenaNotFound);\n                                        return true;\n                                }\n                                Location pl=((Player) cmdsd).getLocation();\n                                arena.copyP1(pl);\n                                /*cmdsd.sendMessage(ChatColor.YELLOW\n                                                + \"Be careful! \\n\"\n                                                + \"You must use /speelf sts [arenaname] to init the size of\\n\"\n                                                + \"this arena when you set both point a and point b!\");*/\n                                cmdsd.sendMessage(ChatColor.GREEN + \"Choose \" + pl.getBlockX() + \n                                \",\" + pl.getBlockY() + \",\" + pl.getBlockZ() + \" for the first point of '\" + arena.getName() + \"'.\");\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"sizeb\")) {\n                                if (args.length != 2) {\n                                        cmdsd.sendMessage(ChatColor.RED + \"/speelf sizeb [name]\");\n                                        return true;\n                                }\n                                Arena arena = arenaManager.get(args[1]);\n                                if (arena == null) {\n                                        cmdsd.sendMessage(Message.arenaNotFound);\n                                        return true;\n                                }\n                                Location pl=((Player) cmdsd).getLocation();\n                                arena.copyP2(pl);\n                                cmdsd.sendMessage(ChatColor.GREEN + \"Choose \" + pl.getBlockX() + \n                                \",\" + pl.getBlockY() + \",\" + pl.getBlockZ() + \" for the second point of '\" + arena.getName() + \"'.\");\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"sts\")) {\n                                if (args.length != 2) {\n                                        cmdsd.sendMessage(ChatColor.RED + \"/speelf sts [name]\");\n                                        return true;\n                                }\n                                Arena arena = arenaManager.get(args[1]);\n                                if (arena == null) {\n                                        cmdsd.sendMessage(Message.arenaNotFound);\n                                        return true;\n                                }\n                                arena.getSize().sort();\n                                cmdsd.sendMessage(Message.finish);\n                                return true;\n                        }\n\n                        if (args[0].equalsIgnoreCase(\"refreshSigns\")) {\n                                List<Arena> arenas = arenaManager.getAllArenas();\n                                for (Arena arena : arenas) {\n                                        arena.paintAllSigns();\n                                }\n                                cmdsd.sendMessage(Message.finish);\n                                return true;\n                        }\n                        \n                        if(args[0].equalsIgnoreCase(\"editmod\")){\n                                this.mod=!this.mod;\n                                cmdsd.sendMessage(Message.EDEditMod);\n                                return true;\n                        }\n\n                } else {\n                        cmdsd.sendMessage(Message.noPermission);\n                        return true;\n                }\n                return false;\n        }\n\n        @Override\n        public void onDisable() {\n                List<Arena> ares = arenaManager.getAllArenas();\n                for (Arena hda : ares) {\n                        logger.info(\"Resetting arena: \" + hda.getName() + \".\");\n                        hda.getGameRuleHandler().endRound();\n                }\n                saveData();\n                logger.info(\"Speelf game 已卸载.\");\n        }\n\n        @Override\n        public void onEnable() {\n                logger = getLogger();\n                arenaManager = new ArenaManager();\n                signManager = new SignManager();\n                protector=new Protector(this);\n                getServer().getPluginManager().registerEvents(protector, this);\n                getServer().getPluginManager().registerEvents(new SignHandler(this), this);\n                getDataFolder().mkdir();\n                loadData();\n                logger.info(\"Speelf game 已加载.\");\n\n        }\n\n        public void saveData() {\n                File configFile = new File(getDataFolder()+File.separator+\"arenas.yml\");\n                configFile.delete();\n                try {\n                        configFile.createNewFile();\n                } catch (IOException e1) {\n                        e1.printStackTrace();\n                }\n                FileConfiguration fc = ckeckConfig(configFile);\n                fc.set(\"arenas\", arenaManager.getArenaNum());\n                for (int l = 0; l < arenaManager.getArenaNum(); l++) {\n                        Arena a = arenaManager.get(l);\n                        fc.set(\"\" + l + \".Name\", a.getName());\n                        fc.set(\"\" + l + \".MaxPlayer\", a.getMaxPlayer());\n                        fc.set(\"\" + l + \".Tp.World\", a.getWorld().getName());\n                        fc.set(\"\" + l + \".Tp.X\", a.getTeleportLocation().getX());\n                        fc.set(\"\" + l + \".Tp.Y\", a.getTeleportLocation().getY());\n                        fc.set(\"\" + l + \".Tp.Z\", a.getTeleportLocation().getZ());\n                        fc.set(\"\" + l + \".TpBack.World\", a.getReturnLocation().getWorld()\n                                        .getName());\n                        fc.set(\"\" + l + \".TpBack.X\", a.getReturnLocation().getX());\n                        fc.set(\"\" + l + \".TpBack.Y\", a.getReturnLocation().getY());\n                        fc.set(\"\" + l + \".TpBack.Z\", a.getReturnLocation().getZ());\n                        fc.set(\"\" + l + \".Size.H.World\", a.getSize().getH().getWorld()\n                                        .getName());\n                        fc.set(\"\" + l + \".Size.H.X\", a.getSize().getH().getX());\n                        fc.set(\"\" + l + \".Size.H.Y\", a.getSize().getH().getY());\n                        fc.set(\"\" + l + \".Size.H.Z\", a.getSize().getH().getZ());\n                        fc.set(\"\" + l + \".Size.L.World\", a.getSize().getL().getWorld()\n                                        .getName());\n                        fc.set(\"\" + l + \".Size.L.X\", a.getSize().getL().getX());\n                        fc.set(\"\" + l + \".Size.L.Y\", a.getSize().getL().getY());\n                        fc.set(\"\" + l + \".Size.L.Z\", a.getSize().getL().getZ());\n                        fc.set(\"\" + l + \".JoinSigns.Num\", a.getJoinSignCount());\n                        for (int i = 0; i < a.getJoinSigns().size(); i++) {\n                                fc.set(\"\" + l + \".JoinSign.\" + i + \".World\", a.getJoinSign(i)\n                                                .getSign().getLocation().getWorld().getName());\n                                fc.set(\"\" + l + \".JoinSign.\" + i + \".X\", a.getJoinSign(i)\n                                                .getSign().getBlock().getX());\n                                fc.set(\"\" + l + \".JoinSign.\" + i + \".Y\", a.getJoinSign(i)\n                                                .getSign().getBlock().getY());\n                                fc.set(\"\" + l + \".JoinSign.\" + i + \".Z\", a.getJoinSign(i)\n                                                .getSign().getBlock().getZ());\n                        }\n                }\n                try {\n                        fc.save(configFile);\n                } catch (IOException e) {\n                        logger.info(\"Saving data exception!!Check the config file plz\");\n                        e.printStackTrace();\n                }\n                logger.info(\"Data saved.\");\n        }\n        \n        public boolean isEditMod(){\n                return mod;\n        }\n\n        public void performOutPut(String string) {\n                logger.info(string);\n                \n        }\n\n}\n复制代码Arena:\npackage arena;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.bukkit.ChatColor;\nimport org.bukkit.Location;\nimport org.bukkit.Material;\nimport org.bukkit.World;\nimport org.bukkit.block.Sign;\nimport org.bukkit.enchantments.Enchantment;\nimport org.bukkit.entity.Player;\nimport org.bukkit.inventory.ItemStack;\n\nimport sign.SignEditor;\nimport sign.types.JoinSign;\nimport arena.data.ArenaSize;\nimport arena.data.ArenaStatus;\nimport arena.data.PlayerData;\nimport arena.listeners.GameController;\nimport arena.messages.Message;\nimport arena.reset.map.MapHandler;\n\npublic class Arena {\n\n        Message msgSender = null;\n\n        ArenaStatus arenaStatus = null;\n\n        private GameController gameRuleHandler = null;\n\n        MapHandler grHandler = null;\n\n        List<JoinSign> joinSigns = new ArrayList<JoinSign>();\n        final int leastPlayers = 2;\n        int maxPlayer = -1;\n\n        String name = \"\";\n\n        int playerCount = 0;\n        List<PlayerData> players = new ArrayList<PlayerData>();\n\n        ArenaSize size = null;\n\n        Location teleportBackLocation = null;\n\n        Location teleportLocation = null;\n\n        public Arena(String n, int mp, Location loc, MapHandler hdr) {\n\n                teleportLocation = loc;\n                grHandler = hdr;\n                maxPlayer = mp;\n                name = n;\n                arenaStatus = ArenaStatus.OpEdit;\n                msgSender = new Message(this);\n                size = new ArenaSize();\n        }\n\n        public boolean add(Player p) {\n                if (arenaStatus == ArenaStatus.Starting\n                                || arenaStatus == ArenaStatus.WaitForPlayer) {\n                        players.add(new PlayerData(p));\n                        playerCount++;\n                        return true;\n                }\n                return false;\n        }\n\n        public void addJoinSign(JoinSign sig) {\n                joinSigns.add(sig);\n                // sig.setCode(joinSigns.size());\n        }\n\n        public boolean checkJoin() {\n                if (!checkWork())\n                        return false;\n                if (playerCount == maxPlayer)\n                        return false;\n                if (arenaStatus == ArenaStatus.WaitForPlayer)\n                        return true;\n                return false;\n        }\n\n        @SuppressWarnings(\"deprecation\")\n        public boolean checkWork() {\n                if (teleportLocation == null)\n                        return false;\n                if (teleportBackLocation == null)\n                        return false;\n                if (size == null)\n                        return false;\n                if (size.isInited() == false)//TODO\n                        return false;\n                return true;\n        }\n\n        public void clear() {\n                players.clear();\n                playerCount = 0;\n        }\n\n        public void clearAllPlayersInventory() {\n\n                for (PlayerData pd : players) {\n                        pd.getPlayer().getInventory().clear();\n                }\n\n        }\n\n        public void deleteJoinSign(Sign state) {\n                for (JoinSign js : joinSigns) {\n                        if (js.getSign().getLocation().equals(state.getLocation())) {\n                                joinSigns.remove(js);\n                        }\n                }\n\n        }\n\n        @Override\n        public boolean equals(Object obj) {\n                if (!(obj instanceof Arena))\n                        return false;\n                if (((Arena) obj).getName().equalsIgnoreCase(name))\n                        return true;\n                return false;\n        }\n\n        public GameController getGameRuleHandler() {\n                return gameRuleHandler;\n        }\n\n        public MapHandler getGroundHandler() {\n                return grHandler;\n        }\n\n        public JoinSign getJoinSign(int index) {\n                return joinSigns.get(index);\n        }\n\n        public int getJoinSignCount() {\n                return joinSigns.size();\n        }\n\n        public List<JoinSign> getJoinSigns() {\n                return joinSigns;\n        }\n\n        public int getMaxPlayer() {\n                return maxPlayer;\n        }\n\n        public Message getMsgSender() {\n                return msgSender;\n        }\n\n        public String getName() {\n                return name;\n        }\n\n        /**\n         * @deprecated\n         * @param index\n         * @return\n         */\n        public PlayerData getPlayer(int index) {\n                return players.get(index);\n\n        }\n\n        public PlayerData getPlayer(String name) {\n                for (int i = 0; i < playerCount; i++) {\n                        if (players.get(i).getName().equalsIgnoreCase(name))\n                                return players.get(i);\n                }\n                return null;\n\n        }\n        \n        public PlayerData getPlayer(Player p){\n                for (int i = 0; i < playerCount; i++) {\n                        if (players.get(i).getName().equalsIgnoreCase(p.getName()))\n                                return players.get(i);\n                }\n                return null;\n        }\n\n        public int getPlayerCount() {\n                return playerCount;\n        }\n\n        public List<PlayerData> getPlayers() {\n                return players;\n        }\n\n        public Location getReturnLocation() {\n                return teleportBackLocation;\n        }\n\n        public ArenaSize getSize() {\n                return size;\n        }\n\n        public ArenaStatus getStatus() {\n                return arenaStatus;\n        }\n\n        public Location getTeleportLocation() {\n                return teleportLocation;\n        }\n\n        public World getWorld() {\n                return teleportLocation.getWorld();\n        }\n\n        public boolean isFull() {\n                if (maxPlayer == playerCount)\n                        return true;\n                return false;\n        }\n\n        public boolean isInited() {\n                if (grHandler == null || gameRuleHandler == null || size == null)\n                        return false;\n                return true;\n        }\n\n        public boolean isInThisArena(String nam) {\n                for (int i = 0; i < playerCount; i++) {\n                        if (players.get(i).getName().equalsIgnoreCase(nam))\n                                return true;\n                }\n                return false;\n        }\n\n        /**\n         * @deprecated\n         * @return\n         */\n        @Deprecated\n        public boolean isResetting() {\n                if (arenaStatus == ArenaStatus.Resetting)\n                        return true;\n                return false;\n        }\n\n        public boolean isStarted() {\n                if (arenaStatus == ArenaStatus.InGame)\n                        return true;\n                return false;\n        }\n\n        /**\n         * Use 'getStatus()'\n         * @deprecated \n         * @return\n         */\n        @Deprecated\n        public boolean isWorking() {\n                if (arenaStatus != ArenaStatus.OpEdit\n                                && arenaStatus != ArenaStatus.Stop)\n                        return true;\n                return false;\n        }\n\n        /**\n         * just delete the player from the player list\n         * @param player\n         */\n        public void leave(Player player) {\n                for (int i = 0; i < playerCount; i++) {\n                        if (players.get(i).getName().equalsIgnoreCase(player.getName())) {\n                                players.remove(i);\n                                playerCount--;\n                                break;\n                        }\n                }\n        }\n\n        public void message(String arg) {\n                for (int i = 0; i < playerCount; i++) {\n                        players.get(i).getPlayer().sendMessage(arg);\n                }\n        }\n\n        @SuppressWarnings(\"deprecation\")\n        public void out(String pname) {\n                PlayerData p = getPlayer(pname);\n                p.setDeadth(true);\n                message(ChatColor.YELLOW + p.getName() + \" was out!\");\n                p.getPlayer().setFlying(true);\n                for (PlayerData i : players) {\n                        if (!i.getName().equalsIgnoreCase(p.getName()))\n                                i.getPlayer().hidePlayer(p.getPlayer());\n                }\n                p.getPlayer().getInventory().clear();\n                p.getPlayer().updateInventory();\n                p.getPlayer().sendMessage(ChatColor.RED + \"You were out!\");\n\n        }\n        \n        @SuppressWarnings(\"deprecation\")\n        public void out(Player pl) {\n                PlayerData p = getPlayer(pl);\n                p.getPlayer().setAllowFlight(true);\n                p.setDeadth(true);\n                message(ChatColor.YELLOW + p.getName() + \" was out!\");\n                p.getPlayer().setFlying(true);\n                for (PlayerData i : players) {\n                        if (!i.getName().equalsIgnoreCase(p.getName()))\n                                i.getPlayer().hidePlayer(p.getPlayer());\n                }\n                p.getPlayer().getInventory().clear();\n                p.getPlayer().updateInventory();\n                p.getPlayer().sendMessage(ChatColor.RED + \"You were out!\");\n        }\n\n        public void paintAllSigns() {\n                for (JoinSign js : joinSigns) {\n                        SignEditor.paint(js);\n                }\n        }\n\n        private void sendTools() {\n                ItemStack tool = new ItemStack(Material.DIAMOND_SPADE);\n                tool.addEnchantment(Enchantment.DIG_SPEED, 5);\n                tool.addEnchantment(Enchantment.DURABILITY, 3);\n                tool.getItemMeta().setDisplayName(\"Speelf Spade\");\n                for (PlayerData pd : players) {\n                        pd.getPlayer().getInventory().addItem(tool);\n                }\n        }\n\n        /**\n         * it is 'set',not copy.\n         * @param hd\n         */\n        public void setGameRuleHandler(GameController hd) {\n                gameRuleHandler = hd;\n\n        }\n\n        public void setMaxPlayer(int mp) {\n                maxPlayer = mp;\n        }\n\n        public void copyP1(Location loc) {\n                size.copyP1(loc);\n        }\n\n        public void copyP2(Location loc) {\n                size.copyP2(loc);\n        }\n\n        public void copySize(ArenaSize as) {\n                size = as.clone();\n        }\n\n        public void copySize(Location a, Location b) {\n                size.copy(a.clone(), b.clone());\n        }\n\n        public void setStatus(ArenaStatus as) {\n                arenaStatus = as;\n        }\n\n        public void copyTeleportBackLocation(Location loc) {\n                teleportBackLocation = loc.clone();\n        }\n\n        public void copyTeleportLocation(Location loc) {\n                teleportLocation = loc.clone();\n        }\n\n        /**\n         * only do inventory cleaning and send tools and set status to 'InGame'.\n         * also send the start message to players.\n         */\n        public void startGame() {\n                arenaStatus = ArenaStatus.InGame;\n                clearAllPlayersInventory();\n                sendTools();\n                message(Message.gameStart);\n        }\n\n        public boolean isInThisArena(Location loc) {\n                return size.isInIt(loc);\n        }\n\n}\n复制代码\nArenaManager:\npackage arena;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.bukkit.Location;\n\npublic class ArenaManager {\n\n        List<Arena> arenas = new ArrayList<Arena>();\n        int num = 0;\n\n        public void addArena(Arena are) {\n                arenas.add(are);\n                num++;\n        }\n\n        public boolean deleteArena(Arena are) {\n                int at = 0;\n                boolean flag = false;\n                for (; at < num; at++) {\n                        if (arenas.get(at).equals(are)) {\n                                flag = true;\n                                break;\n                        }\n                }\n                if (!flag)\n                        return false;\n                arenas.remove(at);\n                num--;\n                return true;\n        }\n\n        /**\n         * \n         * @param i\n         * @return 没有时返回null\n         */\n        public Arena get(int i) {\n                if (i < num && i >= 0)\n                        return arenas.get(i);\n                return null;\n        }\n\n        /**\n         * \n         * @param name\n         * @return 没有时返回null\n         */\n        public Arena get(String name) {\n                for (int i = 0; i < num; i++) {\n                        if (arenas.get(i).getName().equalsIgnoreCase(name))\n                                return arenas.get(i);\n                }\n                return null;\n        }\n\n        public List<Arena> getAllArenas() {\n                return arenas;\n\n        }\n\n        public Arena getArena(String name) {\n                for (int i = 0; i < num; i++) {\n                        if (arenas.get(i).isInThisArena(name))\n                                return arenas.get(i);\n                }\n                return null;\n        }\n\n        public Arena getArenaByPlayer(String name) {\n                for (int i = 0; i < num; i++) {\n                        if (arenas.get(i).isInThisArena(name))\n                                return arenas.get(i);\n                }\n                return null;\n        }\n\n        public int getArenaNum() {\n                return num;\n\n        }\n\n        public int getCode(String name) {\n                for (int i = 0; i < num; i++) {\n                        if (arenas.get(i).getName().equalsIgnoreCase(name))\n                                return i;\n                }\n                return -1;\n        }\n\n        public boolean isPlaying(String name) {\n                for (int i = 0; i < num; i++) {\n                        if (arenas.get(i).isInThisArena(name))\n                                return true;\n                }\n                return false;\n        }\n\n        public boolean isInAnyArena(Location location) {\n                for(Arena a:arenas)\n                        if(a.isInThisArena(location))\n                                return true;\n                return false;\n        }\n\n        public Arena get(Location location) {\n                for(Arena a:arenas)\n                        if(a.isInThisArena(location))\n                                return a;\n                return null;\n        }\n\n}\n复制代码\nArenaSize:\npackage arena.data;\n\nimport org.bukkit.Bukkit;\nimport org.bukkit.Location;\n\npublic class ArenaSize {\n\n        private Location h, l;\n        \n        private Location p1, p2;\n\n        public ArenaSize() {\n                h = null;\n                l = null;\n                p1 = new Location(Bukkit.getWorlds().get(0), 0, 0, 0);\n                p2 = new Location(Bukkit.getWorlds().get(0), 0, 0, 0);\n                sort();\n        }\n\n        public ArenaSize(Location a, Location b) {\n                p1 = a;\n                p2 = b;\n                sort();\n        }\n\n        /**\n         * gets the high location\n         * @return\n         */\n        public Location getH() {\n                return h;\n        }\n\n        /**\n         * gets the low location\n         * @return\n         */\n        public Location getL() {\n                return l;\n\n        }\n\n        /**\n         * no used\n         * @deprecated\n         * @return\n         */\n        public boolean isInited() {\n                if (h != null && l != null)\n                        return true;\n                return false;\n        }\n\n        public void copy(Location h, Location l) {\n                this.p1 = h.clone();\n                this.p2 = l.clone();\n                sort();\n        }\n\n        /**\n         * sets the first point of this area\n         * problem solved\n         * @param h\n         */\n        public void copyP1(Location h) {\n                this.p1 = h.clone();\n                sort();\n        }\n\n        /**\n         * sets the second point of this area\n         * problem solved\n         * @param l\n         */\n        public void copyP2(Location l) {\n                this.p2 = l.clone();\n                sort();\n        }\n\n        /**\n         * refresh the value of l and h from p1 and p2\n         * @return \n         */\n        public ArenaSize sort() {\n                Location a = p1, b = p2;\n                double ax = a.getX(), bx = b.getX();\n                double hx = (ax > bx) ? ax : bx, lx = (ax > bx) ? bx : ax;\n                double ay = a.getY(), by = b.getY();\n                double hy = (ay > by) ? ay : by, ly = (ay > by) ? by : ay;\n                double az = a.getZ(), bz = b.getZ();\n                double hz = (az > bz) ? az : bz, lz = (az > bz) ? bz : az;\n                h = new Location(a.getWorld(), hx, hy, hz);\n                l = new Location(b.getWorld(), lx, ly, lz);\n                return this;\n        }\n\n        /**\n         * return another object which has the same value as this one\n         */\n        public ArenaSize clone(){\n                return new ArenaSize(l,h);\n        }\n\n        public boolean isInIt(Location loc) {\n                        if (loc.getX() <= h.getX()\n                                && loc.getY() <= h.getY()\n                                && loc.getZ() <= h.getZ()\n                                && loc.getX() >= l.getX()\n                                && loc.getY() >= l.getY()\n                                && loc.getZ() >= l.getZ()) \n                                return true;\n                return false;\n        }\n        \n        /*\n         * public void refresh(){ sort(); if(h==null||l==null) setInited(false);\n         * else setInited(true); }\n         * \n         * public boolean isInited() { return inited; }\n         * \n         * public void setInited(boolean inited) { this.inited = inited; }\n         */\n\n}\n复制代码\nArenaStatus:\npackage arena.data;\n\npublic enum ArenaStatus {\n\n        InGame, Stop, WaitForPlayer, Starting, Resetting, OpEdit,\n\n}\n复制代码\nPlayerData:\npackage arena.data;\n\nimport java.util.Collection;\n\nimport org.bukkit.entity.Player;\nimport org.bukkit.inventory.ItemStack;\nimport org.bukkit.potion.PotionEffect;\n\npublic class PlayerData {//没做完\n\n        Player player = null;\n        //int score = 0;\n        //int kills = 0;\n        int exp;\n        boolean isDead = false;\n        ItemStack[] inv=null,amr=null;\n        Collection<PotionEffect> effects=null;\n\n        public PlayerData(Player p) {\n                player = p;\n                //score = 0;\n                //kills = 0;\n                inv=null;\n                amr=null;\n                exp=0;\n        }\n\n        @SuppressWarnings(\"deprecation\")\n        public void storeInventory(){\n                inv=player.getInventory().getContents();\n                amr=player.getInventory().getArmorContents();\n                player.getInventory().clear();\n                player.getInventory().setArmorContents(null);\n                player.updateInventory();\n        }\n        \n        public void storeLevel(){\n                exp=player.getLevel();\n                player.setExp(0F);\n        }\n        \n        public void storePotionEffects(){\n                effects = player.getActivePotionEffects();\n                for (PotionEffect effect : effects)\n                    player.removePotionEffect(effect.getType());\n        }\n        \n        @SuppressWarnings(\"deprecation\")\n        public void restoreInventory(){\n                player.getInventory().setContents(inv);\n                player.getInventory().setArmorContents(amr);\n                player.updateInventory();\n        }\n        \n        public void restoreLevel(){\n                player.setExp(exp);\n        }\n        \n        public void restorePotionEffects(){\n                player.addPotionEffects(effects);\n        }\n\n        public String getName() {\n                return player.getName();\n        }\n\n        public Player getPlayer() {\n                return player;\n        }\n\n        public boolean isDead() {\n                return isDead;\n        }\n\n        public void setDeadth(boolean s) {\n                isDead = s;\n        }\n\n}\n复制代码\nGameController:\npackage arena.listeners;\n\nimport org.bukkit.Bukkit;\nimport org.bukkit.ChatColor;\nimport org.bukkit.Material;\nimport org.bukkit.entity.Player;\n\nimport plugin.Speelf;\nimport arena.Arena;\nimport arena.data.ArenaStatus;\nimport arena.data.PlayerData;\nimport arena.messages.Message;\n\npublic class GameController {\n\n        class StartingThread implements Runnable {\n\n                Thread thread = new Thread(this);\n                boolean canStart = false;\n                Arena handleArena = null;\n\n                public StartingThread(Arena arena) {\n                        handleArena = arena;\n                }\n\n                @Override\n                public void run() {\n                        int seconds = 60;\n                        handleArena.message(Message.startingIn1Min);\n                        while (canStart && seconds > 0) {\n                                if (handleArena.getPlayerCount() == handleArena.getMaxPlayer()\n                                                && seconds > 5)\n                                        seconds = 5;\n                                if (seconds == 30)\n                                        handleArena.message(ChatColor.RED + \"30\" + ChatColor.YELLOW\n                                                        + \" seconds until the game start!\");\n                                if (seconds == 10)\n                                        handleArena.message(ChatColor.RED + \"10\" + ChatColor.YELLOW\n                                                        + \" seconds until the game start!\");\n                                if (seconds <= 5)\n                                        handleArena.message(ChatColor.RED + \"\" + seconds\n                                                        + ChatColor.YELLOW\n                                                        + \" seconds until the game start!\");\n                                seconds--;\n                                try {\n                                        Thread.sleep(1000);\n                                } catch (InterruptedException e) {\n                                        e.printStackTrace();\n                                }\n                        }\n                        if (canStart) {\n                                handleArena.startGame();\n                        } else\n                                handleArena.message(ChatColor.RED + \"Start celled\");\n                }\n\n                synchronized public void setCanStart(boolean canStart) {\n                        this.canStart = canStart;\n                }\n\n                public void start() {\n                        thread.start();\n                }\n\n        }\n\n        @SuppressWarnings(\"deprecation\")\n        static public void endRound(Arena arena) {\n                arena.setStatus(ArenaStatus.Resetting);\n                arena.paintAllSigns();\n                int pn = arena.getPlayerCount();\n                for (int i = 0; i < pn; i++)\n                        arena.getPlayer(i).getPlayer().teleport(arena.getReturnLocation());\n                arena.clearAllPlayersInventory();\n                arena.clear();\n                arena.getGroundHandler().reset();\n                arena.setStatus(ArenaStatus.WaitForPlayer);\n                arena.paintAllSigns();\n        }\n\n        Speelf plugin;\n\n        Arena handleArena = null;\n\n        StartingThread insideThread = null;\n\n        @SuppressWarnings(\"unused\")\n        private PlayerStatusChecker checker;\n\n        public GameController(Speelf speelf, Arena hda) {\n                plugin = speelf;\n                handleArena = hda;\n                checker=new PlayerStatusChecker(hda);\n        }\n\n        public void endRound() {\n                handleArena.setStatus(ArenaStatus.Resetting);\n                handleArena.paintAllSigns();\n                for (PlayerData pd : handleArena.getPlayers()){\n                        pd.getPlayer().teleport(handleArena.getReturnLocation());\n                        pd.getPlayer().setAllowFlight(false);\n                        for (PlayerData pd2 : handleArena.getPlayers()){\n                                if(pd!=pd2)pd.getPlayer().showPlayer(pd2.getPlayer());\n                        }\n                }\n                handleArena.clearAllPlayersInventory();\n                handleArena.clear();\n                handleArena.getGroundHandler().reset();\n                handleArena.setStatus(ArenaStatus.WaitForPlayer);\n                handleArena.paintAllSigns();\n        }\n\n        // TODO player stores\n        @SuppressWarnings(\"deprecation\")\n        synchronized public void playerJoined(Player p) {\n                handleArena.message(ChatColor.RED + \"[\" + handleArena.getPlayerCount()\n                                + \"/\" + handleArena.getMaxPlayer() + \"] \" + ChatColor.YELLOW\n                                + p.getName() + ChatColor.YELLOW + \" joined the game.\");\n                p.getInventory().clear();\n                p.updateInventory();\n                if (insideThread == null) {\n                        insideThread = new StartingThread(handleArena);\n                }\n                if (handleArena.getPlayerCount() >= 2) {\n                        if (!insideThread.canStart) {\n                                insideThread.setCanStart(true);\n                                insideThread.start();\n                        }\n                }\n        }\n\n        @SuppressWarnings(\"deprecation\")\n        synchronized public void playerLeft(Player p) {\n                handleArena.message(ChatColor.RED + \"[\" + handleArena.getPlayerCount()\n                                + \"/\" + handleArena.getMaxPlayer() + \"] \" + ChatColor.YELLOW\n                                + p.getName() + ChatColor.YELLOW + \" left the game.\");\n                p.getInventory().clear();\n                p.updateInventory();\n                if (insideThread != null && handleArena.getPlayerCount() < 2) {\n                        insideThread.setCanStart(false);\n                }\n        }\n\n        /**\n         * problem!\n         * \n         * @param event\n         */\n        /*\n         * @EventHandler(priority = EventPriority.HIGH) public void\n         * PlayerOutEvent(PlayerMoveEvent event) { if\n         * (plugin.getArenas().isPlaying(event.getPlayer().getName())) {\n         * //System.out.print(\"G1\"); if (plugin.getArenas()\n         * .getArenaByPlayer(event.getPlayer().getName()) != handleArena) return;\n         * //System.out.print(\"G2\"); if (event.getFrom().getBlock().getType() ==\n         * Material.WATER ||) {//TODO //System.out.println(\"G3\"); Arena are =\n         * plugin.getArenas().getArenaByPlayer( event.getPlayer().getName()); if\n         * (are.getPlayer(event.getPlayer().getName()).isDead()) return;\n         * //System.out.println(\"G4\"); if (!are.isStarted()) return;\n         * are.out(event.getPlayer().getName()); if (winner(are) != null) {\n         * are.message(\"§a\" + winner(are).getName() + \" won the game!\");\n         * Bukkit.getScheduler().runTask(plugin, new Runnable(){ public void run(){\n         * try { Thread.sleep(7000); } catch (InterruptedException e) {\n         * e.printStackTrace(); endRound(); } endRound(); } }); } } }\n         * \n         * }\n         */\n\n        @SuppressWarnings(\"deprecation\")\n        public Player winner() {\n                int countAlive = 0;\n                for (int i = 0; i < handleArena.getPlayerCount(); i++) {\n                        if (!handleArena.getPlayer(i).isDead())\n                                countAlive++;\n                }\n                if (countAlive == 1) {\n                        for (int i = 0; i < handleArena.getPlayerCount(); i++) {\n                                if (!handleArena.getPlayer(i).isDead())\n                                        return handleArena.getPlayer(i).getPlayer();\n                        }\n                }\n                return null;\n        }\n\n        class PlayerStatusChecker implements Runnable {\n                Arena handleArena;\n                Thread thread;\n\n                public PlayerStatusChecker(Arena hda) {\n                        handleArena = hda;\n                        thread = new Thread(this);\n                        thread.start();\n                }\n\n                @SuppressWarnings(\"deprecation\")\n                public void run() {\n                        while (true) {\n                                try {\n                                        Thread.sleep(200);\n                                } catch (InterruptedException e) {\n                                        e.printStackTrace();\n                                }\n                                for (int i = 0; i < handleArena.getPlayerCount(); i++) {\n                                        Material type = handleArena.getPlayer(i).getPlayer().getLocation().getBlock().getType();\n                                        //plugin.performOutPut(type.name());\n                                        if (winner() == null) {\n                                                //plugin.performOutPut(type.name());\n                                                if (type.equals(Material.STATIONARY_WATER)&& !handleArena.getPlayer(i).isDead()) {\n                                                        handleArena.out(handleArena.getPlayer(i)\n                                                                        .getPlayer());\n                                                        if (winner() != null) {\n                                                                handleArena.message(\"§a\" + winner().getName()\n                                                                                + \" won the game!\");\n                                                                Bukkit.getScheduler().runTask(plugin,\n                                                                                new Runnable() {\n                                                                                        public void run() {\n                                                                                                try {\n                                                                                                        Thread.sleep(7000);\n                                                                                                } catch (InterruptedException e) {\n                                                                                                        e.printStackTrace();\n                                                                                                        endRound();\n                                                                                                }\n                                                                                                endRound();\n                                                                                        }\n                                                                                });\n                                                        }/* end if */\n                                                }/* end out if */\n                                        }/* end winner if */\n                                }/* end for */\n                        }/* end while */\n                }\n        }\n}\n\n复制代码\nProtector:\npackage arena.listeners;\n\nimport org.bukkit.Location;\nimport org.bukkit.Material;\nimport org.bukkit.entity.EntityType;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.EventPriority;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.block.BlockBreakEvent;\nimport org.bukkit.event.block.BlockPlaceEvent;\nimport org.bukkit.event.entity.EntityDamageEvent;\nimport org.bukkit.event.entity.FoodLevelChangeEvent;\nimport org.bukkit.event.player.PlayerDropItemEvent;\nimport org.bukkit.event.player.PlayerMoveEvent;\n\nimport plugin.Speelf;\nimport arena.Arena;\nimport arena.data.ArenaStatus;\nimport arena.messages.Message;\n\npublic class Protector implements Listener {\n\n        Speelf plugin;\n\n        public Protector(Speelf speelf) {\n                plugin = speelf;\n        }\n\n        @EventHandler\n        public void PlayerBreakBlock(BlockBreakEvent event) {\n                if (event.getPlayer() == null)\n                        return;\n                Player p = event.getPlayer();\n                if (plugin.getArenas().isPlaying(p.getName())) {\n                        Arena arena = plugin.getArenas().getArenaByPlayer(p.getName());\n                        if (arena.getStatus() == ArenaStatus.InGame) {\n                                if (event.getBlock().getType() == Material.SNOW_BLOCK){\n                                        plugin.getArenas().getArenaByPlayer(event.getPlayer().getName()).\n                                        getGroundHandler().addBlock(event.getBlock().getLocation());\n                                        event.getBlock().breakNaturally(null); //TODO may not true\n                                        event.setCancelled(true);\n                                        //plugin.performOutPut(\"[BlockBreakEvent] by \"+event.getPlayer().getName()+\" accept.\");\n                                        return;\n                                }\n                        }\n                        event.setCancelled(true);\n                }\n        }\n\n        @EventHandler\n        public void PlayerDamage(EntityDamageEvent event) {\n                if (event.getEntity() == null)\n                        return;\n                if (event.getEntity() instanceof Player) {\n                        if (plugin.getArenas().isPlaying(\n                                        ((Player) event.getEntity()).getName()))\n                                event.setCancelled(true);\n                }\n        }\n         \n        @EventHandler\n        public void PlayerDropItems(PlayerDropItemEvent event) {\n                if(!plugin.getArenas().isPlaying(event.getPlayer().getName()))\n                        return;\n                if (!event.getPlayer().hasPermission(\"speelf.cde\")) {\n                        event.setCancelled(true);\n                }\n        }\n        \n        @EventHandler\n        public void BlockPlace(BlockPlaceEvent event){\n                if(plugin.getArenas().isPlaying(event.getPlayer().getName())){\n                        event.setCancelled(true);\n                }\n        }\n        \n        @EventHandler\n        public void PlayerLoseFoodLevel(FoodLevelChangeEvent event){\n                if(event.getEntityType()!=EntityType.PLAYER)\n                        return;\n                Player p=(Player)event.getEntity();\n                if(plugin.getArenas().isPlaying(p.getName())){\n                        p.setFoodLevel(20);\n                        event.setCancelled(true);\n                }\n                \n        }\n        \n        @EventHandler(priority = EventPriority.LOWEST)\n        public void PlayerMoveOutFromArenaArea(PlayerMoveEvent event) {\n                Location loc = event.getTo();\n                if (plugin.getArenas().isPlaying(event.getPlayer().getName())) {\n                        Arena hda = plugin.getArenas().getArenaByPlayer(\n                                        event.getPlayer().getName());\n                        if(!hda.isInThisArena(loc)){\n                                event.setCancelled(true);\n                                event.getPlayer().sendMessage(Message.stayInArena);\n                        }\n                }\n        }\n        \n        @EventHandler\n        public void PlayerBreakBlockFromOtherPlaces(BlockBreakEvent event){//TODO\n                if(event.getPlayer()==null)return;\n                if(plugin.getArenas().isInAnyArena(event.getBlock().getLocation())){\n                        Arena a=plugin.getArenas().get(event.getBlock().getLocation());\n                        if(a.getStatus()==ArenaStatus.OpEdit&&event.getPlayer().hasPermission(\"speelf.cde\"))\n                                return;\n                        if(plugin.getArenas().isPlaying(event.getPlayer().getName()))return;\n                        event.setCancelled(true);\n                        event.getPlayer().sendMessage(Message.cannotBreakBlock);\n                }\n        }\n        \n        @EventHandler\n        public void PlayerPlaceBlockFromOtherPlaces(BlockPlaceEvent event){\n                if(event.getPlayer()==null)return;\n                if(plugin.getArenas().isInAnyArena(event.getBlock().getLocation())){\n                        Arena a=plugin.getArenas().get(event.getBlock().getLocation());\n                        if(a.getStatus()==ArenaStatus.OpEdit&&event.getPlayer().hasPermission(\"speelf.cde\"))\n                                return;\n                        if(plugin.getArenas().isPlaying(event.getPlayer().getName()))return;\n                        event.setCancelled(true);\n                        event.getPlayer().sendMessage(Message.cannotPlaceBlock);\n                }\n        }\n\n}\n复制代码\nMessage:\npackage arena.messages;\n\nimport org.bukkit.ChatColor;\nimport org.bukkit.entity.Player;\n\nimport arena.Arena;\n\npublic class Message {\n\n        public final static String stayInArena = ChatColor.RED + \"Stay in arena! You can not leave it!\";\n        public final static String noPermission = \"§cYou have no permission for this!\";\n        public final static String EDEditMod = ChatColor.YELLOW+\"Enable/Disable edit mod.\";\n        public final static String leave = \"§aYou left [arenaname]!\";\n        public final static String join = \"§aYou joined [arenaname]!\";\n        public final static String arenaNotFound = \"§cArena not found!\";\n        public final static String finish = ChatColor.GRAY + \"Command finish!\";\n        public final static String wrongArgs = \"§cWrong args!\";\n        public final static String arenaCleanedByOp = \"§aThis arena is closed by a op!\";\n        public final static String gameStart = \"§cGame start!\";\n        public final static String startingIn1Min = ChatColor.RED + \"1\"\n                        + ChatColor.YELLOW + \" minute until the game start.\";\n        public final static String signDeleted = ChatColor.GRAY\n                        + \"Sign break successfully\";\n        public static final String cannotBreakBlock = ChatColor.RED + \"You can not break the block there!\";\n        public static final String cannotPlaceBlock = ChatColor.RED + \"You can not place the block there!\";\n        \n        public final ChatColor waringColor=ChatColor.RED;\n        public final ChatColor acceptColor=ChatColor.GREEN;\n        public final ChatColor messageColor=ChatColor.YELLOW;\n        public final ChatColor otherColor=ChatColor.GRAY;\n}复制代码\nMapHandler:\npackage arena.reset.map;\n\nimport org.bukkit.Bukkit;\nimport org.bukkit.Location;\nimport org.bukkit.Material;\nimport plugin.Speelf;\nimport arena.Arena;\n\npublic class MapHandler {\n\n        SnowBlockDataReporter rpt = new SnowBlockDataReporter();\n        Speelf plugin;\n        Arena handleArena = null;\n\n        public MapHandler(Speelf p, Arena ha) {\n                plugin = p;\n                handleArena = ha;\n        }\n\n        /*@EventHandler(priority = EventPriority.HIGH)\n        public void remember(BlockBreakEvent event) {\n                if (event.getPlayer() == null)\n                        return;\n                System.out.print(\"RMB \"+event.getBlock().getType().name());\n                if (event.getBlock().getType() == Material.SNOW_BLOCK) {\n                        System.out.print(\"RMB1 \");\n                        if (plugin.getArenas()\n                                        .getArenaByPlayer(event.getPlayer().getName()) == handleArena) {\n                                System.out.print(\"RMB2\");\n                                if (handleArena.isStarted()) {\n                                        System.out.print(\"RMB\");\n                                        rpt.push(event.getBlock().getLocation());\n                                } else\n                                        return;\n                        }\n                } else\n                        return;\n        }*/\n\n        public void reset() {\n                Bukkit.getLogger().info(\n                                \"Cleaning up speelf arena:\" + handleArena.getName());\n                new Thread(new Runnable() {\n\n                        @Override\n                        public void run() {\n\n                        while (!rpt.isEmpty())\n                                        rpt.pop().getBlock().setType(Material.SNOW_BLOCK);\n                        plugin.performOutPut(\"Finish cleaning up speelf arena:\" + handleArena.getName());\n                        }\n                }).start();\n\n\n        }\n\n        public void setHandleArena(Arena arena) {\n                handleArena = arena;\n\n        }\n\n        public void addBlock(Location location) {\n                rpt.push(location);\n                \n        }\n\n}\n复制代码\nSBR:\npackage arena.reset.map;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.bukkit.Location;\n\npublic class SnowBlockDataReporter {\n\n        List<Location> locs = new ArrayList<Location>();\n        int num = 0;\n\n        public Location get(int i) {\n                if (i >= num || i < 0)\n                        return null;\n                return locs.get(i);\n        }\n\n        public boolean isEmpty() {\n                if (num == 0)\n                        return true;\n                return false;\n        }\n\n        public Location pop() {\n                if (isEmpty())\n                        return null;\n                Location loc = get(num - 1);\n                locs.remove(num - 1);\n                num--;\n                return loc;\n        }\n\n        public void push(Location loc) {\n                if (loc != null) {\n                        locs.add(loc);\n                        num++;\n                }\n        }\n\n}\n复制代码SignEditor:\npackage sign;\n\nimport org.bukkit.ChatColor;\nimport org.bukkit.block.Sign;\nimport org.bukkit.event.block.SignChangeEvent;\n\nimport sign.types.JoinSign;\nimport arena.Arena;\nimport arena.data.ArenaStatus;\n\npublic class SignEditor {\n\n        // TODO\n\n        public static void paint(JoinSign js) {\n                Arena arena = js.to();\n                Sign sign = js.getSign();\n                if (!arena.checkWork()) {\n                        sign.setLine(0, ChatColor.RED + \"[Speelf]\");\n                        sign.setLine(1, ChatColor.GRAY + arena.getName());\n                        sign.setLine(2, ChatColor.GRAY + \"coming soon\");\n                        sign.setLine(3, \"=========\");\n                        sign.update();\n                        return;\n                }\n                ArenaStatus as = arena.getStatus();\n                sign.setLine(0, ChatColor.RED + \"[Speelf]\");\n                sign.setLine(1, ChatColor.GRAY + arena.getName());\n                sign.setLine(2, ChatColor.RED + as.toString());\n                sign.setLine(3, ChatColor.YELLOW + \"[\" + arena.getPlayerCount() + \"/\"\n                                + arena.getMaxPlayer() + \"]\");\n                sign.update();\n        }\n\n}复制代码\nSignHandler:\npackage sign;\n\nimport org.bukkit.ChatColor;\nimport org.bukkit.block.Sign;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.EventPriority;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.block.Action;\nimport org.bukkit.event.block.BlockBreakEvent;\nimport org.bukkit.event.block.SignChangeEvent;\nimport org.bukkit.event.player.PlayerInteractEvent;\n\nimport plugin.Speelf;\nimport sign.types.JoinSign;\nimport sign.types.LeaveSign;\nimport sign.types.TpSign;\nimport arena.Arena;\nimport arena.messages.Message;\n\npublic class SignHandler implements Listener {\n\n        Speelf plugin;\n\n        public SignHandler(Speelf p) {\n                plugin = p;\n        }\n\n        @EventHandler\n        public void onPlayerBreakBlock(BlockBreakEvent event) {\n                if (event.getBlock().getState() instanceof Sign) {\n                        if (plugin.getSignManager().has(event.getBlock().getLocation())) {\n                                if (event.getPlayer().hasPermission(\"speelf.cde\")) {\n                                        if (plugin.getSignManager()\n                                                        .get((Sign) event.getBlock().getState()).getType() == TpSign.JOIN) {\n                                                plugin.getSignManager()\n                                                                .get((Sign) event.getBlock().getState())\n                                                                .to()\n                                                                .deleteJoinSign(\n                                                                                (Sign) event.getBlock().getState());\n                                                ;\n                                                plugin.getSignManager().unLoad(\n                                                                (Sign) event.getBlock().getState());\n                                        }\n                                        event.getPlayer().sendMessage(\n                                                        ChatColor.GRAY + \"Sign broked successfully\");\n                                        event.getBlock().breakNaturally();\n                                } else {\n                                        event.getPlayer().sendMessage(Message.noPermission);\n                                        event.setCancelled(true);\n                                }\n\n                        }\n                } else\n                        return;\n        }\n\n        @EventHandler\n        public void onPlayerClickTeleportSign(PlayerInteractEvent event) {\n\n                // TODO\n\n                if (event.getClickedBlock() == null) // TODO\n                        return;\n                if (!event.getAction().equals(Action.RIGHT_CLICK_BLOCK))\n                        return;\n                if (event.getClickedBlock().getState() instanceof Sign) {\n                        if (plugin.getSignManager().has(\n                                        event.getClickedBlock().getLocation())) {\n                                TpSign sig = plugin.getSignManager().get(\n                                                (Sign) event.getClickedBlock().getState());\n                                if (sig.getType() == TpSign.JOIN) {\n                                        JoinSign js = (JoinSign) sig;\n                                        if (js.to().checkJoin() == false)\n                                                return;\n                                        js.to().add(event.getPlayer());\n                                        event.getPlayer().teleport(js.to().getTeleportLocation());\n                                        event.getPlayer().sendMessage(\n                                                        ChatColor.GRAY + \"You joined this arena.\");\n                                        js.to().getGameRuleHandler()\n                                                        .playerJoined(event.getPlayer());\n                                        js.to().paintAllSigns();\n                                } else {\n                                        LeaveSign ls = (LeaveSign) sig;\n                                        ls.to().leave(event.getPlayer());\n                                        event.getPlayer().teleport(ls.to().getReturnLocation());\n                                        event.getPlayer().sendMessage(\n                                                        ChatColor.GRAY + \"You left this arena.\");\n                                        ls.to().getGameRuleHandler().playerLeft(event.getPlayer());\n                                        ls.to().paintAllSigns();\n                                }\n                        }\n                } else\n                        return;\n\n        }\n\n        @EventHandler(priority = EventPriority.HIGH)\n        public void onPlayerWritingOnSign(SignChangeEvent event) {\n                Sign sig = (Sign) event.getBlock().getState();\n                if (event.getLine(0).equalsIgnoreCase(\"[speelf]\")) {\n                        if (!event.getPlayer().hasPermission(\"speelf.cde\")) {\n                                event.getPlayer().sendMessage(Message.noPermission);\n                                event.getBlock().breakNaturally();\n                                event.setCancelled(true);\n                                return;\n                        }\n                        String arenanam = event.getLine(2);\n                        if (event.getLine(1).equalsIgnoreCase(\"join\")) { // join\n                                Arena arena = plugin.getArenas().get(arenanam);\n                                if (arena == null) {\n                                        event.getPlayer().sendMessage(Message.arenaNotFound);\n                                        event.getBlock().breakNaturally();\n                                        return;\n                                }\n                                JoinSign js = new JoinSign(arena, sig);\n                                arena.addJoinSign(js);\n                                plugin.getSignManager().regist(js);\n                                event.setLine(0, ChatColor.RED + \"[Speelf]\");\n                                event.setLine(1, ChatColor.GRAY + arena.getName());\n                                event.setLine(2, ChatColor.GRAY + arena.getStatus().toString());\n                                event.setLine(3,\n                                                ChatColor.YELLOW + \"[\" + arena.getPlayerCount() + \"/\"\n                                                                + arena.getMaxPlayer() + \"]\");\n                                event.getPlayer().sendMessage(Message.finish);\n                        }\n                        if (event.getLine(1).equalsIgnoreCase(\"leave\")) { // leave\n                                Arena arena = plugin.getArenas().get(arenanam);\n                                if (arena == null) {\n                                        event.getPlayer().sendMessage(Message.arenaNotFound);\n                                        return;\n                                }\n                                LeaveSign ls = new LeaveSign(arena, sig);\n                                plugin.getSignManager().regist(ls);\n                                //TODO ls.paint();\n                                event.getPlayer().sendMessage(Message.finish);\n                        }\n                }\n        }\n\n}\n复制代码\nSignManager:\npackage sign;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.bukkit.Location;\nimport org.bukkit.block.Sign;\n\nimport sign.types.JoinSign;\nimport sign.types.TpSign;\n\npublic class SignManager {\n\n        List<TpSign> signs = new ArrayList<TpSign>();\n        int num = 0;\n\n        public void regist(TpSign sig) {\n                signs.add(num, sig);\n                num++;\n        }\n\n        public void unLoad(JoinSign j) {\n                for (int i = 0; i < num; i++) {\n                        if (signs.get(i) == j) {\n                                num--;\n                                signs.remove(i);\n                                return;\n                        }\n                }\n\n        }\n\n        public void unLoad(Sign sig) {\n                for (int i = 0; i < num; i++) {\n                        if (signs.get(i).getSign().getLocation().equals(sig.getLocation())) {\n                                num--;\n                                signs.remove(i);\n                                return;\n                        }\n                }\n\n        }\n\n        public TpSign get(Sign sig) {\n                for (int i = 0; i < num; i++) {\n                        if (signs.get(i).getSign().getLocation().equals(sig.getLocation()))\n                                return signs.get(i);\n                }\n                return null;\n        }\n\n        public List<TpSign> getAll(String arenanam) {\n                List<TpSign> ret = new ArrayList<TpSign>();\n                for (int i = 0; i < num; i++) {\n                        if (signs.get(i).to().getName().equalsIgnoreCase(arenanam))\n                                ret.add(signs.get(i));\n                }\n                return ret;\n        }\n\n        public boolean has(Location location) {\n                for (int i = 0; i < num; i++) {\n                        if (signs.get(i).getSign().getLocation().equals(location))\n                                return true;\n                }\n                return false;\n        }\n\n}\n复制代码\n\nsign。types：\nJoinSign\nLeaveSign\n\n(现在这个插件没有离开场地的功能。。)\n\n\n\n\n\n\n\n\n\n\nsrc.rar\n\n\n2015-2-4 13:44 上传\n点击文件名下载附件\n\n\n\n\n16.34 KB, 阅读权限: 20, 下载次数: 128\n\n\n\n\n",
    "replies": [
        {
            "author": "RAY5DHao",
            "timestamp": 1416715260,
            "txt_content": "SPLEEF插件不是已经有了么??"
        },
        {
            "author": "fatezero",
            "timestamp": 1416716460,
            "txt_content": "不是已经有 吗{:10_492:}"
        },
        {
            "author": "741410550",
            "timestamp": 1421553480,
            "txt_content": "{:10_527:}有为什么还做啊  "
        },
        {
            "author": "4one_R",
            "timestamp": 1421668440,
            "txt_content": "支持原创！"
        },
        {
            "author": "Grandiose",
            "timestamp": 1421678100,
            "txt_content": "这个早就有人写过了吧？。。"
        },
        {
            "author": "Hineven",
            "timestamp": 1422702060,
            "txt_content": "Grandiose 发表于 2015-1-19 22:35\n这个早就有人写过了吧？。。\n是啊但第一次写想着应该比较简单"
        },
        {
            "author": "Hineven",
            "timestamp": 1423028760,
            "txt_content": "胡晨晓 发表于 2015-1-31 19:01\n是啊但第一次写想着应该比较简单\n更完了（十个字）"
        },
        {
            "author": "Hineven",
            "timestamp": 1423029060,
            "txt_content": "突然之间有一股想水的冲动"
        },
        {
            "author": "Hineven",
            "timestamp": 1423029120,
            "txt_content": "胡晨晓 发表于 2015-2-4 13:51\n突然之间有一股想水的冲动\n让我再水一次（就一次）"
        },
        {
            "author": "Hineven",
            "timestamp": 1423029120,
            "txt_content": "胡晨晓 发表于 2015-2-4 13:52\n让我再水一次（就一次）\n再水一下应该也没问题吧"
        }
    ]
}