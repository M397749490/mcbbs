{
    "title": "最强复读机？服务端后台的大量报错",
    "author": "冻土",
    "replyCount": 4,
    "timestamp": 1541857440,
    "txt_content": " 本帖最后由 冻土 于 2018-11-10 23:49 编辑 \n\n之前发过一次这个问题了，但是没能够得到解决，所以再发一次。原来的问题因为发的时间太久，已经申请关闭了。\n\n这个问题出现在装了forge的服务端，虽然确切地说是1.12.2/forge2705/sponge3361，但是推测这个问题在其他装了forge的端上面也会存在。\n\n大家都知道，服务器或者客户端网络状况不好的时候容易出现进入游戏后无法移动，并随后卡掉线的情况。\n但是在自己开服的过程中我发现了这样一个问题：\n当一个玩家掉线时，有时候会出现如下面所示的15行报错：\n[01:45:19] [Netty Server IO #12/ERROR] [FML]: NetworkDispatcher exception\njava.io.IOException: 远程主机强迫关闭了一个现有的连接。\n        at sun.nio.ch.SocketDispatcher.writev0(Native Method) ~[?:1.8.0_171]\n        at sun.nio.ch.SocketDispatcher.writev(Unknown Source) ~[?:1.8.0_171]\n        at sun.nio.ch.IOUtil.write(Unknown Source) ~[?:1.8.0_171]\n        at sun.nio.ch.SocketChannelImpl.write(Unknown Source) ~[?:1.8.0_171]\n        at io.netty.channel.socket.nio.NioSocketChannel.doWrite(NioSocketChannel.java:432) ~[NioSocketChannel.class:?]\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.flush0(AbstractChannel.java:856) [AbstractChannel$AbstractUnsafe.class:?]\n        at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.forceFlush(AbstractNioChannel.java:368) [AbstractNioChannel$AbstractNioUnsafe.class:?]\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:618) [NioEventLoop.class:?]\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:559) [NioEventLoop.class:?]\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:476) [NioEventLoop.class:?]\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:438) [NioEventLoop.class:?]\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858) [SingleThreadEventExecutor$5.class:?]\n        at java.lang.Thread.run(Unknown Source) [?:1.8.0_171]复制代码并且在掉线后的一段时间内重复出现多次。如果玩家多次尝试登录并掉线，这个报错的规模将会极为巨大，堪称史上最强复读机。\n这个复读机有多强呢，如下图所示：\n\n\n\n\nQQ图片20181110214719.png (113.86 KB, 下载次数: 0)\n\n下载附件\n\n一天几百万行，史上最强复读机\n2018-11-10 21:35 上传\n\n\n\n\n\n可以看到这个log文件的行数高达214.3万行，而其中“NetworkDispatcher exception”的计数高达14万多，而由于每出现一句“NetworkDispatcher exception”就意味着15行报错，推算可知其中报错高达2142510行，也就是说二百万行的log中只有五百行不是这个报错！\n刷报错的时候，服务端后台输入指令会产生巨大延迟，同时服务端的性能也会有少许下降。\n\n因为我不懂Java，只能瞎猜一下bug的原因。\n我猜想的原因是，某个mod或者插件导致服务端和客户端建立了大量的连接（或者说叫握手？），然后玩家掉线导致这些连接断开，所以产生大量的报错\n那么，能做到这一点的mod难道是jei？\n我现在正在删除服务端的jei进行测试，同时也希望各路大佬能帮忙解答这个问题。\n\n实测删了jei仍然存在这个问题\n",
    "replies": [
        {
            "author": "XuHaitian",
            "timestamp": 1541901960,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "XuHaitian",
            "timestamp": 1541902920,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "AzureManor",
            "timestamp": 1541903460,
            "txt_content": "客户端试图向服务器发送太多数据了, 这是Forge的一个BUG, 升级Forge试试"
        },
        {
            "author": "向文",
            "timestamp": 1541945760,
            "txt_content": "升级下端版本"
        }
    ]
}