{
    "title": "NPC脚本问题-回城",
    "author": "SaliCkera",
    "replyCount": 3,
    "timestamp": 1562693640,
    "txt_content": " 本帖最后由 瑾枫￡F.P 于 2019-7-10 01:36 编辑 \n\n手持\"回城\"shift3秒传送，冷却1分钟冷却完毕说出\"冷却完毕\"\n\n求帮忙233\n\n\n\n版本:1.7.10\n\n",
    "replies": [
        {
            "author": "粘兽",
            "timestamp": 1562693640,
            "txt_content": " 本帖最后由 粘兽sama 于 2019-7-10 04:00 编辑 \n\n下面这串代码放在Init接口中\nnpc.clearTempData();\nnpc.setTempData('backHome-count',{});\nnpc.setTempData('backHome-cooldown',{});复制代码\n\n下面这串代码放在Update接口中\n// 冷却时长毫秒\nvar cd = 5000;\n// 传送到的坐标\nvar pos = '~ ~3 ~';\n\nplayers = world.getAllServerPlayers();\nfor(var i in players){\n    var player = world.getPlayer(players[i].name);\n    if(player != null && player.isSneaking() && player.getHeldItem() != null){\n        var held = player.getHeldItem().getDisplayName();\n        if(held.indexOf('回城') > -1){\n            if(player.name in npc.getTempData('backHome-count')){\n                var now = npc.getTempData('backHome-count')[player.name] += 0.5;\n                if(now > 2.5){\n                    var time = new Date().getTime();\n                    delete npc.getTempData('backHome-count')[player.name];\n                    if(player.name in npc.getTempData('backHome-cooldown') && time < npc.getTempData('backHome-cooldown')[player.name]){\n                        player.sendMessage('回城冷却中···');\n                    }else{\n                        var cmd = 'tp {name} {pos}';\n                        npc.executeCommand(cmd.replace('{name}',player.name).replace('{pos}',pos));\n                        npc.getTempData('backHome-cooldown')[player.name] = time + cd;\n                        cooldown(player);\n                    }\n                }\n            }else{\n                npc.getTempData('backHome-count')[player.name] = 0.5;\n            }\n        }\n    }else if(players[i].name in npc.getTempData('backHome-count')){\n        delete npc.getTempData('backHome-count')[players[i].name];\n    }\n}\n\nfunction cooldown(player){\n    var Thread = Java.type(\"java.lang.Thread\");\n    var Runnable = Java.extend(Java.type(\"java.lang.Runnable\"),{\n        run: function(){\n            try{\n                Thread.sleep(cd);\n                player.sendMessage('冷却完毕');\n                delete npc.getTempData('backHome-cooldown')[player.name];\n            }catch(e){}\n        }\n    });\n    new Thread(new Runnable()).start();\n}复制代码\n\n以上代码放入对应的接口中，请让npc处于一直被加载的状态。\n手持带有\"回城\"关键词的物品潜行3秒会执行命令将玩家传送到指定的坐标。\n\ncnpc脚本教程贴 如何搭建脚本环境与使用脚本都在这里看吧↓\n[NSS][BGM][NPC][图文][干货]RE:CNPC-自定义NPC 脚本教程[复活连载]\nhttp://www.mcbbs.net/thread-816677-1-1.html"
        },
        {
            "author": "奈何晴空",
            "timestamp": 1562832660,
            "txt_content": "这个是什么版本的"
        },
        {
            "author": "j1612480068",
            "timestamp": 1563348240,
            "txt_content": "那个坐标~ ~3 ~是什么意思\n"
        }
    ]
}