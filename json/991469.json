{
    "title": "无法给予玩家buff",
    "author": "luoevan",
    "replyCount": 15,
    "timestamp": 1584669720,
    "txt_content": "\n\n\n\n\nTIM图片20200320095343.png (54.08 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-20 09:54 上传\n\n\n\n\n\n这个插件原理就是把玩家死亡次数存入config文件里，然后读取后，如果玩家死亡次数>5，给予玩家一个负面buff，并且信息提醒。但是现在使用了Potioneffect类后没有给buff，后台也无报错。\n\n",
    "replies": [
        {
            "author": "猫凉、",
            "timestamp": 1584669840,
            "txt_content": "我怀疑你错版"
        },
        {
            "author": "luoevan",
            "timestamp": 1584669960,
            "txt_content": "猫凉、 发表于 2020-3-20 10:04\n我怀疑你错版\n确认过了没有错版"
        },
        {
            "author": "南外丶仓鼠",
            "timestamp": 1584670020,
            "txt_content": "为什么要在player前加final呢\n另外我还不确定你有没有加\n＠EventHandler"
        },
        {
            "author": "luoevan",
            "timestamp": 1584670200,
            "txt_content": "南外丶仓鼠 发表于 2020-3-20 10:07\n为什么要在player前加final呢\n另外我还不确定你有没有加\n＠EventHandler\n@EventHandler加了的，player不需要被继承所以用final"
        },
        {
            "author": "南外丶仓鼠",
            "timestamp": 1584670380,
            "txt_content": "luoevan 发表于 2020-3-20 10:10\n@EventHandler加了的，player不需要被继承所以用final\n你删掉final试试看\n另外建议uuid存储，因为正版玩家可以改名绕过死亡限制"
        },
        {
            "author": "luoevan",
            "timestamp": 1584670440,
            "txt_content": "南外丶仓鼠 发表于 2020-3-20 10:13\n你删掉final试试看\n另外建议uuid存储，因为正版玩家可以改名绕过死亡限制\n谢谢提醒"
        },
        {
            "author": "luoevan",
            "timestamp": 1584672000,
            "txt_content": "还是不行，改了final"
        },
        {
            "author": "602723113",
            "timestamp": 1584673200,
            "txt_content": "为什么不使用 Map 当做缓存呢？\n一定要拿Config？\n\n在我看来，如果做这些需求，可以直接 \nMap<UUID, Integer> map = new HashMap<>();\nmap.put(玩家UUID, map.getOrDefault(玩家UUID, 0) + 1); // 每次map内自动增1\n\n// 判断只需要\nif map.containskey(玩家uuid) {\n  if(map.get(玩家uuid) >= 5) {\n    // 药水\n    return;\n  }\n}\n// map增加操作\n复制代码"
        },
        {
            "author": "luoevan",
            "timestamp": 1584673380,
            "txt_content": "602723113 发表于 2020-3-20 11:00\n为什么不使用 Map 当做缓存呢？\n一定要拿Config？\n是缓存吗？可以存储吗"
        },
        {
            "author": "luoevan",
            "timestamp": 1584673500,
            "txt_content": "luoevan 发表于 2020-3-20 11:03\n是缓存吗？可以存储吗\n长期存储"
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1584673740,
            "txt_content": "playerrespawnevent中对player本身的操作（加buff，sethealth）等会被忽略，因为这时只是处理player重生相关的事件，player本身还没有被创建\n解决方式是创建一个同步延迟event\n\n    @EventHandler\n    public void onPlayerRespawn(PlayerRespawnEvent event){\n        final Player player = event.getPlayer();\n        Bukkit.getServer().getScheduler().scheduleSyncDelayedTask(this, new BukkitRunnable(){\n            public void run(){\n                player.setHealth(10.0);\n                player.setFoodLevel(10);\n                player.sendMessage(ChatColor.RED + \"You have died and respawned with half health.\");\n            }\n        }, 20);\n    }\n复制代码"
        },
        {
            "author": "luoevan",
            "timestamp": 1584673800,
            "txt_content": "疾风暗影 发表于 2020-3-20 11:09\nplayerrespawnevent中对player本身的操作（加buff，sethealth）等会被忽略，因为这时只是处理player重生相 ...\n好的，我试一下"
        },
        {
            "author": "602723113",
            "timestamp": 1584677100,
            "txt_content": "luoevan 发表于 2020-3-20 11:05\n长期存储\n在实际的代码中，实时通过io去读写并不是明智的选择， 你应该通过缓存先将数据储存，在disable时进行保存，或者写一个runnable的task每十分钟或者半小时保存一次"
        },
        {
            "author": "luoevan",
            "timestamp": 1584683940,
            "txt_content": "602723113 发表于 2020-3-20 12:05\n在实际的代码中，实时通过io去读写并不是明智的选择， 你应该通过缓存先将数据储存，在disable时进行保存 ...\n好的,我去试试看"
        },
        {
            "author": "2076959984",
            "timestamp": 1584690780,
            "txt_content": "6666666666666666666666666666666666"
        }
    ]
}