{
    "title": "书本登录监听源码例分析教程",
    "author": "zts123456",
    "replyCount": 3,
    "timestamp": 1473572700,
    "txt_content": " 本帖最后由 bzts123456 于 2016-9-11 14:20 编辑 \n<blockquote>package cthuwork.login.listener;\n\nimport cthuwork.login.login.LoginManage;   //写的事件处理\nimport cthuwork.login.task.TaskClear;\nimport cthuwork.login.user.User;\nimport cthuwork.login.user.UserManage;\nimport cthuwork.login.utils.MD5;\nimport java.util.List;\nimport org.bukkit.entity.Player;                      //玩家实体获取类\nimport org.bukkit.event.EventHandler;          //事件处理类\nimport org.bukkit.event.EventPriority;         //事件优先级处理类\nimport org.bukkit.event.Listener;                //事件监听类\nimport org.bukkit.event.player.PlayerEditBookEvent;      //玩家编辑书本处理类\nimport org.bukkit.event.player.PlayerJoinEvent;         //玩家加入事件处理类\nimport org.bukkit.event.player.PlayerKickEvent;        //玩家踢出服务器处理类\nimport org.bukkit.event.player.PlayerQuitEvent;         //玩家退出游戏处理类\nimport org.bukkit.inventory.meta.BookMeta;        //书本存储类 得到书本中玩家写入一定一些数据\n\npublic class ListenerLogin\n  implements Listener\n{\n  public static ListenerLogin instance;\n\n  private String getPassword(BookMeta meta, boolean signing)        //得到书本中数据和点击登录和取消的状态\n  {\n    if (meta == null) return null;   \n\n    if (signing) return meta.getTitle();  得到书中标题内容\n\n    List pages = meta.getPages();  //得到页数\n    if (pages == null) return null;   //页数为空则为空\n    if (pages.size() < 2) return null;   //页数大于2则为空\n\n    return (String)pages.get(1);  //默认页数1\n  }\n\n  @EventHandler(priority=EventPriority.HIGHEST)\n  public void onPlayerJoinEvent(PlayerJoinEvent event) {  //判断玩家加入游戏\n    LoginManage.login(event.getPlayer());\n  }\n\n  @EventHandler(priority=EventPriority.HIGHEST)\n  public void onPlayerEditBookEvent(PlayerEditBookEvent event) { //判断是否在点击书本\n    Player player = event.getPlayer(); //得到玩家信息\n    if (LoginManage.isLogin(player)) return;\n\n    event.setCancelled(true);\n    String password = getPassword(event.getNewBookMeta(), event.isSigning()); //得到玩家书本的密码 和点击登录状态\n\n    if (!LoginManage.matches(password)) {   //密码判断发送给玩家密码字符串不符合规范.具体判断字符串函数在LoginManage.matches下\n      if (!LoginManage.error(player)) player.sendMessage(\"§c[§4错误§c] §6输入的密码是无效的！(2 - 16 位且没有特殊字符)\"); else\n        player.kickPlayer(\"§c[§4错误§c] §6密码错误次数过多\");\n      return;\n    }\n\n    password = MD5.md5(password, 10);             //得到玩家的密码并MD5加密\n    User user = UserManage.instance.getUser(player);           //得到玩家MD5\n\n    if (LoginManage.isRegister(user.password)) {         //新玩家注册游戏存储玩家姓名和 MD5加密后的数据\n      user.password = password;\n      user.save();\n    }\n\n    if (!password.equals(user.password)) {       //密码错误发送给玩家的事件\n      if (!LoginManage.error(player)) player.sendMessage(\"§c[§4错误§c] §6密码错误，请重试！\"); else\n        player.kickPlayer(\"§c[§4错误§c] §6密码错误次数过多\");      //密码错误过多踢出玩家\n      return;\n    }\n      //登录成功后事件\n    LoginManage.setLogin(player, true);     //确认玩家登录\n    LoginManage.task(player);    //UUID获取等一些玩家数据\n    TaskClear.start(player);         //清理之前的事件.防止堆积\n    player.sendMessage(\"§2[§a成功§2] §a登录成功！\");\n  }\n\n  @EventHandler(priority=EventPriority.HIGHEST)\n  public void onPlayerQuitEvent(PlayerQuitEvent event) {\n    Player player = event.getPlayer();\n    LoginManage.back(player);             //玩家点书本中取消自己退出游戏事件\n    LoginManage.setLogin(player, false);\n  }\n\n  @EventHandler(priority=EventPriority.HIGHEST)\n  public void onPlayerKickEvent(PlayerKickEvent event) {\n    Player player = event.getPlayer();         //玩家尝试密码过多踢出游戏事件\n    LoginManage.back(player);\n    LoginManage.setLogin(player, false);\n  }\n}复制代码\n\n\n\n如果中间有什么错误请指出谢谢\n才来到论坛请多多关照..后续还会写一些事件处理之类的分析..让大家学会开发.\n还要验证码回帖好麻烦-.-",
    "replies": [
        {
            "author": "RE_OVO",
            "timestamp": 1473858600,
            "txt_content": "再写个木牌登录，利用PL+AuthME"
        },
        {
            "author": "xuel",
            "timestamp": 1531670160,
            "txt_content": "jebme 发表于 2016-9-14 21:10\n再写个木牌登录，利用PL+AuthME\n竟然是RE小哥哥"
        },
        {
            "author": "站浅瞳",
            "timestamp": 1531670340,
            "txt_content": "MCBBS有你更精彩"
        }
    ]
}