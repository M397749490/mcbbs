{
    "title": "【CBL|丢人素学姐, pku_zzzz】在Minecraft中计算字符串的MD5值",
    "author": "丢人素学姐",
    "replyCount": 42,
    "timestamp": 1551430320,
    "txt_content": " 本帖最后由 Vinogradov 于 2019-3-16 19:21 编辑 \n\n在Minecraft中计算字符串的MD5值\n主要制作者：丢人素学姐\n压缩方案提出者：pku_zzzz\n\n项目地址：https://github.com/YijunYuan/Minecraft_MD5\n下载地址：https://github.com/YijunYuan/Minecraft_MD5/releases\n\n什么是MD5？\nMD5消息摘要算法（英语：MD5 Message-Digest Algorithm），一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。MD5由美国密码学家罗纳德·李维斯特（Ronald Linn Rivest）设计，于1992年公开，用以取代MD4算法。这套算法的程序在 RFC 1321 中被加以规范。--Wiki\n\n为什么要在Minecraft中计算字符串的MD5值？\n没为什么。就是让大家知道我（们）可以做到。\n\n\n限制：\n此数据包只支持计算ASCII字符串需满足 1<=字符串长度<567\n\n注意：如果你无视了以上所述的限制或以下的使用方法，那么本数据包将会在没有任何警告的情况下给出错误结果，即使往里面加入警告很容易。\n\n\n使用方法：\n加载本数据包仔细阅读使用方法（也就是你现在在阅读的东西）。运行命令/function md5:reset复制代码（注意，每次计算前都必须运行该指令以重置系统。）输入字符串。本数据包目前支持两种输入方式。一、使用我之前制作的数据包'keyboard'。你可以在->此处<-找到它的使用方法。输入完毕后，执行/function md5:import_string复制代码以导入数据。由于这个键盘的使用十分不方便，只建议用来输入很短的字符串。二、使用项目中的test_string函数。具体地说，调用测试函数，使用方法为test_string(\"Put the string you want to test here!\");复制代码然后编译运行后将生成的文件放入.minecraft/<Your World Name>/datapacks/md5/data/md5/functions/复制代码并运行/function md5:test_string复制代码导入字符串。运行/function md5:core_wrapper复制代码进行运算。注意：运行这个函数会造成明显卡顿。运行/function md5:display_result复制代码以显示结果。\n\n\n原理讲解：\n        关于MD5算法本身这里不再赘述，有兴趣的朋友可以去看Wiki上的伪代码，写得非常清楚。我们这里主要谈一谈在Minecraft中的实现方法。\n        纵观整个MD5算法，出现了两种数据类型：无符号8位整数，无符号32位整数；以及若干种运算：（可能带位移的）复制，加法，位运算（OR，AND，XOR，NOT，LEFT_ROTATION）。\n        那么从中可以知道，使用记分板原生的运算来直接实现是不合适的，因为位运算会变得非常麻烦（而在MD5计算中位运算非常多），且在溢出等问题的控制上也比较不方便。我们需要一种能方便地进行位运算的整数系统。\n        最直接的想法是，把每个整数的每个bit都分开存，这样每次位运算时，只要分别对每个bit进行处理即可，省去了把每一位取出来运算完再放回去的麻烦（这时加法 会稍微麻烦一些，但搞过OI的人肯定知道怎么实现高精度加法，这里是同样的原理）。\n        基于这样的想法，素学姐的第一版实现如下：\n        将一个记分板看作一个整数，将一串假名：bit0，bit1，...，bit31在此记分板中的值依次看作这个整数的第0位，第1位，...，第31位。（8bit类似）。\n那么位运算的实现就可以这么写（以XOR为例，摘抄自素学姐的代码）：void inline XOR_32(ostream& STREAM, const string& IP1, const string& IP2, const string& RES) {\n    for (int i = 0; i < 32; i++) {\n        STREAM << \"execute if score bit\" << i << \" vars.\" << IP1 << \" = bit\" << i << \" vars.\" << IP2 << \" \"\n                    << \"run scoreboard players set bit\" << i << \" vars.\" << RES << \" 0\" << endl;\n        STREAM << \"execute unless score bit\" << i << \" vars.\" << IP1 << \" = bit\" << i << \" vars.\" << IP2 << \" \"\n                    << \"run scoreboard players set bit\" << i << \" vars.\" << RES << \" 1\" << endl;\n    }复制代码比较简单。类似地，其他位运算及加法大都可以写成void inline something(ostream& STREAM, const string& IP1, const string& IP2, const string& RES) {\n    for (int i = 0; i < 32; i++) {\n        xxxx\n    }\n}复制代码的形式。生成mcfunction后，我们发现这个写法下命令的数量超过了我们的想象，整个数据包有超过一百万条命令，数据包大小接近200MB，载入时会造成**的卡顿（虽然确实可以运算而且结果是对的）。原因就在于，对于每一次数学上的原子运算，生成命令后都数量都会变为32倍以上（因为要对每bit经行分别操作），完成两个32bit整数的加法甚至需要100多条命令，数量十分吓人。\n        虽然这个数据包并不会有什么实际的用途，但我们还是想问：能不能做得更好？\n\n        这时，pku_zzzz向素学姐提出了他的一个想法，大致如下：\n既然位运算、拷贝和加法对每bit进行的操作都是完全一样的；而且两个不同的bit之间，除了加法外的运算都是互相完全独立的，那么是否可以让这32bit“并行”地运行呢？\n        pku_zzzz所说的“并行”并不是真正意义上多线程的并行，而是指使用选择器将这32个bit一次性选中，然后使用execute as xxx run xxx，内层使用@s进行指代，这样只用一条指令就能完成位运算和拷贝运算，而加法运算只需在execute时指定执行顺序即可（下面会说到加法的特殊性）。\n        而在第一版中，素学姐使用了并不存在的实体的假名，是无法被选择器选中的。因此，现在我们将假名改为32个盔甲架，依次加上bit0，bit1，...，bit31的tag，并让bit0，...，bitk加上tag Lk（这里k应该看作一个变量，1<=k<=32）。然后实现运算时就会变得非常简单：\n        我们还是以XOR为例，\nvoid inline XOR_32(ostream& ofs, const string& IP1, const string& IP2, const string& RES) {\n    ofs << \"execute as @e[tag=L32] if score @s vars.\" << IP1 << \" = @s vars.\" << IP2 << \" \"\n         << \"run scoreboard players set @s vars.\" << RES << \" 0\" << endl;\n    ofs << \"execute as @e[tag=L32] unless score @s vars.\" << IP1 << \" = @s vars.\" << IP2 << \" \"\n         << \"run scoreboard players set @s vars.\" << RES << \" 1\" << endl;\n}复制代码        这样完成一次XOR运算就只需要两条命令，十分方便！\n        加法的话，由于对顺序的强烈依赖性，所以需要将每bit的运算放到另一个function里，然后使用execute+选择器按顺序调用。\n而如何指定调用顺序呢？\n        我们想到选择器中有sort的选项，可以以某一点为基点，让选中的实体由近及远地依次执行。于是我们将前文中所述的盔甲架依次排成一列，并选最低位bit0位基点，实现加法如下：\nvoid inline ADD_32(ostream& ofs, const string& IP1, const string& IP2, const string& RES) {\n    MAKE_SVAR(ofs, \"stemp1\", 0); //carry=0\n\n\n    ofstream ofs_add(\"./output/add_impl/add_\" + IP1 + \"_\" + IP2 + \".mcfunction\");\n\n    //c.d[c.len++]=a.d[i] + b.d[i] + carry;\n    ofs_add << \"scoreboard players operation @s vars.\"\n                << RES << \" = @s vars.\" << IP1 << endl;\n    ofs_add << \"scoreboard players operation @s vars.\"\n                << RES << \" += @s vars.\" << IP2 << endl;\n    ofs_add << \"scoreboard players operation @s vars.\"\n                << RES << \" += stemp1 svars\" << endl;\n\n    //carry=c.d[c.len++]/2;\n    ofs_add << \"scoreboard players operation stemp1 svars\"\n                << \" = @s vars.\" << RES << endl;\n    ofs_add << \"scoreboard players operation stemp1 svars\"\n                << \" /= const2 svars\" << endl;\n\n    //c.d[c.len++]%=2;\n    ofs_add << \"scoreboard players operation @s vars.\"\n                << RES << \" %= const2 svars\" << endl;\n\n    ofs_add.close();\n\n    ofs << \"execute at @e[tag=md5.bit0] as @e[tag=L32,sort=furthest] \"\n         << \"run function md5:add_impl/add_\" + IP1 + \"_\" + IP2 << endl;\n\n}复制代码        等等！你看到了furthest而不是nearest，这是为什么？加法难道不是从低位加到高位吗（反映到命令上，就是以bit0为基点，由近到远）？\n        素学姐一开始写的确实是nearest，但在测试时惊奇地发现加法竟然是从高位开始加的！在确认自己写法无误后，他将问题转给了pku_zzzz，于是就有了帖子[命令] Minecraft 1.13.x 中 Function 嵌套执行的顺序问题。简而言之，MC-126946 造成了顺序颠倒。于是无奈之中我们只能将nearest改为furthest，使得行为上正常了。但这是非常肮脏的hack，很可能在未来的某个版本被修复，倒是这个地方还需要改回来。\n        另外，带位移的拷贝也需要使用sort，不过不受以上所述的BUG的影响：\nvoid inline COPY(ostream& ofs, const string& TO, const string& FROM, size_t length, size_t offset) {\n    ofs << \"execute as @e[tag=L\" << length << \"] at @s positioned ~\" << offset <<\n               \" ~ ~ run scoreboard players operation @e[tag=md5.bit,sort=nearest,limit=1] vars.\" << TO << \" = @s vars.\"\n         << FROM << endl;\n}复制代码        其他运算也类似，在此不再赘述。\n        在此改动后，数据包的大小已不到8MB，可见pku_zzzz的想法是极其有效且重要的！\n        其他地方就没有什么特别的了，有兴趣的朋友可去GitHub中查看生成器的代码。\n\n\n其他：        使用完全一样的技术，我们可以实现SHA-256等hash算法。\n\n\n感谢：\n@玄素@SPGoding \n\n\n\n\n\n\n\n\n\n\n\n[groupid=546]Command Block Logic[/groupid]",
    "replies": [
        {
            "author": "pku_zzzz",
            "timestamp": 1551430800,
            "txt_content": "沙发？\n\n当时我也想到过类似的坑的，不过由于素学姐在我之前已经着手去做了，所以我就把这个点子放弃了。不过，之后具体构思的细节我也和素学姐说了，和素学姐当时的实现也有一定程度的差异，没想到素学姐直接把我挂在了第二作者的位置，我也是感到有些荣幸吧。\n\n其实感觉这样的想法还是挺容易想到的，毕竟现在的命令差不多也快发展成面向实体编程了（笑）。"
        },
        {
            "author": "爱心魔王FHC",
            "timestamp": 1551435300,
            "txt_content": "计算MD5你们是真的恐怖，以后都不用下软件了，MC里计算就好了"
        },
        {
            "author": "森林蝙蝠",
            "timestamp": 1551442920,
            "txt_content": "太牛逼了，衬托得我渺小不堪，一无是处。"
        },
        {
            "author": "寒兮!",
            "timestamp": 1551443340,
            "txt_content": "太强了,mc迟早变成运行环境(大雾)"
        },
        {
            "author": "zyjking",
            "timestamp": 1551448560,
            "txt_content": "在MC中计算MD5……\n你们是有多闲……"
        },
        {
            "author": "寒江独钓",
            "timestamp": 1551521940,
            "txt_content": "感谢楼主分享~学到了"
        },
        {
            "author": "fanyanfeng",
            "timestamp": 1551534720,
            "txt_content": "厉害，没谁了"
        },
        {
            "author": "taibaiOVO",
            "timestamp": 1551578820,
            "txt_content": "感谢楼主分享~学到了"
        },
        {
            "author": "princess01",
            "timestamp": 1551630120,
            "txt_content": "突然感到自己的渺小系列"
        },
        {
            "author": "WB1436871576",
            "timestamp": 1552016640,
            "txt_content": "牛逼到我看不懂..............................."
        },
        {
            "author": "164978694",
            "timestamp": 1552205760,
            "txt_content": "正经:\n我眼睛疼\n\n余味:\n[图片]\n\n正经:\n不能一直盯着电脑\n\n余味:\n嗯嗯 那就别看了"
        },
        {
            "author": "猿汐",
            "timestamp": 1552211880,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "2984035075",
            "timestamp": 1552695600,
            "txt_content": "ooooooooooooo"
        },
        {
            "author": "...Fisherman",
            "timestamp": 1552803480,
            "txt_content": "学到了，哈哈哈"
        },
        {
            "author": "Trthgfghg",
            "timestamp": 1552809540,
            "txt_content": "万利达独爱i多家"
        },
        {
            "author": "kether离",
            "timestamp": 1553255580,
            "txt_content": "进来逛逛然后喝茶ing最后疯狂膜拜ing"
        },
        {
            "author": "asdqwe159654852",
            "timestamp": 1553848980,
            "txt_content": "444444444444444444444"
        },
        {
            "author": "asdqwe159654852",
            "timestamp": 1553849040,
            "txt_content": "44444444444444444444"
        },
        {
            "author": "斩玄地青月",
            "timestamp": 1553871000,
            "txt_content": "。。。。。。"
        },
        {
            "author": "无法大神",
            "timestamp": 1554023940,
            "txt_content": "啦啦啦啦啦啦啦啦啦啦啦啦啦啦"
        },
        {
            "author": "a15398390095",
            "timestamp": 1554112440,
            "txt_content": "感谢分享  感谢"
        },
        {
            "author": "lovethx",
            "timestamp": 1554376260,
            "txt_content": "......................................"
        },
        {
            "author": "忘·羡",
            "timestamp": 1554379920,
            "txt_content": "讲的真好"
        },
        {
            "author": "wingzi060123",
            "timestamp": 1554395160,
            "txt_content": "数学不好的人表示看不懂"
        },
        {
            "author": "niyuan",
            "timestamp": 1554616440,
            "txt_content": "新人做任务"
        },
        {
            "author": "鼆畻",
            "timestamp": 1554626640,
            "txt_content": "emmmmmmmmmmmmmmmmmmmmmmmmmmmmm"
        },
        {
            "author": "niyuan",
            "timestamp": 1554628320,
            "txt_content": "电脑崩了？该换了"
        },
        {
            "author": "大恐龙啊",
            "timestamp": 1554870180,
            "txt_content": "adwasawdssawdsa"
        },
        {
            "author": "Nissyara",
            "timestamp": 1555331520,
            "txt_content": "做一个c编译器吧，把c代码编译成mc命令"
        },
        {
            "author": "丢人素学姐",
            "timestamp": 1555406700,
            "txt_content": "Nissyara 发表于 2019-4-15 20:32\n做一个c编译器吧，把c代码编译成mc命令\n你怎么知道我没在做呢"
        },
        {
            "author": "lop121",
            "timestamp": 1555506180,
            "txt_content": "大佬666666"
        },
        {
            "author": "旎小殇",
            "timestamp": 1555557720,
            "txt_content": " 本帖最后由 旎小殇 于 2019-5-12 23:02 编辑 \n\n感谢支持楼主继续加油，期待更新"
        },
        {
            "author": "旎小殇",
            "timestamp": 1555557780,
            "txt_content": " 本帖最后由 旎小殇 于 2019-5-12 23:02 编辑 \n\n感谢支持楼主继续加油"
        },
        {
            "author": "旎小殇",
            "timestamp": 1555558140,
            "txt_content": " 本帖最后由 旎小殇 于 2019-5-12 22:57 编辑 \n\n继续努力加油，很有用"
        },
        {
            "author": "HUI极度灰",
            "timestamp": 1555754880,
            "txt_content": "嗯嗯嗯，好厉害！（不明觉厉）"
        },
        {
            "author": "CCxia",
            "timestamp": 1556723280,
            "txt_content": "看了下确实学到了很多，之前在1.12.2里也自己写了个32位的架构来实现高精度的代数型三角函数运算，但当时自己命名不规范，没有利用假名的优势，甚至常量的命令我用@p ten这种来表示10，简直了。也准备在1.14里把之前写的不完善的地方优化一下。"
        },
        {
            "author": "1677343686",
            "timestamp": 1557035400,
            "txt_content": "大佬牛逼啊"
        },
        {
            "author": "ActiveDesktop",
            "timestamp": 1557065820,
            "txt_content": "大佬。。或许以后想要做个什么东西开个mc模拟下环境就能搞出来了？= ="
        },
        {
            "author": "旎小殇",
            "timestamp": 1557673080,
            "txt_content": "旎小殇 发表于 2019-4-18 11:22\n6666666666\n加油加油，很有用很棒棒"
        },
        {
            "author": "cf6513272991",
            "timestamp": 1558761000,
            "txt_content": "\n感谢楼主分享~学到了"
        },
        {
            "author": "REgouzi",
            "timestamp": 1594463520,
            "txt_content": "看不懂啊看不懂，我怕是玩了个假MC"
        },
        {
            "author": "669775992",
            "timestamp": 1594484760,
            "txt_content": "......我是真没看懂，不过你在MC里用命令算MD5是个神魔操作啊？！"
        }
    ]
}