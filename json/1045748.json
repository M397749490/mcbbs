{
    "title": "PVPIN教程RL--配方、合成表的创建与注册，以及NameSpacedKey",
    "author": "William_Shi",
    "replyCount": 2,
    "timestamp": 1589554020,
    "txt_content": " 本帖最后由 William_Shi 于 2020-5-16 08:49 编辑 \n\n本教程系PVPIN教程复刻系列\n索引见https://www.mcbbs.net/thread-1034477-1-1.html\n本教程不做排版，如果你觉得不舒服，可以选择退出本页面\n本教程所有代码全部在coding开源，详见索引本教程可能存在一定吞代码问题，总体上以开源地址的代码为准\nBukkit中文文档对配方相关内容的汉化较为缺乏（2020.5.14），故我按自己的理解做了一定翻译\nBukkit中文文档对NameSpacedKey没有翻译，但是有新人一直无法理解，故我写了本教程\n\n本教程涵盖内容：如何注册一个自定义的配方\n如何创建有序合成、无序合成、熔炉等配方\n\n当年在PVPIN，注册配方非常简单，积木都已经为你做好，但是现在该怎么注册一个配方呢？\n首先我们在BukkitAPI AllClasses页面搜索 recipe关键字 应该有15个结果，不过这些当中有相当一部分是不需要使用的，后文会讲，那么我们先看Recipe这个类，是这样的（https://bukkit.windit.net/javadoc/org/bukkit/inventory/Recipe.html）\n\npublic interface Recipe\nRepresents some type of crafting recipe.\n\n所以这个Recipe本身是一个接口，这该怎么理解呢？如果你接触过NBT，你应该知道NBTBase（NBT基础数据包）；如果你接触过net.md_5.bungee.chat的相关内容，你应该知道ChatBaseComponent，这些东西都不可以直接新建其对象，此处不展开了，但是我们可以通过类比的方式知道Recipe是什么，Recipe，是所有配方都实现的接口，换句话说Recipe是所有配方的总称，所有配方的超集，但是你不可以直接新建一个Recipe对象，因为mc不可能知道你要新建什么配方，这正如同你不能new 一个接口一样，你必须new 接口的非抽象非接口的子类，也就是说你必须new 一个具体的配方，然后mc才可以帮你处理合成、烧制等行为\n\n比如说，你可以new 一个org.bukkit.inventory.ShapedRecipe，也就是说你可以new一个有序合成配方，你可以new 一个org.bukkit.inventory.ShapelessRecipe，代表无序合成配方，你可以new任何具体的配方，但你不可以直接new Recipe。\n\n那么在新建ShapedRecipe时我们又遇到了一个参数，类型NameSpacedKey\n\n构造器和说明\nShapedRecipe(ItemStack result)\n已过时。 \nShapedRecipe(NamespacedKey key, ItemStack result)\nCreate a shaped recipe to craft the specified ItemStack.\n\n众所周知，任何过时方法都应该尽可能避免使用，那么什么是NameSpacedKey呢？\nhttps://bukkit.windit.net/javadoc/org/bukkit/NamespacedKey.html\n\nNameSpace是命名空间，他的出现，是为了防止同名的材质、附魔、配方等等对象产生冲突。比如说minecraft:stone 表示minecraft这个命名空间里的石头这个材质，假如我自己注册了一个stone，命名空间是我PVPINDemoRL的命名空间，那么就是pvpindemorl:stone ，二者就不会产生冲突（当然，不建议随便取和原版一模一样的名字，容易混淆），这个NamespacedKey在很多地方都有应用。比如说海螺螺大佬的BukkitPersistent教程里，每一个二进制标签都要有一个NameSpacedKey，以保证某个插件的数据可以和其他插件的数据相区别开来。海螺螺大佬的教程是https://www.mcbbs.net/forum.php?mod=viewthread&tid=918325，当然与本文探讨的内容无关，不过海螺螺大佬的实例我们可以学习，那么他写了什么呢？\nnew NamespacedKey(plugin, \"playerJob\")复制代码\n所以NameSpacedKey的使用方法很明晰了\n\nNamespacedKey(Plugin plugin, java.lang.String key)\nCreate a key in the plugin's namespace.\nNamespacedKey(java.lang.String namespace, java.lang.String key)\n已过时。 \nshould never be used by plugins, for internal use only!!\n\n过时的方法，不应当使用。所以只需要传入插件的主类实例，bukkit就会分配一个NameSpace，给你的插件使用。这个NameSpacedKey在配方、材质、附魔、BKPersistent等等地方都有使用，因此你的一个插件对应一个NameSpace，同一个插件使用同一个NameSpaced，以确保不同插件注册的东西没有冲突。而你可以在NameSpace里自由注册自己的Key，用来表示不同的NameSpacedKey。\n\nKeys may only contain lowercase alphanumeric characters, periods, underscores, hyphens, and forward slashes.\n这句话是说Key不能包含一些奇奇怪怪的符号，你只能使用字母、数字、句号(英文句号)、下划线、短杠（-）、正斜杠（/)\n我把所有可以用的符号打在底下\nabcdefghijklmnopqrstuvwxyz0123456789_-/.\n不可以出现其他字符，否则就不是有效的Key\n\n所以我们不难写出这样的代码\n\nNamespacedKey key = new NamespacedKey( plugin, \"recipe1\");\n复制代码\n那么这样就成功注册了一个NameSpacedKey\n\n那么接下来我们要开始学习，无序合成（https://bukkit.windit.net/javado ... hapelessRecipe.html）\n\n构造器和说明\nShapelessRecipe(ItemStack result)\n已过时。 \nShapelessRecipe(NamespacedKey key, ItemStack result)\nCreate a shapeless recipe to craft the specified ItemStack.\n那么第一个参数就是你的Key，第二个就是合成结果的物品堆\n\n那么我们不难写出这样的代码\n\n\n\n\nShapelessCode.png (31.93 KB, 下载次数: 1)\n\n下载附件\n\n2020-5-15 22:29 上传\n\n\n\n\n\n其中addIngredient表示向配方添加一个材质因为是无序合成，所以add的顺序并不重要，那么我们就随便写了玻璃和黑曜石\n那么最后一行的Bukkit#addRecipe是什么呢？要让服务器知道你有这么一个Recipe对象，必须向服务器进行注册，此时就使用Bukkit#addRecipe方法\n进入游戏测试效果，看起来是这样的\n\n\n\n\nShapeless2.png (161.06 KB, 下载次数: 0)\n\n下载附件\n\n2020-5-15 22:46 上传\n\n\n\n\n\n\n\n\nShapeless1.png (165.41 KB, 下载次数: 0)\n\n下载附件\n\n2020-5-15 22:46 上传\n\n\n\n\n\n接下来我们就要接触到本节最难的一部分，有序合成（https://bukkit.windit.net/javado ... y/ShapedRecipe.html）\n\n构造器和说明\nShapedRecipe(ItemStack result)\n已过时。 \nShapedRecipe(NamespacedKey key, ItemStack result)\nCreate a shaped recipe to craft the specified ItemStack.\n同理，第一个参数是Key，第二个是合成结果的物品堆\n\n那么有序合成，物品摆放的位置显然是很重要的，该怎么定义物品摆放的位置呢？答案是使用char\n\nshape(java.lang.String... shape)\nSet the shape of this recipe to the specified rows.\n\n使用了varargs，接下来我会以实例的形式给大家展示是怎么使用的\n\n\n\n\nShapedRecipe.png (26.93 KB, 下载次数: 0)\n\n下载附件\n\n2020-5-15 22:29 上传\n\n\n\n\n\n那么游戏内效果是这样的\n\n\n\n\nShaped.png (117.11 KB, 下载次数: 0)\n\n下载附件\n\n2020-5-15 22:47 上传\n\n\n\n\n\n那么你是不是已经有些理解了呢，没错\n使用shape(\"aaa\",\"bbb\",\"ccc\")，就代表了你的这个配方，在3x3的工作台上，应该是第一行摆放一种物品，第二行一种，第三行一种。而a、b、c在此处代表了什么物品，就要通过setIngredient方法来建立这个char和物品的对应关系\n在我的实例里面，就使用a代表石英，b代表钻石，c代表绿宝石，得到的效果，就在上面，大家应该可以看到\n\n比如说shape(\"abc\",\"def\",\"ghi\")，那么就可以把你的配方变成一个九种不同物品的配方\n当然这里也可以是shape(\"aaa\",\"a a\",\"aaa\")，此时就是周围放8个a，中间留空\n\n所以总结来说，shape方法用来设置配方的物品摆放顺序\n使用一个char代表同材质的物品（空格代表没有）\nsetIngredient来建立char和物品材质之间的对应关系（可能有一些难以理解，你可以通过自己测试的方法深入了解，这里感性认识很重要！）\n\n但是这里有一点需要注意\n配方的“物品”，只可以是物品材质或MaterialData，但是MaterialData类已经被Bukkit废弃（具体看文档），所以请尽可能使用Material\nBukkit关于Material废弃的论述如下\n\n类 MaterialData\norg.bukkit.material.MaterialData\n所有已实现的接口:\njava.lang.Cloneable\n直接已知子类:\nBanner, Bed, Cake, Cauldron, Coal, CocoaPlant, Command, Comparator, Crops, Diode, DirectionalContainer, Door, Dye, FlowerPot, Gate, Hopper, LongGrass, Mushroom, NetherWarts, Observer, PistonBaseMaterial, PistonExtensionMaterial, PressurePlate, Pumpkin, Rails, RedstoneWire, Sandstone, Sign, SimpleAttachableMaterialData, Skull, SpawnEgg, Stairs, TexturedMaterial, Tripwire, Vine, Wood, Wool\n已过时。 \n所有关于MaterialData的用法已过时，并且将来会被移除. 请使用 BlockData.\n\n其中Bukkit英文原文为\n“\nall usage of MaterialData is deprecated and subject to removal. Use BlockData.\n”\n\n如果你有一些特殊需求，更推荐你使用一个自定义的GUI（比如说箱子GUI），做一个合成按键，然后自己检测对应格子的物品。\n\n\n最后讲熔炉配方（https://bukkit.windit.net/javadoc/org/bukkit/inventory/FurnaceRecipe.html）\n\n构造器和说明（去除了所有过时构造器）\nFurnaceRecipe(NamespacedKey key, ItemStack result, Material source, float experience, int cookingTime)\nCreate a furnace recipe to craft the specified ItemStack.\nFurnaceRecipe(NamespacedKey key, ItemStack result, RecipeChoice input, float experience, int cookingTime)\nCreate a furnace recipe to craft the specified ItemStack.\n第一个参数是Key，第二个是烧制的结果，第三个是被烧的物品，第四个是烧制完取出时得到的经验值，第五个是烧制时长\n\n这是RecipeChoice的文档（https://bukkit.windit.net/javado ... y/RecipeChoice.html）\nThis class is not legal for implementation by plugins!\n所以使用方法只有一个，见下\n\n\n\n\nFurnaceCode.png (21.04 KB, 下载次数: 0)\n\n下载附件\n\n2020-5-15 22:29 上传\n\n\n\n\n\n这里我把所有的参数全部放进了构造器，但是其实都有对应的getter和setter可以使用\n我的配方是烧制信标得到潮涌核心\n\n最终效果如下\n\n\n\n\nFurnace2.png (152.86 KB, 下载次数: 0)\n\n下载附件\n\n2020-5-15 22:46 上传\n\n\n\n\n\n\n\n\nFurnace1.png (145.69 KB, 下载次数: 0)\n\n下载附件\n\n2020-5-15 22:46 上传\n\n\n\n\n\n请注意！1.14+已经出现了烟熏炉等具有熔炉功能的方块，所以更建议使用CookingRecipe，（https://bukkit.windit.net/javado ... /CookingRecipe.html），不过需要注意，这个CookingRecipe包括了烟熏炉，高炉，熔炉，篝火的配方，如果你要进行一些限制就请分别注册，上述所有的配方与熔炉配方的使用方法几乎完全一样，参数也几乎一样\n\n如果你想对配方进行一些额外的操作，比如说，玩家要具备某些指定权限才可以合成某个物品，你可以监听CraftItemEvent，比如说，某个物品烧制需要特定的多方块结构（我假设有一个多方块的自定义的熔炉结构），那么你可以监听BlockCookEvent\n\n",
    "replies": [
        {
            "author": "949151128",
            "timestamp": 1589557020,
            "txt_content": "没想到还有这些骚操作，楼主很棒阿，感谢分享"
        },
        {
            "author": "AuroraCruiser",
            "timestamp": 1592886240,
            "txt_content": "大佬牛逼 你的贴子我几乎都看了 干货满满"
        }
    ]
}