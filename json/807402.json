{
    "title": "如何把文本的表达式 计算出来？",
    "author": "Meagic",
    "replyCount": 17,
    "timestamp": 1532047860,
    "txt_content": " 本帖最后由 Meagic 于 2018-7-20 13:51 编辑 \n\n如题 像某些插件的表达式    获取配置文件的一个文本\n例如 \"233-666\"\n获取到这个文本后 我该怎么进行转换计算？\n\n感谢各位的帮助，已学会\n另外 我自学 不看书 不看视频\n靠着反编译源码学会的JAVA \n没有基础知识也是 233 正常的\n",
    "replies": [
        {
            "author": "sahdsg",
            "timestamp": 1532050020,
            "txt_content": "初中时候的想法 不支持括号\n把减号和加号作为分隔符分割\n然后把乘号和除号作为分隔符将上一次分割的分割\n最后计算\n\n\n\n\nvfdvnfdjkvfs.png (1.81 KB, 下载次数: 0)\n\n下载附件\n\n2018-7-20 09:24 上传\n\n\n\n\n就像这样……\n\n后来想过用栈……然后没想了\n\n"
        },
        {
            "author": "Meagic",
            "timestamp": 1532051700,
            "txt_content": "sahdsg 发表于 2018-7-20 09:27\n初中时候的想法 不支持括号\n把减号和加号作为分隔符分割\n然后把乘号和除号作为分隔符将上一次分割的分割\n这个貌似实现方法并不能实践\n\n带括号的那种 怎么转 - -\n\n(233-11)*2-6*(1+3)"
        },
        {
            "author": "吕易天",
            "timestamp": 1532052780,
            "txt_content": "Meagic 发表于 2018-7-20 09:55\n这个貌似实现方法并不能实践\n\n带括号的那种 怎么转 - -\n你这个问题不就是语法解析器了么，用正则token分割呗。"
        },
        {
            "author": "吕易天",
            "timestamp": 1532052960,
            "txt_content": "Meagic 发表于 2018-7-20 09:55\n这个貌似实现方法并不能实践\n\n带括号的那种 怎么转 - -\n还有一种方法，找出括号的数量/2然后循环然后找\"（\"然后找它对应的\"）\"然后把括号中的算出来以后文本替换到原来的文本里，这样就把括号处理了。"
        },
        {
            "author": "吕易天",
            "timestamp": 1532053080,
            "txt_content": "吕易天 发表于 2018-7-20 10:16\n还有一种方法，找出括号的数量/2然后循环然后找\"（\"然后找它对应的\"）\"然后把括号中的算出来以后文本替换 ...\n如果这个括号的内容算不出来说明里面还有括号或者表达式错误，那么就去寻找里面的括号按照同样步骤处理，如果找不到里面的括号就是表达式错误，就直接结束运算。"
        },
        {
            "author": "dogeop",
            "timestamp": 1532055720,
            "txt_content": "有时间瞎问，不如多看书，这种最初级的问题任何一本算法书都会讲。"
        },
        {
            "author": "dogeop",
            "timestamp": 1532055720,
            "txt_content": "数据结构与算法了解一下。"
        },
        {
            "author": "王自如",
            "timestamp": 1532058900,
            "txt_content": "用引擎可以看看（墙） https://code.google.com/archive/p/fast-el/\n带括号的，先用正则把公式括号全部拆解掉进行计算，在根据先算加减后算乘除来计算\n挺有意思的问题呀"
        },
        {
            "author": "Smokey_Days",
            "timestamp": 1532059260,
            "txt_content": "基础知识啊...\n就是维护一个符号栈一个数字栈就行了。简单题。"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1532063880,
            "txt_content": " 本帖最后由 langyo_v3 于 2018-7-25 01:58 编辑 \n\n真是的，你们也就只说说，叫楼主去学这样学那样\n楼主要是学懂了还会来问？\n不回答也可以，但我也没看见有哪个人拿出资料给楼主学的\n\n不废话，贴源码\n好久没用java了，手太生，写了有一小时才写出来，也没调试\n\n加减乘除优先级改变运算顺序的部分我没去写，楼主要是需要可以自己补充\npackage com.github.langyo.test;\n\nimport java.util.*;\nimport java.util.regex.*;\n\n// 该类用于进行字符串形式的简单数学表达式到运算结果的转换与计算\n\npublic class StringToNumberAndDeal {\n\n        public static void main(String[] args) {\n                // 此子程序仅供用于启动测试\n        }\n\n        // 执行此函数，将你要解析的表达式传进来，它会给你结果\n        public int executeExpression(String input) {\n                _parse(new StringBuilder(input));\n                _deal();\n                \n                return result;\n        }\n        \n        // 运算符枚举\n        enum operationType{\n                add, // 加\n                sub, // 减\n                mul, // 乘\n                dev, // 除\n                mod // 取模（求余数）\n        }\n        \n        // 初始时为表达式的第一个数字，随着deal函数的进行，此数字会被不断修改直到运算完毕，变成结果\n        int result;\n        // 运算数字与运算符组合的缓存列表，当parse函数解析完毕后deal函数会逐个处理这里头的内容\n        // 表达式的第一个数字不会存储在这里头\n        Vector<operationType> mathCacheType = new Vector<>();\n        Vector<Integer> mathCacheNumber = new Vector<>();\n        \n        // 用于将表达式拆分成一条一条的小运算指令；此函数会递归调用自己\n        private void _parse(StringBuilder content) {\n                // 创建用于括号的匹配表达式；必须是头部的括号，因为表达式是从头逐个解析的\n                // 此正则表达式为： ^ *?\\((.+)\\)\n                static Pattern patternBrackets = Pattern.compile(\"^ *?\\\\((.+)\\\\)\");\n                // 创建用于运算符的匹配表达式，包括+ - * / %；表达式从头逐个解析\n                // 此正则表达式为： ^ *?(\\+|\\-|\\*|\\/|\\%) *?(\\-?[0-9]*[1-9])\n                static Pattern patternOperations = Pattern.compile(\"^ *?(\\\\+|\\\\-|\\\\*|\\\\/|\\\\%) *?(\\\\-?[0-9]*[1-9])\");\n                \n                // 循环进行匹配，除非content中的运算符已经全部匹配且删除完再跳出\n                // （删除指的是每解析完成一步骤，此步骤解析到的数字和运算符部分会被切割删除掉）\n                while(content.length() != 0) {\n                        // 创建括号的匹配结果容器\n                        Matcher matchBrackets = patternBrackets.matcher(content.toString());\n                        // 创建运算符的匹配结果容器\n                        Matcher matchOperations = patternOperations.matcher(content.toString());\n                        \n                        if(matchBrackets.find()) {\n                                // 如果能检测到括号\n                                // 先递归调用自己，以解析子表达式\n                                _parse(new StringBuilder(matchBrackets.group(1)));\n                                // 然后删除匹配的部分\n                                content = content.delete(0, matchBrackets.group(0).length());\n                        }else if(matchOperations.find()){\n                                // 如果能检测到运算符\n                                // 将运算类型解析出来\n                                operationType t = null;\n                                switch(matchOperations.group(1)) {\n                                case \"+\":\n                                        t = operationType.add;\n                                case \"-\":\n                                        t = operationType.sub;\n                                case \"*\":\n                                        t = operationType.mul;\n                                case \"/\":\n                                        t = operationType.dev;\n                                case \"%\":\n                                        t = operationType.mod;\n                                }\n                                // 将匹配到的内容加入进mathCache数组中\n                                mathCacheType.add(t);\n                                mathCacheNumber.add(Integer.parseInt(matchOperations.group(2)));\n                                // 然后删除匹配的部分\n                                content = content.delete(0, matchOperations.group(0).length());\n                        }else{\n                                // 语法错误，抛运算错误\n                                throw new ArithmeticException();\n                        }\n                }\n        }\n        \n        // 执行拆分好的一大批小的运算式\n        private void _deal() {\n                for(int i = 0; i < mathCacheType.size(); ++i) {\n                        // 逐个执行，根据mathCacheType中对应元素所储存的类型执行相应的操作\n                        switch(mathCacheType.get(i)) {\n                        case add: // 加\n                                result = result + mathCacheNumber.get(i);\n                        case sub: // 减\n                                result = result - mathCacheNumber.get(i);\n                        case mul: // 乘\n                                result = result * mathCacheNumber.get(i);\n                        case dev: // 除\n                                result = result / mathCacheNumber.get(i);\n                        case mod: // 取模\n                                result = result % mathCacheNumber.get(i);\n                        }\n                }\n        }\n}\n复制代码"
        },
        {
            "author": "RainIFunS",
            "timestamp": 1532160420,
            "txt_content": "基础只是不是看源码自学的吗0 -0 像我"
        },
        {
            "author": "zghh008",
            "timestamp": 1532342220,
            "txt_content": "逆波兰表达式，了解一下。"
        },
        {
            "author": "弱鸡绿毛怪",
            "timestamp": 1532396400,
            "txt_content": "int returns = (int)new ScriptEngineManager().getEngineByName(\"JavaScript\").eval(\"233-666\");"
        },
        {
            "author": "Smokey_Days",
            "timestamp": 1532423520,
            "txt_content": " 本帖最后由 Smokey_Days 于 2018-7-24 17:13 编辑 \nlangyo_v3 发表于 2018-7-20 13:18\n真是的，你们也就只说说，叫楼主去学这样学那样\n楼主要是学懂了还会来问？\n不回答也可以，但我也没看见有哪 ...\n虽然代码写得不是很好，但是思路很清晰_(:з」∠)_惭愧惭愧，我也几百年没写JAVA了。\n开头的话地图炮了吧\n"
        },
        {
            "author": "1850343382",
            "timestamp": 1532436000,
            "txt_content": "\n这种简单计算，直接上Script引擎"
        },
        {
            "author": "Takej",
            "timestamp": 1532516640,
            "txt_content": "我不会，好啊吧我是活跃气氛"
        },
        {
            "author": "Himmelt",
            "timestamp": 1532650440,
            "txt_content": "上网搜java的四则运算吧，这是一个相对复杂的功能，自己写不如找经典算法。"
        }
    ]
}