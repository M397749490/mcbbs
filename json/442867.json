{
    "title": "Day's 水桶插件开发教程 第五章 事件/监听器",
    "author": "whatafcukday",
    "replyCount": 29,
    "timestamp": 1431092040,
    "txt_content": "Day’s 水桶插件开发教程5.事件/监听器这次简洁版 （懒+没人看不想更） 监听器 顾名思义 就是监控服务器的信息具体监控什么信息呢？ 就要用到事件了 事件分许多种 比如方块放置 液体流动 玩家加入 玩家移动等1先创建一个监听器  可以新建一个类 也可以在主类中创建他要求实现listen接口并且导入import org.bukkit.event.Listener; 像这样Package  xx.xx.xx;import org.bukkit.event.Listener;public class PluginListener implements Listener {}2创建一个方法 参数为代表某个事件的类 并为他标记EventHandler比如@EventHandlerPublic void name (BlockBreakEvent evt) {}创建一个监听器需要记住两点  让该类实现listener接口&添加EventHandler标记 然后创建好了监听器 还需要注册他 一般在主类启用方法中注册getServer().getPluginManager().registerEvents(new ListenerClassName(), this);其中ListenerClassName为监听器的类名 当选择创建在主类中时两个参数都为this你可以在任何地方注册事件 让他启用 怎么注销？HandlerList.unregisterAll(); 直接注销此插件中所有事件一般在卸载方法中执行 或者 使用BlockBreakEvent.getHandlerList().unregister(Listener/Plugin);注销该监听器/主类中的BlockBreakEvent事件。该处的Listener指监听器 Plugin 指主类注销后 将不会继续监听。 可以代码补全来快速找到自己需要的关于事件的方法 假设我们事件参数为evt输入evt.         (末尾有个点)然后就会弹出一个框框 你可以在里面找需要的方法比如玩家加入事件 PlayerJoinEvent evtevt.getPlayer 就得到加入的那个玩家了 自定义事件不讲 暂时用不到。 作业：从javadoc中寻找取消事件的方法 并写一个玩家进服全服公告的插件 javadoc:   https://hub.spigotmc.org/javadocs/bukkit/没事就多翻翻 javadoc总会有收获的 =0=  事件什么的也在API里全服公告也有方法 还是在javadoc里 别的教程你们也可以去翻一番　多多少少有些不一样　从多方面看问题才是最明智的。有金币的拿金币来没金币的拿人气来 最好两样都拿来 不然。。我会越变越懒得！",
    "replies": [
        {
            "author": "上白丶慧泽音",
            "timestamp": 1431170700,
            "txt_content": "我想问下禁止物品拾取是不是这样做.\n@EventHandler\npublic void Ban(PlayerPickupItemEvent evt){\nPlayer p = evt.getPlayer();\np.setCancelled(true);\np.sendMessage(\"该物品被禁止\");\n}\n复制代码"
        },
        {
            "author": "桃渊林",
            "timestamp": 1431170700,
            "txt_content": "Package的P需要小写"
        },
        {
            "author": "whatafcukday",
            "timestamp": 1431175680,
            "txt_content": "上白丶慧泽音 发表于 2015-5-9 19:25\n我想问下禁止物品拾取是不是这样做.\n恩是可以这样做{:10_505:}"
        },
        {
            "author": "whatafcukday",
            "timestamp": 1431175680,
            "txt_content": "hcrgm1 发表于 2015-5-9 19:25\nPackage的P需要小写\n{:10_492:} 留给他们自己矫正"
        },
        {
            "author": "上白丶慧泽音",
            "timestamp": 1431176700,
            "txt_content": " 本帖最后由 上白丶慧泽音 于 2015-5-10 10:29 编辑 \n\n\n \npublic void onEnable() {\nif(!getDataFolder().exists()) {\ngetDataFolder().mkdir();\n}\ngetLogger().info(\"测试插件.\")\n}\n\npublic boolean onCommand(CommandSender sender,Command cmd,String label,String[] args){\nif(label.equalsIgnoreCase(\"bin\")){\nif(args.length == 0){\nsender.sendMessage(\"§e/bin set [玩家] [消息] 设置指定玩家进入消息\")\nsender.sendMessage(\"§e/bin remove [玩家] 取消玩家进入消息\")\n}\nif(args[0].equalsIgnoreCase(\"set\")){\nif(args.length != 3){\nsender.sendMessage(\"§e/bin set [玩家] [消息] 设置指定玩家进入消息\")\nreturn true;\n}\nif(args.length == 3){\nPlayer player = args[1];\nString message = args[2];\nsetmessage(player,message);\n}\n}\nif(args[0].equalsIgnoreCase(\"remove\")){\nif(args.length != 2){\nsender.sendMessage(\"§e/bin remove [玩家] 取消玩家进入消息\");\nreturn true;\n}\nif(args.length < 2){\nsender.sendMessage(\"参数过长\");\nreturn true;\n}\nif(args.length>){\nsender.sendMessage(\"参数过短\");\nreturn true;\n}\nPlayer player = args[1];\nif(removemessage(player)){\nsender.sendMessage(\"§c删除成功\");\n}\nsender.sendMessage(\"§c删除失败\");\n}\n}\n}\n\n@EventHandler\npublic void PJE (PlayerJoinEvent evt){\nPlayer p = evt.getPlayer();\nif(p == getmessage(p)){\nbukkit.broadcastMessage(getmessage());\n}\n}\n\n\npublic FileConfiguration load (File file){\nif(!file.exists()){\ntry{\nfile.createNewFile();\n}\ncatch(IOException e){\ne.printStackTrace();\n}\n}\nreturn YamlConfiguration.loadConfiguration(file);\n}\npublic void setmessage(Player p,String msg){\nFile file=new File(getDataFolder(),\"config.yml\");\nFileConfiguration config = load(file)\nPlayer p = getServer.getPlayer(args[1]);\nconfig.set(\"bin.\"+p+\".\", msg)\ntry{\ngetConfig().save(file);\n}\ncatch\n(IOException e){e.printStackTrace();\n}\n\npublic void getmessage(Player p){\nFile file=new File(getDataFolder(),\"config.yml\");\nFileConfiguration config = load(file);\nif(config.contains(\"config.yml\")){\nString mess = config.getString(\"bin.\"+p+\".\");\nreturn mess;\n}\n}\npublic boolean removemessage(Player p){\nFile file = new File(getDataFolder(),\"config.yml\");\nFileConfiguration config = load(file);\nif(config.contains(\"config.yml\")){\nconfig.set(\"bin.\"+p,null);\ntry{\ngetConfig().save(file);\n}\ncatch\n(IOException e){e.printStackTrace();\nreturn true;\n}\nreturn false;\n}复制代码\n\n\n这个花几十分钟弄出来的\n就是 写配置文件不会 写指令到很熟悉\n好像写的好复杂{:10_522:}\n请看看有什么错误.\n顺便缩写下"
        },
        {
            "author": "whatafcukday",
            "timestamp": 1431182100,
            "txt_content": " 本帖最后由 whatafcukday 于 2015-5-9 22:39 编辑 \n上白丶慧泽音 发表于 2015-5-9 21:05\n这个花几十分钟弄出来的\n就是 写配置文件不会 写指令到很熟悉\n好像写的好复杂\ngetmessage有什么意义？ 表示你应该判断配置文件中 玩家p有没有保存过登陆信息 若有则返回该字符串若无返回null 然后再在事件中判断要是有就输出，没有就无视\n写程序要严谨， 方法的返回值一定要清晰，半吊子一般哪里错了改哪里是写不出好程序的哦！\n\n"
        },
        {
            "author": "上白丶慧泽音",
            "timestamp": 1431223500,
            "txt_content": " 本帖最后由 上白丶慧泽音 于 2015-5-10 10:31 编辑 \nwhatafcukday 发表于 2015-5-9 22:35\ngetmessage有什么意义？ 表示你应该判断配置文件中 玩家p有没有保存过登陆信息 若有则返回该字符串若无返 ...\n\n这样么,注册事件那也忘记添加了. \ngetServer().getPluginManager().registerEvents(this, this);还有命令那行没错啊本来就是 /bin set 不是/bin 的话就不执行. \n@EventHandler\npublic void PJE (PlayerJoinEvent evt){\nPlayer p = evt.getPlayer();\nString b = getmessage(p);\nif(p != null){\n   bukkit.broadcastMessage(getmessage(b));\n}\n}\n\npublic void getmessage(Player p){\n  File file=new File(getDataFolder(),\"config.yml\");\n  FileConfiguration config = load(file);\n  if(config.contains(\"config.yml\")){\n  String mess = config.getString(\"bin.\"+p+\".\");\n  return mess;\n  }\n  return null;\n}\n\n"
        },
        {
            "author": "上白丶慧泽音",
            "timestamp": 1431224580,
            "txt_content": "whatafcukday 发表于 2015-5-9 22:35\ngetmessage有什么意义？ 表示你应该判断配置文件中 玩家p有没有保存过登陆信息 若有则返回该字符串若无返 ...\n我想问下读配置和写配置到底怎么弄的.\n如你第四章是不是这样读的\nMessage:\n  Default: 普通人\n  Builder: 建筑者\n读Default这样?\ngetConfig().getString(“Message”).getString(\"Default\");\n还是getConfig.getString(\"Message.Default\");\n那在Message添加owner是不是这样\ngetConfig().setString(\"Message\",\"Owner.管理组\") \n还是.getConfig().setString(\"Message\",\"Owner:管理组\")\n\n创建一个config.yml如何创建啊我怎么看了各种实例都不一样.\n而且Bukkit Api 找不到那一栏在哪里."
        },
        {
            "author": "t9044",
            "timestamp": 1431225360,
            "txt_content": "上白丶慧泽音 发表于 2015-5-10 10:23\n我想问下读配置和写配置到底怎么弄的.\n如你第四章是不是这样读的\nMessage:\n你都已经把代码写出来了..自己尝试一下不就可以了嘛\nconfig.yml是你要在IDE上创建的"
        },
        {
            "author": "whatafcukday",
            "timestamp": 1431225660,
            "txt_content": "上白丶慧泽音 发表于 2015-5-10 10:23\n我想问下读配置和写配置到底怎么弄的.\n如你第四章是不是这样读的\nMessage:\ngetString(路径) \nMessage:\n   Default: 普通人\n  Builder: 建筑者\nDefault的路径= \"Message.Default\""
        },
        {
            "author": "whatafcukday",
            "timestamp": 1431225780,
            "txt_content": "上白丶慧泽音 发表于 2015-5-10 10:05\n这样么,注册事件那也忘记添加了. \ngetServer().getPluginManager().registerEvents(this, this);还有命令 ...\n错了，你那是判断触发的玩家等不等于null 但是既然触发了怎么可能等于null呢 应该是getmessage得到的那个等不等于null"
        },
        {
            "author": "上白丶慧泽音",
            "timestamp": 1431236880,
            "txt_content": "whatafcukday 发表于 2015-5-10 10:43\n错了，你那是判断触发的玩家等不等于null 但是既然触发了怎么可能等于null呢 应该是getmessage得到的那个 ...\n我这是判断玩家是不是为null.\n 如果不是那就发送消息\n如果是什么都不做.\ngetmessage 那有返回null."
        },
        {
            "author": "whatafcukday",
            "timestamp": 1431242700,
            "txt_content": "上白丶慧泽音 发表于 2015-5-10 13:48\n我这是判断玩家是不是为null.\n 如果不是那就发送消息\n如果是什么都不做.\n if(config.contains(\"config.yml\"))  这是什么鬼。。。"
        },
        {
            "author": "上白丶慧泽音",
            "timestamp": 1431244440,
            "txt_content": "whatafcukday 发表于 2015-5-10 15:25\nif(config.contains(\"config.yml\"))  这是什么鬼。。。\nFile file=new File(getDataFolder(),\"config.yml\");\nFileConfiguration config = load(file)\n我看这里来模仿读写配置的.http://www.mcbbs.net/thread-282740-1-1.html"
        },
        {
            "author": "whatafcukday",
            "timestamp": 1431260280,
            "txt_content": "上白丶慧泽音 发表于 2015-5-10 15:54\nFile file=new File(getDataFolder(),\"config.yml\");\nFileConfiguration config = load(file)\n我看这里来 ...\nif(config.contains(\"config.yml\"))  是判断在config中路径\"config.yml\"存不存在 毛的关系都没有。。"
        },
        {
            "author": "UAC_MagicK",
            "timestamp": 1431260520,
            "txt_content": "新手听不懂   上视屏吧{:10_522:}"
        },
        {
            "author": "上白丶慧泽音",
            "timestamp": 1431260580,
            "txt_content": "whatafcukday 发表于 2015-5-10 20:18\nif(config.contains(\"config.yml\"))  是判断在config中路径\"config.yml\"存不存在 毛的关系都没有。。 ...\n这个是读配置.如果存在加载\n  if(config.contains(\"config.yml\")){\n  String mess = config.getString(\"bin.\"+p+\".\");\n  return mess;"
        },
        {
            "author": "whatafcukday",
            "timestamp": 1431260640,
            "txt_content": "-----王者----- 发表于 2015-5-10 20:22\n新手听不懂   上视屏吧\n{:10_492:} 多看几遍 看不懂继续看肯定有一天能看懂的 要边写程序边看"
        },
        {
            "author": "whatafcukday",
            "timestamp": 1431260760,
            "txt_content": "上白丶慧泽音 发表于 2015-5-10 20:23\n这个是读配置.如果存在加载\n  if(config.contains(\"config.yml\")){\n  String mess = config.getString(\"b ...\n{:10_494:}你可以直接在jar包中创建一个config 这样当saveDefaultConfig时config.yml不存在就会把jar包中的config拉过来"
        },
        {
            "author": "上白丶慧泽音",
            "timestamp": 1431261180,
            "txt_content": "whatafcukday 发表于 2015-5-10 20:26\n你可以直接在jar包中创建一个config 这样当saveDefaultConfig时config.yml不存在就会把jar包中 ...\n哦那样啊.....这个是插件自动生成的= ="
        },
        {
            "author": "1377023219",
            "timestamp": 1452310560,
            "txt_content": "不错啊，谢谢楼主了"
        },
        {
            "author": "a59118196",
            "timestamp": 1470556020,
            "txt_content": "不错，支持原创教程\n"
        },
        {
            "author": "SmartZombie",
            "timestamp": 1475462760,
            "txt_content": "一个监听器类中可以写两个监听方法吗"
        },
        {
            "author": "1713438554",
            "timestamp": 1486359600,
            "txt_content": "在PlayerJoinEvent里面加入：\nPlayer a = event.getPlayer()\nbukkit.broadcastmessage(\"Test\");//好像是这样"
        },
        {
            "author": "kqn3",
            "timestamp": 1498366020,
            "txt_content": "楼主，我找不到玩家进服的事件。。。。。"
        },
        {
            "author": "kqn3",
            "timestamp": 1498366500,
            "txt_content": "kqn3 发表于 2017-6-25 12:47\n楼主，我找不到玩家进服的事件。。。。。\n没事，找到；了"
        },
        {
            "author": "kqn3",
            "timestamp": 1498367100,
            "txt_content": "@EventHandler\n        public void EnterCall(PlayerJoinEvent evt) {\n\n                getServer().getPluginManager().registerEvents(new pluginname(), this);\n                        Player p=evt.getPlayer();\n                        \n                evt.setJoinMessage(\"玩家：\"+p.getName()+\"进入服务器\"+\"(没想到吧，我又回来啦)\");\n\n        }//不知道evt.setJoinMessage是不是“加入游戏时向全服发送消息”的意思"
        },
        {
            "author": "kqn3",
            "timestamp": 1498367100,
            "txt_content": "@EventHandler\n        public void EnterCall(PlayerJoinEvent evt) {\n\n                getServer().getPluginManager().registerEvents(new pluginname(), this);\n                        Player p=evt.getPlayer();\n                        \n                evt.setJoinMessage(\"玩家：\"+p.getName()+\"进入服务器\"+\"(没想到吧，我又回来啦)\");\n\n        }//不知道evt.setJoinMessage是不是“加入游戏时向全服发送消息”的意思"
        },
        {
            "author": "SakuraYuyuko233",
            "timestamp": 1509718800,
            "txt_content": "whatafcukday 发表于 2015-5-9 20:48\n恩是可以这样做{:10_505:}\nsetCancelled(true)这个报错"
        }
    ]
}