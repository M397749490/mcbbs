{
    "title": "如何在不堵塞主线程的情况下延时执行代码",
    "author": "3079655185",
    "replyCount": 17,
    "timestamp": 1587682440,
    "txt_content": "以tpa为例，延时120秒后会取消掉请求，并发送给玩家一条消息：请求已超时\n那怎么做到延时执行代码呢，而且不要堵塞主线程\n求带佬们解答",
    "replies": [
        {
            "author": "天辉胡萝卜",
            "timestamp": 1587685080,
            "txt_content": "Bukkit.getScheduler().runTaskLater\n\nhttps://hub.spigotmc.org/javadoc ... lang.Runnable-long-"
        },
        {
            "author": "3079655185",
            "timestamp": 1587686880,
            "txt_content": "疾风暗影 发表于 2020-4-24 07:38\nBukkit.getScheduler().runTaskLater\n\nhttps://hub.spigotmc.org/javadocs/spigot/org/bukkit/scheduler/Bu ...\n在文档里看到个异步的方法：runTaskLaterAsynchronously()\n\n那这个runTaskLater会堵塞主线程吗"
        },
        {
            "author": "mangiare",
            "timestamp": 1587686940,
            "txt_content": "3079655185 发表于 2020-4-24 08:08\n在文档里看到个异步的方法：runTaskLaterAsynchronously()\n\n那这个runTaskLater会堵塞主线程吗 ...\n既然是异步了，为什么会堵塞主线程呢？"
        },
        {
            "author": "3079655185",
            "timestamp": 1587687720,
            "txt_content": "mangiare 发表于 2020-4-24 08:09\n既然是异步了，为什么会堵塞主线程呢？\n我问的是runTaskLater会不会堵塞主线程...\n\n另外问下，刚刚看到了这个代码\n\nPlayer p = 获取玩家;\nnew BukkitRunnable(){\n    @Override\n    public static void run(){\n    处理代码省略\n    p.sendMessage(\"已超时\");\n    }\n}.runTaskLaterAsynchronously(this, 2400) ;\n复制代码\n这样是不是也可以做到120秒后给玩家发送一条消息。\n另外问个我不太懂的问题，new BukkitRunnable()里面的这个p会不会随着上面的p变化啊。\n就是比如两个玩家:A玩家和B玩家\nA玩家输入了指令，插件运行上面的代码；在A玩家超时之前，B玩家输入指令，插件运行了上面的代码。\n那最后会不会两条sendMessage都发给了B玩家"
        },
        {
            "author": "mangiare",
            "timestamp": 1587687960,
            "txt_content": "3079655185 发表于 2020-4-24 08:22\n我问的是runTaskLater会不会堵塞主线程...\n\n另外问下，刚刚看到了这个代码\n谁执行这条命令，p就是谁咯\n感觉还是Lambda好看emmmm"
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1587688500,
            "txt_content": "3079655185 发表于 2020-4-24 08:22\n我问的是runTaskLater会不会堵塞主线程...\n\n另外问下，刚刚看到了这个代码\n你既然调用了p.sendMessage就不要runTaskLaterAsynchronously，只能runTaskLater\n\n\nrunTaskLater不会堵塞主线程，他只是在对应的未来时间创建一个任务"
        },
        {
            "author": "mangiare",
            "timestamp": 1587688800,
            "txt_content": "疾风暗影 发表于 2020-4-24 08:35\n你既然调用了p.sendMessage就不要runTaskLaterAsynchronously，只能runTaskLater\n可以在里面调用一个同步线程套娃，逃"
        },
        {
            "author": "3079655185",
            "timestamp": 1587689400,
            "txt_content": "疾风暗影 发表于 2020-4-24 08:35\n你既然调用了p.sendMessage就不要runTaskLaterAsynchronously，只能runTaskLater\nhttps://www.mcbbs.net/thread-535223-1-1.html\n我看这个里面介绍会堵塞主线程\n是不是在120秒后才会运行一下指定代码，运行指定代码的时候会一下堵塞主线程(但会很快)\n然后循环执行的那个不用异步的话会一直堵塞主线程是吗"
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1587689580,
            "txt_content": "3079655185 发表于 2020-4-24 08:50\nhttps://www.mcbbs.net/thread-535223-1-1.html\n我看这个里面介绍会堵塞主线程\n是不是在120秒后才会运行 ...是不是在120秒后才会运行一下指定代码，运行指定代码的时候会一下堵塞主线程(但会很快)\n\n差不多是这样\n\n如果你的task很耗时（比如循环里很多事），那么就会严重阻塞，tps拉低。。"
        },
        {
            "author": "3079655185",
            "timestamp": 1587690120,
            "txt_content": "疾风暗影 发表于 2020-4-24 08:53\n差不多是这样\n\n如果你的task很耗时（比如循环里很多事），那么就会严重阻塞，tps拉低。。 ...\n问个进阶点的问题，怎么循环执行调用BukkitAPI的方法"
        },
        {
            "author": "Mc_Ryoko",
            "timestamp": 1587690240,
            "txt_content": "emm  懂..."
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1587690300,
            "txt_content": "你说的循环执行指什么呢？\n\n想每tick调用一次的话直接注册scheduler就行了"
        },
        {
            "author": "Sssss...",
            "timestamp": 1587690420,
            "txt_content": "高版本：BukkitRunnable#runTaskLater()\n低版本：Bukkit.getScheduler().runTaskLater(BukkitRunnable)\n\nhttps://bukkit.windit.net/javadoc/"
        },
        {
            "author": "Sssss...",
            "timestamp": 1587690480,
            "txt_content": "3079655185 发表于 2020-4-24 09:02\n问个进阶点的问题，怎么循环执行调用BukkitAPI的方法\nrunTaskTimer"
        },
        {
            "author": "3079655185",
            "timestamp": 1587690900,
            "txt_content": "疾风暗影 发表于 2020-4-24 09:05\n你说的循环执行指什么呢？\n\n想每tick调用一次的话直接注册scheduler就行了\nBukkit.getScheduler().runTaskLater()\n参数怎么填"
        },
        {
            "author": "mangiare",
            "timestamp": 1587691560,
            "txt_content": "3079655185 发表于 2020-4-24 09:15\nBukkit.getScheduler().runTaskLater()\n参数怎么填Bukkit.getScheduler().runTaskAsynchronously(this, () -> {\n    Bukkit.getScheduler().runTask(this, () -> player.sendMessage(\"超时!\"));\n});复制代码\n\n把this换成插件对象"
        },
        {
            "author": "3079655185",
            "timestamp": 1587691980,
            "txt_content": " 本帖最后由 3079655185 于 2020-4-24 09:41 编辑 \nmangiare 发表于 2020-4-24 09:26\n把this换成插件对象\n就是异步中套同步呗，那我用这个BukkitRunnable里面的可以吗https://www.mcbbs.net/thread-535223-1-1.html\n"
        }
    ]
}