{
    "title": "【内网穿透】使用VPS搭建ngrok穿透端口来运行mc服务器",
    "author": "zhang980887",
    "replyCount": 5,
    "timestamp": 1509340200,
    "txt_content": " 本帖最后由 zhang980887 于 2017-10-30 13:40 编辑 \n\n你是否还在为服务器的配置和价格发愁？你是否还在为没有公网IP而忧心？\n搭建穿透来在本地运行服务器吧！\n\n\n首先，你得有个VPS和一个域名（没备案的也行）。\n1.创建centos6系统（不推荐7）\n\n\n\n\n2.使用Xshell连接\n\n这样就算连接好了。\n\n\n3.为你的域名添加泛解析。\n打开你的域名管理页面，\n\n在主机名位置添加*号，把对应值指向你的服务器IP。\n\n\n4.安装git、go、ngrok。\n这里参考了sunny的博客，地址：http://www.sunnyos.com/article-show-48.html \n使用命令：下载git所需要的依赖包yum -y install zlib-devel openssl-devel perl hg cpio expat-devel gettext-devel curl curl-devel perl-ExtUtils-MakeMaker hg wget gcc gcc-c++复制代码\n\n再下载gitwget https://www.kernel.org/pub/software/scm/git/git-2.6.0.tar.gz复制代码\n\n再使用命令解压gittar zxvf git-2.6.0.tar.gz复制代码\n再使用命令编译git。cd git-2.6.0\n./configure --prefix=/usr/local/git\nmake\nmake install复制代码\n最后输入来创建git的软链接ln -s /usr/local/git/bin/* /usr/bin/复制代码\n安装go\n下载go环境包 \n由于编译go需要1.4的版本（最新版本会编译失败），但是go中国网站并没有这个资源，所以我这里提供一个下载\nhttps://share.weiyun.com/5e10ab460e27da7bf637f2bd3bef8a7f\n再使用flashFXP进行连接\n点击站点》站点管理器》新建站点》输入名称》连接类型选择SFTP over SSH》输入用户名和密码\n把go放到root目录下\n解压go环境包tar -zxvf go1.4.2.linux-amd64.tar.gz #64位\ntar -zxvf go1.4.2.linux-386.tar.gz #32位复制代码\n指定位置mv go /usr/local/复制代码\n添加GO的软链接ln -s /usr/local/go/bin/* /usr/bin/复制代码\n编译NGROKcd /usr/local/\ngit clone https://github.com/inconshreveable/ngrok.git\nexport GOPATH=/usr/local/ngrok/\nexport NGROK_DOMAIN=\"ngrok.mcpyjiaoyi.top\" #注意这里改成自己的域名\ncd ngrok\n复制代码\n生成证书openssl genrsa -out rootCA.key 2048\nopenssl req -x509 -new -nodes -key rootCA.key -subj \"/CN=$NGROK_DOMAIN\" -days 5000 -out rootCA.pem\nopenssl genrsa -out server.key 2048\nopenssl req -new -key server.key -subj \"/CN=$NGROK_DOMAIN\" -out server.csr\nopenssl x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 5000复制代码\n复制证书到指定位置cp rootCA.pem assets/client/tls/ngrokroot.crt\ncp server.crt assets/server/tls/snakeoil.crt\ncp server.key assets/server/tls/snakeoil.key\n复制代码询问你是否覆盖的时候 输入Y加回车\n\n4.编译服务端\n32位：cd /usr/local/go/src\nGOOS=linux GOARCH=386 ./make.bash\ncd /usr/local/ngrok/\nGOOS=linux GOARCH=386 make release-server复制代码\n\n64位cd /usr/local/go/src\nGOOS=linux GOARCH=amd64 ./make.bash\ncd /usr/local/ngrok/\nGOOS=linux GOARCH=amd64 make release-server复制代码5.编译windons客户端cd /usr/local/go/src\nGOOS=windows GOARCH=amd64 ./make.bash\ncd /usr/local/ngrok/\nGOOS=windows GOARCH=amd64 make release-client\n复制代码\n6.启动服务端/usr/local/ngrok/bin/ngrokd -domain=\"$NGROK_DOMAIN\" -httpAddr=\":80\"复制代码\n7.配置客户端\n打开flashFXP连接到VPS，在目录usr/local/ngrok/bin/windons_amd64下面有个ngrok.exe就是客户端了\n把它下载到本地电脑。新建一个TXT，复制以下内容server_addr: \"ngrok.mcpyjiaoyi.top:4443\" #你自己的域名，端口输入4443\ntrust_host_root_certs: false\n复制代码另存为 ngrok.cfg\n打开文本文档，复制以下内容ngrok -config=\"ngrok.cfg\" start mstsc复制代码另存为 启动.bat \n客户端配置完成后有这三个文件\n保存完毕点开启动.bat，这样显示就说明穿透成功\n\n打开服务器测试一下\n成功\n\n\n\n\n备注：连接失败问题：严格检查配置文件中域名是否和设置一样\n                              检测服务器时间是否正确\n                              查看端口是否开放，可以使用以下命令来开启端口/sbin/iptables -I INPUT -p tcp --dport 8080 -j ACCEPT #开启8080端口  \n/etc/rc.d/init.d/iptables save #保存配置  \n/etc/rc.d/init.d/iptables restart #重启服务  复制代码\n\n          Xshell断开连接后，端口映射也会断开问题，可以安装screen来保持连接。详情请看：\n          http://blog.csdn.net/eagle5063/article/details/53843211\n\n完\n\n\n\n",
    "replies": [
        {
            "author": "1207741285",
            "timestamp": 1509344340,
            "txt_content": "收藏了，有空试试看"
        },
        {
            "author": "晴天娃娃_",
            "timestamp": 1509345180,
            "txt_content": "Windows那？？？"
        },
        {
            "author": "寒枫岭",
            "timestamp": 1541410740,
            "txt_content": "在网上查到了ngrok，一查还真可以开mc服。。。感谢楼主的分享！"
        },
        {
            "author": "1723624171",
            "timestamp": 1541896380,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "dashuzhi",
            "timestamp": 1541942040,
            "txt_content": "收藏了，也许会用到呢\n"
        }
    ]
}