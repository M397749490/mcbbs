{
    "title": "求助，在onBlockActived调用player.openGui之后GuiHandler不会被调用",
    "author": "tt36999",
    "replyCount": 2,
    "timestamp": 1540885140,
    "txt_content": " 本帖最后由 tt36999 于 2018-10-31 10:51 编辑 \n\n总得来说，我搞了一个方块，然后弄了一个GUI给他。正常来说当调用player.openGui之后，MC应该会去调用注册的GuiHandler。\n我检查了不少地方，不过并没有发现什么问题，下面是一部分可能有关的代码。这个是MOD入口文件\n    @SidedProxy(clientSide = \"com.tt36999.BrewingCraft.Proxy.ClientProxy\", serverSide = \"com.tt36999.BrewingCraft.Proxy.CommonProxy\")\n    public static IProxy proxy;\n\n    @Mod.Instance\n    public static BrewingCraft instance;\n\n    @Mod.EventHandler\n    public void preInit(FMLPreInitializationEvent event) {\n        logger = event.getModLog();\n    }\n\n    @Mod.EventHandler\n    public void init(FMLInitializationEvent event) {\n        proxy.onInit(event);\n    }\n\n    public static void openGui(EntityPlayer player, BRCGuiHandler.EnumGui gui, World world, int x, int y, int z) {\n        FMLNetworkHandler.openGui(player, instance, gui.getId(), world, x, y, z);\n    }复制代码方块的右击事件\n    @Override\n    public boolean onBlockActivated(World worldIn, BlockPos pos, IBlockState state, EntityPlayer playerIn, EnumHand hand, EnumFacing facing, float hitX, float hitY, float hitZ) {\n        final IFluidHandler fluidHandler = getFluidHandler(worldIn, pos);\n        if (fluidHandler != null) {\n            ItemStack heldItem = playerIn.getHeldItem(hand);\n            if (!CapabilityUtils.hasCapability(heldItem, CapabilityFluidHandler.FLUID_HANDLER_ITEM_CAPABILITY, null)) {\n                if (!worldIn.isRemote) {\n                    if (hasGui()) {\n                        BrewingCraft.logger.info(\"Open Gui \" + getGui().getId());//正常执行\n                        //BrewingCraft.openGui(playerIn, getGui(), worldIn, pos.getX(), pos.getY(), pos.getZ());//请忽略这个，我只想试试这样能不能打开GUI\n                        playerIn.openGui(BrewingCraft.instance, getGui().getId(), worldIn, pos.getX(), pos.getY(), pos.getZ());\n                    } else {\n                        IFluidTankProperties[] properties = fluidHandler.getTankProperties();\n                        StringBuilder builder = new StringBuilder();\n                        for (IFluidTankProperties tankProperties : properties)\n                            builder.append(tankProperties.getContents().getLocalizedName() + \":\" + tankProperties.getContents().amount + \"/\" + tankProperties.getCapacity());\n                        playerIn.sendStatusMessage(new TextComponentString(builder.toString()), false);\n                    }\n                }\n                return true;\n            }\n            FluidUtil.interactWithFluidHandler(playerIn, hand, fluidHandler);\n            return FluidUtil.getFluidHandler(playerIn.getHeldItem(hand)) != null;\n        }\n        return false;\n    }复制代码这个是GuiHandler\n    @Nullable\n    @Override\n    public Object getServerGuiElement(int ID, EntityPlayer player, World world, int x, int y, int z) {\n        BrewingCraft.logger.info(\"Get server con \" + ID);//没被执行\n        switch (ID) {\n            case 0:\n                return new ContainerTestBlock(player.inventory, (TileEntityFluidContainer) world.getTileEntity(new BlockPos(x, y, z)));\n        }\n        BrewingCraft.logger.warn(\"[Warning] Can not get server gui container with id is \" + ID);\n        return null;\n    }\n\n    @Nullable\n    @Override\n    public Object getClientGuiElement(int ID, EntityPlayer player, World world, int x, int y, int z) {\n        BrewingCraft.logger.info(\"Get client gui \" + ID);//没被执行\n        switch (ID) {\n            case 0:\n                return new GuiTestFluidContainer((ContainerBRC) getServerGuiElement(ID, player, world, x, y, z), player.inventory);\n        }\n        BrewingCraft.logger.warn(\"[Warning] Can not get client gui object with id is \" + ID);\n        return null;\n    }复制代码@Mod.EventBusSubscriber\npublic class CommonProxy implements IProxy {\n\n    @SubscribeEvent\n    public static void onPotionRegister(RegistryEvent.Register<Potion> register) {\n        BRCPotions.register(register.getRegistry());\n    }\n\n    @SubscribeEvent\n    public static void onPlayerSleepEvent(PlayerSleepInBedEvent event) {\n        if (BRCPotions.potionEffectExcited.isAvailable(event))\n            BRCPotions.potionEffectExcited.onDoEffect(event);\n    }\n\n    @SubscribeEvent\n    public static void onLivingDamagedEvent(LivingDamageEvent event) {\n        if (BRCPotions.potionExplosionProof.isAvailable(event))\n            BRCPotions.potionExplosionProof.onDoEffect(event);\n    }\n\n    @SubscribeEvent\n    public static void onRrgisterItem(RegistryEvent.Register<Item> event) {\n        BRCItems.register(event.getRegistry());\n        BRCBlocks.registerItemBlock(event.getRegistry());\n    }\n\n    @SubscribeEvent\n    public static void onRegisterBlock(RegistryEvent.Register<Block> event) {\n        BRCBlocks.register(event.getRegistry());\n        BRCBlocks.registerTileEntity();\n    }\n\n    @Override\n    public void onInit(FMLInitializationEvent event) {\n        NetworkRegistry.INSTANCE.registerGuiHandler(BrewingCraft.instance, new BRCGuiHandler());\n    }\n}复制代码\n\n\n大佬们请问是我哪里代码写错了？或者是忽略了什么小细节\n",
    "replies": [
        {
            "author": "GiNYAi",
            "timestamp": 1540892940,
            "txt_content": "似乎你的IGuiHandler并没有注册?\nhttps://fmltutor.ustc-zzzz.net/3.4.1-创建一个新的GUI界面.html\nNetworkRegistry.INSTANCE.registerGuiHandler(FMLTutor.instance, this);复制代码"
        },
        {
            "author": "tt36999",
            "timestamp": 1540953180,
            "txt_content": "GiNYAi 发表于 2018-10-30 17:49\n似乎你的IGuiHandler并没有注册?\nhttps://fmltutor.ustc-zzzz.net/3.4.1-创建一个新的GUI界面.html\n ...\n抱歉我的锅，这里的代码忘记贴出来了，注册在CommonProxy的init方法中"
        }
    ]
}