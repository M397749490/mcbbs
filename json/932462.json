{
    "title": "[已解决]Forge1.12.2流体贴图问题",
    "author": "negation",
    "replyCount": 7,
    "timestamp": 1576244400,
    "txt_content": " 本帖最后由 negation 于 2019-12-15 12:24 编辑 \n\n蠢新在学习做流体，但最后进游戏之后发现流体没有贴图，都是紫黑块。代码如下：创建流体（FluidMercury.java）\npackage negation.test.fluid;\n\nimport negation.test.Test;\nimport net.minecraft.util.ResourceLocation;\nimport net.minecraftforge.fluids.Fluid;\n\npublic class FluidMercury extends Fluid\n{\n        public static final ResourceLocation still=new ResourceLocation(Test.MODID+\":\"+\"fluid/mercury_still\");\n        public static final ResourceLocation flowing=new ResourceLocation(Test.MODID+\":\"+\"fluid/mercury_flow\");\n        \n        public FluidMercury()\n        {\n                super(\"mercury\",FluidMercury.still,FluidMercury.flowing);\n                //public Fluid(String fluidName, ResourceLocation still, ResourceLocation flowing)方法。\n                this.setUnlocalizedName(\"fluidMercury\");\n                this.setDensity(13600);\n                this.setViscosity(750);\n                this.setLuminosity(0);\n                this.setTemperature(300);\n        }\n}\n复制代码\n\n注册流体及流体对应的方块的渲染（FluidLoade.java）\n\npublic class FluidLoader\n{\n        public static Fluid fluidMercury = new FluidMercury();\n        \n        public FluidLoader(FMLPreInitializationEvent event)\n        {\n                if(FluidRegistry.isFluidRegistered(fluidMercury))\n                {\n                        event.getModLog().info(\"Found fluid {},the registration is canceled.\",fluidMercury.getName());\n                        fluidMercury=FluidRegistry.getFluid(fluidMercury.getName());\n                }\n                else\n                {\n                        FluidRegistry.registerFluid(fluidMercury);\n                }\n        }\n        \n        /*\n         * 注册流体方块的渲染\n         */\n        @SideOnly(Side.CLIENT)\n        public static void registerRenders()\n        {\n                registerFluidRender((BlockFluidBase) BlockLoader.fluidMercury,\"fluid_mercury\");\n        }\n        \n        @SideOnly(Side.CLIENT)\n        public static void registerFluidRender(BlockFluidBase blockfluid,String blockStateName)\n        {\n                final String location = Test.MODID+\":\"+blockStateName;\n                final Item itemFluid = Item.getItemFromBlock(blockfluid);\n                ModelLoader.setCustomMeshDefinition(itemFluid, new ItemMeshDefinition()\n                {\n                        @Override\n                        public ModelResourceLocation getModelLocation(ItemStack stack)\n                        {\n                                return new ModelResourceLocation(location,\"fluid\");\n                        }\n                });\n                ModelLoader.setCustomStateMapper(blockfluid, new StateMapperBase()\n                {\n                        @Override\n                        protected ModelResourceLocation getModelResourceLocation(IBlockState state)\n                        {\n                                return new ModelResourceLocation(location,\"fluid\");\n                        }\n                });\n        }\n}\n复制代码\n\n注册流体对应的方块（BlockFluidMercury.java）\n\npublic class BlockFluidMercury extends BlockFluidClassic\n{\n        public BlockFluidMercury()\n        {\n                super(FluidLoader.fluidMercury,Material.WATER);\n                //BlockFluidClassic类的构造方法有两个参数，分别是对应的流体、和这种流体方块使用的材质，这里的材质为水。\n                this.setUnlocalizedName(\"fluidMercury\");\n                //设置本地化名称。\n                this.setCreativeTab(CreativeTabsLoader.tabFMLTutor);\n                //加进创造模式物品栏。\n        }\n}复制代码\n\n方块注册（BlockLoader.java）\n\npublic class BlockLoader\n{\n        public static Block blockChromite=new BlockChromite();\n        public static Block fluidMercury=new BlockFluidMercury();\n        \n        public BlockLoader(FMLPreInitializationEvent event)\n        {\n                register(blockChromite,\"block_chromite\");//设置方块ID。\n                register(fluidMercury,\"fluid_mercury\");\n        }\n        \n         @SideOnly(Side.CLIENT)\n            public static void registerRenders()\n            {\n                registerRender(blockChromite);\n            }\n         \n         private static void register(Block block,String name)\n         {\n                 ForgeRegistries.BLOCKS.register(block.setRegistryName(name));\n                 //注册方块。\n                 ForgeRegistries.ITEMS.register(new ItemBlock(block).setRegistryName(block.getRegistryName()));\n                 //注册该方块对应的模型。\n         }\n         \n         @SideOnly(Side.CLIENT)\n            private static void registerRender(Block block)\n            {\n                 ModelResourceLocation model = new ModelResourceLocation(block.getRegistryName(), \"inventory\");\n                 ModelLoader.setCustomModelResourceLocation(Item.getItemFromBlock(block), 0, model);\n            }\n}复制代码\n\n自定义的方块模型文件（fluid_mercury.json）\n\n{\n  \"forge_marker\": 1,\n  \"variants\": {\n    \"fluid\": {\n      \"model\": \"forge:fluid\",\n      \"custom\": { \"fluid\": \"mercury\" }\n    }\n  }\n}复制代码\n\n贴图都位于“src\\main\\resources\\assets\\test\\textures\\fluid”内。\nmercury_flow.png.mcmeta\n\n{\n  \"animation\":{}\n}复制代码\n\nmercury_till.png.mcmeta\n\n{\n  \"animation\": {\n    \"frametime\": 2\n  }\n}复制代码\n\nCommonProxy.java（下划线语句为FluidLoader(event)的注册）\n\npackage negation.test.common;\n\nimport negation.test.block.BlockLoader;\nimport negation.test.command.CommandLoader;\nimport negation.test.crafting.CraftingLoader;\nimport negation.test.creativetab.CreativeTabsLoader;\nimport negation.test.enchantment.EnchantmentLoader;\nimport negation.test.event.EnchantmentEvents;\nimport negation.test.event.EventLoader;\nimport negation.test.event.PotionEvent;\nimport negation.test.fluid.FluidLoader;\nimport negation.test.item.ItemLoader;\nimport negation.test.potion.PotionLoader;\nimport negation.test.sound.SoundEvents;\nimport negation.test.sound.SoundsLoader;\nimport negation.test.worldgen.WorldGeneratorLoader;\nimport net.minecraftforge.fml.common.event.FMLInitializationEvent;\nimport net.minecraftforge.fml.common.event.FMLPostInitializationEvent;\nimport net.minecraftforge.fml.common.event.FMLPreInitializationEvent;\nimport net.minecraftforge.fml.common.event.FMLServerStartingEvent;\n\npublic class CommonProxy\n{\n        public void preInit(FMLPreInitializationEvent event)\n        {\n                new ConfigLoader(event);\n                new CreativeTabsLoader(event);\n                <u>new FluidLoader(event);</u>\n                new ItemLoader(event);\n                new BlockLoader(event);\n                new OreDictionaryLoader(event);\n                new PotionLoader(event);\n        }\n        public void init(FMLInitializationEvent event)\n        {\n                new CraftingLoader();\n                new EventLoader();\n                new EnchantmentLoader();\n                new EnchantmentEvents();\n                new PotionEvent();\n                new SoundsLoader();\n                new SoundEvents();\n                new WorldGeneratorLoader();\n        }\n        public void postInit(FMLPostInitializationEvent event)\n        {\n                \n        }\n        \n        public void serverStarting(FMLServerStartingEvent event)\n        {\n                new CommandLoader(event);\n        }\n}复制代码\n\nItemRenderLoader.java（下划线语句为FluidLoader.registerRenders()的注册）\n\npackage negation.test.client;\n\nimport negation.test.block.BlockLoader;\nimport negation.test.fluid.FluidLoader;\nimport negation.test.item.ItemLoader;\n\npublic class ItemRenderLoader\n{\n        public ItemRenderLoader()\n        {\n                ItemLoader.registerRenders();\n                BlockLoader.registerRenders();\n                <u>FluidLoader.registerRenders();</u>\n        }\n}\n复制代码\n",
    "replies": [
        {
            "author": "3TUSK",
            "timestamp": 1576266840,
            "txt_content": "src\\main\\resources\\assets\\test\\textures\\fluid\n难道不是 src\\main\\resources\\assets\\test\\textures\\fluids？"
        },
        {
            "author": "negation",
            "timestamp": 1576296120,
            "txt_content": "3TUSK 发表于 2019-12-14 03:54\n难道不是 src\\main\\resources\\assets\\test\\textures\\fluids？\n额，并不是，改成fluids依旧无效。"
        },
        {
            "author": "roj234",
            "timestamp": 1576301400,
            "txt_content": "流程:\n1. preInit阶段注册流体FluidRegistry.registerFluid(fluid);\n2. 然后创建方块对象并且fluid.setBlock(block);\n3. 在RegistryEvent.Register<Block>事件发生时注册方块\n4. 在ModelRegistryEvent时注册模型 \n可能是顺序的问题毕竟我好像没看到什么代码上的问题\n以及一个很蠢的问题：不会你只放了mcmeta文件而没有PNG吧，还有图片尺寸？"
        },
        {
            "author": "negation",
            "timestamp": 1576304880,
            "txt_content": "roj234 发表于 2019-12-14 13:30\n流程:\n1. preInit阶段注册流体FluidRegistry.registerFluid(fluid);\n2. 然后创建方块对象并且fluid.setBloc ...\n      我又按照土球球大佬的教程检查了一下，感觉顺序应该没有问题，但我贴出了全部的注册，希望大佬看下我是不是星际了，没发现。\n      图片的话，我更换成了土球球大佬教程中的，无效。"
        },
        {
            "author": "negation",
            "timestamp": 1576327680,
            "txt_content": " 本帖最后由 negation 于 2019-12-14 20:56 编辑 \n\n另外，本蠢新发现如果“fluid_mercury.json”中\"custom\": { \"fluid\": \"mercury\" }复制代码的\"mercury\"改为其他任何字段会导致流体使用原版水的贴图，我以为是“BlockFluidMercury.java”中super(FluidLoader.fluidMercury,Material.WATER);复制代码导致的，但将其改为super(FluidLoader.fluidMercury,Material.LAVA);复制代码后发现流体依然使用水的贴图，但跳进流体内会出现跳进岩浆的动画效果，很……ENNNN……神奇。总之，有没有大佬能救救蠢新啊。"
        },
        {
            "author": "3TUSK",
            "timestamp": 1576348320,
            "txt_content": "negation 发表于 2019-12-14 20:48\n另外，本蠢新发现如果“fluid_mercury.json”中的\"mercury\"改为其他任何字段会导致流体使用原版水的贴图， ...的\"mercury\"改为其他任何字段会导致流体使用原版水的贴图\nfluid 字段用于确定具体流体的类型，你改成不存在的流体id那只能fallback回水咯（来源请求）。\n\n我以为是“BlockFluidMercury.java”中……\nBlock 的 Material 类型和渲染无关！\n\n\n\nmercury_till.png.mcmeta\n确定不是 mercury_still.png.mcmeta？"
        },
        {
            "author": "negation",
            "timestamp": 1576383420,
            "txt_content": "3TUSK 发表于 2019-12-15 02:32\nfluid 字段用于确定具体流体的类型，你改成不存在的流体id那只能fallback回水咯（来源请求）。\n感谢大佬解惑，以及，确实是mercury_still.png.mcmeta文件名错了，再次感谢大佬。"
        }
    ]
}