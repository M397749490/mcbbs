{
    "title": "[Spigot1.12.2]事件异常、空指针异常",
    "author": "天启-麒麟",
    "replyCount": 12,
    "timestamp": 1587603000,
    "txt_content": "大佬们我自己写的一个死亡后带有指定lore和名字的装备消失的一个插件，但是不知道为啥放在服务器里面，玩家一死亡就会报EventException: null和空指针异常。求各位大佬解决\n\n下面是主类的代码：\n\npackage com.kylin.deaddeleteitem;\n\nimport org.bukkit.Bukkit;\nimport org.bukkit.ChatColor;\nimport org.bukkit.command.Command;\nimport org.bukkit.command.CommandSender;\nimport org.bukkit.configuration.file.FileConfiguration;\nimport org.bukkit.configuration.file.YamlConfiguration;\nimport org.bukkit.plugin.java.JavaPlugin;\n\nimport java.io.File;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\npublic class Main extends JavaPlugin {\n    public static Map<String, List<String>> map = new HashMap<>();\n\n    @Override\n    public void onEnable() {\n        getLogger().info(ChatColor.BLUE+\"插件运行\");\n        Bukkit.getPluginManager().registerEvents(new Listen(),this);\n        this.saveResource(\"Test.yml\",false);\n        File file = new File(this.getDataFolder(),\"Test.yml\");\n        FileConfiguration test = YamlConfiguration.loadConfiguration(file);\n        for (int i = 0; i >= 0; i++) {\n            if (test.getList(\"Test\"+i+\".Lore\")==null){return;}\n            else{\n                String str = test.getString(\"Test\"+i+\".Display\");\n                List<String> list = test.getStringList(\"Test\" + i + \".Lore\");\n                map.put(str,list);\n            }\n        }\n    }\n\n    @Override\n    public boolean onCommand(CommandSender sender, Command cmd, String label, String[] args) {\n        if (cmd.getName().equalsIgnoreCase(\"deitem\")&&(args[0].equalsIgnoreCase(\"reload\")||args[0].equalsIgnoreCase(\"re\"))){\n            onEnable();\n            return true;\n        }\n        return false;\n    }\n\n    @Override\n    public void onDisable() {\n\n    }\n}\n复制代码\n下面是监听器的代码：\n\npackage com.kylin.deaddeleteitem;\n\nimport org.bukkit.ChatColor;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.player.PlayerRespawnEvent;\nimport org.bukkit.inventory.Inventory;\n\nimport java.util.List;\nimport java.util.Set;\n\npublic class Listen implements Listener {\n    @EventHandler\n    public void onDead(PlayerRespawnEvent e){\n        Inventory inv = e.getPlayer().getInventory();\n        for (int i = 5; i <= 45; i++) {\n            String name = inv.getItem(i).getItemMeta().getDisplayName();\n            Set<String> nameSet = Main.map.keySet();\n            for (String s : nameSet) {\n                if (name.equals(s)){\n                    //遍历输出map里面的value，和那个名字相同的item的lore遍历作比较\n                    List<String> list = Main.map.get(s);\n                    List<String> lore = inv.getItem(i).getItemMeta().getLore();\n                    if (list.size()==lore.size()){\n                        boolean b = DiGui(list, lore, list.size() - 1);\n                        if (b){\n                            inv.remove(inv.getItem(i));\n                            e.getPlayer().sendMessage(ChatColor.RED+\"您身上的神器：\"+inv.getItem(i).getItemMeta().getDisplayName()+\"已消失\");\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    public boolean DiGui(List<String> l1,List<String> l2,int size){\n        if (size==-1){return true;}\n        return l1.get(size).equals(l2.get(size))&&DiGui(l1, l2, size-1);\n    }\n}\n复制代码\n求各位大佬帮忙看看！！",
    "replies": [
        {
            "author": "天辉胡萝卜",
            "timestamp": 1587603600,
            "txt_content": "把报错的stacktrace发上来？"
        },
        {
            "author": "lt_name",
            "timestamp": 1587603600,
            "txt_content": " 本帖最后由 lt_name 于 2020-4-23 09:02 编辑 \n\nPlayerRespawnEvent 是玩家重生事件吧。。。\n应该还有个玩家死亡事件\n我的技术也不高，我个人感觉原因是这样：\n你监听的玩家重生事件，应该是在玩家重生前调用，那个时候玩家实体应该没有创建，所以获取不到背包"
        },
        {
            "author": "天启-麒麟",
            "timestamp": 1587604320,
            "txt_content": "疾风暗影 发表于 2020-4-23 09:00\n把报错的stacktrace发上来？[09:10:37 ERROR]: Could not pass event PlayerRespawnEvent to DeadDeleteItem vv1.0\norg.bukkit.event.EventException: null\n        at org.bukkit.plugin.java.JavaPluginLoader$1.execute(JavaPluginLoader.java:306) ~[spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at org.bukkit.plugin.RegisteredListener.callEvent(RegisteredListener.java:62) ~[spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at org.bukkit.plugin.SimplePluginManager.fireEvent(SimplePluginManager.java:500) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at org.bukkit.plugin.SimplePluginManager.callEvent(SimplePluginManager.java:485) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.PlayerList.moveToWorld(PlayerList.java:654) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.PlayerList.moveToWorld(PlayerList.java:582) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.PlayerConnection.a(PlayerConnection.java:1653) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.PacketPlayInClientCommand.a(SourceFile:31) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.PacketPlayInClientCommand.a(SourceFile:8) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.PlayerConnectionUtils$1.run(SourceFile:13) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source) [?:1.8.0_92]\n        at java.util.concurrent.FutureTask.run(Unknown Source) [?:1.8.0_92]\n        at net.minecraft.server.v1_12_R1.SystemUtils.a(SourceFile:46) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.MinecraftServer.D(MinecraftServer.java:748) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.DedicatedServer.D(DedicatedServer.java:406) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.MinecraftServer.C(MinecraftServer.java:679) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at net.minecraft.server.v1_12_R1.MinecraftServer.run(MinecraftServer.java:577) [spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        at java.lang.Thread.run(Unknown Source) [?:1.8.0_92]\nCaused by: java.lang.NullPointerException\n        at com.kylin.deaddeleteitem.Listen.onDead(Listen.java:17) ~[?:?]\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_92]\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) ~[?:1.8.0_92]\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) ~[?:1.8.0_92]\n        at java.lang.reflect.Method.invoke(Unknown Source) ~[?:1.8.0_92]\n        at org.bukkit.plugin.java.JavaPluginLoader$1.execute(JavaPluginLoader.java:302) ~[spigot-1.12.2.jar:git-Spigot-dcd1643-e60fc34]\n        ... 17 more复制代码我不知道你说的stackstace是啥，但是应该是这个了吧大佬\n\n"
        },
        {
            "author": "天启-麒麟",
            "timestamp": 1587604380,
            "txt_content": "lt_name 发表于 2020-4-23 09:00\nPlayerRespawnEvent 是玩家重生事件吧。。。\n应该还有个玩家死亡事件\n我的技术也不高，我个人感觉原因是这 ...\n我又找了一遍API我么得找到玩家死亡的事件= ="
        },
        {
            "author": "lt_name",
            "timestamp": 1587604440,
            "txt_content": "麒麟喵o 发表于 2020-4-23 09:13\n我又找了一遍API我么得找到玩家死亡的事件= =\n从你的报错来看，应该是没获取到玩家背包，你开debug打个断点，看看获取到的inv是不是空的"
        },
        {
            "author": "天启-麒麟",
            "timestamp": 1587604560,
            "txt_content": "lt_name 发表于 2020-4-23 09:14\n从你的报错来看，应该是没获取到玩家背包，你开debug打个断点，看看获取到的inv是不是空的 ...\n咋开debug = =我只会普通的IDEA开debug，我要不输出一下那个inv看看？"
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1587604680,
            "txt_content": "你需要用BukkitScheduler延迟一个tick来做\n\nPlayerRespawnEvent触发时，玩家对象并没有创建，所以获取inventory会返回null\n\n参考：https://www.spigotmc.org/threads ... t-inventory.143517/"
        },
        {
            "author": "天启-麒麟",
            "timestamp": 1587604980,
            "txt_content": "疾风暗影 发表于 2020-4-23 09:18\n你需要用BukkitScheduler延迟一个tick来做\n\nPlayerRespawnEvent触发时，玩家对象并没有创建，所以获取inven ...\n我试试哈大佬"
        },
        {
            "author": "天启-麒麟",
            "timestamp": 1587605700,
            "txt_content": "疾风暗影 发表于 2020-4-23 09:18\n你需要用BukkitScheduler延迟一个tick来做\n\nPlayerRespawnEvent触发时，玩家对象并没有创建，所以获取inven ...\n谢谢大佬！！！不报错了"
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1587606600,
            "txt_content": "不是多线程休眠哦，是bukkit.getscheduler().runtasklater"
        },
        {
            "author": "William_Shi",
            "timestamp": 1587606600,
            "txt_content": "我看那个spigot的帖子底下\n题主一直在说自己不想要bkrunnable\n然后还说自己传参player对象而非玩家名就好了\n虽然spigotmc的帖子底下有人建议使用bkrunnable\n但也有人指出其缺点:1tick可以发生很多事情，比如说玩家退出游戏\n所以该用什么办法lz自己衡量吧"
        },
        {
            "author": "zhangqinyi",
            "timestamp": 1587649320,
            "txt_content": "谢谢大佬，非常棒"
        }
    ]
}