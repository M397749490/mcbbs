{
    "title": "服务器卡顿30人不到",
    "author": "gecccc",
    "replyCount": 11,
    "timestamp": 1585661940,
    "txt_content": " 本帖最后由 gecccc 于 2020-3-31 21:50 编辑 \n\n我的服务器是1.15.2的paper端\n10核x5687,16g内存\n但是游戏里不到30人，甚至20人就会卡顿\n看任务管理器，cpu使用不到40%（甚至只有10几），内存使用在60%有时候会多一点\n为什么有多余资源服务端不吃呢\n这是我的timing：\ntimings.aikar.co/?id=29a1fa54790c490a83a4cf7e870a1195\n\n求大佬给个优化建议\n附带启动参数java -server -Xincgc -Xmx13G -Xms13G -XX:+AggressiveOpts -XX:+UseCompressedOops -XX:+UseCMSCompactAtFullCollection -XX:+UseFastAccessorMethods -XX:ParallelGCThreads=4 -XX:+UseConcMarkSweepGC -XX:CMSFullGCsBeforeCompaction=2 -XX:CMSInitiatingOccupancyFraction=70 -XX:-DisableExplicitGC -XX:TargetSurvivorRatio=90 -Djline.terminal=jline.UnsupportedTerminal -jar Paper-1.15.2-b121.jar --nogui\n\n\n\n\n\n\n\n\nUZJ{A)XQ[U73V_E94LACZ76.png\n(262.67 KB, 下载次数: 0)\n\n\n\n\n下载附件\n\n\n2020-3-31 21:47 上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "EmptyLava",
            "timestamp": 1585661940,
            "txt_content": "↑请问楼上(我指的是两楼前，不知道怎么回事发出来某人就躺枪了)，13GB内存难道还不够吗\n原因(3)\n1.实体占用(60%)\n2.Connection Handler和PacketProcessing(60%,这一部分几乎无法优化)\n3.一定的区块加载(30%)\n优化方案(7)\n1.在任务管理器中右键javaw.exe,转详细信息后右键javaw.exe将优先级改为实时,这可以增加cpu的占用率从而提升tps(但服务器重启后需要重新配置,建议配合计划任务)\n2.在spigot.yml中设置\nentity-tracking-range\nanimals: 18\nmonsters: 24\n3.在spigot.yml中设置\nentity-activation-range\nanimals: 20\nmonsters: 24\n4.在bukkit.yml中设置\nmonster-spawns: 5(如果设置过了就增加3)\n5.在bukkit.yml下设置\nspawn-limits:\nmonsters: 35\nanimals: 5\n6.在server.properties中设置view-distance为3-5\n7.Paper.yml内设置\nmax-chunk-gens-per-tick: 3\nmax-chunk-sends-per-tick: 35\nmax-auto-save-chunks-per-tick: 12\n可以大幅降低玩家跑图占用，并降低区块加载的高峰"
        },
        {
            "author": "是Cancer啊",
            "timestamp": 1585662120,
            "txt_content": "改bat"
        },
        {
            "author": "gecccc",
            "timestamp": 1585662240,
            "txt_content": "是Cancer啊 发表于 2020-3-31 21:42\n改bat\n萌新不是太懂，可否详细说明？"
        },
        {
            "author": "是Cancer啊",
            "timestamp": 1585662300,
            "txt_content": "编辑你的bat启动器\n找到XMs - Xms"
        },
        {
            "author": "是Cancer啊",
            "timestamp": 1585662300,
            "txt_content": "调高一点就可以了"
        },
        {
            "author": "是Cancer啊",
            "timestamp": 1585662480,
            "txt_content": "这是我的[url=home.php?mod=space&uid=39305]@echo[/url] off&setlocal enabledelayedexpansion        \nset a=-1\n:ok\nset /a a+=1\ntitle 斗罗大陆 [崩溃检查] 崩溃次数:%a%\nset /a s=3\nfor /l %%i in (1,1,!s!) do (\nset /a s-=1\nping -n %s% 127.1>nul\necho 开服倒计时开始！ !s!)\necho 服务器开始运行！\njava -Xms1G -Xmx2G -jar CatServer-47463d5-universal.jar\ngoto ok\npause复制代码\n-Xms1G -Xmx2G -jar \n1和2调更高一点就行了"
        },
        {
            "author": "结城希亚",
            "timestamp": 1585662960,
            "txt_content": "没什么好优化的，升级CPU吧\n核心数量：四核心\n主频：3.6GHz\n而且你目前cpu也不太行，开高版本服务器怎么能没4GHz（核心要这么多没用）"
        },
        {
            "author": "h1234hh",
            "timestamp": 1585664160,
            "txt_content": "调高xmx，调低xms"
        },
        {
            "author": "DreamVoid",
            "timestamp": 1585664580,
            "txt_content": "说实话，启动参数不是越多越好\n其实你只需要xincgc aggressiveopts useg1gc，剩下的优化交给paper就行了\n之前我的服务器也是被一大堆启动参数坑了，后来就加了2个，tps流畅19.8"
        },
        {
            "author": "dong呵呵",
            "timestamp": 1585669620,
            "txt_content": "DreamVoid 发表于 2020-3-31 22:23\n说实话，启动参数不是越多越好\n其实你只需要xincgc aggressiveopts useg1gc，剩下的优化交给paper就行了\n之 ...\n请问这个参数是什么意思，useg1gc是只用1g嘛？\n我最大可用16g,除掉一些意外预留，14个g给游戏该怎么写啊？"
        },
        {
            "author": "DreamVoid",
            "timestamp": 1585701540,
            "txt_content": "dong呵呵 发表于 2020-3-31 23:47\n请问这个参数是什么意思，useg1gc是只用1g嘛？\n我最大可用16g,除掉一些意外预留，14个g给游戏该怎么写啊 ...\nUseG1GC这个参数是给大内存用的，开启垃圾处理的参数\n最高14G的话就-Xmx14G 推荐把Xms去掉或者改成-Xms14G"
        }
    ]
}