{
    "title": "[超详细Multicraft教程]多机器(Daemon)关联教程",
    "author": "1784234383",
    "replyCount": 7,
    "timestamp": 1469628000,
    "txt_content": " 本帖最后由 1784234383 于 2016-7-29 23:00 编辑 \n\n首先，支持Multicraft发展， http://www.multicraft.org/ ！\n——————————————————————————————————————————————————————\n大家好我是王可！我又来发(shui)教(jing)程(yan)了！\n上一次我发教程大概已经是2年前了，至于是什么这里暂不提及。\n——————————————————————————————————————————————————————\n1、前言\n这篇教程到底适用于哪些人？↓\n1、需要使用网页控制台；\n2、在同一局域网下有多台机器供运行MC服；\n3、采用MultiCraft网页控制台；\n4、有足够的耐心的（因为本文篇幅超长）。\n如果以上条件都符合您的话，那么您看对文章了。本篇文章也许将非常适合您。\n\n\n为什么我要写这篇文章？↓\n今天上午在multicraft官网偶然看到似乎这奇妙的网页控制台还支持多机器关联，而且正好我也有多个服务器，想平均一下负载，因此开始探究多机器关联的方法。但是在他们官网一阵查找后似乎并没有找到有关这方面的资料，而且在mcbbs也搜索了一下，找到了一个帖子。这个帖子看他的计划似乎包括了多机器关联，但可惜等了好久都没有更新，似乎成坟了吧。我只好自己开始试验。经过一下午的各种尝试，终于弄明白了这奇妙的货到底怎么多机器关联。\n不太理解我说的“Multicraft多机器关联”？\n某特idc知道吧，当你玩MC的时候连接的服务器地址都是**.[省略]eidc.com，但是控制台却是**.34[省略].com，经过我的域名解析查询这两个域名所指向的IP不同，但是控制台却真真实实地控制了另一个IP上的服务器。这是怎么做到的呢？（噗根本不是转发器，转发器那就没必要再开个IP了）\n本篇文章就是写如何只通过一个http服务器（Multicraft网页端），来掌控多个Daemon的方法。\n——————————————————————————————————————————————————————\n2、搭建环境\n正所谓“工欲善其事，必先利其器”。要玩Multicraft多机器关联，那么您必须满足以下条件：\n1、拥有一个Dynamic版的Multicraft的key\n2、至少两台正常运行的电脑（虚拟机亦可；当然也可以不在同一内网下，只要这两台电脑能正常通讯即可，但建议在同一内网）\n3、一个正常运行的mysql（而不可以是SQLite）+http+php的环境（Windows-standalone版的Multicraft已经自带http+支持mysql的php的nginx网页环境）\n本帖以两个Windows10——1x实体机+1x虚拟机作为基本电脑环境。\nLinux电脑可以参考本帖的思路进行多机器关联。\n——————————————————————————————————————————————————————\n3、实战开始\n首先放轻松，这个真的没有你想的那么难！\n1、首先当然是下载Multicraft了。\n\n\n\n\nQQ截图20160727192435.png (129.61 KB, 下载次数: 3)\n\n下载附件\n\n2016-7-27 19:38 上传\n\n\n\n\n\n\n\n\n\n\n\nQQ截图20160727193624.png (141.32 KB, 下载次数: 3)\n\n下载附件\n\n2016-7-27 19:31 上传\n\n\n\n\n\n\n建议使用迅雷下载，避免因官网在国外而导致国内速度奇慢无比。本帖以下载Windows的64位Multicraft1.8.2(standalone)版本为例。\n2、下载完成后解压，并进行加入key或破解以获得Dynamic授权。\n（没有正版Dynamic key的可以参考这个帖子，但是如果你要用这个帖子的破解方法的话，除非你能把RewriteRule那块弄明白，否则你最高也只能用2.0.0-pre19版本，因此建议使用1.8.2这个正式版）首先声明一点，破解的Dynamic版Multicraft仅供研究学习之用，请勿用于商业用途！否则请支持正版，购买Dynamic Key！（当然也顺便求教怎么弄这个RewriteRule a.a 我研究了挺长时间也没弄明白）\n\n\n\n\n\nQQ截图20160727194150.png (1.89 KB, 下载次数: 6)\n\n下载附件\n\n2016-7-27 19:36 上传\n\n\n\n\n\n\n3、运行\n\n\n\n\nQQ截图20160727194556.png (801 Bytes, 下载次数: 6)\n\n下载附件\n\n2016-7-27 19:40 上传\n\n\n\n\n并用浏览器访问http://localhost/以检查Multicraft运行是否正常，当您的浏览器中出现下面这样的页面，且Multicraft的cmd窗口为下面这样则说明Multicraft运行正常。\n\n\n\n\nQQ截图20160727194942.png (64.2 KB, 下载次数: 2)\n\n下载附件\n\n2016-7-27 19:51 上传\n\n\n\n\n\n\n\n\n\n\n\nQQ截图20160727194904.png (38.56 KB, 下载次数: 5)\n\n下载附件\n\n2016-7-27 19:44 上传\n\n\n\n\n\n（233，cmd窗口里用红线打上的那部分是因为我RewriteRule没搞懂）至于有人说按照上面的破解贴架设完本地http服务器后发现启动Multicraft后再访问localhost还是你搭建的http服务器的内容，而不是Multicraft的网页，那么你可以给Multicraft中的nginx的网页端口改一下。虽然我并不是用改端口这种方法，但是你们可以学习一下。我的方法是把破解需要用的version文件夹直接放入Multicraft中的panel文件夹，并修改panel文件夹下的.htaccess文件。改端口的话，首先依次进入Multicraft→nginx-1.6.2→conf，找到nginx.conf文件，使用Notepad++打开。\n\n\n\n\nQQ截图20160727195744.png (19.23 KB, 下载次数: 2)\n\n下载附件\n\n2016-7-27 19:59 上传\n\n\n\n\n\n\n\n\n\n\n\nQQ截图20160727195913.png (17 KB, 下载次数: 0)\n\n下载附件\n\n2016-7-27 19:53 上传\n\n\n\n\n\n更改过后不要忘记重启整个Multicraft（即stop.bat后再start.bat）4、使用install.php重新设置Multicraft。Windows-standalone版本中，数据库实际上使用的是SQLite，但是由于多机器关联的同时必须共享整个数据库，因此我们不能使用SQLite，而是用MySQL。将以下代码直接写进install.php，并把install.php放入panel文件夹。\n<?php\n/**\n *\n *   Copyright ? 2010-2012 by xhost.ch GmbH\n *\n *   All rights reserved.\n *\n **/\n\n$yii = dirname(__FILE__).'/protected/yii/yii.php';\n$config = dirname(__FILE__).'/protected/config/internal/install.php';\n\ndefined('YII_DEBUG') or define('YII_DEBUG',true);\n// how many levels of call stack should be shown in each log message\ndefined('YII_TRACE_LEVEL') or define('YII_TRACE_LEVEL',3);\n\nrequire_once($yii);\n$app = Yii::createWebApplication($config);\n$app->params['installer'] = 'show';\nif (preg_match('/^(site\\/log(in|out)|install\\/)/', @$_GET['r']))\n    $app->run();\nelse\n    $app->runController('/install');\n复制代码\n（是的，这就是原封不动的installer.php，不过别介意我写成install.php）\n\n\n然后访问http://localhost/install.php来开始设置Multicraft。\n\n我说到这里可能有人会问我为什么不直接在multicraft.conf中把database项改成mysql，这是因为如果你的MySQL还是处于比较空的状态，没有Multicraft需要用的数据表，因此如果你直接更改multicraft.conf的话再启动会直接报错。\n\n\n\n\n\n\n\n\nQQ截图20160727200759.png (107.91 KB, 下载次数: 3)\n\n下载附件\n\n2016-7-27 20:10 上传\n\n\n\n\n\n\n\n\n\n\n\nQQ截图20160727200827.png (121.99 KB, 下载次数: 4)\n\n下载附件\n\n2016-7-27 20:03 上传\n\n\n\n\n\n到这里可能有人发现下面的Protected directory是红色的Failed，而不是绿色的Passed，这是因为Protected文件夹里装的实际上是网页控制台所调用的各种代码性数据，不允许访问这是正常的，但好在我们没有需要更改这个文件夹的内容，这步你可以直接点上面的Continue Anyway，并点击确定。当然如果这一步全都是绿Passed的话那就更好了。\n接下载再Continue一次，我们就到了这。\n\n\n\n\nQQ截图20160727201306.png (121.56 KB, 下载次数: 5)\n\n下载附件\n\n2016-7-27 20:07 上传\n\n\n\n\n\n如果你只扫一眼，相信一定会骂道：“MDZZ！连个按钮都没有！还能不能愉快地玩耍了！！！”但是你仔细看中间那段文字，会发现你需要先登录（Login），才能继续操作。那么我们就登录吧，用默认的账号admin+密码admin，Login进去。\n\n\n\n\nQQ截图20160727201534.png (21.15 KB, 下载次数: 4)\n\n下载附件\n\n2016-7-27 20:10 上传\n\n\n\n\n\n\n\n\n\n\n\nQQ截图20160727201559.png (66.49 KB, 下载次数: 3)\n\n下载附件\n\n2016-7-27 20:17 上传\n\n\n\n\n\n\nLogin成功后，就可以继续install.php了。\n\n\n\n\nQQ截图20160727201700.png (118.31 KB, 下载次数: 10)\n\n下载附件\n\n2016-7-27 20:19 上传\n\n\n\n\n\n这一步是设置面板的数据库，为了多机器关联我们当然要把Database Type改成MySQL。如下：\n\n\n\n\nQQ截图20160727201728.png (17.87 KB, 下载次数: 6)\n\n下载附件\n\n2016-7-27 20:12 上传\n\n\n\n\n\n但是，当你看到Database Name那一项时，一定会猛然想起：还没有给Multicraft设置一个MySQL的数据库呢！但是实际上如果你不怎么直接去修改MySQL并且也没有强迫症的话可以直接把这一栏改成mysql，因为mysql是MySQL安装后自带的一个库。（我应该没记错吧）\n\n\n\n\nQQ截图20160727202501.png (17 KB, 下载次数: 3)\n\n下载附件\n\n2016-7-27 20:19 上传\n\n\n\n\n\n最后就是这个样子了。先别急着点上面的Continue，先点下下面的Save and Test。\n\n\n\n\n\nQQ截图20160727202623.png (104.01 KB, 下载次数: 2)\n\n下载附件\n\n2016-7-27 20:21 上传\n\n\n\n\n\n然后你就会机智地发现你回来了.......（此时最好不要骂人233）别着急，此时点一下左上面的左箭头（←）来上一步，并刷新页面。哈哈，进度恢复了，工作继续...\n\n\n\n\nQQ截图20160727202930.png (132.45 KB, 下载次数: 8)\n\n下载附件\n\n2016-7-27 20:25 上传\n\n\n\n\n\n如果你的MySQL账号密码都正确的话，应该在图中黄色区域提示“Database seems to be uninitialized”（翻译：数据库看起来还没有被设置过），这时我们直接点击Initialize Database即可。然后不出意外的话应该会出现这个界面：\n\n\n\n\nQQ截图20160727203452.png (128.04 KB, 下载次数: 4)\n\n下载附件\n\n2016-7-27 20:29 上传\n\n\n\n\n\n还是Continue，没说的！Continue之后可能还需要再登录一次，那就还是老规矩，双admin登入。\n\n\n\n\n\nQQ截图20160727203609.png (126.18 KB, 下载次数: 3)\n\n下载附件\n\n2016-7-27 20:37 上传\n\n\n\n\n\n然后我们就来到了Daemon设置。还是一样的，把下面改成MySQL，而且这货不会介意你panel数据库和Daemon数据库在一起的。设置好后就是这个样子：\n\n\n\n\nQQ截图20160727203819.png (20.43 KB, 下载次数: 9)\n\n下载附件\n\n2016-7-27 20:33 上传\n\n\n\n\n\n然后还和刚才一样，Save and Test，然后Initialize Database，再Continue。\n\n\n\n\n\nQQ截图20160727203936.png (123.93 KB, 下载次数: 4)\n\n下载附件\n\n2016-7-27 20:34 上传\n\n\n\n\n\n这里的设置看起来如果好好用过Multicraft的人，是不是看着很熟悉？这里就不多介绍了，就说一下下面的Password for daemon connections就行了。\n\n\n\n\nQQ截图20160727204053.png (4.39 KB, 下载次数: 2)\n\n下载附件\n\n2016-7-27 20:42 上传\n\n\n\n\n\n这个Password（密码）到底是干什么用的呢？其实你可以把这个保持默认，这个密码一般是用来外网Multicraft多机关联用的，如果是内网的话，并且确定25465和3306端口不暴露给公网的话就不用改。但是如果你有一点点强迫症的话，你可以改成自己的密码。但是这个密码最好记住。\n然后就是Save了。\n\n\n\n\nQQ截图20160727204357.png (878 Bytes, 下载次数: 5)\n\n下载附件\n\n2016-7-27 20:38 上传\n\n\n\n\n\n\n\n\n\n\n\nQQ截图20160727204500.png (139.35 KB, 下载次数: 9)\n\n下载附件\n\n2016-7-27 20:39 上传\n\n\n\n\n\n这一步他是让你检查multicraft.conf，数据是不是和图中第一个蓝框中的设置是一致的。其实这里可以逐行复制，然后到multicraft.conf里面按Ctrl+F查找就行了。当然第一行因为前面有#，可以忽略不计。\n这个网页先放在这里，不要关闭！\n（心细的人可能发现了我图中的MySQL密码改成usbw了，再心细一点可能也发现了数据库名称变成mysqi了。然而不要在意这些细节，USBWebserver的锅= =）\n如果你找不到这些内容的话，那多半就是install.php没给你改multicraft.conf了。也很简单，首先到multicraft.conf里，找到第54行，在最前面加个#。\n\n\n\n\nQQ截图20160727205035.png (3.07 KB, 下载次数: 4)\n\n下载附件\n\n2016-7-27 20:52 上传\n\n\n\n\n\n然后把刚才网页上的第一个蓝框中的内容复制进去，就比如我这样（当然第一行有#我就不复制了）。\n\n\n\n\nQQ截图20160727205233.png (16.34 KB, 下载次数: 9)\n\n下载附件\n\n2016-7-27 20:47 上传\n\n\n\n\n\n但是你往上翻翻，找到第30行，会发现这和我的60行配置项是冲突的。所以那就把我的60行删除吧（当然也没人介意你删除第30行）最后就是这个样子了。\n\n\n\n\nQQ截图20160727205417.png (5.56 KB, 下载次数: 5)\n\n下载附件\n\n2016-7-27 20:56 上传\n\n\n\n\n\n不过你以为这就完事了？并不是，其实multicraft.conf你还差两项没有配置。往上翻，找到第17行与24行。\n\n\n\n\nQQ截图20160727205520.png (8.67 KB, 下载次数: 4)\n\n下载附件\n\n2016-7-27 20:57 上传\n\n\n\n\n\n你会发现第17行，IP那里设置的是127.0.0.1，这个道理和配置Bukkit的server.properties里面的IP选项是一样的。你设置成127.0.0.1，那么它就只对127.0.0.1开放，也就是本地，如果是这样的话还怎么多机器关联？所以，直接改成0.0.0.0吧，这样就能对所有网络端口开放了！\n\n\n\n\nQQ截图20160727205728.png (711 Bytes, 下载次数: 0)\n\n下载附件\n\n2016-7-27 20:59 上传\n\n\n\n\n\n而下一行则是重点。如果你仔细看这13行至23行的注释的话，大概不难看出，似乎不但17行要设置为0.0.0.0，下面也得设置成某个IP。但是这个IP到底是什么呢？当初我就是被这个问题困扰了许久。我原本以为是这里应该是连接到另一个Daemon的机器的IP，但是无论我怎么弄都是不行。那怎么办？凉拌 其实这怪我当初太大意，你仔细看，它要设置的实际上是“External IP”，外部IP，它可没让你设置成目标服务器IP！所以直接改成你服务器所在的内网IP，并把前面的#去掉。（当然外网也没问题）\n\n\n\n\nQQ截图20160727210228.png (2.27 KB, 下载次数: 2)\n\n下载附件\n\n2016-7-27 20:57 上传\n\n\n\n\n\n不要忘记等于号后面还有一个空格！保存！好了，主机的multicraft.conf设置完毕了！\n放松一下吧！让我们重启下Multicraft，直接stop.bat再start.bat。（这里不用担心之前的网页还开着，毕竟网页这东西不是像QQ一样必须随时有网络，打开了之后多数情况下浏览器已经断开和http服务器的连接了[或是已经没有数据交流了]。）\n\n\n\n\nQQ截图20160727210856.png (29.27 KB, 下载次数: 1)\n\n下载附件\n\n2016-7-27 21:10 上传\n\n\n\n\n\n如果新打开的cmd窗口中你发现多出了“New client connected”和“Client *** successfully authorized”则证明你的multicraft.conf配置完全没有问题！再看下刚才我让你不要关闭的网页，是不是下面已经有一个绿框了，有的话这台机器的Multicraft配置就彻底ok了。\n\n\n\n\nQQ截图20160727211652.png (115.03 KB, 下载次数: 4)\n\n下载附件\n\n2016-7-27 21:19 上传\n\n\n\n\n\n\n主机的设置工作我们基本完成了。！这里的Multicraft暂时不要关！\n接下来就是另一台机器上场喽。\n/*****以下操作都在另一台机器上，除非特殊说明，否则不要对第一台机器进行更改！*****/\n把你刚才配置好的整个Multicraft文件夹复制到另一台机器上（这里则是虚拟机）\n\n\n\n\nQQ截图20160727211325.jpg (124.65 KB, 下载次数: 3)\n\n下载附件\n\n2016-7-27 21:09 上传\n\n\n\n\n\n\n然后进入Multicraft\\multicraft，还是用Notepad++打开multicraft.conf（别紧张，其实我们这次改的multicraft.conf内容不算多）首先是第24行，改成我们另一台机器的内网IP\n\n\n\n\nQQ截图20160727211926.png (103.24 KB, 下载次数: 3)\n\n下载附件\n\n2016-7-27 21:14 上传\n\n\n\n\n\n然后是第50行，把这行前面的#去掉，并把后面的数字改成2。\n\n\n\n\nQQ截图20160727212017.png (96.71 KB, 下载次数: 3)\n\n下载附件\n\n2016-7-27 21:22 上传\n\n\n\n\n\n这就是Daemon的ID标识了，每一个ID都必须是唯一的，也就是说，如果你继续往下配置机器的话，那么id必须依次得是3、4、5······，总之ID不能重复。然后是下面，也就是我们刚刚配置MySQL的地方。\n\n\n\n\nQQ截图20160727212309.png (98.37 KB, 下载次数: 6)\n\n下载附件\n\n2016-7-27 21:24 上传\n\n\n\n\n\n把host后面的127.0.0.1改成你的第一台机器的IP，也就应该是这样：\n\n\n\n\nQQ截图20160727212410.png (3.79 KB, 下载次数: 5)\n\n下载附件\n\n2016-7-27 21:20 上传\n\n\n\n\n\n\n至于下面的name，这个是给Daemon命名，选择性更改。\n\n\n\n\nQQ截图20160727212715.png (4.03 KB, 下载次数: 1)\n\n下载附件\n\n2016-7-27 21:22 上传\n\n\n\n\n\n\n然后保存，start.bat！不出意外的话就是这个样子了\n\n\n\n\nQQ截图20160727214754.png (119.77 KB, 下载次数: 8)\n\n下载附件\n\n2016-7-27 21:50 上传\n\n\n\n\n\n\n（返回第一台机器）而还记得之前我让你不关掉的网页吗？看一下，如果下面出现两个绿框就说明成功了：\n\n\n\n\nQQ截图20160727214931.png (101.65 KB, 下载次数: 2)\n\n下载附件\n\n2016-7-27 21:44 上传\n\n\n\n\n\n\n/**********以下操作都回到第一台机器上**********/因为设置数据库都完事了，所以install.php就可以删除了。直接访问http://localhost/，然后要登陆的话就双admin登入。接着我们直接来到创建服务器这里。\n\n\n\n\nQQ截图20160727215216.png (92.07 KB, 下载次数: 6)\n\n下载附件\n\n2016-7-27 21:54 上传\n\n\n\n\n\n你会发现上面多了一个“管理系统”（英文版就是Daemon），这下你会用了吧？233所以本教程到此结束。感谢大家的观看。——————————————————————————————————————————————————————4、后记首先声明一点，破解的Dynamic版Multicraft仅供研究学习之用，请勿用于商业用途！否则请支持正版，购买Dynamic Key！对于这些问题，我们需要的都是足够的好奇心与大胆的尝试，当然还有更多的查找资料！一个大教程帖子下来了，倒也没用到什么特殊的东西，那就送给大家一个我做的BungeeCord.jar.conf吧，放在multicraft\\jar目录下的那种。[config]\nname = [1.8]BungeeCord\n#source = http://ci.md-5.net/job/BungeeCord/lastSuccessfulBuild/artifact/bootstrap/target/BungeeCord.jar\n\n[encoding]\nencode = utf-8\ndecode = gb2312\nfileEncoding = latin-1\n#decode这里如果是Windows就原封不动，如果是Linux就改成utf-8。但是encode不要动，因为MC服务器这货就是utf-8的。。。\n\n\n[commands]\nlist = glist\nstop = end\nversion = bungee\nsay = alert\n\n[startup]\ncommand=\"{JAVA}\" -Xmx{MAX_MEMORY}M -Djline.terminal=jline.UnsupportedTerminal -XX:+AggressiveOpts -XX:+UseCompressedOops -jar \"{JAR}\" nogui --nojline --log-strip-color true \n\n[parse_players]\nstart=Total players online: (?P<v_maxDataLines>\\d+)\n\n[parse_startup]\nstart=Listening on /\n\n[parse_connect]\nstart=] <-> InitialHandler has connected\n\n[parse_disconnect]\nstart=] disconnected with:\n\n[parse_stop]\nstart=Thank you and goodbye\nstart2=Could not bind to host /复制代码\n\n",
    "replies": [
        {
            "author": "1784234383",
            "timestamp": 1469712000,
            "txt_content": "然而似乎没有太多人需要这篇教程，只好默默地顶了。"
        },
        {
            "author": "ouAuAuo",
            "timestamp": 1496293620,
            "txt_content": "1784234383 发表于 2016-7-28 21:20\n然而似乎没有太多人需要这篇教程，只好默默地顶了。\n教程写得不错，对于某些人来说还是有很多很大的用处，加油哦"
        },
        {
            "author": "冰冷冷",
            "timestamp": 1500285660,
            "txt_content": "教程很好，就是2.1.1版的MySQL怎么搭建"
        },
        {
            "author": "1784234383",
            "timestamp": 1500352320,
            "txt_content": "gengda 发表于 2017-7-17 18:01\n教程很好，就是2.1.1版的MySQL怎么搭建\n应该也差不多吧= =我还真没用过2.1.1，目前貌似还没有破解Dynamic版的"
        },
        {
            "author": "冰冷冷",
            "timestamp": 1500363300,
            "txt_content": "1784234383 发表于 2017-7-18 12:32\n应该也差不多吧= =我还真没用过2.1.1，目前貌似还没有破解Dynamic版的\n伪站啊，搭建一个伪站就可以了，我现在就用着呢"
        },
        {
            "author": "WenshuangLin",
            "timestamp": 1539999780,
            "txt_content": "默默地顶一下，虽然不需要，但是收藏了。"
        },
        {
            "author": "星耀幻影",
            "timestamp": 1540007100,
            "txt_content": "gengda 发表于 2017-7-17 18:01\n教程很好，就是2.1.1版的MySQL怎么搭建\n可以使用PHPLAMP一键环境部署"
        }
    ]
}