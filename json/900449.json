{
    "title": "[NSS][CNPC]CNPC Script —— 让脚本发出声音",
    "author": "Rain_Effect",
    "replyCount": 8,
    "timestamp": 1565489220,
    "txt_content": " 本帖最后由 Rain_Effect 于 2019-8-11 10:13 编辑 \n\n\n教学前言在阅读此教程前，请先了解CustomNPCs的脚本功能。\nhttps://www.mcbbs.net/thread-816677-1-1.html\n\n脚本上加上音效，想必是一些脚本作者的想法，\n但碍于Noppes(CNPC作者)在5月10日的快照版才推出播放音效的功能呢...\n嘛其实也差不多...\n更新科普在19年5月10日更新的CNPC快照版本中，作者为玩家添加了新的功能：\nnoppes.npcs.api.entity.IPlayer.playSound?(java.lang.String sound, float volume, float pitch);\n——点我跳转到API页\n虽说功能出来的晚，但实际上也可以通过NPCAPI执行，虽说效率会偏慢...\n例如使用如下脚本的方式进行声音传输：\nfunction playSound(player, sound, volume, pitch){\n    var API = Java.type(\"noppes.npcs.api.NpcAPI\").Instance();\n    API.executeCommand(API.getIWorld(0), \"/playsound \" + sound + \" master \" + player.name + \" ~ ~ ~ \" + volume + \" \" + pitch);\n}复制代码注：此处播放音效的方式中需要的值和快照中的playSound功能相同。\n基础教学环节我们先来了解一下，怎么获取自己希望播放的音效名，\n每个音效肯定都有其指定的名称值，才能正确的播放所需要的音效，\n而音效的名称值，则被保存在Sounds.json文件内。\n在WIKI中，详细说明了该文件的组成结构，\n——点我跳转到WIKI(Sounds.json)\n\n这里以实际例子进行举例：\n{\n  \"block.note.basedrum\": {\n    \"sounds\": [\n      \"note/bd\"\n    ],\n    \"subtitle\": \"subtitles.block.note.note\"\n  }\n}复制代码\"block.note.basedrum\" —— 音效名, 该处指向: 方块→音符盒→低音鼓\n\"sounds\": [ —— 音效文件列\n\"note/bd\" —— 音效文件\n\"subtitle\": \"subtitles.block.note.note\" —— 对应的辅助字幕文字\n在这里，我们只需要取其音效名(\"block.note.basedrum\")即可，\n\n说完音效名，下面我们来说说volume，\nvolume其实就是播放的音量大小，最大值为1.0 。\n\n之后，让我们了解一下pitch，\npitch就是音调，用来调节一个声音的音调变化，以及播放速度，最大值为2.0 。\n但实际上使用的情况下，这里一般是不需要做任何改动的，默认为1即可。\n注：如果你需要让它发出音符盒的不同音调，请看高级教学环节。\n\n最后，通过playSound的方式注入：function interact(event){ //右键触发\n    event.player.playSound(\"block.note.basedrum\", 1, 1); //播放音效\n}复制代码啥?不是快照版本?用了上面给的NPCAPI执行方式进行的?那就这样：function interact(event){ //右键触发\n    playSound(event.player, \"block.note.basedrum\", 1, 1);\n}复制代码这样，一个简单的播放音效功能就完成了！\n\n高级教学环节因为音符盒音效的特殊性，使得在调整音调方面，需要进行计算操作。\n而音符盒本身具有25个音调，对应的音色也会附图进行说明\n音符盒计算公式表:音高 (第一八度)交互次数音高 (pitch)音高 (第二八度)交互次数音高 (pitch)F#/Gb02^(-12/12) = 0.5F#/Gb122^(0/12) = 1G12^(-11/12) ≈ 0.529732G132^(1/12) ≈ 1.05946G#/Ab22^(-10/12) ≈ 0.561231G#/Ab142^(2/12) ≈ 1.12246A32^(-9/12) ≈ 0.594604A152^(3/12) ≈ 1.18921A#/Bb42^(-8/12) ≈ 0.629961A#/Bb162^(4/12) ≈ 1.25992B52^(-7/12) ≈ 0.667420B172^(5/12) ≈ 1.33484C62^(-6/12) ≈ 0.707107C182^(6/12) ≈ 1.41421C#/Db72^(-5/12) ≈ 0.749154C#/Db192^(7/12) ≈ 1.49831D82^(-4/12) ≈ 0.793701D202^(8/12) ≈ 1.58740D#/Eb92^(-3/12) ≈ 0.840896D#/Eb212^(9/12) ≈ 1.68179E102^(-2/12) ≈ 0.890899E222^(10/12) ≈ 1.78180F112^(-1/12) ≈ 0.943874F232^(11/12) ≈ 1.88775F#/Gb122^(0/12) = 1F#/Gb242^(12/12) = 2JavaScript程序公式:\nvar click = 0; //交互次数\nMath.pow(2, (click-12)/12); //公式运算复制代码\n\n\n\n最后的话恩什么？想学习CustomNPCs的脚本功能？\n想在服务器增加更多的自定义可玩性？\n想给服务器加入更丰富的自主游戏机制？\n\n加入我们吧！我们是一群热爱CustomNPCs脚本的玩家群体，\n在这里，你可以学习到CustomNPCs的脚本用法，\n在这里，你可以了解到CustomNPCs的实际作用，\n很多人不了解CustomNPCs甚至能做到这个地步，\n而我们，能让你服务器的CustomNPCs更加强大！\nQQ群：1022010897\n[groupid=1595]CNPC Script Studio[/groupid]",
    "replies": [
        {
            "author": "微笑的路人",
            "timestamp": 1565491560,
            "txt_content": "感谢大佬分享！\n今天积分用完了"
        },
        {
            "author": "lzh最帅",
            "timestamp": 1565672400,
            "txt_content": "Tue Aug 13 12:57:29 CST 2019 tab 1:\njavax.script.ScriptException: TypeError: noppes.npcs.api.wrapper.PlayerWrapper@7bbd6f3b has no such function \"showChestGui\" in <eval> at line number 22\n        at jdk.nashorn.api.scripting.NashornScriptEngine.throwAsScriptException(NashornScriptEngine.java:467)\n        at jdk.nashorn.api.scripting.NashornScriptEngine.invokeImpl(NashornScriptEngine.java:389)\n        at jdk.nashorn.api.scripting.NashornScriptEngine.invokeFunction(NashornScriptEngine.java:190)\n        at noppes.npcs.controllers.ScriptContainer.run(ScriptContainer.java:169)\n        at noppes.npcs.controllers.ScriptContainer.run(ScriptContainer.java:126)\n        at noppes.npcs.controllers.data.PlayerScriptData.runScript(PlayerScriptData.java:86)\n        at noppes.npcs.EventHooks.onPlayerKeyPressed(EventHooks.java:428)\n        at noppes.npcs.PacketHandlerPlayer.player(PacketHandlerPlayer.java:63)\n        at noppes.npcs.PacketHandlerPlayer.lambda$onServerPacket$0(PacketHandlerPlayer.java:44)\n        at noppes.npcs.PacketHandlerPlayer$Lambda$195/1647971486.run(Unknown Source)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at net.minecraft.util.Util.func_181617_a(SourceFile:46)\n        at net.minecraft.server.MinecraftServer.func_71190_q(MinecraftServer.java:721)\n        at net.minecraft.server.MinecraftServer.func_71217_p(MinecraftServer.java:666)\n        at net.minecraft.server.integrated.IntegratedServer.func_71217_p(IntegratedServer.java:185)\n        at net.minecraft.server.MinecraftServer.run(MinecraftServer.java:524)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: <eval>:22 TypeError: noppes.npcs.api.wrapper.PlayerWrapper@7bbd6f3b has no such function \"showChestGui\"\n        at jdk.nashorn.internal.runtime.ECMAErrors.error(ECMAErrors.java:57)\n        at jdk.nashorn.internal.runtime.ECMAErrors.typeError(ECMAErrors.java:213)\n        at jdk.nashorn.internal.runtime.ECMAErrors.typeError(ECMAErrors.java:185)\n        at jdk.nashorn.internal.runtime.ECMAErrors.typeError(ECMAErrors.java:172)\n        at jdk.nashorn.internal.runtime.linker.NashornBottomLinker.linkBean(NashornBottomLinker.java:106)\n        at jdk.nashorn.internal.runtime.linker.NashornBottomLinker.getGuardedInvocation(NashornBottomLinker.java:71)\n        at jdk.internal.dynalink.support.CompositeGuardingDynamicLinker.getGuardedInvocation(CompositeGuardingDynamicLinker.java:124)\n        at jdk.internal.dynalink.support.LinkerServicesImpl.getGuardedInvocation(LinkerServicesImpl.java:154)\n        at jdk.internal.dynalink.DynamicLinker.relink(DynamicLinker.java:253)\n        at jdk.nashorn.internal.scripts.Script$Recompilation$48$1586A$\\^eval\\_.keyPressed(<eval>:22)\n        at jdk.nashorn.internal.runtime.ScriptFunctionData.invoke(ScriptFunctionData.java:642)\n        at jdk.nashorn.internal.runtime.ScriptFunction.invoke(ScriptFunction.java:228)\n        at jdk.nashorn.internal.runtime.ScriptRuntime.apply(ScriptRuntime.java:393)\n        at jdk.nashorn.api.scripting.ScriptObjectMirror.callMember(ScriptObjectMirror.java:199)\n        at jdk.nashorn.api.scripting.NashornScriptEngine.invokeImpl(NashornScriptEngine.java:383)\n        ... 16 more\nTue Aug 13 12:56:27 CST 2019 tab 1:\njavax.script.ScriptException: TypeError: noppes.npcs.api.wrapper.PlayerWrapper@7bbd6f3b has no such function \"showChestGui\" in <eval> at line number 22\n        at jdk.nashorn.api.scripting.NashornScriptEngine.throwAsScriptException(NashornScriptEngine.java:467)\n        at jdk.nashorn.api.scripting.NashornScriptEngine.invokeImpl(NashornScriptEngine.java:389)\n        at jdk.nashorn.api.scripting.NashornScriptEngine.invokeFunction(NashornScriptEngine.java:190)\n        at noppes.npcs.controllers.ScriptContainer.run(ScriptContainer.java:169)\n        at noppes.npcs.controllers.ScriptContainer.run(ScriptContainer.java:126)\n        at noppes.npcs.controllers.data.PlayerScriptData.runScript(PlayerScriptData.java:86)\n        at noppes.npcs.EventHooks.onPlayerKeyPressed(EventHooks.java:428)\n        at noppes.npcs.PacketHandlerPlayer.player(PacketHandlerPlayer.java:63)\n        at noppes.npcs.PacketHandlerPlayer.lambda$onServerPacket$0(PacketHandlerPlayer.java:44)\n        at noppes.npcs.PacketHandlerPlayer$Lambda$195/1647971486.run(Unknown Source)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at net.minecraft.util.Util.func_181617_a(SourceFile:46)\n        at net.minecraft.server.MinecraftServer.func_71190_q(MinecraftServer.java:721)\n        at net.minecraft.server.MinecraftServer.func_71217_p(MinecraftServer.java:666)\n        at net.minecraft.server.integrated.IntegratedServer.func_71217_p(IntegratedServer.java:185)\n        at net.minecraft.server.MinecraftServer.run(MinecraftServer.java:524)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: <eval>:22 TypeError: noppes.npcs.api.wrapper.PlayerWrapper@7bbd6f3b has no such function \"showChestGui\"\n        at jdk.nashorn.internal.runtime.ECMAErrors.error(ECMAErrors.java:57)\n        at jdk.nashorn.internal.runtime.ECMAErrors.typeError(ECMAErrors.java:213)\n        at jdk.nashorn.internal.runtime.ECMAErrors.typeError(ECMAErrors.java:185)\n        at jdk.nashorn.internal.runtime.ECMAErrors.typeError(ECMAErrors.java:172)\n        at jdk.nashorn.internal.runtime.linker.NashornBottomLinker.linkBean(NashornBottomLinker.java:106)\n        at jdk.nashorn.internal.runtime.linker.NashornBottomLinker.getGuardedInvocation(NashornBottomLinker.java:71)\n        at jdk.internal.dynalink.support.CompositeGuardingDynamicLinker.getGuardedInvocation(CompositeGuardingDynamicLinker.java:124)\n        at jdk.internal.dynalink.support.LinkerServicesImpl.getGuardedInvocation(LinkerServicesImpl.java:154)\n        at jdk.internal.dynalink.DynamicLinker.relink(DynamicLinker.java:253)\n        at jdk.nashorn.internal.scripts.Script$Recompilation$43$1586A$\\^eval\\_.keyPressed(<eval>:22)\n        at jdk.nashorn.internal.runtime.ScriptFunctionData.invoke(ScriptFunctionData.java:642)\n        at jdk.nashorn.internal.runtime.ScriptFunction.invoke(ScriptFunction.java:228)\n        at jdk.nashorn.internal.runtime.ScriptRuntime.apply(ScriptRuntime.java:393)\n        at jdk.nashorn.api.scripting.ScriptObjectMirror.callMember(ScriptObjectMirror.java:199)\n        at jdk.nashorn.api.scripting.NashornScriptEngine.invokeImpl(NashornScriptEngine.java:383)\n        ... 16 more\n复制代码\n这个报错是怎么回事，请大佬教一下a.a"
        },
        {
            "author": "Rain_Effect",
            "timestamp": 1565725200,
            "txt_content": "lzh最帅 发表于 2019-8-13 13:00\n这个报错是怎么回事，请大佬教一下a.a\n此处报错是因为你的CustomNPCs模组版本并不支持showChestGui的function，也就是版本过低，需要更新。\n\n但目前(截止至8/13)，showChestGui的function需要在至少为10May19的快照版本以上才能正常运行，当然建议使用最新版。"
        },
        {
            "author": "lzh最帅",
            "timestamp": 1565743140,
            "txt_content": " 本帖最后由 lzh最帅 于 2019-8-14 08:48 编辑 \nRain_Effect 发表于 2019-8-14 03:40\n此处报错是因为你的CustomNPCs模组版本并不支持showChestGui的function，也就是版本过低，需要更新。\n\n但 ...\n那从哪里下快照版呢"
        },
        {
            "author": "Rain_Effect",
            "timestamp": 1576003980,
            "txt_content": "lzh最帅 发表于 2019-8-14 08:39\n那从哪里下快照版呢\n加入我们这边的CustomNPCs交流群即可，群内有作者发布的最新快照版本"
        },
        {
            "author": "a448758292",
            "timestamp": 1580847480,
            "txt_content": "MCBBS有你更精彩~"
        },
        {
            "author": "Lemon_ccc",
            "timestamp": 1595182980,
            "txt_content": "感谢楼主的教程"
        },
        {
            "author": "mf是他儿",
            "timestamp": 1595206500,
            "txt_content": "感谢楼主~~"
        }
    ]
}