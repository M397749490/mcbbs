{
    "title": "sponge的一个优化小教程",
    "author": "忆华",
    "replyCount": 12,
    "timestamp": 1534574880,
    "txt_content": " 本帖最后由 忆华 于 2019-4-21 00:35 编辑 \n前言\n我以前也是一位只会spigot和KC之类的服主，但当我一次看到高版本如此丰富的新内容时\n我决定，我要去做出一个高版本的模组服务器。sponge核心，也在BBS发现了。\n相比以往的核心，sponge是非常特殊的。他有着多线程的优化，也有着KC无可媲美的模组兼容性。\n但sponge的优化，总被人诟病。因此。我打算写这个教程，希望对sponge的服主们有所帮助（本帖参考sponge的wiki编辑，如有雷同，纯属巧合）\n注：不保证所有的sponge服使用后都能有效果。仅供参考。\n\nForge与forgeChunkLoading文件\n\n这两个文件均在config文件夹中。\nForge\n#开启后会自动移除一些可能导致错误的实体，有极小风险\n    B:removeErroringEntities=true\n        \n    #同上，这个则是移除可能导致错误的方块\n    B:removeErroringTileEntities=true\n\n复制代码这两个选项是可以很大程度上避免你因为某种模组的问题而崩服的。当然只是很大程度，不是百分百。\n # 多线程加载地形\n    B:alwaysSetupTerrainOffThread=true复制代码这个选项可以充分发挥你服务器其他核心的力量。可以选择性的开启（假如你的核心不多主频很高，可以不开）\n\nforgeChunkLoading\ndefaults {\n    # 允许mod优先forge对区块的操作（建议开启）\n    B:enabled=true\n    # 异步加载区块（强烈建议开启）\n    B:asyncChunkLoading=true复制代码\n\nglobal文件\n\n\n\n\n注意 此处的步骤繁琐，并且需要按照自身服务器进行合适的修改。帖子只会给一个参考的数值。    world {\n        # 自动保存玩家背包的时间,单位为tick,1秒=20tick（越低对CPU的损耗越高。但是对数据的保存有很大用处，请按照自己的需求设置）\n        auto-player-save-interval=1500\n        # 自动保存服务器地图的时间（同上）\n        auto-save-interval=1500\n                # 区块回收阀值,大于0的话到了这个值以后才会开始回收区块,视服务器在线情况而定,0的话会一直进行区块回收复制代码 # 相距多少个方块的掉落物会被合并成一个掉落物，太大会极度消耗cpu，默认即可\n        item-merge-radius=2.5\n        # 是否保持单个世界出生点附近256个区块加载，建议为false，减少损耗\n        keep-spawn-loaded=false\n                # 树叶自然腐烂是否开启,false可稍微的提升tps\n        leaf-decay=true\n        # 是否在服务器启动时加载所有世界,默认即可\n        load-on-startup=true\n                # 每个tick时间最大可卸载的区块数量（服务器性能强的可以提高此数值）\n                max-chunk-unloads-per-tick=1000复制代码optimizations {\n        #异步光照\n        async-lighting {\n            #是否启用异步光照\n            enabled=true\n            #异步光照线程数量（根据服务器的CPU进行设置。）\n            num-threads=2\n        }\n                #当有mod实体方面出错的时候把这个设置为false\n        cache-tameable-owners=true\n        #是否预先合并掉落物\n        drops-pre-merge=true\n        #是否启用对MC-128547附魔帮助溢出漏洞的修复\n        enchantment-helper-leak-fix=true\n        #快速检查服务器线程\n        faster-thread-checks=true\n        #设置为true的话可以启用panda-redstone,这提升了红石性能。此选项会有一定问题。请谨慎开启\n        panda-redstone=true复制代码\nserver.properties文件\n主要修改为视距与生成实体选项。# 出生点的保护半径 设置为0 则为出生点脚下的方块\nspawn-protection=16\n# 一个tick的最长等待时间，如果超过此数值，将会结束服务器\n# 设置为-1禁用此选项\nmax-tick-time=60000\ngenerator-settings=\n# 强制玩家以默认游戏模式进入服务器\n# 关闭则以最后一次下线的游戏模式进入\nforce-gamemode=false\n#是否开启下界（地狱）\nallow-nether=true\n# 默认的游戏模式\n# 这里修改后，请用nucleus插件再次进行修改，否则可能无效，会以nucleus设置的为主。\ngamemode=0\n# 允许服务器开启针对 GameSpy4 协议的监听。用于收集服务器信息。\nenable-query=false\nplayer-idle-timeout=0\n# 难度\n# 0-和平 1-简单 2-普通 3-困难\n#请根据你服务器需要的难度进行修改\ndifficulty=1\n# 怪物是否生成\n# 若设置为false所有怪物将不会生成。\n# 若为true夜晚正常刷怪\n# 一些模组刷怪笼会无视此选项（这个会影响你的服务器性能）\n<font color=\"#008080\">spawn-monsters=true</font>\nop-permission-level=4\n# 是否开启PVP\npvp=true\nsnooper-enabled=true\n# 生成地图的类型 若无特殊要求 默认default即可\nlevel-type=default\nhardcore=false\nenable-command-block=false\n# 最大玩家数量设置\nmax-players=20\n# 越小对CPU负荷越高。越大对带宽要求更高\n# 强烈不建议小于64\n<font color=\"#ff0000\">network-compression-threshold=250</font>\nresource-pack-sha1=\n# 游戏边境方块最大数量 默认即可\nmax-world-size=29999984\n# 设置服务器要监听的端口\n# 默认为25565\nserver-port=25565\n# 如果你想把你的服务器绑定到特定的 IP 上去请设置这一项。强烈建议将这一项留空。\nserver-ip=127.0.0.1\n# 是否生成村民\nspawn-npcs=true\n# 是否允许飞行\nallow-flight=false\n# 默认世界的名字\nlevel-name=world\n# 服务器的视距，请不要设置太高，否则对性能有严重的消耗！\n<font color=\"#ff0000\">view-distance=4</font>\nresource-pack=\n# 是否生成动物\n<font color=\"#008080\">spawn-animals=true</font>\n# 是否开启白名单模式\nwhite-list=true\n# 是否在新区块生成特殊的结构（例如村庄）\n# 此选项即便关闭，地牢仍然生成\n<font color=\"#008080\">generate-structures=true</font>\n# 是否开启正版验证\n# 盗版服务器请关闭，否则无法进入服务器\nonline-mode=false\n# 允许建造的最高高度，地形也会受到限制\nmax-build-height=256\n# 地图种子，默认为空即可\nlevel-seed=\nprevent-proxy-connections=false\n#服务器的motd，不过一般使用ServerListPlus插件进行设置。\nmotd=A Minecraft Server\nenable-rcon=false\n复制代码\n插件、模组的优化\n插件推荐使用catclearlag。但注意以下问题\n一、请设置一个区块内的怪物最好不要太少。否则会出现无法扔东西（一定几率会被卡没）不掉落原版掉落物\n\n二、unloadchunk指令可能会导致无法扔东西的bug，而且这个东西最好不用。三、最好不要用地皮插件，目前sponge的地皮插件不稳定性太高，容易造成难以挽回的损失。四、nucleus插件很强大请仔细研究其用处。五、最好不要让服务器实体过多，否则会造成你动都动不了的卡顿...\n模组推荐使用：formfix（内存）、AI Improvements（AI优化，就是让怪物智商下降）、BetterfpsAI Improvements模组可能会导致游戏难度降低，请自行考虑是否添加\nTimings\n如果卡顿，多看timings分析问题。开启方法为在后台或者游戏内输入sponge timings on然后稍等几分钟。再输入sponge timings report打开网址自行分析（大多是 实体或者区块刷新、卸载，地图保存或者是其他问题）\n启动参数\n待更......咕咕咕~~~~\n\n\n\n\n",
    "replies": [
        {
            "author": "v1877274488",
            "timestamp": 1534575360,
            "txt_content": "感谢楼主出教程！"
        },
        {
            "author": "忆华",
            "timestamp": 1534577160,
            "txt_content": "v1877274488 发表于 2018-8-18 14:56\n感谢楼主出教程！\n都是熟人啦~\n不过你应该不知道我是谁的"
        },
        {
            "author": "ssdkssdk",
            "timestamp": 1552921440,
            "txt_content": "非常感谢，很有用（来自辣鸡小服腐竹）"
        },
        {
            "author": "cybmp3",
            "timestamp": 1554363420,
            "txt_content": "ai improvement不是增强吗？"
        },
        {
            "author": "忆华",
            "timestamp": 1554469320,
            "txt_content": "cybmp3 发表于 2019-4-4 15:37\nai improvement不是增强吗？\n并不是，他只是一个更加智能的算法，减低服务器的负荷，但实际上会让怪物变蠢，而变相的降低了难度。"
        },
        {
            "author": "Star小铭",
            "timestamp": 1556621460,
            "txt_content": "我用timing分析了一下，发现消耗最多的是拔刀剑的，一个叫on entitycanupdate的方法"
        },
        {
            "author": "忆华",
            "timestamp": 1556622120,
            "txt_content": "Star小铭 发表于 2019-4-30 18:51\n我用timing分析了一下，发现消耗最多的是拔刀剑的，一个叫on entitycanupdate的方法 ...\nemmm 你可以按照我帖子进行调整一些参数去优化，因为拔刀的话，确实有点麻烦的"
        },
        {
            "author": "呱呱",
            "timestamp": 1575625860,
            "txt_content": "FoamFix的Curse页似乎写了和Sponge存在兼容性问题 需要在客户端而不是服务端使用\nSupport\nThe following mods are not supported and I cannot guarantee satisfactory fixes related to interactions with them:\nSponge. Some of our engine changes conflict. (Note that, even if you have Sponge on the server side, using FoamFix on the client side while connecting to a Sponge server is supported!)"
        },
        {
            "author": "3512885810",
            "timestamp": 1582265880,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "怕一笑丶",
            "timestamp": 1587401100,
            "txt_content": "期待楼主下次更新"
        },
        {
            "author": "zzz261263",
            "timestamp": 1590592920,
            "txt_content": "6666666666"
        },
        {
            "author": "xiao七",
            "timestamp": 1598199540,
            "txt_content": "学到了谢谢分享"
        }
    ]
}