{
    "title": "检测玩家 用(弓/剑)造成伤害值",
    "author": "WERKXXT",
    "replyCount": 15,
    "timestamp": 1597507680,
    "txt_content": "最近在做一个新的好玩的\n想做一个用特定弓(或者剑)造成指定伤害即可触发某某效果等\n我找到了一个EntityShootBowEvent\n但是我发现无法getPlayer 但也因此导致我没法获取物品栏进行检测\n然后也没办法检测我造成了多少伤害...\n(悄咪咪的问一下怎么知道我对某个物品按下了某个键位？想要做一个功能，但是却发现不会搞嘿嘿希望大佬解答）",
    "replies": [
        {
            "author": "南柯郡守",
            "timestamp": 1597510080,
            "txt_content": "你说的这个事件是实体射箭 所以 getEntity() 之后要判断是否是玩家\n\n然后直接强转就行了\n\n\n\n\n\n对某个物品按下了某个键位\n只能做检测按下F键  就是监听PlayerSwapHandItemsEvent\n\n不过可以尝试配合VV的keyboardhelper做任意按键"
        },
        {
            "author": "天辉胡萝卜",
            "timestamp": 1597512600,
            "txt_content": "EntityShootBowEvent不好检测伤害值吧\n可以用EntityDamageByEntityEvent"
        },
        {
            "author": "William_Shi",
            "timestamp": 1597537260,
            "txt_content": "EntityShootBowEvent无法确认射中谁\n因为是在射箭时触发\n而非射中时触发\n可以监听箭击中，配合Projectile#getShooter方法，判断是不是玩家射箭\n在进行你的其他逻辑\n其次，按下按键是客户端行为，Bukkit插件本身无力插手\n你只能干预那些按下按键导致服务端收到数据包的\n比如说F键切换主副手，Q键丢弃物品等"
        },
        {
            "author": "WERKXXT",
            "timestamp": 1597568760,
            "txt_content": "William_Shi 发表于 2020-8-16 08:21\nEntityShootBowEvent无法确认射中谁\n因为是在射箭时触发\n而非射中时触发\nProjectileLaunchEvent这个事件应该是可以的吧？\n我利用Player p = (Player)event.getEntity().getShooter();获取的shooter\n但是我不知道怎么搞是否击中玩家...以及获取伤害...\n是我要再开一个新的监听还是什么？"
        },
        {
            "author": "洞穴夜莺",
            "timestamp": 1597569660,
            "txt_content": "WERKXXT 发表于 2020-8-16 17:06\nProjectileLaunchEvent这个事件应该是可以的吧？\n我利用Player p = (Player)event.getEntity().getShoote ...\n没有必要，你只需要监听造成伤害就得了\n因为弹射物记录了他的主人是谁"
        },
        {
            "author": "WERKXXT",
            "timestamp": 1597571100,
            "txt_content": "洞穴夜莺 发表于 2020-8-16 17:21\n没有必要，你只需要监听造成伤害就得了\n因为弹射物记录了他的主人是谁\n啊啊啊啊感觉自己脑子都快炸了\n请问能否给一个比较透彻的说法...\n事件能不能说一下叫什么...每天靠翻spigot文档学习脑子都快炸了。（问就是没地方学习只能硬翻阅）\n谢谢！如果有具体代码更好！"
        },
        {
            "author": "WERKXXT",
            "timestamp": 1597571400,
            "txt_content": "William_Shi 发表于 2020-8-16 08:21\nEntityShootBowEvent无法确认射中谁\n因为是在射箭时触发\n而非射中时触发\n哦对了按键检测一般是指拿着指南针啊骨头乱七八糟的右键后会触发的意思...不知道怎么做右键检测"
        },
        {
            "author": "洞穴夜莺",
            "timestamp": 1597572180,
            "txt_content": "WERKXXT 发表于 2020-8-16 17:50\n哦对了按键检测一般是指拿着指南针啊骨头乱七八糟的右键后会触发的意思...不知道怎么做右键检测 ...\nPlayerInteractEvent#getAction()监听玩家左右键\nEntityDamageByEntityEvent#getDamager()获取造成伤害的实体\nEntityDamageByEntityEvent#getEntity()获取受害者\nEntityDamageByEntityEvent#getCause()获取原因"
        },
        {
            "author": "William_Shi",
            "timestamp": 1597573920,
            "txt_content": "WERKXXT 发表于 2020-8-16 17:45\n啊啊啊啊感觉自己脑子都快炸了\n请问能否给一个比较透彻的说法...\n事件能不能说一下叫什么...每天靠翻spig ...\n上文说过了\nProjectile#getShooter获取抛射物发射者\n抛射物都有发射者\n所以通过\nhttps://bukkit.windit.net/javado ... ectileHitEvent.html\n可以直接监听抛射物击中，再通过事件中的抛射物获取发射者\n判断击中的是玩家之后就可以进行自己的操作\n伤害的话就不能用这个\n要采用EntityDamageEvent\n如果判断伤害原因是抛射物，再把EntityDamageEvent\n直接强转为子事件EntityDamageByEntityEvent\n然后事件中的Damager就是抛射物，强转Projectile获取发射者\n事件中的实体就是受伤者"
        },
        {
            "author": "WERKXXT",
            "timestamp": 1597583760,
            "txt_content": "William_Shi 发表于 2020-8-16 18:32\n上文说过了\nProjectile#getShooter获取抛射物发射者\n抛射物都有发射者@EventHandler\n    public void hit(ProjectileHitEvent event){\n        double hit = 0;\n        Player shooter = (Player)event.getEntity().getShooter();\n        hit = ((Arrow) event.getEntity()).getDamage();\n        System.out.println(hit);\n        shooter.sendMessage(\"->\" + hit + \"damage!\");\n    }复制代码\n能不能帮忙看一下为什么我打中实体的时候不会冒出任何提示？（甚至后台都不提示）"
        },
        {
            "author": "洞穴夜莺",
            "timestamp": 1597583880,
            "txt_content": "WERKXXT 发表于 2020-8-16 21:16\n能不能帮忙看一下为什么我打中实体的时候不会冒出任何提示？（甚至后台都不提示） ...\n能发一下完整的代码和目录结构吗"
        },
        {
            "author": "WERKXXT",
            "timestamp": 1597584600,
            "txt_content": "洞穴夜莺 发表于 2020-8-16 21:18\n能发一下完整的代码和目录结构吗public class hitbow implements Listener {\n    @EventHandler\n    public void onLan(ProjectileHitEvent event) {\n        double hit = 0;\n        Player ps = (Player)event.getEntity().getShooter();\n        if (!(event.getEntity() instanceof Player)){\n            return;\n        }\n        if (ps.getInventory().getItemInMainHand().getType()!= Material.BOW){\n            return;\n        }\n        ItemStack bow = ps.getInventory().getItemInMainHand();\n        if (bow.hasItemMeta()){\n            return;\n        }\n        if (bow.getItemMeta().hasDisplayName()){\n            return;\n        }\n        if (bow.getItemMeta().getDisplayName().equals(\"Buff\")){\n            hit = ((Arrow) event.getEntity()).getDamage();\n            ps.sendMessage(\"这是一条测试消息\" + hit);\n            System.out.println(hit);\n        }\n    }\n}复制代码"
        },
        {
            "author": "WERKXXT",
            "timestamp": 1597584600,
            "txt_content": "WERKXXT 发表于 2020-8-16 21:30\n注册已经注册了"
        },
        {
            "author": "洞穴夜莺",
            "timestamp": 1597584900,
            "txt_content": " 本帖最后由 洞穴夜莺 于 2020-8-16 21:37 编辑 \nWERKXXT 发表于 2020-8-16 21:30\nevent.getEntity() instanceof Player\n投掷物不能是玩家\n应该是event.getHitEntity() instanceof Player\n\n\n其次这里不只是玩家可以射箭，小白也可以，掠夺者也可以，你必须考虑这种情况，并将其排除在外\nPlayer ps = (Player)event.getEntity().getShooter();\n"
        },
        {
            "author": "WERKXXT",
            "timestamp": 1597595100,
            "txt_content": "洞穴夜莺 发表于 2020-8-16 21:35\nevent.getEntity() instanceof Player\n投掷物不能是玩家\n应该是event.getHitEntity() instanceof Player\n好！谢谢！"
        }
    ]
}