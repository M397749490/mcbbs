{
    "title": "MCmod制作 1.11(14.mod设置gui & lang文件用法 & mcmod.info文件)",
    "author": "zkm00323",
    "replyCount": 2,
    "timestamp": 1490599260,
    "txt_content": " 本帖最后由 zkm00323 于 2017-3-28 14:54 编辑 \n\n不知道从哪个版本起,mod的config可以在mc进行设置这各功能其实算是蛮不错的,很方便,可视化\n\n\n\n\n\nQQ截图20170326180039.png (41.76 KB, 下载次数: 10)\n\n下载附件\n\n2017-3-26 18:04 上传\n\n\n\n\n\n\n\n\n\nQQ截图20170326180253.png (48.73 KB, 下载次数: 13)\n\n下载附件\n\n2017-3-26 18:06 上传\n\n\n\n\n\n\n\n\n\nQQ截图20170326180259.png (38.43 KB, 下载次数: 8)\n\n下载附件\n\n2017-3-26 18:06 上传\n\n\n\n\n\n\n\n呢么我们就开始做吧!\n\n\n1.生成mod的cfg文件\n\n\n\n\nQQ截图20170326180520.png (6.87 KB, 下载次数: 9)\n\n下载附件\n\n2017-3-26 18:08 上传\n\n\n\n\n\n新建一个class,输入\npublic class ModConfig {\n        private static Configuration config = null;\n        \n        public static void init() {\n                //生成config文件\n                File configFile = new File(Loader.instance().getConfigDir(), \"SoulOfAshes.cfg\");\n                config = new Configuration(configFile);\n                syncFromFiles();\n        }\n                \n        public static void register() {\n                MinecraftForge.EVENT_BUS.register(new ModConfig());\n        }\n        \n        @SubscribeEvent(priority = EventPriority.LOWEST)\n        public void onEvent(ConfigChangedEvent.OnConfigChangedEvent event) {\n                if(event.getModID().equals(Name.MOD_ID)) {\n                        syncFromGui();\n                }\n        }\n        \n        public static Configuration getConfig() {\n                return config;\n        }\n        \n        public static void syncFromFiles(){syncConfig(true, true);}\n        public static void syncFromGui(){syncConfig(false, true);}\n        public static void syncFromFields(){syncConfig(false, false);}\n        \n        private static void syncConfig(boolean loadFromConfigFile, boolean readFieldsFromConfig) {\n                if(loadFromConfigFile) config.load();\n                \n                if(readFieldsFromConfig) {}\n\n                if(config.hasChanged()) config.save();\n        }\n}\n\n\n\n在Main里加入ModConfig.init();\n        @EventHandler\n        public void preInit(FMLPreInitializationEvent event){\n                ModParticle.init();\n                ModPotion.init();\n                ModItems.init();\n                ModEntity.init();\n                ModAchivenent.init();\n                ModConfig.init();\n                proxy.init();\n        }\n\n在ClientProxy里的init()加入ModConfig.register();\n        public void init(){\n                ModConfig.register();\n                ModItems.register();\n                ModEntity.register();\n        }\n\n  我们注册的这个ConfigChangedEvent.OnConfigChangedEvent事件是当我们用gui改变\n设置后呼叫我们写的syncConfig方法,往cfg里写入新的变量\n\n这算是基础框架,现在开启游戏后我们就可\n以在run/config文件夹里看到我们的SoulOfAshes.cfg了(现在里面是空的)\n\n\n接下来我们来加入一个可设置的Int值\npublic class ModConfig {\n        private static Configuration config = null;\n                public static final String ICE = \"ice\";\n        \n        public static int iceBulletDamage;\n        \n        public static void init() {\n                File configFile = new File(Loader.instance().getConfigDir(), \"SoulOfAshes.cfg\");\n                config = new Configuration(configFile);\n                syncFromFiles();\n        }\n                \n        public static void register() {\n                MinecraftForge.EVENT_BUS.register(new ModConfig());\n        }\n        \n        @SubscribeEvent(priority = EventPriority.LOWEST)\n        public void onEvent(ConfigChangedEvent.OnConfigChangedEvent event) {\n                if(event.getModID().equals(Name.MOD_ID)) {\n                        syncFromGui();\n                }\n        }\n\n        public static Configuration getConfig() {\n                return config;\n        }\n        \n        public static void syncFromFiles(){syncConfig(true, true);}\n        public static void syncFromGui(){syncConfig(false, true);}\n        public static void syncFromFields(){syncConfig(false, false);}\n        \n        private static void syncConfig(boolean loadFromConfigFile, boolean readFieldsFromConfig) {\n                if(loadFromConfigFile) config.load();\n               //详情请看*lang文件用法\n                Property IBD = config.get(ICE, \"iceBullet Damage\", 20, I18n.format(\"config.skills.ice.ice_bullet_damage.comment\"), 5, 40);\n                \n                List<String> ListSetting = new ArrayList<String>();\n                ListSetting.add(IBD.getName());\n                config.setCategoryPropertyOrder(ICE, ListSetting);\n                \n                if(readFieldsFromConfig){\n                      iceBulletDamage = IBD.getInt();\n                }\n                \n               IBD.set(iceBulletDamage);\n\n                if(config.hasChanged()) config.save();\n        }\n}\n\n\nconfig.get有非常多的输入方式,我这里解释\n一下参数,各位可以选择自己的需求做选择(String啊,boolean啊,\n各种阵列啊都可以,会影响到下面gui里的显示效果)\n     category         所属的类(同一类的之后在gui里被放到同一个按钮下)\n     key                  此变量的名字\n     comment        简介(会在cfg文件里,以及gui画面鼠标放在变量名上时显示)\n     defaultValues 默认变量\n\n     一些min,max什么的就不说了\n\n\n*lang文件用法\n\nI18n.format(\"config.skills.ice.ice_bullet_damage.comment\")这句话是个重点可以记一下\nI18n.format(String)这个方法可以配合lang文件做使用\n现在我们新建一个中文lang文件\n\n\n\n\nQQ截图20170327114521.png (5.81 KB, 下载次数: 7)\n\n下载附件\n\n2017-3-27 11:35 上传\n\n\n\n\n\n\n不同语言的→lang文件名←列表\nzh_CN在里面输入\nconfig.skills.ice.ice_bullet_damage.comment=冰弹伤害\nen_US里面输入\nconfig.skills.ice.ice_bullet_damage.comment=Fxxk English\n\n现在如果你用英语打开游戏后我们看看cfg\n\n\n\n\nQQ截图20170327115427.png (8.9 KB, 下载次数: 17)\n\n下载附件\n\n2017-3-27 11:42 上传\n\n\n\n\n\n\n\n呢再换成中文后打开游戏\n\n\n\n\nQQ截图20170327112747.png (12.6 KB, 下载次数: 14)\n\n下载附件\n\n2017-3-27 11:59 上传\n\n\n\n\n\n\n\n没错! I18n.format()这个方法可以依照使用语言而切换\n显示的东西,当然也适用于如果你想再游戏里显示讯息\n@wlwy\n\n呢么作为举例,我把之前做的血瓶的文字显示也改成了\n用 I18n.format()这种方式,有兴趣的可以自己看一下\n\n\n*mcmod.info文件\n\n\n\n\n\nQQ截图20170327155040.png (2.81 KB, 下载次数: 7)\n\n下载附件\n\n2017-3-27 15:53 上传\n\n\n\n\n\n\n[\n    {\n      \"modid\": \"soa\",\n      \"name\": \"Soul of Ashes\",\n      \"description\": \"Write every thing you want to say.\",\n      \"version\": \"The First Version\",\n      \"mcversion\": \"${mcversion}\",\n      \"url\": \"\",\n      \"updateUrl\": \"\",\n      \"authorList\": [\"autherA\",\"autherB\"],\n      \"credits\": \"Ashrta~~~~~~~~~~~~~~~~~~~~~~\",\n      \"logoFile\": \"assets/soa/logo.gif\",\n      \"screenshots\": [],\n      \"dependencies\": [],\n    }\n]\n\n\n\n\n\nQQ截图20170327150552.png (29.55 KB, 下载次数: 5)\n\n下载附件\n\n2017-3-27 15:08 上传\n\n\n\n\n\nfrom:http://mcforge-cn.readthedocs.io ... tarted/structuring/\n\n\n2.设置gui画面\n\n新建GuiFactory文件\n\n\n\n\nQQ截图20170327133951.png (7.17 KB, 下载次数: 7)\n\n下载附件\n\n2017-3-27 14:52 上传\n\n\n\n\n\n在里面输入public class ConfigGuiFactory implements IModGuiFactory {\n\n        @Override\n        public void initialize(Minecraft minecraftInstance) {}\n\n        @Override\n        public Class<? extends GuiScreen> mainConfigGuiClass() {\n                return ModGuiConfig.class;\n        }\n\n        @Override\n        public Set<RuntimeOptionCategoryElement> runtimeGuiCategories() {\n                return null;\n        }\n\n        @Override\n        public RuntimeOptionGuiHandler getHandlerFor(RuntimeOptionCategoryElement element) {\n                return null;\n        }\n\n        public static class ModGuiConfig extends GuiConfig{\n\n                public ModGuiConfig(GuiScreen parentScreen) {\n                        super(parentScreen, getConfigElements(), Name.MOD_ID, false, false, I18n.format(\"gui.config.main_title\"));</font></b><b><font color=\"#0000ff\">\n                }\n\n                private static List<IConfigElement> getConfigElements() {\n                        List<IConfigElement> list = new ArrayList<IConfigElement>();\n                        return list;\n                }\n        }\n}\n\n\n然后我们回到Main,在@Mod注解里加入新的元素\n@Mod(modid = Name.MOD_ID,\n           name = Name.NAME,\n           version = Name.VERSION,\n           acceptedMinecraftVersions = Name.ACCEPT_VRTDION,\n           guiFactory = Name.CONFIG_GUI_CLASS\n)\n\n\n在Name里新建这个final String\npublic static final String CONFIG_GUI_CLASS = \"ModSoul_of_Ashes.Config.ConfigGuiFactory\";\n\n\n最后记得在resources里写*mcmod.info文件\n\n现在可以打开游戏看看(:这个人太天真,以为用gif图就会动,不乖乖用png,真垃圾)\n\n\n\n\nQQ截图20170327160331.png (76.92 KB, 下载次数: 3)\n\n下载附件\n\n2017-3-27 16:07 上传\n\n\n\n\n\n我们现在有config选项了!\n\n\n\n\nQQ截图20170327160453.png (28.46 KB, 下载次数: 9)\n\n下载附件\n\n2017-3-27 15:51 上传\n\n\n\n\n\n但是里面还没有东西\n\n呢么现在我们就来添加东西\n在原本的 里加入新的代码\npublic static class ModGuiConfig extends GuiConfig{\n                public ModGuiConfig(GuiScreen parentScreen) {\n                        super(parentScreen, getConfigElements(), Name.MOD_ID, false, false, I18n.format(\"gui.config.main_title\"));\n                }\n\n\n                private static List<IConfigElement> getConfigElements() {\n                        List<IConfigElement> list = new ArrayList<IConfigElement>();\n                        //在这里写这一层所含有的内容\n                        list.add(new DummyCategoryElement(I18n.format(\"gui.config.category.skills\"), \"gui.config.category.skills\", CategoryEntrySetting.class));\n                        return list;\n                }\n                \n                public static class CategoryEntrySetting extends CategoryEntry{\n                        public CategoryEntrySetting(GuiConfig owningScreen, GuiConfigEntries owningEntryList,IConfigElement configElement) {super(owningScreen, owningEntryList, configElement);}\n                        @Override\n                        protected GuiScreen buildChildScreen() {\n                                List<IConfigElement> list = new ArrayList<IConfigElement>();\n                                //在这里写这一层所含有的内容\n                                list.add(new DummyCategoryElement(I18n.format(\"gui.config.category.Ice\"), \"gui.config.category.Ice\", CategorySkillsSetting.class));\n                                String windowTitle = I18n.format(\"gui.config.category.Ice\");\n                                return new GuiConfig(owningScreen, list, owningScreen.modID, this.configElement.requiresWorldRestart() || this.owningScreen.allRequireWorldRestart, this.configElement.requiresMcRestart() || this.owningScreen.allRequireMcRestart, windowTitle);\n                        }\n                }\n        }\n}\n\n\n现在我们打开游戏就会看到我们的modconfig出现skills选项了\n\n\n\n\nQQ截图20170327170438.png (26.66 KB, 下载次数: 11)\n\n下载附件\n\n2017-3-27 17:08 上传\n\n\n\n\n\n\n虽然现在点进去还是什么都没有\n\n没事呢现在我们再往按钮里面加一个按钮\npublic static class ModGuiConfig extends GuiConfig{\n                public ModGuiConfig(GuiScreen parentScreen) {\n                        super(parentScreen, getConfigElements(), Name.MOD_ID, false, false, I18n.format(\"gui.config.main_title\"));\n                }\n\n\n                private static List<IConfigElement> getConfigElements() {\n                        List<IConfigElement> list = new ArrayList<IConfigElement>();\n                        //在这里写这一层所含有的内容\n                        list.add(new DummyCategoryElement(I18n.format(\"gui.config.category.skills\"), \"gui.config.category.skills\", CategoryEntrySetting.class));\n                        return list;\n                }\n                \n                public static class CategoryEntrySetting extends CategoryEntry{\n                        public CategoryEntrySetting(GuiConfig owningScreen, GuiConfigEntries owningEntryList,IConfigElement configElement) {super(owningScreen, owningEntryList, configElement);}\n                        @Override\n                        protected GuiScreen buildChildScreen() {\n                                List<IConfigElement> list = new ArrayList<IConfigElement>();\n                               //在这里写这一层所含有的内容\n                                list.add(new DummyCategoryElement(I18n.format(\"gui.config.category.Ice\"), \"gui.config.category.Ice\", CategorySkillsSetting.class));\n                                String windowTitle = I18n.format(\"gui.config.category.Ice\");\n                                return new GuiConfig(owningScreen, list, owningScreen.modID, this.configElement.requiresWorldRestart() || this.owningScreen.allRequireWorldRestart, this.configElement.requiresMcRestart() || this.owningScreen.allRequireMcRestart, windowTitle);\n                        }\n                        \n                        public static class CategorySkillsSetting extends CategoryEntry{\n                                public CategorySkillsSetting(GuiConfig owningScreen, GuiConfigEntries owningEntryList,IConfigElement configElement){super(owningScreen, owningEntryList, configElement);}\n                                @Override\n                                protected GuiScreen buildChildScreen() {\n                                        List<IConfigElement> list = new ArrayList<IConfigElement>();                                        \n                                        //在这里写这一层所含有的内容\n                                        String windowTitle = I18n.format(\"gui.config.category.icebullet\");                \n                                        return new GuiConfig(owningScreen, list, owningScreen.modID, this.configElement.requiresWorldRestart() || this.owningScreen.allRequireWorldRestart, this.configElement.requiresMcRestart() || this.owningScreen.allRequireMcRestart, windowTitle);\n                                }\n                        }\n                }\n        }\n}\n\n\n\n现在skills按钮点下去就会有ice按钮了\n\n现在可以在ice按钮里面加入参数栏来改变变量了\npublic static class ModGuiConfig extends GuiConfig{\n\n\n                public ModGuiConfig(GuiScreen parentScreen) {\n                        super(parentScreen, getConfigElements(), Name.MOD_ID, false, false, I18n.format(\"gui.config.main_title\"));\n\n\n                }\n\n\n                private static List<IConfigElement> getConfigElements() {\n                        List<IConfigElement> list = new ArrayList<IConfigElement>();\n                        //在这里写这一层所含有的内容\n                        list.add(new DummyCategoryElement(I18n.format(\"gui.config.category.skills\"), \"gui.config.category.skills\", CategoryEntrySetting.class));\n                        return list;\n                }\n                \n                public static class CategoryEntrySetting extends CategoryEntry{\n                        public CategoryEntrySetting(GuiConfig owningScreen, GuiConfigEntries owningEntryList,IConfigElement configElement) {super(owningScreen, owningEntryList, configElement);}\n                        @Override\n                        protected GuiScreen buildChildScreen() {\n                                List<IConfigElement> list = new ArrayList<IConfigElement>();\n                                //在这里写这一层所含有的内容\n                                list.add(new DummyCategoryElement(I18n.format(\"gui.config.category.Ice\"), \"gui.config.category.Ice\", CategorySkillsSetting.class));\n                                String windowTitle = I18n.format(\"gui.config.category.Ice\");\n                                return new GuiConfig(owningScreen, list, owningScreen.modID, this.configElement.requiresWorldRestart() || this.owningScreen.allRequireWorldRestart, this.configElement.requiresMcRestart() || this.owningScreen.allRequireMcRestart, windowTitle);\n                        }\n                        \n                        public static class CategorySkillsSetting extends CategoryEntry{\n                                public CategorySkillsSetting(GuiConfig owningScreen, GuiConfigEntries owningEntryList,IConfigElement configElement){super(owningScreen, owningEntryList, configElement);}\n                                @Override\n                                protected GuiScreen buildChildScreen() {\n                                        List<IConfigElement> list = new ArrayList<IConfigElement>();                                        \n\n                                        //在这里写这一层所含有的内容\n                                        list.addAll(new ConfigElement(ModConfig.getConfig().getCategory(ModConfig.ICE)).getChildElements());\n                                        String windowTitle = I18n.format(\"gui.config.category.icebullet\");                \n                                        return new GuiConfig(owningScreen, list, owningScreen.modID, this.configElement.requiresWorldRestart() || this.owningScreen.allRequireWorldRestart, this.configElement.requiresMcRestart() || this.owningScreen.allRequireMcRestart, windowTitle);\n                                }\n                        }\n                }\n        }\n}\n\n\n\n\nQQ截图20170327175433.png (24.86 KB, 下载次数: 4)\n\n下载附件\n\n2017-3-27 17:59 上传\n\n\n\n\n\n现在点进去就有画面\n\n但这种有区间范围内设值的变量用拉条来设置比较科学对吧\n我们回到ModConfig文件里的syncConfig方法\n         private static void syncConfig(boolean loadFromConfigFile, boolean readFieldsFromConfig) {\n                if(loadFromConfigFile) config.load();\n                \n                Property IBD = config.get(ICE, \"iceBullet Damage\", 20, I18n.format(\"config.skills.ice.ice_bullet_damage.comment\"), 5, 40);\n                IBD.setConfigEntryClass(NumberSliderEntry.class);\n                \n                List<String> ListSetting = new ArrayList<String>();\n                ListSetting.add(IBD.getName());\n                config.setCategoryPropertyOrder(ICE, ListSetting);\n                \n                if(readFieldsFromConfig){\n                        iceBulletDamage = IBD.getInt();\n                }\n                \n                IBD.set(iceBulletDamage);\n\n\n                if(config.hasChanged()) config.save();\n        }\n\n加入这一句以后再打开游戏\n\n\n\n\nQQ截图20170327180335.png (26.35 KB, 下载次数: 8)\n\n下载附件\n\n2017-3-27 18:06 上传\n\n\n\n\n\n\n\n我们也有其他小东西可以设置变量\nProperty.setRequiresMcRestart(true)      不可在游戏中更改的设置,只可查看\n等.....(我还没发现其他的设置,有兴趣的可以翻翻IModGuiFactory的Type History)\n\n最后的最后要让冰弹的伤害数值读取到我们设置的值\n到EntityIcebullet的onImpact方法下\n protected void onImpact(RayTraceResult result) {\n         if (!this.worldObj.isRemote) {\n                 if (result.entityHit instanceof EntityLivingBase && result.entityHit != getThrower()) {\n                      result.entityHit.attackEntityFrom(DamageSource.causeThrownDamage(this, this.getThrower()),ModConfig.iceBulletDamage);\n                 }\n                this.worldObj.setEntityState(this, (byte) 1);\n                this.setDead();\n        }\n}\n\n\n\n\n不知道各位看到这里能不能够举一反三了\n例如让一个按钮和一个设置存在于同一平面\n再在按钮下面创建一个按钮\n在ICE属性类下加入新的变量\n创建一个String变量\n创建一个String List变量.....\n\n好吧我知道还有很多没讲清楚,这篇教程已经非常长了\n希望想了解的人可以自己研究一下\n\n现在源码都上传去github了\nhttps://github.com/zkm00323/Example\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "zkm00323",
            "timestamp": 1490684760,
            "txt_content": "还有一些额外功能没讲到,比如在gui画面里面加入图片什么的\nhttp://jabelarminecraft.blogspot ... iguration-guis.html\n可能需要配合下面这个教程食用\nhttp://blog.hakugyokurou.net/?p=734\n\n\n"
        },
        {
            "author": "清晨w",
            "timestamp": 1518510780,
            "txt_content": "话说I18n这个类有@SideOnly(Side.CLIENT)的注解吧，服务端运行的时候会报错的"
        }
    ]
}