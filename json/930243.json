{
    "title": "[教程]避免模型棱边出现异常线条的办法",
    "author": "GeForceLegend",
    "replyCount": 9,
    "timestamp": 1575350280,
    "txt_content": " 本帖最后由 GeForceLegend 于 2020-7-30 20:05 编辑 \n\n\n====前言====\n\n注：这个和游玩时方块边界出现透明线条不属于同一种现象，方块边界出现透明线条一般是由于显卡驱动设置的问题，可以在NVIDIA控制面板内将图形设置改为“偏重性能”或者“由3D应用程序决定”来解决。本帖讲的是一个方块的内部的模型出现的棱边异常，不仅限于透明线条，但是一般以透明线条出现。\n\n在为Minecraft的资源包制作模型的时候，经常会发现模型的棱边有一些异常线条（比如透明线条），例如下图活板门内孔的边缘：\n\n\n\n\n\n\n2019-12-03_08.38.16.png (92.64 KB, 下载次数: 0)\n\n下载附件\n\n2019-12-3 08:39 上传\n\n\n\n\n\n这种现象在1.14之前的版本中更为明显。\n\n这种现象的原因是Minecraft在给模型引用贴图之前会先将贴图略微拉伸，导致uv的引用坐标与实际的像素点直接有微小的偏差，从而导致了模型的贴图引用区域稍微偏离预想范围。这种异常现象可以通过给一个较大的面分配一个较小的贴图区域来放大（例如给一个16*16的面引用贴图里面1*1的区域）。\n\n本教程针对的是使用16X贴图的情况，未使用更高分辨率的贴图做过测试。\n本教程的数据和方案均为实验得出，暂时没有源代码层面的支持。\n测试时，用1.8.9，1.9.4，1.10.2，1.11.2，1.12.2，1.13.2来代表同一大版本的情况，1.8.9、1.10.2、1.12.2、1.13.2、1.14.4测试了开启Optifine的情况。\n\n网易版不在考虑范围内\n\n====基础知识====\nMinecraft中，模型的每个面对贴图的引用区域由uv的四个数决定，例如[0,0,16,16]就是引用由(0,0)到(16,16)的一个矩形。在Minecraft中一个贴图以左上角为(0,0)，右下角为(16,16)，水平方向为x轴，垂直方向为y轴，以此决定坐标。经过本人多次测试，似乎小数点后第五位开始的uv坐标对实际的贴图引用影响不大，因此建议uv坐标四舍五入到小数点后四位即可。\n\n\n\n\n\n\ngrass_side.png (4.39 KB, 下载次数: 0)\n\n下载附件\n\n2019-12-3 08:55 上传\n\n\n\n\n\n对于一个面的贴图引用，x轴方向和y轴方向的偏离互不干扰彼此独立，只与在自身方向上的贴图引用区域有关。因此可以仅需要研究一个方向上的规律，就可以推导出另一个方向上的规律。\n在Minecraft中，不同的版本，甚至同一版本开启/关闭Optifine，都可能会使贴图拉伸的规律变化。\n\n====各版本的贴图拉伸规律====\n\n1.8（无论是否开启Optifine，L5版本以前）及1.9~1.13（不开启Optifine）\n\n\n在这些版本中，贴图的拉伸相对非常简单。16px的贴图以(8,8)为中心被拉伸到了16.02px，也就是每条边各向外扩张0.01px。而贴图拉伸后坐标的位置没有变化，因此实际上贴图的引用位置偏内。\n\n\n\n\n\n\ngrass_side2.png (13.9 KB, 下载次数: 0)\n\n下载附件\n\n2019-12-3 09:15 上传\n\n\n\n\n\n\n\n1.8（Optifine 1.8.9 L5及之后的版本）1.9~1.13（开启Optifine）\n\n\n情况较为复杂。建议直接看解决方案。\n\n\n1.14以后（无论是否开启Optifine）\n\n\n在这些版本中，贴图拉伸的比率极其容易变化，小到加载另一个资源包或者装载一个优化mod都可能导致比率变化，因此在这些版本中不太推荐为贴图的细小拉伸做专门的适配。\n在本教程中出现的比例为使用我自己的资源包测试时得到的比例。\n与之前的版本相比，贴图的拉伸比率比较大，由16px拉伸到了约16.0627px左右。\n1.14.4中，uv引用位置的中心坐标将成为贴图拉伸的中心。例如一个面引用了(0,0)到(4,8)的矩形贴图，则贴图拉伸的中心为(2,4)。绝大部分情况下，若引用的贴图区域在某一方向上长度小于等于4，该方向上贴图拉伸造成的影响就可以接近忽略不计。\n\n\n====解决方案====\n\n1.8（无论是否开启Optifine，L5版本以前）及1.9~1.13（不开启Optifine）\n\n\n只需要按照拉伸比率调整即可，由0~16调整为-0.01~16.01。中间的部分可以很容易的计算得到。\n\n\n1.8（Optifine 1.8.9 L5及之后的版本）1.9~1.13（开启Optifine）\n\n\n在某一方向上，若贴图的引用中心为x，则实际上中心的位置应当向外侧移动|x-8|*0.00125（相当于开启Optifine后贴图引用中心的坐标变化等同于不开Optifine版本的uv坐标变化），并且长度为原长度的16.052/16倍。\n例如，[0,3,4,9]，x轴方向上理论中心为2，则实际中心为1.9925，长度为4*16.052/16=4.013，则x轴方向上的引用范围应为-0.014~3.999；y轴方向上理论中心为6，实际中心为5.9975，长度为6*16.052/16=6.0195，则y轴方向上的引用范围应为2.98775~9.00725，考虑到小数点后第五位开始对贴图引用区域影响较小，可以取为2.9878~9.0072，即最终用于抵消贴图拉伸产生的影响的结果为[-0.014,2.9878,3.999,9.0072]。\n\n\n1.14以后（无论是否开启Optifine）\n\n\n由于中心固定，只需要uv坐标的每条边向外扩张（0.0313/16*该方向上引用长度）即可。\n例如[16,4,0,16]变为[16.0314,3.9843,-0.0314,16.025]即可最小化贴图拉伸带来的影响。\n\n但是，由于这些版本中的拉伸倍率容易变化，并不推荐上面的解决方案！\n\n由于1.14开始贴图拉伸的中心就是贴图引用区域的中心，贴图引用区域外不会再影响面的边缘了，因此大部分情况下模型的棱边都不会出现异常线条。但是，如果贴图的引用区域存在透明的部分，仍然有可能会因为略微的拉伸出现透明的细缝；或者设计模型时有些面重合了，即使理论上重合区域各像素颜色完全一致，部分像素的边缘仍然会出现深度冲突带来的色块闪烁。\n\n因此，在1.14以上的版本中，我的推荐措施就是直接在设计模型时避开透明部分，透明部分的边缘分成多个元素处理，并且设计模型时尽量避免出现面重合的现象。可以为了优化总面数考虑把一些较小的面重合一部分，但是不推荐较大的面，尤其是边缘部分与其他面重合。\n\n\n====结语====\n\n我不知道MOJANG是出于什么搞出这种特性的，可能是游戏引擎的问题，也可能是有意为之，但是这确实对模型制作者很不友好。虽然很多时候并不需要用到这种方案，但是一旦到了需要使用这种方案的时候，一个个调数据值还是很麻烦的。但是有这样一个教程总好过面对模型棱边的缝隙而无可奈何要好一些，希望对各位有所帮助。\n\n\n\n\n\n\n\n\n\n\nTIM截图20191203120746.png\n(134.81 KB, 下载次数: 1)\n\n\n\n\n下载附件\n\n\n2019-12-3 12:08 上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "nggcgg2",
            "timestamp": 1575351120,
            "txt_content": "的确很烦 amd显卡尤其烦 经常被这个bug恶心"
        },
        {
            "author": "rooke_zb",
            "timestamp": 1575354180,
            "txt_content": " 本帖最后由 brooke_zb 于 2019-12-3 20:51 编辑 \n\n\n\n\n\nfile_1575354057000.jpg (199.2 KB, 下载次数: 0)\n\n下载附件\n\n2019-12-3 14:20 上传\n\n\n\n\n\n诶，问一下你会不会出现这种情况，用独显（我是1660ti）玩就会有非常严重的异常缝隙，用核显就不会，我在想是不是驱动的问题\n\n@nggcgg2 但是各项异性过滤开了就没法开光影了↓\n"
        },
        {
            "author": "GeForceLegend",
            "timestamp": 1575355200,
            "txt_content": "brooke_zb 发表于 2019-12-3 14:23\n诶，问一下你会不会出现这种情况，用独显（我是1660ti）玩就会有非常严重的异常缝隙，用核显就不会，我在 ...\n你这个和模型本身没有关系，应该是显卡驱动设置的问题，在NVIDIA控制面板里面调一下图像设置偏重于性能应该就可以了"
        },
        {
            "author": "weeazn",
            "timestamp": 1575360360,
            "txt_content": "brooke_zb 发表于 2019-12-3 14:23\n诶，问一下你会不会出现这种情况，用独显（我是1660ti）玩就会有非常严重的异常缝隙，用核显就不会，我在 ...\n以前也遇到过这种情况，重置一下显卡设置再重启游戏就行了"
        },
        {
            "author": "a1294790523",
            "timestamp": 1575383940,
            "txt_content": "brooke_zb 发表于 2019-12-3 14:23\n诶，问一下你会不会出现这种情况，用独显（我是1660ti）玩就会有非常严重的异常缝隙，用核显就不会，我在 ...\n在显卡控制面板对javaw.exe关闭FXAA抗锯齿即可"
        },
        {
            "author": "chyx",
            "timestamp": 1576312680,
            "txt_content": "好气啊。\n得想个办法不自己一遍一遍改。\nemmmm\ndef g(x1,y1,x2,y2):\n        x1,x2=f(x1,x2)\n        y1,y2=f(y1,y2)\n        return [x1,y1,x2,y2]\n\ndef f(a,b):\n        c=((b-a)/16)*0.0313\n        return a-c,b+c\n\nfor element in json_file[\"elements\"]:\n        for face in element[\"faces\"].values():\n                face[\"uv\"]=g(*face[\"uv\"])\n\n这样一口气全都给改了行不行？"
        },
        {
            "author": "GeForceLegend",
            "timestamp": 1576320180,
            "txt_content": "chyx 发表于 2019-12-14 16:38\n好气啊。\n得想个办法不自己一遍一遍改。\nemmmm\n没必要每个元素的每个面都改，1.14开始由于贴图拉伸机制更改了一下，只有极少数的元素还要拉伸了，倒是针对1.13或者更早版本的可以考虑一下"
        },
        {
            "author": "lalalamyhope",
            "timestamp": 1580287020,
            "txt_content": "膜拜大佬"
        },
        {
            "author": "赤丶瞳",
            "timestamp": 1580288940,
            "txt_content": "mcbbc有你更精彩"
        }
    ]
}