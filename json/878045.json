{
    "title": "关于IDEA使用Gradle调试Mod会无法读取材质的问题及解决方案",
    "author": "云闪",
    "replyCount": 6,
    "timestamp": 1561671960,
    "txt_content": " 本帖最后由 云闪 于 2019-9-18 13:32 编辑 \n\n\n花了好几个小时才搞定这个问题，不写一下就会有浪费了大把时间的感觉，而写了就不会有！所以我要写下来！才不是水贴\n这个解决方案对大多数开发者可能是没啥用的，因为我怀疑没几个人会遇到这个问题。然后我又写了好多_(:з」∠)_\n\n没什么人关心的问题描述：\n使用IDEA启动Minecraft调试(该运行配置由./gradlew genIntellijRuns命令生成)\n\n在Minecraft中打开界面的时候发现UI材质变成紫黑方块，即Minecraft无法找到材质(红白线是我调试UI位置的时候画的辅助线)\n\n(就不截图代码和图片路径了，由下文的正确显示可以证明代码和图片路径的正确性，保证两次截图之间没有修改任何代码和资源文件)\n没什么需求的解决方案：\n这个不要勾就行了(应该很少人勾，可能只有我这种喜欢Gradle的才会设置成默认勾上的吧_(:з」∠)_)\n\n然后再启动就能愉快地发现材质正常了\n\n然而我花了好久才发现这样就行\n(而且对于我来说这个不是最优解决方案 只是唯一可行的方案\n\n问题复现步骤(也就是说一般人不这样操作的话是不会触发问题的)：\n1. 正常使用./gradlew idea和./gradlew genIntellijRuns配置完IDEA工作环境之后，还要在手贱使用IDEA的导入Gradle项目的功能(IDEA打开项目后右下角会提示导入)。所以说既然有build.gradle，那么我导入Gradle项目来工作不是很合理吗！\n2. 导入项目之后其它很正常(会多出来两个api和test项目逼着你使用更规范的开发模式，除非没有强迫症)，但是导入之后会发现./gradlew genIntellijRuns这个命令生成的两个IDEA的运行配置会因为找不到启动类而发生错误，原因是导入之后项目架构分为根项目xxx以及三个子项目xxx.api, xxx.main, xxx.test，mod的主要代码和资源都在xxx.main这个项目，所以把运行配置的依赖项目(use classpath of module)从xxx改成xxx.main就完事了。\n3. 把解决方案那个让不要勾的勾上，然后把out这个文件夹删了(如果不删的话会出现mod重复加载的错误导致崩端)\n没什么意义的问题原理分析：\nIDEA在启动Application类型的运行配置的时候，会通过classpath生成启动命令\n\ncopy到Notepad++中 由于命令长度高达11402个字符，故将;(classpath的路径分隔符)替换成回车符，\n即可看到关键路径，下面两张图分别是 不勾解决方案中截图的那个框，以及勾了的情况\n\n\n\n正常情况下，IDEA的处理是没有问题的，毕竟勾了的情况下也是同时有classes和resources的路径，而Application这类运行配置的含义是独立程序，所以也是能正常获取资源的。然而，Forge Mod开发并不属于正常情况，由./gradlew genIntellijRuns生成的启动配置是通过一个名叫GradleStart的类来启动Minecraft，而我们实际上写的mod是他扫描classpath来加载的。\n\n问题来了\n毕竟咱不能让多个mod的材质冲突，所以找资源得找mod自己的文件，不能像普通应用一样直接全局搜资源，所以要保存mod的路径\nso 如果勾了那个框，就会出现这种情况\n\n很显然，mod的路径被锁定到了build/classes/main这个文件夹，而mod的材质文件所在的build\\resources\\main文件夹被完全忽视了\n那么找不到材质也就 很正常了\n\n而如果不勾的话，IDEA会把资源文件和编译好的class文件copy到同一个文件夹中，也就不会出现找不到材质的情况了\n（以上问题在1.7.10和1.12.2的开发环境中测试过，都是相同的）\n\n那么说了那么久的那个框，勾与不勾到底有什么区别：\n不勾的话，使用IDEA构建/运行项目的时候会使用IDEA自己的构建/运行逻辑。而勾上的话，则会使用Gradle的构建/运行逻辑\n碎碎念 我为什么要搞这么麻烦：\n其实不麻烦，导入Gradle项目 然后改个运行配置 然后记住不要勾那个就行，点几下的事情而已。\n有道是 知其然 知其所以然。看起来麻烦实际上是求知的过程而已，求知总是不会那么简单的。\n\n\n好吧，那么明明输完./gradlew idea和./gradlew genIntellijRuns之后就可以正常用了，我为什么还要搞些其他的东西，闲得没事干吗？好像是挺闲的\n原因嘛，应该可以说出来不少\n比如使用Gradle构建可以保证不会出现我测试的时候正常运行，想发布的时候莫名有问题，或者代码发给别人的时候莫名有问题(既然是Gradle项目 并且是都是用wrapper的，那么不发IDEA配置文件很正常嘛 并且别人也不一定用IDEA)(不过可能性确实挺低的)\n比如让自己使用Gradle成为习惯(真的习惯了)，毕竟新一代的自动化构建工具\n再比如...好像比不出来了 尴尬\n但是最重要的原因，当然是！强迫症！\n明明是gradle项目，明明生成的文件都是可以在build目录的，为什么还要多一个out文件夹，难看死了。至于把out文件夹放进build里面？也很难受 IDEA和Gradle是好朋友 但是随便把自己的东西插进别人里面(雾)也挺难受的\n那么怎样才能没有out文件夹呢！当然是把IDEA自己的构建/运行代理给Gradle执行，既继承了多平台统一的优点 还可以不多出难看的东西\n\n只是_(:з」∠)_这个问题搞下来，最终还是没法把out文件夹解决掉，要是有更好的方法就好了 有的话我当场表演删帖\n\n\n",
    "replies": [
        {
            "author": "lq2007",
            "timestamp": 1568697480,
            "txt_content": " 本帖最后由 lq2007 于 2019-9-17 13:19 编辑 \n\n多谢。。。我也遇到了这么个问题，在某次更新idea后出现了。。。翻了N多设置都没找到原因，只能手动运行 runClient 调试"
        },
        {
            "author": "lq2007",
            "timestamp": 1568698320,
            "txt_content": "补充一下\n新版本 idea 好像默认就是 Gradle 类型运行，相关配置为\n\n\n\n\n\n2019-09-17_132934.gif\n(211.14 KB, 下载次数: 1)\n\n\n\n\n下载附件\n\n\n2019-9-17 13:31 上传\n\n\n\n\n\n\n\n\n新版本idea将 Gradle 作为默认\n\n\n\n\n\n\n"
        },
        {
            "author": "云闪",
            "timestamp": 1568698860,
            "txt_content": "lq2007 发表于 2019-9-17 13:18\n多谢。。。我也遇到了这么个问题，在某次更新idea后出现了。。。翻了N多设置都没找到原因，只能手动运行 ru ...\n能帮到人真的太开心了~\n\n其实默认gradle挺好的，只是ForgeGradle他对idea在这个设置有点奇怪的不兼容"
        },
        {
            "author": "sdblt12",
            "timestamp": 1590735480,
            "txt_content": "问题复现的运行配置的依赖项目（use classpath of module）是什么东西，在哪里改呢"
        },
        {
            "author": "Laxjty",
            "timestamp": 1611383820,
            "txt_content": "lq2007 发表于 2019-9-17 13:32\n补充一下\n新版本 idea 好像默认就是 Gradle 类型运行，相关配置为\n23333333333333"
        },
        {
            "author": "ml0834666",
            "timestamp": 1611535560,
            "txt_content": "可以。。受教了。"
        }
    ]
}