{
    "title": "原版模组GUI材质放缩与平移量计算公式",
    "author": "ruhuasiyu",
    "replyCount": 9,
    "timestamp": 1574340240,
    "txt_content": " 本帖最后由 ruhuasiyu 于 2019-11-21 20:48 编辑 \n\n在原版模组材质设计中，我们往往需要将一张很大的材质放到容器的物品栏中，然后进行放缩和平移来达到我们期望的图片效果。然而平移量 (translation) 并不好计算，可能有的时候效果差不多了也就觉得ok了，其实这些可以精确计算出来的。我们来一起推导下这个计算公式。\n\n我们计算 x 轴的 display 的 scale 和 translation，y 轴是类似的。假设我们有一张宽w高h的材质，其上有一个距离左上角 [a,b]-[a',b'] 的图案，我们希望将它投影到物品栏中，使得这个图案的坐标变为 [x,y]-[x',y']。这里我们取坐标轴中心为物品栏的正中间。\n\n\n我们先考虑使用默认 elements 的情形。此时放缩倍数为\nscale[0]=λ=w(x'-x)/(16(a'-a)).复制代码此时图案左上角坐标变为 16λ(a/w-1/2). 平移量为\ntranslation[0]=x-16λ (a/w-1/2)=x'-16λ(a'/w-1/2).复制代码\n如果我们修改了 elements 使得新的elements 范围为 [fx,fy]-[tx,ty]，则该 elements 中心坐标变为 [λ((fx+tx)/2-8), λ((fy+ty)/2-8)]，放缩倍数为\nscale[0]=16λ/(tx-fx)=w(x'-x)/((tx-fx)(a'-a)).复制代码平移量为\ntranslation[0]=x-16λ(a/w-1/2)-λ((fx+tx)/2-8).复制代码注意 y 轴以上为正，下为负，因此最后的 translation 需要乘以-1.\n\n最后，如果你希望你的材质的像素点和原本GUI的像素点是一样大的(或者为 1/n 倍)，则最好在绘制的时候就将期望的图案大小确定为 a'-a=x'-x (或 a'-a=n(x'-x))。\n\n举个例子，我这里有一张表示经验槽的图，图片大小为 64×64，图案位于 [21,8]-[42,58]，我们希望将其对齐到其所在方格以及上下一共3格的18×54 大小范围(每个格子本身16×16，每个边框厚度1)，我们已经设置 elements 范围为\n\"from\": [ -8, -8, 0 ], \"to\": [ 24, 24, 1 ],\n\n对于 x 轴\nw=64,a=21,a'=42,x=-9,x'=9复制代码计算可得 \nλ=24/7, scale[0]=12/7=1.71428572, translation[0]=3/7=0.428571429.复制代码对于 y 轴\nw=64,a=8,a'=58,x=-27,x'=27复制代码计算可得\nλ=4.32, scale[1]=2.16, translation[1]=-1.08.复制代码我们可以看出，最终对齐得非常精确（鼠标所指物品栏与边框有缝隙是因为放缩后的白色边框比物品栏的边框窄）。\n\n\n最终的模型文件为\n{\n  \"elements\": [\n    {\n      \"from\": [ -8, -8, 0 ],\n      \"to\": [ 24, 24, 1 ],\n      \"faces\": {\n        \"south\": { \"uv\":[0,0,16,16],\"texture\": \"#layer0\"}\n      }\n    }\n  ],\n  \"display\": {\n    \"gui\": {\n      \"scale\": [ 1.71428572, 2.16, 3 ],\n      \"translation\": [ 0.428571429, 1.08, 10]\n    }\n}复制代码\n\n图片版公式：\n",
    "replies": [
        {
            "author": "SolidBlock",
            "timestamp": 1584200940,
            "txt_content": "写得不错，有时间我会研读（或许是考完以后了）。"
        },
        {
            "author": "zzl2010",
            "timestamp": 1584691560,
            "txt_content": "厉害            "
        },
        {
            "author": "、、、、、、、",
            "timestamp": 1588171980,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "1511829221",
            "timestamp": 1589675220,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "5825918",
            "timestamp": 1589681760,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "314842068",
            "timestamp": 1591147740,
            "txt_content": "MCBBS，有你更精彩~"
        },
        {
            "author": "cyxzbd",
            "timestamp": 1593350220,
            "txt_content": "强！66666666"
        },
        {
            "author": "4399游戏王",
            "timestamp": 1613993640,
            "txt_content": "源码过于复杂 搞不明白"
        },
        {
            "author": "4399游戏王",
            "timestamp": 1613993640,
            "txt_content": "你具体是咋做的呢 我有点搞不懂啊 大佬教教我"
        }
    ]
}