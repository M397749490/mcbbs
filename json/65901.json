{
    "title": "区域文件格式(Region File Format)",
    "author": "DJXGAME",
    "replyCount": 4,
    "timestamp": 1353552840,
    "txt_content": " 本帖最后由 DJXGAME 于 2012-11-22 11:07 编辑 \n\n区域文件格式\n\n区块文件格式为在Minecraft 1.3中为存储区块所引入的一种文件格式。其中每32×32个区块就会成为一组存储进一个独立的区域文件。可以这么认为，区域为整个文件系统的一部分，其中头文件用于确定每一个文件的位置、扇区则为所分配的大小。整个系统基于MCRegion，[1]，这是一个由Scaevolus编写的MOD。（他的Optimine项目也同样很有名。）MCRegion格式几乎未发生变化，除了向其中添加随时间戳更新的区块列表。Jahkob宣称这一全新的格式相比于之前的系统而言速度提高到7倍。[2]在Minecraft 1.2中，区域文件被Anvil文件格式所取代；但是铁砧文件格式只对区块格式做出修改，只会将区域文件的文件名由\".mcr\"修改为 \".mca\"。区域文件区域文件的位置\n区域文件位于目录下名叫\"region\"的子文件中，并以r.x.z.mcr的命名方式进行命名（其中x和z为区域的坐标）。为了计算某一区块所属的区域的坐标，可以通过将区块坐标除以32即可。在Java中：\nint localX = (int)floor(chunkX / 32.0);  \nint localZ = (int)floor(chunkZ / 32.0);复制代码\n在对位进行操作时（移位）：\nint localX = chunkX >> 5\nint localZ = chunkZ >> 5复制代码\n举例来说，坐标为（30, -3）的区块位于（0，-1）的区域中；而坐标为（70,-30）的区块位于（2，-1）的区域中。\n结构\n区域文件以8kB头文件开头，其中包含了该区域文件所包括的区块信息（最后更新的时间以及方位等）。区块坐标为（x，z）的区块在所在区域中的位置可以按如下方式找到：在区域文件中偏移4* ((x mod 32) + (z mod 32) * 32)字节即可。针对于x或z可能为负的情况，在计算其模数后需要以31减去其绝对值。在区块信息之后4096字节为时间戳。文件的剩余部分包含了1024个区块的信息，并以大量的未使用空间点缀其间。\n\n字节0 - 40954096 - 81918192...描述位置 (1024 个入口地址)时间戳 (1024 个入口地址)区块和未使用空间\n区块的位置\n区域中所包含的区块的位置信息由4字节组成，分为两部分：前三个字节为自文件开始的4KB区段中的偏移信息（高位优先），剩余的一个字节为区块的长度（也在4KB区段中，四舍五入）。区块的总大小最大为1MB。如果区块并未包含在所对应的区域文件中（如该区块还未生成或还未迁移），则该部分会全部为零。\n字节0123描述偏移区段数\n偏移为2的区块会在世界戳列表结束后开始。区块的时间戳\n时间戳列表的入口地址为独立的四字节高位优先的整值变量，代表了该区块的最后修改时间。\n字节0123描述时间戳\n区块数据\n区块数据以一个长度为四字节的（高位优先的）数据开头，代表了区块以字节计的实际大小。之后的字节表示区块数据的压缩方法。剩余的一字节为压缩的区块数据。\n字节012345...描述长度（以字节计）压缩类型压缩后的数据（长度为1字节）\n当前有两种压缩方法：数值方法1GZip (RFC1952) （在实际中未得到应用）2Zlib (RFC1950)\n如果您倾向于使用Deflate(RFC1951)阅读使用Zlib算法压缩后的区块数据，请跳过前两个字节，并在解压缩之前留下最后四个字节。未经压缩的数据已NBT格式进行保存，详细的信息请参见区块格式词条页面。如果使用第一种压缩算法，压缩后的文件与Alpha区块文件的磁盘目录相同。值得注意的是在官方客户端中使用的是第2种压缩算法。数据迁移与level.dat\n\nMinecraft在转换至新版本时的界面样子。\n\n在Beta1.3中会在载入世界之前将任何\"较早\"版本的区块转换至区域文件之中，而不是在随着游戏的进行逐渐进行转换。在转化的过程中，level.dat会更新TAG_Int(\"version(版本)\")至19132版本。Beta1.3同时也引入了一种新的世界命名空间，TAG_String(\"LevelName\")。也引入了在玩家复合标签（TAG_Compounds），（单人游戏为level.dat，多人游戏为[playername].dat）中新的标签，TAG_Byte(\"Sleeping\")，这一标签用于确定玩家是否在睡觉。其值非真(1)即假(0)。在版本beta 1.8中添加了TAG_Int(\"GameType\")；在版本beta1.9中添加了TAG_byte(\"hardcore\")。在level.dat中的其他部分未作改变。\n另见世界格式区块格式铁砧文件格式\n\n外部链接Mojang announcement of new region formatMcRegionScaevolus according McRegionJeb helping tool-makersRegionFile in JavaRegionFileCache in Java\n另见↑ http://www.minecraftforum.net/viewtopic.php?f=25&t=120160&start=510#p2619453↑ http://www.pcgamer.com/2011/02/09/minecraft-dev-diary-new-block-magic-fiddles/\n\n下一篇翻译Anvil文件格式~区块格式被御坂美琴同学抢走了%>_<%\n↑算了,还是不翻译了;不懂得他们内部的命名规则。",
    "replies": [
        {
            "author": "58083408",
            "timestamp": 1353558120,
            "txt_content": "看不懂的说"
        },
        {
            "author": "2451125564",
            "timestamp": 1353558180,
            "txt_content": "同上         "
        },
        {
            "author": "zjy",
            "timestamp": 1353560580,
            "txt_content": "好像很厉害的样子"
        },
        {
            "author": "jianghr",
            "timestamp": 1353665340,
            "txt_content": "区域文件被Anvil文件格式所取代；但是铁砧文件格式只对区块格式做出修改，另见世界格式区块格式铁砧文件格式\n\n“anvil”这里应该是不需要翻译的，此处我怀疑你机翻可能。\n=======\n炮姐同志开始填区块格式的坑了，那个真叫小众和技术性的条目。\n\n"
        }
    ]
}