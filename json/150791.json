{
    "title": "[Pocketmine]投票踢出插件",
    "author": "|NAT",
    "replyCount": 14,
    "timestamp": 1375146480,
    "txt_content": "还没有在多人联机测试 不知道是否有BUG \n/startvote <Player>来发起对一个玩家的投票 \n/vote <Player>来投票,当票数超过在线人数的一半时，玩家会被踢出.(退出玩家的投票将撤销)\n<?php\n/*\n__PocketMine Plugin__\nname=VoteKick\ndescription=Vote to kick a player\nversion=0.2\nauthor=NAT\nclass=VoteKick\napiversion=9\n*/\n//NOTICE : This plugins is STILL IN DEBUG .\n\nclass VoteKick implements Plugin{\n        private $api,$server;\n        public function __construct(ServerAPI $api, $server = false){\n                $this->api = $api;\n                $this->server = ServerAPI::request();\n        }\n        public function init(){\n                $this->api->console->register(\"startvote\", \"<player>\", array($this, \"handleCommand\"));\n                $this->api->console->register(\"vote\",\"<player>\", array($this, \"handleCommand\"));\n                $this->server->api->ban->cmdWhitelist(\"vote\");\n                $this->server->api->ban->cmdWhitelist(\"startvote\");\n                $this->api->addHandler(\"player.quit\", array($this, \"handler\"), 5);\n                $this->voting=0;\n        }\n        public function __destruct(){\n        }\n        public function handler(&$data, $event){\n                switch($data){\n                    case \"player.quit\":\n                       for($k=1;$k=$this->volting;$k++){\n                         if($this->canvote1[$data->iusername][$this->vote[$k][1]]==\"false\"){\n                        $this->vote[$k][1]=$this->vote[$k][1]-1;\n                        $this->canvote1[$data->iusername][1]==\"\";\n                        }\n                     }\n                }\n        }\n        public function handleCommand($cmd, $arg ,$issuer , $alias){\n                \n                switch($cmd){\n                case \"startvote\":\n                        $this->newvote(array_shift($arg));\n                        break;\n                case \"vote\":\n                        $this->vote(array_shift($arg));\n                        break;\n                }\n                return $this->output;\n        }\n        public function canvote($name,$tovote){\n                if(empty($this->canvote1[$name][$tovote])){\n                        $this->canvote1[$name][$tovote]=\"false\";\n                        return true;\n                }else{\n                        return false;\n                }\n        }        \n        public function isonline($totest){\n                        $player = $this->api->player->get($totest);\n                        if(!$player){\n                                return false;\n                        }\n                        return true;\n        }\n        public function invote($tovote)\n        {\n                $invote=false;\n                if($this->voting!=0){\n                for($i=1;$i=$this->voting;$i++){\n                        if($this->vote[$i][1]=$tovote){\n                                $this->tmp=$i;\n                                $invote=true;\n                                break;\n                                }\n                        }\n                }\n                return $invote;\n        }\n        public function newvote($tovote){\n                if(empty($tovote)){\n                        $this->output=\"Usage : /startvote <player> (start a vote to kick someone)\";\n                        return 0;\n                        }\n                if($this->invote($tovote)||!$this->isonline($tovote))\n                {\n                        $this->output=\"Error During Try to start vote,Player might not online or already in vote.\";\n                }else{\n                        $this->api->chat->broadcast(\"Voting to kick \".$tovote.\" Using /vote \".$tovote.\" to vote it.\");\n                        $this->voting=$this->voting+1;\n                        $this->vote[$this->voting][1]=$tovote;\n                        $this->vote[$this->voting][2]=1;\n                }\n        }\n        public function vote($tovote){\n                if(empty($tovote)) {\n                        $this->output=\"Usage : /vote <player> (vote to kick someone)\";\n                        return 0;\n                        }\n                if(!$this->invote($tovote)||!$this->isonline($tovote)||!$this->canvote($issuer,$tovote)){\n                        $this->snd(\"Error During Try to vote,Player might not online, isn't in vote , you has voted or running command from console\");\n                        return 0;\n                }else{\n                        $this->output=\"Vote to kick Player \".$tovote.\" Successful!\";\n                        $this->vote[$this->tmp][2]=$vote[$this->tmp][2]+1;\n                }\n                if($this->vote[$this->tmp][2]>count($this->clients)/2)\n                {\n                        $player = $this->api->player->get($tovote);\n                        $this->api->chat->broadcast($tovote.\" has been kicked by voting\");\n                        $player->close(\"You has been vote to kick\");\n                }\n        }\n}\n?>复制代码复制代码,存到VoteKick.php,然后放入/plugins\n",
    "replies": [
        {
            "author": "a992199857",
            "timestamp": 1375146660,
            "txt_content": "这不是穿越前列腺里的东西么"
        },
        {
            "author": "ever-lose",
            "timestamp": 1375149060,
            "txt_content": "让我找一个可怜的路人甲来试验一下"
        },
        {
            "author": "|NAT",
            "timestamp": 1375159380,
            "txt_content": "用了的人给些反馈好么?OvO"
        },
        {
            "author": "ljyloo",
            "timestamp": 1375191900,
            "txt_content": "发布了啊=w=，来支持一个\nps:近段时间我的口算能力飞速提升，为何？"
        },
        {
            "author": "|NAT",
            "timestamp": 1375234200,
            "txt_content": "ljyloo 发表于 2013-7-30 21:45 \n发布了啊=w=，来支持一个\nps:近段时间我的口算能力飞速提升，为何？\n{:10_492:}神奇的mcbbs适合练习口算"
        },
        {
            "author": "TylrDrdn",
            "timestamp": 1375237980,
            "txt_content": " 本帖最后由 TylrDrdn 于 2013-7-31 11:38 编辑 \n\n看代码貌似没有对管理员的保护啊。。"
        },
        {
            "author": "haixing",
            "timestamp": 1375238460,
            "txt_content": "|NAT 发表于 2013-7-31 09:30 \n神奇的mcbbs适合练习口算\n+1008611..."
        },
        {
            "author": "|NAT",
            "timestamp": 1375238880,
            "txt_content": "TylrDrdn 发表于 2013-7-31 10:33 \n看代码貌似没有对管理员的保护啊。。\n正确w\n咱要民主233333"
        },
        {
            "author": "西瓜太郎",
            "timestamp": 1383739320,
            "txt_content": "……为什么不是php文件→_→"
        },
        {
            "author": "raysuperman",
            "timestamp": 1389799440,
            "txt_content": "用不着这么开源吧。。"
        },
        {
            "author": "zuliyixing",
            "timestamp": 1393175760,
            "txt_content": "确实用不着"
        },
        {
            "author": "wqp2004",
            "timestamp": 1473049620,
            "txt_content": "222222222222222222222222222222222222"
        },
        {
            "author": "wqp2004",
            "timestamp": 1473050100,
            "txt_content": "66666666666666666666666666666666666"
        },
        {
            "author": "Deng1256",
            "timestamp": 1475416200,
            "txt_content": "挖坟2333333333333333333333333333"
        }
    ]
}