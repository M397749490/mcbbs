{
    "title": "如何解决回收内存时造成的卡顿",
    "author": "喵",
    "replyCount": 9,
    "timestamp": 1588078200,
    "txt_content": "如题所示，服务器/gc可以查看空闲内存\n但是服务器每秒都会消耗几百M的内存，然后服务端就会回收内存\n但是回收内存回造成全服的卡顿，请问如何解决\n版本是1.12.2，cat端",
    "replies": [
        {
            "author": "阴阳师元素祭祀",
            "timestamp": 1588078260,
            "txt_content": "你在想peach\n内存回收不可避\n你可以\n>增大总分配内存 减少内存两次回收周期\n>使用并行的垃圾收集器 尽量减少stop world代理的影响\n>看看是什么mod 每秒能吃200+MB\n>关服保_平_安\n_(你其他信息呢\n\n还有 茶馆举报处理下"
        },
        {
            "author": "EmptyLava",
            "timestamp": 1588079880,
            "txt_content": " 本帖最后由 EmptyLava 于 2020-4-28 21:25 编辑 \n\n增大Xmx是最好用的\n内存回收不可避免，如果你绕过gc，总有一天会内存溢出/内存泄露的\n另外你能确定是内存回收导致的卡顿?不如spark采样看看"
        },
        {
            "author": "暮城",
            "timestamp": 1588086780,
            "txt_content": "试试将Xmx和Xms设置成一样的大小，强分内存给服务端。\n另外，提升内存频率可以非常有效的提高运行效率"
        },
        {
            "author": "炫宙菌",
            "timestamp": 1588087380,
            "txt_content": "Aikar对于1.15优化参数的补充\n2020.4.20他做出的回复\n\n告诉大家，1.15在性能上做了很多改善，并且发现了我的以前一些设置项(Flag)的问题\n几周前，我开始调整这些设置项来解决这个问题，并进一步优化它们，并且做了大量的测试\n一个多星期以来，我们在最新的一组设置项上保持服务器允许稳定，并且每个使用者都感到了巨大的改进\n现在，为了改进Minecraft最新版本Java的GC，需要使用这些设置项\n请参见https://mcflags.emc.gs\n是的，这些设置项仍然适用于旧版本的MC,甚至在旧版本效果更好。旧版本中的缺陷不会受到太大的影响，而且新版本设置也无需担心！这些新参数可以降低GC回收的间隔时间\n许多服务器已经开始切换新的启动参数，一些MC服务商(Hosts)甚至正在帮助服主设置它们\n一些MC服务商甚至告诉我它可以节省CPU使用：）\n另外，从所有的GC研究中发现，很多人都在更新版本的Java来使用ZGC。我的建议是避免使用ZGC,除非你满足两个条件:\n1）版本为Java 14+，\n2）至少有15-20GB的最大内存(分配给Xmx)\n如果你在内存上低于这个值，就像大多数服务器一样，ZGC最终会破坏你的性能!\n即使有人吹捧它可以减少延迟,那都是骗人的鬼话\n如果您想知道更多，可以到Discord论坛询问或查找关键词“ZGC Allocation Stall”\n原话:\nFYI everyone, 1.15 did a number on performance, and uncovered an issue with my old flag set.\n\nA few weeks ago I started tweaking the flags to fix that issue and optimize them even more, and did a lot of beta testing.\n\nWe've been stable on the latest set of flags for over a week now, and has shown massive improvement for everyone using them.\n\nThese flags are now pretty much required to improve the GC of Java for Minecraft's latest versions.\n\nsee https://mcflags.emc.gs\n\nAnd yes, these flags still work on older versions of MC! And will do even better there. The flaw in the old set did not get hit at all much on the older versions, but the new set will remove all worry, as well as lower GC pause times.\n\nLots of servers have started switching, as well as some MC Hosts are even helping set them up now.\nSome MC Hosts have even told me it is saving them on CPU usage too\n\nAlso, from all the GC research again, a lot of people have been evaluating ZGC in newer Java. My recommendation is to avoid ZGC unless you are both: 1) On Java 14, and 2) Have at least 15-20GB of memory given to Xmx.\n\nIf you are lower than that on memory, like most servers are, ZGC will end up destroying your performance, even when it says it has low pauses, the pause information is deceptive. If you're curious to know more, ask on Discord or look up \"ZGC Allocation Stall\"\n\n该参数:The JVM 启动参数 – MC 1.15 更新准确使用这些设置, 只更改 Xmx 和 Xms. 这些设置可以根据任何大小的内存（甚至只有500MB）下运行且自行调整java -Xms10G -Xmx10G -XX:+UseG1GC -XX:+ParallelRefProcEnabled -XX:MaxGCPauseMillis=200 -XX:+UnlockExperimentalVMOptions -XX:+DisableExplicitGC -XX:-OmitStackTraceInFastThrow -XX:+AlwaysPreTouch  -XX:G1NewSizePercent=30 -XX:G1MaxNewSizePercent=40 -XX:G1HeapRegionSize=8M -XX:G1ReservePercent=20 -XX:G1HeapWastePercent=5 -XX:G1MixedGCCountTarget=8 -XX:InitiatingHeapOccupancyPercent=15 -XX:G1MixedGCLiveThresholdPercent=90 -XX:G1RSetUpdatingPauseTimePercent=5 -XX:SurvivorRatio=32 -XX:MaxTenuringThreshold=1 -Dusing.aikars.flags=true -Daikars.new.flags=true -jar 核心文件名.jar nogui\n上次更新: Apr 06 2020 3:30PM EST\n注意: 这些设置还在测试阶段。如果遇到旧一代的GC问题，请到Paper的Discord界面反馈\n我最后一次设置1.15中效果尤其明显。这些设置在Java 8和Java 11(JDK11)上都有效!!!\n这些设置仍然推荐老版本MC1.8-1.15+使用\n以上参数确实有用,我在1.14使用后直接解决了大量玩家进服时线程卡死问题\n\n\n以上参数涉及回收内存,1.14+不要使用ZGC\n内存没法不回收 或许可以让内存回收更频繁 Aikar提供的启动参数可能有用"
        },
        {
            "author": "yuan_kun",
            "timestamp": 1588089780,
            "txt_content": "如果你服务器内存很高 可以吧回收区块关了\n玩家跑图 加载区块加回收区块 \n在加上玩家的tick 实体  tps会严重下降\n要不就是给世界设置边界 \n"
        },
        {
            "author": "supermiao",
            "timestamp": 1588091640,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "Redstone_ray",
            "timestamp": 1588097340,
            "txt_content": "炫宙菌 发表于 2020-4-28 23:23\nAikar对于1.15优化参数的补充\n2020.4.20他做出的回复\n评分没显示完整\nAikar这个参数我感觉并不是每个服务器都适用\n小一点的生存服还好\n插件多起来的话，或者mod服很容易造成回收之间的卡顿"
        },
        {
            "author": "小张up",
            "timestamp": 1588124820,
            "txt_content": "建议修改启动参数，站内有教程【或者关服跑路】"
        },
        {
            "author": "TheoldFarmer",
            "timestamp": 1588182600,
            "txt_content": "减少回收次数，增大内存，定期重启服务器为最好的解决方法"
        }
    ]
}