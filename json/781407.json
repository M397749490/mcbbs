{
    "title": "[Macro/Keybind Mod]聊天信息处理",
    "author": "yhr",
    "replyCount": 4,
    "timestamp": 1518474660,
    "txt_content": " 本帖最后由 yhr 于 2018-4-8 07:09 编辑 \n\n此教程不是为Macro新人准备的，我将假设阅读的各位已经有关于Macro Mod脚本的基础知识没有相关基础的人，可以去看我的Mod发布帖，http://www.mcbbs.net/thread-775087-1-1.html\n\n\n第一部分-和处理文字相关的事件在“宏绑定-事件”的选项中，我们可以看到有两个和聊天相关的事件,分别是onChat和onSendChatMessage。这两个事件中，onChat用于处理接收到的聊天信息，onSendChatMessage用于处理发出的聊天信息。这两个事件都可以通过CHAT变量在事件中获取信息，但是要注意的是，即使是自己发出的信息，两个事件获取到的信息是有差别的，例如我在两个事件中分别绑定如下代码：\nonChat:\nLOG(\"onchat:&f%CHAT%\");复制代码onSendChatMessage:\nLOG(\"onsend:&f%CHAT%\");复制代码\n效果如下：\n\n\n\n\nSnipaste_2018-02-11_20-50-44.png (9.48 KB, 下载次数: 6)\n\n下载附件\n\n2018-2-13 06:30 上传\n\n\n\n\n\n可以看到两个信息中的CHAT变量内容是不同的，因为发出的信息已经被服务器编辑过了，在想要对信息进行检测的时候尤其需要注意。\n\n第二部分-聊天过滤器\n\n聊天过滤器是这个mod一个相当实用的功能，虽然说这个功能本身非常简单，我在论坛上也看见其它同样功能的mod，但是它的强大之处在于它不仅仅是过滤文本，配合脚本还可以实现和其它脚本以及自定义gui的互动。\n在这里先不提其它的功能，专注于过滤功能本身。\n想要编辑聊天过滤器，在打开编辑宏绑定的界面后，点击左上角的图标，在弹出的菜单里面就可以找到“编辑聊天过滤器”\n\n\n\n\nSnipaste_2018-02-12_16-40-05.png (5.98 KB, 下载次数: 0)\n\n下载附件\n\n2018-2-13 06:42 上传\n\n\n\n\n\n打开后大概是一个像是Macro文本编辑器的界面，在这里写的脚本就会在每次收到聊天信息的时候被执行。\n\n这里有两个特别的命令可以使用，分别是FILTER()和PASS()，都是无参数的，FILTER()表示这条信息将会被过滤掉，这样一来你就像是从来没收到这条信息，PASS()则会标记这条信息为通过。事实上如果执行到脚本结尾都还没有执行到FILTER或PASS的话这条信息将会自动通过。\n例：（如果@f全局变量为真，则过滤掉所有信息）\nIF(@f);\nFILTER();\nENDIF;复制代码\n注意：在这里写的脚本将会比onChat事件先执行，这也意味着如果在这里信息就被过滤掉的话onChat事件并不会被呼叫。\n\n第三部分-文字内容判断\n\n相信在处理文本的时候根据文本的内容进行判断是相当有用的功能，于是Macro提供了四个对文本内容进行判断的方法，分别是IFBEGINSWITH, IFENDWITH, IFCONTAINS和IFMATCHES,这里首先介绍最简单的IFCONTAINS,它的用法是这样的：\nIFCONTAINS(<目标>,<条件>);复制代码这个语句在脚本中用来代替IF。在使用时也和IF类型，需要搭配ELSE,ELSEIF以及ENDIF语句使用，举个例子：\n<div>IFCONTAINS(\"abcdefg\",\"cde\");</div><div>LOG(\"true\");</div><div>ELSE;</div><div>LOG(\"false\");</div><div>ENDIF;</div>复制代码这个例子运行后会发出一个true\n这个时候，结合变量：\nIFCONTAINS(%CHAT%,\"hi\");复制代码在onChat事件或者说聊天过滤器里使用这个判断，便可以在收到的信息中含有hi的时候执行一个脚本了。\nIFBEGINSWITH和IFENDSWITH用法都和IFCONTAINS类似，不过指明了只匹配开头和结尾处。\n\n对于有进阶需求的人，可以使用IFMATCHES,语法和IFCONTAINS类似，不过这里匹配的条件使用的是正则表达式，只要文本中有一处匹配便会视为条件达成，正则表达式的教程在这里就不展开了，请自行百度。同时，据测试匹配不支持中文，想要匹配中文的人，请使用正则表达式的unicode转码，例：\nIFMATCHES(%CHAT%,\"\\u4f60\\u597d\");复制代码这个语句会匹配所有含有“你好”二字的消息。\n\n第四部分-关于彩色文本的处理\n\nMacros对于MC的彩色文本提供了非常好的支持，只要是不发到服务器的消息（ECHO），只需要使用“&”就可以像使用“§”一样的做出颜色代码，例如：\nLOG(\"&00&11&22&33&44&55&66&77&88&99&aa&bb&cc&dd&ee&ff\");复制代码效果如下：\n\n\n\n\nSnipaste_2018-02-12_17-43-00.png (2.29 KB, 下载次数: 4)\n\n下载附件\n\n2018-2-13 07:45 上传\n\n\n\n\n\n\n\n这里提到的是给文字使用颜色代码加上颜色，但是有的时候服务器发来的文本里面如果有样式代码却会给我们带来麻烦，因为颜色代码虽然不会显示出来，但是在尝试匹配的时候却会卡在字与字之间，影响判断。对此Macro也提供了解决办法，就是STRIP语句，用法如下：\nSTRIP(<&目标>,<文本>);复制代码这个语句将会去掉“文本”中的所有样式代码，并将结果存储于“&目标”中，举个例子：\nonChat:\nSTRIP(\"&message\",%CHAT%);\nLOG(%&message%);复制代码测试结果：\n\n\n\n\nSnipaste_2018-02-12_18-02-01.png (20.56 KB, 下载次数: 8)\n\n下载附件\n\n2018-2-13 08:03 上传\n\n\n\n\n\n至于输出的颜色是LOG语句的默认设定，事实上&message变量中存的内容已经是没有格式代码的了。\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "todomaru",
            "timestamp": 1533355500,
            "txt_content": " 本帖最后由 todomaru 于 2018-8-4 12:17 编辑 \n\n应该怎么向服务器发送中文？试了Unicode好像不行\n===================================\n好吧解决了。。只要在\\.minecraft\\liteconfig\\common\\macros\n里面直接编辑脚本的文本文件，输入中文，就可以了。不要在游戏内编辑"
        },
        {
            "author": "todomaru",
            "timestamp": 1533358260,
            "txt_content": "如何获取服务器输出的文本内容并判断？\n我目前写的判断条件只能对玩家说的文本内容生效"
        },
        {
            "author": "yhr",
            "timestamp": 1533526620,
            "txt_content": "todomaru 发表于 2018-8-4 12:51\n如何获取服务器输出的文本内容并判断？\n我目前写的判断条件只能对玩家说的文本内容生效 ...\n请问服务器输出的文本是指什么？\n按道理说所有从服务器发过来的聊天信息都应该会被捕捉到的？"
        },
        {
            "author": "1719027558",
            "timestamp": 1581227100,
            "txt_content": "有没有办法获取发送消息者的ID?"
        }
    ]
}