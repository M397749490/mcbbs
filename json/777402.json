{
    "title": "Towny接MySQL大面积操作崩溃",
    "author": "黄总",
    "replyCount": 3,
    "timestamp": 1517107800,
    "txt_content": "使用的是Towny插件,用MySQL储存数据，使用/town unclaim all指令后服务端奔溃，大概是一次撤销500个区块，算是大面积操作。\n后台报错在下面，MYSQL使用的默认设置，可能是线程什么的不够用，请大佬看看。\n\n\n[10:44:38 ERROR]: The server has stopped responding!\n[10:44:38 ERROR]:               java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n[10:44:38 ERROR]:               java.lang.Thread.run(Thread.java:748)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Thread-6\n[10:44:38 ERROR]:       PID: 24 | Suspended: false | Native: true | State: RUNNABLE\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               sun.nio.fs.LinuxWatchService.poll(Native Method)\n[10:44:38 ERROR]:               sun.nio.fs.LinuxWatchService.access$600(LinuxWatchService.java:47)\n[10:44:38 ERROR]:               sun.nio.fs.LinuxWatchService$Poller.run(LinuxWatchService.java:314)\n[10:44:38 ERROR]:               java.lang.Thread.run(Thread.java:748)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Netty Epoll Server IO #0\n[10:44:38 ERROR]:       PID: 23 | Suspended: false | Native: true | State: RUNNABLE\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               io.netty.channel.epoll.Native.epollWait0(Native Method)\n[10:44:38 ERROR]:               io.netty.channel.epoll.Native.epollWait(Native.java:114)\n[10:44:38 ERROR]:               io.netty.channel.epoll.EpollEventLoop.epollWait(EpollEventLoop.java:235)\n[10:44:38 ERROR]:               io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:252)\n[10:44:38 ERROR]:               io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886)\n[10:44:38 ERROR]:               java.lang.Thread.run(Thread.java:748)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Spigot Metrics Thread\n[10:44:38 ERROR]:       PID: 22 | Suspended: false | Native: false | State: TIMED_WAITING\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               java.lang.Object.wait(Native Method)\n[10:44:38 ERROR]:               java.util.TimerThread.mainLoop(Timer.java:552)\n[10:44:38 ERROR]:               java.util.TimerThread.run(Timer.java:505)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Spigot Watchdog Thread\n[10:44:38 ERROR]:       PID: 21 | Suspended: false | Native: false | State: RUNNABLE\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               sun.management.ThreadImpl.dumpThreads0(Native Method)\n[10:44:38 ERROR]:               sun.management.ThreadImpl.dumpAllThreads(ThreadImpl.java:454)\n[10:44:38 ERROR]:               org.spigotmc.WatchdogThread.run(WatchdogThread.java:76)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Server console handler\n[10:44:38 ERROR]:       PID: 19 | Suspended: false | Native: true | State: RUNNABLE\n[10:44:38 ERROR]:       Thread is waiting on monitor(s):\n[10:44:38 ERROR]:               Locked on:java.io.BufferedInputStream.read(BufferedInputStream.java:265)\n[10:44:38 ERROR]:               Locked on:org.bukkit.craftbukkit.libs.jline.internal.NonBlockingInputStream.read(NonBlockingInputStream.java:169)\n[10:44:38 ERROR]:               Locked on:org.bukkit.craftbukkit.libs.jline.internal.InputStreamReader.read(InputStreamReader.java:261)\n[10:44:38 ERROR]:               Locked on:org.bukkit.craftbukkit.libs.jline.internal.InputStreamReader.read(InputStreamReader.java:198)\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               java.io.FileInputStream.readBytes(Native Method)\n[10:44:38 ERROR]:               java.io.FileInputStream.read(FileInputStream.java:255)\n[10:44:38 ERROR]:               java.io.BufferedInputStream.fill(BufferedInputStream.java:246)\n[10:44:38 ERROR]:               java.io.BufferedInputStream.read(BufferedInputStream.java:265)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.NonBlockingInputStream.read(NonBlockingInputStream.java:169)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.NonBlockingInputStream.read(NonBlockingInputStream.java:137)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.NonBlockingInputStream.read(NonBlockingInputStream.java:246)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.InputStreamReader.read(InputStreamReader.java:261)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.InputStreamReader.read(InputStreamReader.java:198)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.console.ConsoleReader.readCharacter(ConsoleReader.java:2145)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.console.ConsoleReader.readLine(ConsoleReader.java:2349)\n[10:44:38 ERROR]:               net.minecraft.server.v1_12_R1.DedicatedServer$2.run(DedicatedServer.java:85)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Thread-4\n[10:44:38 ERROR]:       PID: 20 | Suspended: false | Native: false | State: RUNNABLE\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               java.lang.UNIXProcess.forkAndExec(Native Method)\n[10:44:38 ERROR]:               java.lang.UNIXProcess.<init>(UNIXProcess.java:247)\n[10:44:38 ERROR]:               java.lang.ProcessImpl.start(ProcessImpl.java:134)\n[10:44:38 ERROR]:               java.lang.ProcessBuilder.start(ProcessBuilder.java:1029)\n[10:44:38 ERROR]:               java.lang.Runtime.exec(Runtime.java:620)\n[10:44:38 ERROR]:               java.lang.Runtime.exec(Runtime.java:485)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.TerminalLineSettings.exec(TerminalLineSettings.java:196)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.TerminalLineSettings.exec(TerminalLineSettings.java:186)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.TerminalLineSettings.stty(TerminalLineSettings.java:181)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.TerminalLineSettings.get(TerminalLineSettings.java:74)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.TerminalLineSettings.getProperty(TerminalLineSettings.java:95)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.UnixTerminal.getWidth(UnixTerminal.java:76)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.console.ConsoleReader.drawBuffer(ConsoleReader.java:879)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.console.ConsoleReader.drawBuffer(ConsoleReader.java:898)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.console.ConsoleReader.drawLine(ConsoleReader.java:608)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.v1_12_R1.util.TerminalConsoleWriterThread.run(TerminalConsoleWriterThread.java:40)\n[10:44:38 ERROR]:               java.lang.Thread.run(Thread.java:748)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: DestroyJavaVM\n[10:44:38 ERROR]:       PID: 18 | Suspended: false | Native: false | State: RUNNABLE\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Server thread\n[10:44:38 ERROR]:       PID: 16 | Suspended: false | Native: false | State: RUNNABLE\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               java.io.FileInputStream.read0(Native Method)\n[10:44:38 ERROR]:               java.io.FileInputStream.read(FileInputStream.java:207)\n[10:44:38 ERROR]:               java.io.DataInputStream.readInt(DataInputStream.java:389)\n[10:44:38 ERROR]:               com.palmergames.bukkit.towny.db.TownyFlatFileSource.loadPlotData(TownyFlatFileSource.java:2331)\n[10:44:38 ERROR]:               com.palmergames.bukkit.towny.regen.TownyRegenAPI.getPlotChunkSnapshot(TownyRegenAPI.java:190)\n[10:44:38 ERROR]:               com.palmergames.bukkit.towny.db.TownyDatabaseHandler.removeTownBlock(TownyDatabaseHandler.java:341)\n[10:44:38 ERROR]:               com.palmergames.bukkit.towny.db.TownyDatabaseHandler.removeTownBlocks(TownyDatabaseHandler.java:356)\n[10:44:38 ERROR]:               com.palmergames.bukkit.towny.tasks.TownClaim$2.run(TownClaim.java:231)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.v1_12_R1.scheduler.CraftTask.run(CraftTask.java:71)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.v1_12_R1.scheduler.CraftScheduler.mainThreadHeartbeat(CraftScheduler.java:353)\n[10:44:38 ERROR]:               net.minecraft.server.v1_12_R1.MinecraftServer.D(MinecraftServer.java:739)\n[10:44:38 ERROR]:               net.minecraft.server.v1_12_R1.DedicatedServer.D(DedicatedServer.java:406)\n[10:44:38 ERROR]:               net.minecraft.server.v1_12_R1.MinecraftServer.C(MinecraftServer.java:679)\n[10:44:38 ERROR]:               net.minecraft.server.v1_12_R1.MinecraftServer.run(MinecraftServer.java:577)\n[10:44:38 ERROR]:               java.lang.Thread.run(Thread.java:748)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Server Infinisleeper\n[10:44:38 ERROR]:       PID: 17 | Suspended: false | Native: false | State: TIMED_WAITING\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               java.lang.Thread.sleep(Native Method)\n[10:44:38 ERROR]:               net.minecraft.server.v1_12_R1.DedicatedServer$1.run(DedicatedServer.java:60)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: NonBlockingInputStreamThread\n[10:44:38 ERROR]:       PID: 14 | Suspended: false | Native: false | State: WAITING\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               java.lang.Object.wait(Native Method)\n[10:44:38 ERROR]:               org.bukkit.craftbukkit.libs.jline.internal.NonBlockingInputStream.run(NonBlockingInputStream.java:278)\n[10:44:38 ERROR]:               java.lang.Thread.run(Thread.java:748)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Snooper Timer\n[10:44:38 ERROR]:       PID: 12 | Suspended: false | Native: false | State: TIMED_WAITING\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               java.lang.Object.wait(Native Method)\n[10:44:38 ERROR]:               java.util.TimerThread.mainLoop(Timer.java:552)\n[10:44:38 ERROR]:               java.util.TimerThread.run(Timer.java:505)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: process reaper\n[10:44:38 ERROR]:       PID: 8 | Suspended: false | Native: false | State: TIMED_WAITING\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               sun.misc.Unsafe.park(Native Method)\n[10:44:38 ERROR]:               java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)\n[10:44:38 ERROR]:               java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)\n[10:44:38 ERROR]:               java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)\n[10:44:38 ERROR]:               java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)\n[10:44:38 ERROR]:               java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)\n[10:44:38 ERROR]:               java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)\n[10:44:38 ERROR]:               java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n[10:44:38 ERROR]:               java.lang.Thread.run(Thread.java:748)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Signal Dispatcher\n[10:44:38 ERROR]:       PID: 4 | Suspended: false | Native: false | State: RUNNABLE\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Finalizer\n[10:44:38 ERROR]:       PID: 3 | Suspended: false | Native: false | State: WAITING\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               java.lang.Object.wait(Native Method)\n[10:44:38 ERROR]:               java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)\n[10:44:38 ERROR]:               java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)\n[10:44:38 ERROR]:               java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)\n[10:44:38 ERROR]: ------------------------------\n[10:44:38 ERROR]: Current Thread: Reference Handler\n[10:44:38 ERROR]:       PID: 2 | Suspended: false | Native: false | State: WAITING\n[10:44:38 ERROR]:       Stack:\n[10:44:38 ERROR]:               java.lang.Object.wait(Native Method)\n[10:44:38 ERROR]:               java.lang.Object.wait(Object.java:502)\n[10:44:38 ERROR]:               java.lang.ref.Reference.tryHandlePending(Reference.java:191)\n[10:44:38 ERROR]:               java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)\n[10:44:38 ERROR]: ------------------------------\n\n以上是完整报错内容\n",
    "replies": [
        {
            "author": "969592505@qq.co",
            "timestamp": 1517115000,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "黄总",
            "timestamp": 1517131020,
            "txt_content": "969592505@qq.co 发表于 2018-1-28 12:50\n就是线程的问题，你一次操作的数据太大了。貌似有部分线程操作死锁。\n没用过这个插件，不推荐大数量区块同 ...\n我使用了MySQL储存才出现这种情况的，MySQL用的是默认设置，请问MySQL要怎么设置才能提升线程使用效率？机子的配置应该是够的。"
        },
        {
            "author": "969592505@qq.co",
            "timestamp": 1517131380,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽\n"
        }
    ]
}