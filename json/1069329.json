{
    "title": "[施工中][月更]用Kotlin开发Fabric mod",
    "author": "squid233",
    "replyCount": 0,
    "timestamp": 1593350100,
    "txt_content": " 本帖最后由 squid233 于 2020-6-29 19:12 编辑 \n\n本教程将教您如何用Kotlin开发Fabric mod。在开始前，请确保您已有Kotlin基础。本教程将以官方教程为基础。\n制作的mod需要Fabric Language Kotlin作为前置。\n请记住：把所有“modid”都替换成您的mod的ID。\n如果有不懂的可以加群询问：1078745269\n本教程所有源码均发布至GitHub。\n\n在开始前，您需要先下载JDK以及IDE。这里推荐使用Intellij IDEA。\n之后，您需要下载提供的示例mod。这里有我设置好版本的示例mod。\n现在，您需要手动设置一些东西。编辑gradle.properties：\n设置archives_base_name为mod名设置maven_group为io.github.GitHub用户名.modid手动更新版本——从这个网站查看最新版本\n接下来就差不多了。您只需要导入项目到IDEA中就可以了。IDEA会自动帮您构建项目，因此您不必担心。\n当构建完成后，关闭并重新打开项目以修复没有启动配置的问题。\n在此之前，我们假设您已经配置好了Kotlin SDK。\n将“username”修改成您在GitHub上的用户名，并把所有“modid”都替换成您的mod的ID，然后启动游戏。在“Run”面板中按下Ctrl+F搜索您mod的ID，如果成功搜索到，那么说明开发环境配置成功了。\n\n现在我们已经成功配置了开发环境。那么是时候该添加一个物品了。\n声明并注册一个物品后，您的代码应该像是下面这样的：\nimport net.minecraft.item.Item\nimport net.minecraft.item.ItemGroup\nimport net.minecraft.util.Identifier\nimport net.minecraft.util.registry.Registry\n\nclass ExampleMod {\n    companion object {\n        const val MODID = \"modid\"\n\n        val FABRIC_ITEM = Item(Item.Settings().group(ItemGroup.MISC))\n    }\n}\n\n@Suppress(\"unused\")\nfun init() {\n    Registry.register(Registry.ITEM, Identifier(ExampleMod.MODID, \"fabric_item\"), ExampleMod.FABRIC_ITEM)\n}复制代码这时通过“runClient”启动游戏，您应该会在杂项中看到一个紫黑的东西。接下来需要给物品添加材质。\n在.../resources/assets/modid/models/item/fabric_item.json中写入：{\n  \"parent\": \"item/generated\",\n  \"textures\": {\n    \"layer0\": \"modid:item/fabric_item\"\n  }\n}复制代码并把材质放到.../resources/assets/modid/textures/item/fabric_item.png\n注：示例贴图：\n随后，您应该能看到物品的材质了。\n为了方便管理和实现其它功能，我们需要创建一个物品类。该代码将实现右键点击发出羊毛声。\nimport net.minecraft.entity.player.PlayerEntity\nimport net.minecraft.item.Item\nimport net.minecraft.item.ItemStack\nimport net.minecraft.sound.SoundEvents\nimport net.minecraft.util.ActionResult\nimport net.minecraft.util.Hand\nimport net.minecraft.util.TypedActionResult\nimport net.minecraft.world.World\n\nclass FabricItem(settings: Settings) : Item(settings) {\n    override fun use(world: World?, user: PlayerEntity?, hand: Hand?): TypedActionResult<ItemStack> {\n        user?.playSound(SoundEvents.BLOCK_WOOL_BREAK, 1.0F, 1.0F)\n        return TypedActionResult<ItemStack>(ActionResult.SUCCESS, user?.getStackInHand(hand))\n    }\n}复制代码之后需要把物品声明替换成您的类：\nval FABRIC_ITEM = FabricItem(Item.Settings().group(ItemGroup.MISC))复制代码完成后，现在使用您的物品应该会发出声音了。\n当然，如果您的物品不是会损坏的，您也可以设置物品的最大堆叠数（就像鸡蛋，雪球一样）：val FABRIC_ITEM = FabricItem(Item.Settings().group(ItemGroup.MISC).maxCount(16))复制代码\n要想添加一个物品组，您只需要用FabricItemGroupBuilder：val ITEM_GROUP: ItemGroup = FabricItemGroupBuilder.build(\n     Identifier(MODID, \"general\")\n     ) { ItemStack(Blocks.COBBLESTONE) }\n\nval OTHER_GROUP: ItemGroup = FabricItemGroupBuilder.create(\n     Identifier(MODID, \"other\"))\n     .icon { ItemStack(Items.BOWL) }\n     .build()复制代码当您创建自定义物品时就可以用上了：val FABRIC_ITEM = FabricItem(Item.Settings().group(ITEM_GROUP).maxCount(16))复制代码您也可以使物品以特定顺序显示。\nval OTHER_GROUP: ItemGroup = FabricItemGroupBuilder.create(\n     Identifier(MODID, \"other\"))\n     .icon { ItemStack(Items.BOWL) }\n     .appendItems {\n                 s: MutableList<ItemStack>? ->\n           s?.add(ItemStack(Blocks.BONE_BLOCK))\n           s?.add(ItemStack(Items.APPLE))\n           s?.add(PotionUtil.setPotion(ItemStack(Items.POTION), Potions.WATER))\n           s?.add(ItemStack.EMPTY)\n           s?.add(ItemStack(Items.IRON_SHOVEL))\n      }\n      .build()复制代码对于第一个例子的完整的翻译密钥：itemGroup.modid.general\n\n要添加工具提示，只需重写appendTooltip方法：\noverride fun appendTooltip(\n        stack: ItemStack?,\n        world: World?,\n        tooltip: MutableList<Text>?,\n        context: TooltipContext?\n    ) {\n        tooltip?.add(TranslatableText(\"item.${ExampleMod.MODID}.fabric_item.tooltip\"))\n    }复制代码对于方块，在您的方块类里重写buildTooltip即可。\n\n\n是否注意到您的物品有一个奇 怪的名字？这是因为您的物品没有本地化。本地化允许您使同样的字符串显示不同的语言。\n您可以通过创建不同的语言文件来实现本地化。只要文件名对应语言代码即可。可以在这里查看所有的语言代码。\n以您的语言代码来命名语言文件。必须要含有英语翻译。对于英语语言文件的完整路径例子：resources/assets/tutorial/lang/en_us.json。\n一个普通的例子：{\n  \"item.modid.fabric_item\": \"Fabric Item\"\n}复制代码左边的字符串为翻译键或TranslatableText，右边的字符串为本地化后显示的文字。\n当您想要为一些东西添加可翻译文本，只需要使用TranslatableText(\"something\")，然后在语言文件中添加即可。{\n  \"item.modid.fabric_item.tooltip\": \"My Tooltip\"\n}复制代码当然您也可以添加可变值。用%d来表示它们。如果这个可变值是字符串则用%s代替。要显示%这个符号用%%。{\n  \"item.modid.fabric_item.tooltip\": \"My Tooltip in month %d, and day %d\"\n}复制代码在代码中如下：val currentMonth = LocalDateTime.now().monthValue\nval currentDay = LocalDateTime.now().dayOfMonth\ntooltip?.add(TranslatableText(\"item.${ExampleMod.MODID}.fabric_item.tooltip\", currentMonth, currentDay))复制代码现在我们希望能够显示多行的工具提示。\\n是不起效果的。因此，我们只需要多个工具提示翻译键就可以了。tooltip?.add(TranslatableText(\"item.${ExampleMod.MODID}.fabric_item.tooltip_1\", currentMonth, currentDay))\ntooltip?.add(TranslatableText(\"item.${ExampleMod.MODID}.fabric_item.tooltip_2\"))复制代码{\n  \"item.modid.fabric_item.tooltip_1\": \"My Tooltip in month %d, and day %d\",\n  \"item.modid.fabric_item.tooltip_2\": \"Line 2 of my tooltip\"\n}复制代码\n\n",
    "replies": []
}