{
    "title": "关于修复高级太阳能通过AEMOD的ME元件刷物品的解决方案",
    "author": "q513902026",
    "replyCount": 0,
    "timestamp": 1460520420,
    "txt_content": "如题 看到插件区的这个帖子 解决的似乎有点草率再加上服务器要求要通过插件修复这BUG的\n\n花了点时间写了一下解决逻辑 但是对于BC的管道没有好的办法解决 只能通过禁止BC管道放置在太阳能\n求大神来个更好的解决方案\n\n代码:public class ModListener extends BaseListener {\n    private static final String AEMODNAME = \"APPLIEDENERGISTICS2_\";\n    private ArrayList<String> banItemName = Lists.newArrayList();\n\n    public ModListener() {\n        super(\"ModListener\", \"0.1.0\");\n        banItemName.addAll(Arrays.asList(new String[] { AEMODNAME + \"ITEMITEMBASICSTORAGECELL64K\",\n                AEMODNAME + \"ITEMITEMSPATIALSTORAGECELL16CUBED\", AEMODNAME + \"ITEMITEMSPATIALSTORAGECELL128CUBED\",\n                AEMODNAME + \"ITEMITEMBASICSTORAGECELL16K\", AEMODNAME + \"ITEMITEMBASICSTORAGECELL1K\",\n                AEMODNAME + \"ITEMITEMSPATIALSTORAGECELL2CUBED\", AEMODNAME + \"ITEMITEMBASICSTORAGECELL4K\", }));\n    }\n\n    /**\n     * 用于阻止玩家把ME元件放入太阳能中\n     * \n     * @param event\n     */\n    @EventHandler\n    public void onInvOpenEvent(InventoryClickEvent event) {\n        if (event.getInventory().getName().equals(\"Advanced Solar Panel\")\n                && event.getInventory().getTitle().equals(\"Advanced Solar Panel\")) {\n            if (banItemName.contains(event.getCursor().getType().name())) {\n                if (event.getRawSlot() < 4 && event.getRawSlot() >= 0) {\n                    final InventoryView view = event.getView();\n                    BiliBS.getInstance().getServer().getScheduler().runTask(BiliBS.getInstance(), new BukkitRunnable() {\n                        @Override\n                        public void run() {\n                            view.close();\n\n                        }\n                    });\n                }\n            }\n        }\n    }\n\n    /**\n     * 用于阻止类似漏斗的方块向太阳能输送ME元件\n     * \n     * @param event\n     */\n    @EventHandler\n    public void onInvMoveItemEvent(InventoryMoveItemEvent event) {\n        if (event.getDestination().getName().equals(\"Advanced Solar Panel\")\n                && event.getDestination().getTitle().equals(\"Advanced Solar Panel\")) {\n            if (banItemName.contains(event.getItem().getType().name())) {\n                event.setCancelled(true);\n            }\n        }\n    }\n    /**\n     * 用于检测是否打开的太阳能的容器中是否存在ME元件\n     * @param event\n     */\n    @EventHandler\n    public void onInvOpenEvnt(InventoryOpenEvent event) {\n        if (event.getInventory().getName().equals(\"Advanced Solar Panel\")\n                && event.getInventory().getTitle().equals(\"Advanced Solar Panel\")) {\n            for (ItemStack itemStack : event.getInventory().getContents()) {\n                if (itemStack == null) {\n                    continue;\n                }\n                if (banItemName.contains(itemStack.getType().name())) {\n                    final InventoryView view = event.getView();\n                    BiliBS.getInstance().getServer().getScheduler().runTask(BiliBS.getInstance(), new BukkitRunnable() {\n                        @Override\n                        public void run() {\n                            view.close();\n                        }\n                    });\n                    return;\n                }\n\n            }\n        }\n    }\n\n    /**\n     * 用于检测管道的放置 防止管道向太阳能输送ME元件\n     * \n     * @param event\n     */\n    @EventHandler\n    public void onBlockPlaceEvent(BlockPlaceEvent event) {\n        if (event.getBlock().getType().name().equals(\"BUILDCRAFTTRANSPORT_PIPEBLOCK\")) {\n            Location block = new Location(event.getBlock().getWorld(), event.getBlock().getLocation().getBlockX(),\n                    event.getBlock().getLocation().getBlockY(), event.getBlock().getLocation().getBlockZ());\n            for (int x = 0; x <= 1; x++) {\n                for (int y = 0; y <= 1; y++) {\n                    for (int z = 0; z <= 1; z++) {\n                        Block assBlock = block.add(x, y, z).getBlock();\n                        if (assBlock.getType().name().equals(\"ADVANCEDSOLARPANEL_BLOCKADVSOLARPANEL\")) {\n                            event.setCancelled(true);\n                            try {\n                                event.getPlayer().updateInventory();\n                            } catch (NoSuchMethodError error) {\n                            }\n                            return;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * 用于处理太阳能GUI关闭时 容器内有ME元件 进行ME元件返还的操作\n     * \n     * @param event\n     */\n    @EventHandler\n    public void onInvCloseEvent(InventoryCloseEvent event) {\n        if (event.getInventory().getName().equals(\"Advanced Solar Panel\")\n                && event.getInventory().getTitle().equals(\"Advanced Solar Panel\")) {\n            ArrayList<ItemStack> flagItemStacks = Lists.newArrayList();\n            for (ItemStack itemStack : event.getInventory().getContents()) {\n                if (itemStack == null) {\n                    continue;\n                }\n                if (banItemName.contains(itemStack.getType().name())) {\n                    flagItemStacks.add(itemStack.clone());\n                    event.getInventory().removeItem(itemStack);\n                }\n            }\n            if (flagItemStacks.size() > 0) {\n                for (HumanEntity humanEntity : event.getViewers()) {\n                    humanEntity.closeInventory();\n                }\n\n                for (ItemStack item : flagItemStacks) {\n                    event.getView().getPlayer().getWorld().dropItem(event.getView().getPlayer().getLocation(), item);\n\n                }\n            }\n        }\n    }\n}复制代码\n\n\n\n",
    "replies": []
}