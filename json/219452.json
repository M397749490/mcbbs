{
    "title": "【插件开发疑问】我又来了。。。",
    "author": "ByZYM",
    "replyCount": 8,
    "timestamp": 1389791700,
    "txt_content": "正在完成一个答题插件\n功能：输入指令开始答题  聊天框开始公告题目1、2……  每道题有3秒作答时间 不在作答时间答题无效\n现在出的问题：我做的是输入指令执行一个聊天监控线程(变量intime为true才传递是否答对)  开始答题时间后设置 boolean intime = true\n开始监控  延迟3秒（暂停线程） 设置 intime = false\n但是发现这样行不通……在答题时间内 输入答案 却无任何反应= =",
    "replies": [
        {
            "author": "youliao",
            "timestamp": 1389793200,
            "txt_content": "好厉害呀{:10_512:}"
        },
        {
            "author": "ByZYM",
            "timestamp": 1389793440,
            "txt_content": "youliao 发表于 2014-1-15 21:40 \n好厉害呀\n好吧…………"
        },
        {
            "author": "尘曲",
            "timestamp": 1389837660,
            "txt_content": "注册了事件？"
        },
        {
            "author": "ByZYM",
            "timestamp": 1389879180,
            "txt_content": "尘曲 发表于 2014-1-16 10:01 \n注册了事件？\n注册了的……"
        },
        {
            "author": "尘曲",
            "timestamp": 1389881760,
            "txt_content": "ByZYM 发表于 2014-1-16 21:33 \n注册了的……\n那你得贴代码出来了，这样完全不知道你是什么情况，反正我是估计你没有注册"
        },
        {
            "author": "sobeit",
            "timestamp": 1389883320,
            "txt_content": "写代码的时候最好回避使用线程{:10_492:}"
        },
        {
            "author": "ByZYM",
            "timestamp": 1389932700,
            "txt_content": "尘曲 发表于 2014-1-16 22:16 \n那你得贴代码出来了，这样完全不知道你是什么情况，反正我是估计你没有注册package REDSTONE.ZYM.DT;\n\nimport java.io.File;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\nimport java.util.HashMap;\nimport java.util.logging.Logger;\n\nimport org.bukkit.Bukkit;\nimport org.bukkit.ChatColor;\nimport org.bukkit.command.Command;\nimport org.bukkit.command.CommandSender;\nimport org.bukkit.configuration.InvalidConfigurationException;\nimport org.bukkit.configuration.file.FileConfiguration;\nimport org.bukkit.configuration.file.YamlConfiguration;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.EventPriority;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.player.AsyncPlayerChatEvent;\nimport org.bukkit.plugin.java.JavaPlugin;\npublic class Main extends JavaPlugin implements Listener {\n        public final Logger logger = Logger.getLogger(\"Minecraft\");\n        public static Main plugin;\n        public final HashMap<Player, Boolean> at = new HashMap<Player, Boolean>();\n        private static Thread t;\n        String[] 问题 = new String[20];\n        Boolean 答题时间 = false;\n        String 指令;\n        String 答案;\n        String 答对玩家 = new String(\"\");\n        @Override\n        public void onEnable() {\n                getServer().getPluginManager().registerEvents(this, this);\n                File configFile = new File(getDataFolder(), \"config.yml\");\n                FileConfiguration config = YamlConfiguration\n                                .loadConfiguration(configFile);\n                if (!configFile.exists()) {\n                        config.set(\"list\", 0);\n                        config.set(\"VIP\", true);\n                        try {\n                                config.save(configFile);\n                        } catch (IOException e) {\n                                e.printStackTrace();\n                        }\n                }/*else {\n                        if (config.getInt(\"list\") != 0){\n                                for(int q = 1;q <= config.getInt(\"list\");q++){\n                                        问题[q-1] = config.getString(\"question\"+q);\n                                }\n                        }\n                }*/\n        }\n\n\n        @Override\n        public void onDisable() {\n        }\n\n        public boolean onCommand(CommandSender sender, Command cmd, String lable,String[] args) {\n                \n                File configFile = new File(getDataFolder(), \"config.yml\");\n                FileConfiguration config = YamlConfiguration\n                                .loadConfiguration(configFile);\n                int 超时;\n                int 问题编号 = 1;\n                if (lable.equalsIgnoreCase(\"dt\")) {\n                        if (sender instanceof Player) {\n                                Player player = (Player) sender;\n                                        if (args.length == 0) {//当有无参数只有 /dt 时\n                                        player.sendMessage(ChatColor.GOLD + \"------------------------------\");\n                                        player.sendMessage(ChatColor.GOLD + \"/dt help : 帮助\");\n                                        player.sendMessage(ChatColor.GOLD + \"/dt info : 插件信息\");\n                    player.sendMessage(ChatColor.GOLD + \"/dt reload : 重新读取配置\");\n                                        player.sendMessage(ChatColor.GOLD + \"------------------------------\");\n                                        return true;\n                                } else if (args.length == 1) {//当有一个参数时\n                                        if (args[0].equalsIgnoreCase(\"help\")) {//参数1=help\n                                        player.sendMessage(ChatColor.GOLD + \"[答题] /dt add [题目] [答案] [超时] [指令]: 添加题目\");\n                    player.sendMessage(ChatColor.GOLD + \"[答题] /dt list ：题目\");\n                    player.sendMessage(ChatColor.GOLD + \"[答题] /dt remove [编号/all] 移除题目\");\n                    player.sendMessage(ChatColor.GOLD + \"[答题] /dt start 开始答题\");\n                    player.sendMessage(ChatColor.GOLD + \"[答题] /dt stop 停止答题\");\n                                                return true;\n                                        } else if (args[0].equalsIgnoreCase(\"info\")) {//参数1=info\n                                                //插件信息\n                                    player.sendMessage(ChatColor.GOLD + \"-----------[答题]-----------\");\n                                        player.sendMessage(ChatColor.GOLD + \"[答题] 此插件由ZYM独立完成\");\n                                        player.sendMessage(ChatColor.GOLD + \"[答题] 功能：答题活动\");\n                                        player.sendMessage(ChatColor.GOLD + \"-----------[答题]------------\");\n                                                return true;\n                                        } else if (args[0].equalsIgnoreCase(\"list\")) {//参数1=list\n                                        player.sendMessage(ChatColor.GOLD + \"[答题] [编号]----[题目]----\");\n                                        //这里遍历题目数组\n                                        if (config.getInt(\"list\") != 0){//列表不等于0\n                                                int 问题个数 = config.getInt(\"list\");\n                                                int a = 1;\n                                                try{\n                                                do\n                                                {\n                                                        问题[a-1] = config.getString(\"question\" + a);\n                                                        player.sendMessage(ChatColor.GOLD + \"[答题]\" + \"[\"+ a +\"]----\" + 问题[a-1]);\n                                                        a+=1;\n                                                }\n                                                while(a < 问题个数);\n                                                }catch (ArrayIndexOutOfBoundsException e) {\n                                                        player.sendMessage(ChatColor.GOLD + \"[错误]列表数组问题\");\n                                                }\n                                                /*for(int a = 1;a <= 问题个数;a++){\n                                        问题[a-1] = config.getString(\"question\" + a);\n                                        player.sendMessage(ChatColor.GOLD + \"[\"+ a +\"]----\" + 问题[a-1]);\n                                                        }*/\n                                        }else {//列表等于0\n                                                player.sendMessage(ChatColor.GOLD + \"[答题] 无题目！\");\n                                        }\n                                        }else if (args[0].equalsIgnoreCase(\"reload\")) {\n                                                //重新读取配置项\n                                                try {\n                                                        config.load(configFile);\n                                                } catch (FileNotFoundException e) {\n                                                        e.printStackTrace();\n                                                } catch (IOException e) {\n                                                        e.printStackTrace();\n                                                } catch (InvalidConfigurationException e) {\n                                                        e.printStackTrace();\n                                                }\n                                                player.sendMessage(ChatColor.GOLD + \"[答题] 配置文件重载成功！\");\n                        return true;\n                    }else if (args[0].equalsIgnoreCase(\"add\")) {//添加题目的指令使用不对时\n                    player.sendMessage(ChatColor.GOLD + \"[答题] 使用方法：/dt add [题目] [答案] [超时] [指令]\");\n                        return true;\n                    }else if (args[0].equalsIgnoreCase(\"remove\")) {\n                    player.sendMessage(ChatColor.GOLD + \"[答题] 使用方法:/dt remove [编号/all]\");\n                        return true;\n                    }else if (args[0].equalsIgnoreCase(\"start\")) {\n                            t.start();\n                            /*if (config.getInt(\"list\") != 0){\n                                    getServer().broadcastMessage(\"[答题] 答题已开启！\");\n                                    getServer().broadcastMessage(\"[答题] 3秒后开始！\");\n                                    try {\n                                                                Thread.sleep(3000);\n                                                        } catch (InterruptedException e) {\n                                                                e.printStackTrace();\n                                                        }\n                                            //Main.plugin.getServer().getScheduler().scheduleSyncDelayedTask(Main.plugin, this, 3000);\n                                            int 问题个数 = config.getInt(\"list\");\n                                    for (问题编号 = 1; 问题编号 <= 问题个数 + 1 ; 问题编号++){\n                                            答对玩家 = \"\";\n                                            getServer().broadcastMessage(\"[答题]第\" + 问题编号 + \"题：\");\n                                            getServer().broadcastMessage(\"[答题]\" + 问题[问题编号-1]);\n                                            答案 = config.getString(\"answer\"+问题编号);\n                                            指令 = config.getString(\"command\"+问题编号);\n                                            超时 = config.getInt(\"outtime\"+问题编号);\n                                            答题时间 = true;\n                                            //Main.plugin.getServer().getScheduler().scheduleSyncDelayedTask(Main.plugin, this, 超时);//延迟\n                                        答题时间 = false;\n                                        getServer().broadcastMessage(\"[答题]\" + \"该题答案为\"+答案);\n                                        //发送奖励\n                                        if (答对玩家 != \"\"){\n                                            Bukkit.getServer().dispatchCommand(Bukkit.getConsoleSender(), 指令.replaceAll(\"<player>\",答对玩家));\n                                            getServer().broadcastMessage(\"[答题]\" + \"恭喜玩家\" + 答对玩家 + \"答对！\" + \"(奖励已发送！)\");\n                                        }else{//无人答对\n                                                getServer().broadcastMessage(\"[答题]\" + \"可惜……没人答对╮(╯▽╰)╭\");\n                                        }\n                                        //Main.plugin.getServer().getScheduler().scheduleSyncDelayedTask(Main.plugin, this, 2000);\n                                        \n                                    }\n                                    }else{//如果列表没东西\n                                                        player.sendMessage(ChatColor.GOLD + \"无题目！不能开始答题！\");\n                                            }*/\n                            }else if (args[0].equalsIgnoreCase(\"stop\")){//停止\n                                    t.interrupt();\n                            return true;\n                            }\n                                        }else if (args.length >= 4){\n                                                if(args[0].equalsIgnoreCase(\"add\")){//使用正确的 /dt add 命令\n                                                        int a = config.getInt(\"list\");\n                                                        String Command = new String (\"\"); \n                                                        config.set(\"list\",a+1);\n                                                        config.set(\"question\" + (a+1),args[1]);\n                                                        config.set(\"answer\" + (a+1),args[2]);\n                                                        config.set(\"outtime\" + (a+1),args[3]);\n                                                        for(int x = 4;x < args.length;x++){//把指令加入\n                                                                Command = Command + args[x] + \" \";\n                                                        }\n                                                        config.set(\"command\"+(a+1),Command.trim());\n                                                        try {//保存设置\n                                                                config.save(configFile);\n                                                        } catch (IOException e) {\n                                                                e.printStackTrace();\n                                                        }\n                                                        player.sendMessage(ChatColor.GOLD + \"[答题] \" + args[1] + args[2] + args[3] + Command);\n                                                        player.sendMessage(ChatColor.GOLD + \"[答题] 题目已添加！\");\n                                                }        \n                                        }else {//参数个数不正确\n                                                player.sendMessage(ChatColor.GOLD + \"[答题] 指令错误，请尝试/dt查看帮助\");\n                                        }\n                                }else {\n                                        getServer().broadcastMessage(\"[答题] 答题已由控制台开启！\");\n                                     //开始答题（只要在控制台输入 /dt 均可以开始答题）\n                    }\n                        }\n                return true;                        \n                }\n        public Main(){\n        t = new Thread(new Runnable(){\n                public void run() {\n                        String[] 问题 = new String[20];\n                        Boolean 答题时间 = false;\n                        String 指令;\n                        String 答案;\n                        String 答对玩家 = new String(\"\");\n                        File configFile = new File(getDataFolder(), \"config.yml\");\n                        FileConfiguration config = YamlConfiguration\n                                        .loadConfiguration(configFile);\n                        int 超时;\n                        int 问题编号 = 1;\n                        if (config.getInt(\"list\") != 0){\n                            getServer().broadcastMessage(\"[答题] 答题已开启！\");\n                            getServer().broadcastMessage(\"[答题] 3秒后开始！\");\n                            try {\n                                        Thread.sleep(3000);\n                                } catch (InterruptedException e) {\n                                        e.printStackTrace();\n                                }\n                                    //Main.plugin.getServer().getScheduler().scheduleSyncDelayedTask(Main.plugin, this, 3000);\n                                    int 问题个数 = config.getInt(\"list\");\n                            for (问题编号 = 1; 问题编号 <= 问题个数 + 1 ; 问题编号++){\n                                    答对玩家 = \"\";\n                                    getServer().broadcastMessage(\"[答题]第\" + 问题编号 + \"题：\");\n                                    getServer().broadcastMessage(\"[答题]\" + 问题[问题编号-1]);\n                                    答案 = config.getString(\"answer\"+问题编号);\n                                    指令 = config.getString(\"command\"+问题编号);\n                                    超时 = config.getInt(\"outtime\"+问题编号);\n                                    getServer().broadcastMessage(\"[答题] 开始答题!\");\n                                    答题时间 = true;\n                                    try {\n                                                Thread.sleep(10000);\n                                        } catch (InterruptedException e) {\n                                                e.printStackTrace();\n                                        }\n                                    //Main.plugin.getServer().getScheduler().scheduleSyncDelayedTask(Main.plugin, this, 超时);//延迟\n                                答题时间 = false;\n                                getServer().broadcastMessage(\"[答题]\" + \"该题答案为\"+答案);\n                                //发送奖励\n                                if (答对玩家 != \"\"){\n                                    Bukkit.getServer().dispatchCommand(Bukkit.getConsoleSender(), 指令.replaceAll(\"<player>\",答对玩家));\n                                    getServer().broadcastMessage(\"[答题]\" + \"恭喜玩家\" + 答对玩家 + \"答对！\" + \"(奖励已发送！)\");\n                                }else{//无人答对\n                                        getServer().broadcastMessage(\"[答题]\" + \"可惜……没人答对╮(╯▽╰)╭\");\n                                }\n                                try {\n                                                Thread.sleep(2000);\n                                        } catch (InterruptedException e) {\n                                                e.printStackTrace();\n                                        }\n                                //Main.plugin.getServer().getScheduler().scheduleSyncDelayedTask(Main.plugin, this, 2000);\n                                \n                            }\n                            }else{//如果列表没东西\n                                    getServer().broadcastMessage(\"[答题]\" + \"还没有题目╮(╯▽╰)╭\");\n                                    }\n                }\n                });\n        }\n        \n        \n        @EventHandler(priority = EventPriority.LOWEST)\n        public void chat(AsyncPlayerChatEvent event) {\n                String msg = event.getMessage();\n                final Player player = event.getPlayer();\n                String playername = player.getName();\n                if(答题时间 = true){\n                        if(msg.contains(\"a\") || msg.contains(\"b\") || msg.contains(\"c\") || msg.contains(\"d\") || msg.contains(\"A\") || msg.contains(\"B\") || msg.contains(\"C\") || msg.contains(\"D\")){\n                                //暂停玩家说话\n                                if (msg.contains(答案)) {\n                                        答题时间 = false;\n                                        答对玩家 = playername;\n                                        }\n                                }\n                        }\n        }复制代码\n"
        },
        {
            "author": "ByZYM",
            "timestamp": 1389932760,
            "txt_content": "ByZYM 发表于 2014-1-17 12:25 \n这个是没利用多线程的  那个多线程我去掉了 用不好"
        }
    ]
}