{
    "title": "[InfStudio]Gui万年坑，为你的方块增加一个Gui吧Part1[1.8Mod开发]",
    "author": "SPE__HaiKuo",
    "replyCount": 18,
    "timestamp": 1435723740,
    "txt_content": " 本帖最后由 SPE__HaiKuo 于 2015-7-1 13:18 编辑 \n\n前言：\nGui这个万年坑脱了好久，最近有空余时间也重新研究了，困难重重啊，和几位仙贝也讨论了好久，1.8真是变化太大了，让人无时无刻想着我*他Forge！我*他Mojang！我*他Notch！看着论坛的Gui教程就只要当风(过时)的教程了，这里就分享一下自己的经验吧。\n本篇先介绍一些基础的备用知识，做一个基本的界面出来，请各位刚学Java的小白点击右上角，毕竟下面的内容直接代码轰炸可能会很难理解\n\n\n正篇：\n这里示例做一个方块，取名为TestGui，因为测试的时候用的是小组在开发的Mod我也懒得单独提取出来了，主类为infstudio.exoticpower.ExoticPower\n如果要做一个Gui将会有以下几个文件：BlockTestGui、GuiTestGui、ContainerTestGui、TileEntityTestGui、GuiHandler、GuiID(可有可无)\n因为Gui制作非常复杂，传统主类可能做着做着就晕了，所以我们新建一个类proxy，里面创建CommonProxy和ClientProxy\n\n主类ExoticPower代码：\npackage infstudio.exoticpower;\n\nimport infstudio.exoticpower.proxy.CommonProxy;\nimport net.minecraftforge.fml.common.Mod;\nimport net.minecraftforge.fml.common.Mod.EventHandler;\nimport net.minecraftforge.fml.common.Mod.Instance;\nimport net.minecraftforge.fml.common.SidedProxy;\nimport net.minecraftforge.fml.common.event.FMLInitializationEvent;\nimport net.minecraftforge.fml.common.event.FMLPostInitializationEvent;\nimport net.minecraftforge.fml.common.event.FMLPreInitializationEvent;\n\n@Mod(modid = \"ExoticPower\", name=\"ExoticPower\" ,version= \"1.0.0\")\npublic class ExoticPower {\n\n        @SidedProxy(clientSide = \"infstudio.exoticpower.proxy.ClientProxy\", serverSide = \"infstudio.exoticpower.proxy.CommonProxy\")\n        public static CommonProxy proxy;\n\n        @Instance(\"ExoticPower\")\n        public static ExoticPower instance;\n        \n        @EventHandler\n        public void preInit(FMLPreInitializationEvent event) {\n                proxy.preInit(event);\n        }\n \n        @EventHandler\n        public void init(FMLInitializationEvent event) {\n                proxy.init(event);\n        }\n \n        @EventHandler\n        public void postInit(FMLPostInitializationEvent event) {\n            proxy.postInit(event);\n        }\n    \n}复制代码\n注意：@Instance里的内容必须与modid一致，否则制作Gui会崩溃\n\nCommonProxy代码：\npackage infstudio.exoticpower.proxy;\n\nimport net.minecraftforge.fml.common.event.FMLInitializationEvent;\nimport net.minecraftforge.fml.common.event.FMLPostInitializationEvent;\nimport net.minecraftforge.fml.common.event.FMLPreInitializationEvent;\n\npublic class CommonProxy {\n\n        public void preInit(FMLPreInitializationEvent event) {\n            \n        }\n         \n        public void init(FMLInitializationEvent event) {\n                //注册方块、物品、Gui等\n        }\n         \n        public void postInit(FMLPostInitializationEvent event) {\n            \n        }\n        \n}复制代码\n\nClientProxy代码：\npackage infstudio.exoticpower.proxy;\n\nimport net.minecraftforge.fml.common.event.FMLInitializationEvent;\nimport net.minecraftforge.fml.common.event.FMLPostInitializationEvent;\nimport net.minecraftforge.fml.common.event.FMLPreInitializationEvent;\n\npublic class ClientProxy extends CommonProxy {\n\n        public void preInit(FMLPreInitializationEvent event) {\n        \n        }\n \n        public void init(FMLInitializationEvent event) {\n                super.init(event);\n                为物品和方块添加材质\n        }\n \n        public void postInit(FMLPostInitializationEvent event) {\n        \n        }\n    \n}复制代码\n准备好这些基础后我们在创建block包并在包下创建BlockTestGui.java继承BlockContainer\npackage infstudio.exoticpower.block;\n\nimport net.minecraft.block.BlockContainer;\n\npublic class BlockTestGui extends BlockContainer {\n\n        protected BlockTestGui() {\n                super(Material.rock);\n        }\n        \n}复制代码\n创建gui.inventory包并在包下创建GuiTestGui.java继承GuiContainer\npackage infstudio.exoticpower.gui.inventory;\n\nimport infstudio.exoticpower.inventory.ContainerTestGui;\nimport infstudio.exoticpower.tileentity.TileEntityTestGui;\nimport net.minecraft.client.gui.inventory.GuiContainer;\nimport net.minecraft.client.renderer.GlStateManager;\nimport net.minecraft.client.resources.I18n;\nimport net.minecraft.entity.player.InventoryPlayer;\nimport net.minecraft.inventory.Container;\nimport net.minecraft.tileentity.TileEntityFurnace;\nimport net.minecraft.util.ResourceLocation;\nimport net.minecraft.util.StatCollector;\n\npublic class GuiTestGui extends GuiContainer {\n\n        private TileEntityTestGui tile;\n        \n        public GuiTestGui(InventoryPlayer playerInv, TileEntityTestGui tileEntity) {\n                super(new ContainerTestGui(playerInv, tileEntity));\n                // TODO Auto-generated constructor stub\n                this.tile = tileEntity;\n                this.doesGuiPauseGame();\n        }\n\n        @Override\n        protected void drawGuiContainerForegroundLayer(int par1, int par2) {\n                String s = StatCollector.translateToLocal(\"TitleTestGui\");    //设置Gui标题\n                this.fontRendererObj.drawString(s, this.xSize / 2 - this.fontRendererObj.getStringWidth(s) / 2, 6, 4210752);\n                this.fontRendererObj.drawString(I18n.format(\"container.inventory\", new Object[0]), 8, this.ySize - 96 + 2, 4210752);\n        }\n        \n        @Override\n        protected void drawGuiContainerBackgroundLayer(float var1, int var2, int var3) {\n                // TODO Auto-generated method stub\n                GlStateManager.color(1.0F, 1.0F, 1.0F, 1.0F);\n                this.mc.getTextureManager().bindTexture(new ResourceLocation(\"exoticpower\", \"textures/gui/container/testgui.png\"));\n                //gui贴图存储地址\n                int k = (this.width - this.xSize) / 2;\n                int l = (this.height - this.ySize) / 2;\n                this.drawTexturedModalRect(k, l, 0, 0, this.xSize, this.ySize);\n        }\n        \n}复制代码\n这里就提供给大家一张图（其实就是当风的图）：\n\n创建tileentity包并在包下创建TileEntityTestGui.java继承TileEntity实现IUpdatePlayerListBox和IInventory\npackage infstudio.exoticpower.tileentity;\n\nimport net.minecraft.entity.player.EntityPlayer;\nimport net.minecraft.inventory.IInventory;\nimport net.minecraft.item.ItemStack;\nimport net.minecraft.server.gui.IUpdatePlayerListBox;\nimport net.minecraft.tileentity.TileEntity;\nimport net.minecraft.util.IChatComponent;\n\npublic class TileEntityTestGui extends TileEntity implements IUpdatePlayerListBox, IInventory{\n\n        private ItemStack tstack[] = new ItemStack[3];    //数量与Gui中库存（槽）个数有关\n        \n        public void update() {\n                //此方法必须加\n        }\n\n        @Override\n        public String getName() {\n                // TODO Auto-generated method stub\n                return null;\n        }\n\n        @Override\n        public boolean hasCustomName() {\n                // TODO Auto-generated method stub\n                return false;\n        }\n\n        @Override\n        public IChatComponent getDisplayName() {\n                // TODO Auto-generated method stub\n                return null;\n        }\n\n        @Override\n        public int getSizeInventory() {\n                // TODO Auto-generated method stub\n                return tstack.length;\n        }    //获得最大库存\n\n        @Override\n        public ItemStack getStackInSlot(int index) {\n                // TODO Auto-generated method stub\n                return tstack[index];\n        }    //获得库存中的物品栈\n\n        @Override\n        public ItemStack decrStackSize(int index, int count) {\n                if (this.tstack[index] != null)\n                {\n                            ItemStack itemstack;\n\n                            if (this.tstack[index].stackSize <= count)\n                            {\n                                itemstack = this.tstack[index];\n                                this.tstack[index] = null;\n                                return itemstack;\n                            }\n                            else\n                            {\n                                itemstack = this.tstack[index].splitStack(count);\n\n                                if (this.tstack[index].stackSize == 0)\n                                {\n                                            this.tstack[index] = null;\n                                }\n\n                                return itemstack;\n                            }\n                }\n                else\n                       {\n                            return null;\n                }\n        }    //复制原版熔炉代码\n\n        @Override\n        public ItemStack getStackInSlotOnClosing(int index) {\n                // TODO Auto-generated method stub\n                return null;\n        }    //关闭Gui时触发的事件\n\n        @Override\n        public void setInventorySlotContents(int index, ItemStack stack) {\n                // TODO Auto-generated method stub\n                this.tstack[index] = stack;\n                if (stack != null && stack.stackSize > this.getInventoryStackLimit())\n                {\n                            stack.stackSize = this.getInventoryStackLimit();\n                }\n        }    //复制原版熔炉代码\n\n        @Override\n        public int getInventoryStackLimit() {\n                // TODO Auto-generated method stub\n                return 64;\n        }    //单个物品栈最大容量\n\n        @Override\n        public boolean isUseableByPlayer(EntityPlayer player) {\n                // TODO Auto-generated method stub\n                return true;\n        }    //是否任何人都能使用Gui\n\n        @Override\n        public void openInventory(EntityPlayer player) {\n                // TODO Auto-generated method stub\n                \n        }\n\n        @Override\n        public void closeInventory(EntityPlayer player) {\n                // TODO Auto-generated method stub\n                \n        }\n\n        @Override\n        public boolean isItemValidForSlot(int index, ItemStack stack) {\n                // TODO Auto-generated method stub\n                return false;\n        }\n\n        @Override\n        public int getField(int id) {\n                // TODO Auto-generated method stub\n                return 0;\n        }\n\n        @Override\n        public void setField(int id, int value) {\n                // TODO Auto-generated method stub\n                \n        }\n\n        @Override\n        public int getFieldCount() {\n                // TODO Auto-generated method stub\n                return 0;\n        }\n\n        @Override\n        public void clear() {\n                // TODO Auto-generated method stub\n                \n        }\n        \n}复制代码\n创建inventory包并在包下创建ContainerTestGui.java\npackage infstudio.exoticpower.inventory;\n\nimport infstudio.exoticpower.tileentity.TileEntityTestGui;\nimport net.minecraft.entity.player.EntityPlayer;\nimport net.minecraft.entity.player.InventoryPlayer;\nimport net.minecraft.inventory.Container;\nimport net.minecraft.inventory.Slot;\n\npublic class ContainerTestGui extends Container{\n\n        private TileEntityTestGui tile;\n        \n        public ContainerTestGui(InventoryPlayer par1InventoryPlayer, TileEntityTestGui tileEntity) {\n                this.tile = tileEntity;\n                this.addSlotToContainer(new Slot(tileEntity, 0, 49, 19));\n                this.addSlotToContainer(new Slot(tileEntity, 1, 112, 19));\n                this.addSlotToContainer(new Slot(tileEntity, 2, 80, 54));    //设置物品栏的槽\n                int var3;\n                for (var3 = 0; var3 < 3; ++var3)\n                {\n                            for (int var4 = 0; var4 < 9; ++var4)\n                            {\n                                this.addSlotToContainer(new Slot(par1InventoryPlayer, var4 + var3 * 9 + 9, 8 + var4 * 18, 84 + var3 * 18));\n                            }\n                }\n\n                for (var3 = 0; var3 < 9; ++var3)\n                {\n                            this.addSlotToContainer(new Slot(par1InventoryPlayer, var3, 8 + var3 * 18, 142));\n                }    //设置Gui的槽\n                //第一个参数是IInventory，第二个参数是ID，对应第一个参数，即取得第一个参数对应ID的内容，第三个参数是显示的X坐标，第四个是参数是显示的Y坐标\n        }\n        \n        @Override\n        public boolean canInteractWith(EntityPlayer playerIn) {\n                // TODO Auto-generated method stub\n                return true;\n                //能否打开Gui\n        }\n\n}复制代码\n在主类创建GuiID类，存取Gui的ID\npackage infstudio.exoticpower;\n\npublic class GuiID {\n\n        public static final int GUI_TG = 0;\n        \n}复制代码\n这时我们再在BlockTestGui增加createNewTileEntity和onBlockActivated方法\n@Override\n        public TileEntity createNewTileEntity(World worldIn, int meta) {\n                return new TileEntityTestGui();\n        }\n        \n        @Override\n        public boolean onBlockActivated(World worldIn, BlockPos pos, IBlockState state, EntityPlayer playerIn, EnumFacing side, float hitX, float hitY, float hitZ)\n        {\n                ItemStack stack = playerIn.inventory.mainInventory[playerIn.inventory.currentItem];\n                playerIn.openGui(ExoticPower.instance, GuiID.GUI_TG, worldIn, pos.getX(), pos.getY(), pos.getZ());\n        return true;\n        }复制代码\n再创建util包和GuiHandler类继承IGuiHandler类\npackage infstudio.exoticpower.util;\n\nimport infstudio.exoticpower.gui.inventory.GuiTestGui;\nimport infstudio.exoticpower.inventory.ContainerTestGui;\nimport infstudio.exoticpower.tileentity.TileEntityTestGui;\nimport infstudio.exoticpower.GuiID;\nimport net.minecraft.entity.player.EntityPlayer;\nimport net.minecraft.util.BlockPos;\nimport net.minecraft.world.World;\nimport net.minecraftforge.fml.common.network.IGuiHandler;\n\npublic class GuiHandler implements IGuiHandler{\n\n        @Override\n        public Object getServerGuiElement(int ID, EntityPlayer player, World world, int x, int y, int z) {\n                // TODO Auto-generated method stub\n                BlockPos bp = new BlockPos(x, y, z);\n                switch(ID)\n                {\n                case GuiID.GUI_TG:\n                        return new ContainerTestGui(player.inventory, (TileEntityTestGui)world.getTileEntity(bp));\n                }\n                return null;\n        }\n\n        @Override\n        public Object getClientGuiElement(int ID, EntityPlayer player, World world, int x, int y, int z) {\n                // TODO Auto-generated method stub\n                BlockPos bp = new BlockPos(x, y, z);\n                switch(ID)\n                {\n                case GuiID.GUI_TG:\n                        return new GuiTestGui(player.inventory, (TileEntityTestGui) world.getTileEntity(bp));\n                }\n                return null;\n        }\n\n}复制代码\n至此基础已经准备就绪，最后再在CommonProxy注册\n\n        public static Block testgui = new BlockTestGui();\n\n        public void init(FMLInitializationEvent event) {\n                    GameRegistry.registerBlock(testgui, \"testgui\");\n                GameRegistry.registerTileEntity(TileEntityTestGui.class, \"TileEntityTestGui\");\n                NetworkRegistry.INSTANCE.registerGuiHandler(ExoticPower.instance, new GuiHandler());\n        }复制代码\n所有准备已经就绪，现在打开游戏试试吧！\n\n\n\n后序：\n不过这个Gui现在什么用都没有，我们要通过更改TileEntity来创建他的功能，具体操作下一个Part会讲，有兴趣的可以先看看当风过时的教程，其实Gui就是不断魔改熔炉等带Gui的方块，只要理解了每个方法的含义就能轻而易举地创造出属于自己的Gui_(:з」∠)_\n*如果有什么好的意见可以提出来哦qwq\n*小唠叨：为何格式那么奇怪啊！调了好久啊！\n*求人气求金粒_(:з」∠)_\n\n[groupid=534]InfinityStudio[/groupid]",
    "replies": [
        {
            "author": "hhttll",
            "timestamp": 1435724100,
            "txt_content": "真.前排围观大触"
        },
        {
            "author": "qq1223332009",
            "timestamp": 1435724400,
            "txt_content": "大力出奇迹{:10_501:}"
        },
        {
            "author": "Fighter",
            "timestamp": 1435724400,
            "txt_content": "學java學到一半就想放棄了......這麼多內容學不完啊{:10_524:}"
        },
        {
            "author": "咕噜and呼噜",
            "timestamp": 1435725060,
            "txt_content": "然而我至今都做不了一个方块 下面的问题没人回答"
        },
        {
            "author": "侠客",
            "timestamp": 1435731000,
            "txt_content": "群里来支持"
        },
        {
            "author": "御殇城c",
            "timestamp": 1435731900,
            "txt_content": "我看看，感觉代码号难=="
        },
        {
            "author": "xcc",
            "timestamp": 1435734540,
            "txt_content": "这个gui看上去就是烧制嘛...."
        },
        {
            "author": "mcjava",
            "timestamp": 1435757700,
            "txt_content": "然而ExoticPower快点开发出来！\n支持，这是中国第一张的1.8gui教程，不错不错"
        },
        {
            "author": "黑暗空间",
            "timestamp": 1435841100,
            "txt_content": "mcjava 发表于 2015-7-1 21:35\n然而ExoticPower快点开发出来！\n支持，这是中国第一张的1.8gui教程，不错不错 ...\nJava代码死记中"
        },
        {
            "author": "Causeway",
            "timestamp": 1435846380,
            "txt_content": "黑暗空间 发表于 2015-7-2 20:45\nJava代码死记中\n也是醉了"
        },
        {
            "author": "拘束",
            "timestamp": 1437013620,
            "txt_content": "字好少...感觉代码要比字多得多..."
        },
        {
            "author": "tzdgreyd",
            "timestamp": 1437048120,
            "txt_content": "求教，我每次一右击我的新方块就shutting down internal server了。。\n我是按照Anvil来改的，就是没有对应的entity了。\n\n就算是跳过这些，直接在onBlockActivated方法里\nMinecraft.getMinecraft().displayGuiScreen(new GuiExchange(player.inventory, w, x, y, z));\n这样的话也是闪退。（我的Gui是GuiExchange）\n\n而相反的，如果直接\nMinecraft.getMinecraft().displayGuiScreen(new GuiRepair(player.inventory, w, x, y, z));\n的话至少能看到页面（虽然会鬼畜）。。\n\n是我的Gui里面出错了吗？（可是我自我感觉还是没有改掉Anvil的关键东西的。。）\n\n跪求解答。。"
        },
        {
            "author": "wsd81377",
            "timestamp": 1437195600,
            "txt_content": "哎呦不错哦"
        },
        {
            "author": "liach",
            "timestamp": 1437354540,
            "txt_content": "exoticpower，被这个mod惊呆了"
        },
        {
            "author": "mjmj1996",
            "timestamp": 1437381840,
            "txt_content": "MC的GUI一直无力吐槽.....(要是能用Swing 该多好OTZ)"
        },
        {
            "author": "harry_01",
            "timestamp": 1438261980,
            "txt_content": "支持一下，写了那么大篇幅。不过我已经被楼主的代码绕晕了。"
        },
        {
            "author": "a970695276",
            "timestamp": 1445787000,
            "txt_content": "这样的方法能用在1.7.10么 =。= 找不到1.7.10的gui教程哎"
        },
        {
            "author": "a970695276",
            "timestamp": 1445837820,
            "txt_content": "请问一下 在1.7.10中 blockpos 这个类是用什么代替的？"
        }
    ]
}