{
    "title": "[MoeApk服经验分享][PM1.2]恢复玩家块操作DEBUG信息显示",
    "author": "Attect",
    "replyCount": 6,
    "timestamp": 1362972900,
    "txt_content": "PocketMine-MP1.2与之前的版本相比没有了\n[DEBUG]时间 谁 放置了 块 在 X Y Z\n的记录，这对追踪服务器里谁搞破坏很不利\n\n进过对比检查，发现是作者把src/API/LevelAPI.php里的第37～39行注释掉了。\n经实验，去掉注释后是不行的，貌似下方代码有误，启用后服务器会在玩家放置或破坏一个块时崩溃\n\n经过一番研究，我们可以在这段代码的上游的代码来加入一段代码让服务端输出信息。\n\n记事本打开src/Player.php\n定位到669行\n\n按下方修改(涉及范围比较长)\n\n        case MC_USE_ITEM:\n                                                        if($this->loggedIn === false){\n                                                                break;\n                                                        }\n                                                        $data[\"eid\"] = $this->eid;\n                                                        if(Utils::distance($this->entity->position, $data) > 10){\n                                                                break;\n                                                        }elseif(($this->gamemode === SURVIVAL or $this->gamemode === ADVENTURE) and !$this->hasItem($data[\"block\"], $data[\"meta\"])){\n                                                                console(\"[DEBUG] 玩家 \"\".$this->username.\"\" 尝试放置一个他没有的块\", true, true, 2);\n                                                                //break;\n                                                        }\n                                                        $this->server->api->block->playerBlockAction($this, new Vector3($data[\"x\"], $data[\"y\"], $data[\"z\"]), $data[\"face\"], $data[\"fx\"], $data[\"fy\"], $data[\"fz\"]);\n\n/////自己添加 开始\n                        $this->equipment = BlockAPI::getItem($data[\"block\"], $data[\"meta\"]);\n                                                                console(\"[DEBUG] 玩家 \".$this->username.\" 放置或改动了 \".$this->equipment->getName().\" (\".$this->equipment->getID().\":\".$this->equipment->getMetadata().\")  在 X \".$data[\"x\"].\" Y \".$data[\"y\"].\" Z \".$data[\"z\"].\"\");\n////自己添加 结束\n\n                                                        break;\n                                                case MC_REMOVE_BLOCK:\n                                                        if($this->loggedIn === false){\n                                                                break;\n                                                        }\n                                                        if(Utils::distance($this->entity->position, $data) > 8){\n                                                                break;\n                                                        }\n                                                        $this->server->api->block->playerBlockBreak($this, new Vector3($data[\"x\"], $data[\"y\"], $data[\"z\"]));\n/////自己添加 开始\n                                                                console(\"[DEBUG] 玩家 \".$this->username.\" 撸掉了 坐标 X \".$data[\"x\"].\" Y \".$data[\"y\"].\" Z \".$data[\"z\"].\"\");\n////自己添加 结束\n                                                        break;\n复制代码",
    "replies": [
        {
            "author": "accee",
            "timestamp": 1362974160,
            "txt_content": "LZ强大啊   "
        },
        {
            "author": "Aikawastep",
            "timestamp": 1362975720,
            "txt_content": "感谢制作，=V=顶"
        },
        {
            "author": "MC小灵通",
            "timestamp": 1363140360,
            "txt_content": "好厉害，顶了"
        },
        {
            "author": "hsk001ufo",
            "timestamp": 1363432320,
            "txt_content": "能直接把那个LeaveAPI.php发出来么"
        },
        {
            "author": "a1257506573",
            "timestamp": 1363432920,
            "txt_content": "hsk001ufo 发表于 2013-3-16 19:12 \n能直接把那个LeaveAPI.php发出来么\n本渣以无力看懂了"
        },
        {
            "author": "hsk001ufo",
            "timestamp": 1363433280,
            "txt_content": "a1257506573 发表于 2013-3-16 19:22 \n本渣以无力看懂了\n- =本渣无力看不懂"
        }
    ]
}