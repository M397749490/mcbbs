{
    "title": "想获取玩家Lore以此增加血量,代码这样写对吗?",
    "author": "绿奈",
    "replyCount": 8,
    "timestamp": 1561420140,
    "txt_content": "因为想要让玩家升级的时候加HP但是加的时候不会连装备的HP算进去,就会导致加的血不是想要的所以想自己写一下,写了几天除了这个代码\n进去测试发现不行,服务器也炸了,但是我不知道代码错在那,麻烦各位大佬帮我看一下\n\n\n\npackage ml.thelunai.main;\nimport java.util.List;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\n\nimport org.bukkit.Material;\nimport org.bukkit.attribute.Attribute;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.player.PlayerLevelChangeEvent;\nimport org.bukkit.inventory.ItemStack;\nimport org.bukkit.inventory.meta.ItemMeta;\npublic class JTQ implements Listener{\n        //主手物品血量\n        private double PlayerHPonMH;\n        //副手物品血量\n        private double PlayerHPonOH;\n        //头盔血量\n        private double PlayerHPonHl;\n        //胸甲血量\n        private double PlayerHPonCl;\n        //裤子血量\n        private double PlayerHPonLi;\n        //鞋子血量\n        private double PlayerHPonBt;\n        //变量物品\n        private ItemStack item;\n        //获取的lore行\n        private String line = \"\";\n        @EventHandler\n    public void onPlayerLevelChange(PlayerLevelChangeEvent event)\n    {\n                //玩家经验改变的时候\n                \n                //主手物品\n                Player p = event.getPlayer();\n                item = p.getInventory().getItemInMainHand();\n        if (item.getType() != Material.AIR) {\n                ItemMeta meta = item.getItemMeta();\n                List<String> lore = meta.getLore();\n                do {\n                    int i= 0;\n                    line = lore.get(i);\n                    PlayerHPonMH = getNumber(line);\n                    i++;\n             } while(!line.contains(\".+生命上限.+\"));\n        }\n        \n        //副手物品\n        item = p.getInventory().getItemInOffHand();\n        if (item.getType() != Material.AIR) {\n                ItemMeta meta = item.getItemMeta();\n                List<String> lore = meta.getLore();\n                do {\n                    int i= 0;\n                    line = lore.get(i);\n                    PlayerHPonOH =  getNumber(line);\n                    i++;\n             } while(!line.contains(\".+生命上限.+\"));\n        }\n        \n        //头盔物品\n        item = p.getInventory().getHelmet();\n        if (item.getType() != Material.AIR) {\n                ItemMeta meta = item.getItemMeta();\n                List<String> lore = meta.getLore();\n                do {\n                    int i= 0;\n                    line = lore.get(i);\n                    PlayerHPonHl =  getNumber(line);\n                    i++;\n             } while(!line.contains(\".+生命上限.+\"));\n        }\n        \n        //胸甲物品\n        item = p.getInventory().getChestplate();\n        if (item.getType() != Material.AIR) {\n                ItemMeta meta = item.getItemMeta();\n                List<String> lore = meta.getLore();\n                do {\n                    int i= 0;\n                    line = lore.get(i);\n                    PlayerHPonCl =  getNumber(line);\n                    i++;\n             } while(!line.contains(\".+生命上限.+\"));\n        }\n        \n        //裤子物品\n        item = p.getInventory().getLeggings();\n        if (item.getType() != Material.AIR) {\n                ItemMeta meta = item.getItemMeta();\n                List<String> lore = meta.getLore();\n                do {\n                    int i= 0;\n                    line = lore.get(i);\n                    PlayerHPonLi =  getNumber(line);\n                    i++;\n             } while(!line.contains(\".+生命上限.+\"));\n        }\n        \n        //鞋子物品\n        item = p.getInventory().getBoots();\n        if (item.getType() != Material.AIR) {\n                ItemMeta meta = item.getItemMeta();\n                List<String> lore = meta.getLore();\n                do {\n                    int i= 0;\n                    line = lore.get(i);\n                    PlayerHPonBt =  getNumber(line);\n                    i++;\n             } while(!line.contains(\".+生命上限.+\"));\n        }\n        \n        //把所有装备的HP加起来\n       double AllPlayerAHP = PlayerHPonMH +  PlayerHPonOH +  PlayerHPonHl +  PlayerHPonCl +  PlayerHPonLi +  PlayerHPonBt;\n       //定义玩家等级\n      int playerLevel = event.getNewLevel();\n      double NowPlayerMaxHP = event.getPlayer().getAttribute(Attribute.GENERIC_MAX_HEALTH).getBaseValue();\n             //判断最大Hp是否有修改\n             if (NowPlayerMaxHP < (20 + AllPlayerAHP + playerLevel *1) ) {\n                    //修改玩家的最大HP\n                       event.getPlayer().getAttribute(Attribute.GENERIC_MAX_HEALTH).setBaseValue((20 + AllPlayerAHP + playerLevel *1));\n                }\n        \n        }\n        \n        \n        //从字符串中获取数字方法\n        public Double getNumber(String lores) {\n                 Double lore = null;\n        // 控制正则表达式的匹配行为的参数(小数)\n        Pattern p = Pattern.compile(\"(\\\\d+\\\\.\\\\d+)\");\n        //Matcher类的构造方法也是私有的,不能随意创建,只能通过Pattern.matcher(CharSequence input)方法得到该类的实例. \n        Matcher m = p.matcher(lores);\n        //m.find用来判断该字符串中是否含有与\"(\\\\d+\\\\.\\\\d+)\"相匹配的子串\n        if (m.find()) {\n            //如果有相匹配的,则判断是否为null操作\n            //group()中的参数：0表示匹配整个正则，1表示匹配第一个括号的正则,2表示匹配第二个正则\n            lores = m.group(1) == null ? \"\" : m.group(1);\n            lore = Double.parseDouble(lores);\n        } else {\n            //如果匹配不到小数，就进行整数匹配\n            p = Pattern.compile(\"(\\\\d+)\");\n            m = p.matcher(lores);\n            if (m.find()) {\n                //如果有整数相匹配\n                lores = m.group(1) == null ? \"\" : m.group(1);\n                lore = Double.parseDouble(lores);\n            } else {\n                //如果没有小数和整数相匹配,即字符串中没有整数和小数，就设为空\n                lores = \"null\";\n            }\n        }\n                return lore;\n}\n        public int getNewLevel() {\n                return this.getNewLevel();\n        }\n        \n    }\n复制代码\n\n",
    "replies": [
        {
            "author": "Ariy",
            "timestamp": 1561422060,
            "txt_content": "do {\n                    int i= 0;\n                    line = lore.get(i);\n                    PlayerHPonMH = getNumber(line);\n                    i++;\n             } while(!line.contains(\".+生命上限.+\"));复制代码\n话说你这个循环，要怎么才能跑出来"
        },
        {
            "author": "绿奈",
            "timestamp": 1561422420,
            "txt_content": "tian_wc 发表于 2019-6-25 08:21\n话说你这个循环，要怎么才能跑出来\nlore.get(里面的lore匹配下面的正在表达式)\n下面这个就为true因为我取反了所以等他为false的他就退出了\nline.contains(\".+生命上限.+\")"
        },
        {
            "author": "Ariy",
            "timestamp": 1561422900,
            "txt_content": "ww2498010071 发表于 2019-6-25 08:27\nlore.get(里面的lore匹配下面的正在表达式)\n下面这个就为true因为我取反了所以等他为false的他就退出了\nl ...\n你这个代码真是槽点满满\n1.你取物品的时候，直接就获取lore,你是否考虑过玩家身上的装备没有lore的情况这样取会报错？\n2.你每次循环，i都被赋值为0，每次判断的lore都是第一条，你确定能跑出来？\n3.你取lore里面数字的正则，也没有判断是否是你的插件写的Lore吧？如果是其他插件或管理写的lore呢？"
        },
        {
            "author": "绿奈",
            "timestamp": 1561423560,
            "txt_content": "tian_wc 发表于 2019-6-25 08:35\n你这个代码真是槽点满满\n1.你取物品的时候，直接就获取lore,你是否考虑过玩家身上的装备没有lore的情况这 ...\n1.这个我之后加(笔记)\n2.do语句一开始就判断一次,当结果为false的时候才退出\n然而我这个语句是false的,我取反之后就是true,当找到Lore的时候结果会为true取反就变成false\n怎么会跑不动?\n3.我就是想让我这个插件判断这条Lore,而关闭其他Lore的判断好加血"
        },
        {
            "author": "云闪",
            "timestamp": 1561494660,
            "txt_content": " 本帖最后由 splt 于 2019-6-26 04:39 编辑 \nww2498010071 发表于 2019-6-25 08:46\n1.这个我之后加(笔记)\n2.do语句一开始就判断一次,当结果为false的时候才退出\n然而我这个语句是false的,我 ...\n他第二点的意思(以及他最开始说的意思)简单来讲就是你应该把 int i= 0;放在循环外面\n你需要一个会提示逻辑错误的ide\n\n你这个代码的情况是框起来的那种问题\n\n快投入IDEA的怀抱(雾"
        },
        {
            "author": "绿奈",
            "timestamp": 1561502220,
            "txt_content": "splt 发表于 2019-6-26 04:31\n他第二点的意思(以及他最开始说的意思)简单来讲就是你应该把 int i= 0;放在循环外面\n你需要一个会提示逻辑 ...\n好吧感谢纠正,我用的eclipse,感觉IDEA会卡我电脑"
        },
        {
            "author": "QiuJay",
            "timestamp": 1564337220,
            "txt_content": "没太明白你的需求，你的意思是玩家升级的时候给玩家回点血，是这样吗？但这和装备有什么关系？"
        },
        {
            "author": "HYFan_Meng",
            "timestamp": 1569056100,
            "txt_content": "QiuJay 发表于 2019-7-29 02:07\n没太明白你的需求，你的意思是玩家升级的时候给玩家回点血，是这样吗？但这和装备有什么关系？ ...\n经验是XP\n他意思就是增加玩家的生命值"
        }
    ]
}