{
    "title": "Python 去mcmod.info时编码报错",
    "author": "MeTerminator",
    "replyCount": 2,
    "timestamp": 1593007560,
    "txt_content": "如题，\n\n\n代码：\nimport zipfile\nimport os\nimport json\n\n\ndef file_name(file_dir):\n    File_Name=[]\n    for files in os.listdir(file_dir):\n        if os.path.splitext(files)[1] == '.jar':\n            File_Name.append(files)\n    return File_Name\nfile_name=file_name(\".\")\n\n#print(file_name)\nallmod = []\n\nfor i in range(len(file_name)):\n        tempjar = zipfile.ZipFile(file_name[i], \"r\")\n        allfile = tempjar.namelist()\n        try:\n                for j in range(len(allfile)):\n                        if \".info\" in allfile[j]:\n                                infofilepath = allfile[j]\n                jarmodinfo = tempjar.read(infofilepath)\n                jarmodinfotemp = jarmodinfo\n                try:\n                        jarmodinfo = str(jarmodinfo, encoding = \"utf-8\")\n                        jarmodinfo = json.loads(jarmodinfo, strict=False)\n                except:\n                        jarmodinfo = str(jarmodinfotemp, encoding = \"gbk\")\n                        print(jarmodinfo)\n                        jarmodinfo = json.loads(jarmodinfo, strict=False)\n                modinfo = [file_name[i] , jarmodinfo[0][\"modid\"]]\n        except KeyError:\n                print(\"此mod：\"+file_name[i]+\"并无mcmod.info，需手动排查。\")\n                modinfo = [file_name[i] , None]\n        allmod.append(modinfo)\n        tempjar.close()\n\n#for i in range(len(allmod)):\n复制代码报错内容：\n\n\n\n\nfile_1593007512000.jpg (300.52 KB, 下载次数: 0)\n\n下载附件\n\n2020-6-24 22:05 上传\n\n\n\n\n\n\n此mod：Chunk Pregenerator V1.12-2.2.jar并无mcmod.info，需手动排查。\n此mod：CosmeticArmorReworked-1.12.2-v4b.jar并无mcmod.info，需手动排查。\n此mod：Cyclic-1.12.2-1.19.18.jar并无mcmod.info，需手动排查。\n此mod：DimensionalDoors-3.0.9-287.jar并无mcmod.info，需手动排查。\n此mod：foamfix-0.10.10-1.12.2.jar并无mcmod.info，需手动排查。\n此mod：Grue-1.12.2-1.8.0.jar并无mcmod.info，需手动排查。\n此mod：ICBM-classic-1.12.2-3.3.0b63.jar并无mcmod.info，需手动排查。\n此mod：JAOPCA-1.12.2-2.2.8.103.jar并无mcmod.info，需手动排查。\n此mod：journeymap-1.12.2-5.7.0.jar并无mcmod.info，需手动排查。\n此mod：just-enough-harvestcraft-1.12.2-1.7.0.jar并无mcmod.info，需手动排查。\n[\n{\n  \"modid\": \"jecalculation\",\n  \"name\": \"Just Enough Calculation\",\n  \"description\": \"A simple mod to help you with recipe calculation.\",\n  \"version\": \"1.12.2-3.2.3\",\n  \"mcversion\": \"1.12.2\",\n  \"url\": \"https://github.com/Towdium/JustEnoughCalculation\",\n  \"updateUrl\": \"http://minecratft.curseforge.com/projects/just-enough-calculation\",\n  \"authorList\": [\"Towdium\"],\n  \"logoFile\": \"\",\n  \"screenshots\": [],\n  \"dependencies\": [jei],\n  \"credits\": \"Thanks to the MCP, Forge and FML guys; along with sesess, Pahimar, MrCrayfish and BedrockMiner for their tutorial.\"\n}\n]\nTraceback (most recent call last):\n  File \"C:\\Users\\jzk20\\Desktop\\科技冒险大陆\\mods\\DelTheSameMods.py\", line 32, in <module>\n    jarmodinfo = json.loads(jarmodinfo, strict=False)\n  File \"C:\\Users\\jzk20\\AppData\\Local\\Programs\\Python\\Python38-32\\lib\\json\\__init__.py\", line 370, in loads\n    return cls(**kw).decode(s)\n  File \"C:\\Users\\jzk20\\AppData\\Local\\Programs\\Python\\Python38-32\\lib\\json\\decoder.py\", line 337, in decode\n    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n  File \"C:\\Users\\jzk20\\AppData\\Local\\Programs\\Python\\Python38-32\\lib\\json\\decoder.py\", line 355, in raw_decode\n    raise JSONDecodeError(\"Expecting value\", s, err.value) from None\njson.decoder.JSONDecodeError: Expecting value: line 13 column 20 (char 425)\n[Finished in 1.4s with exit code 1]\n[cmd: ['C:\\\\Users\\\\jzk20\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python38-32\\\\python.exe', '-u', 'C:\\\\Users\\\\jzk20\\\\Desktop\\\\科技冒险大陆\\\\mods\\\\DelTheSameMods.py']]\n[dir: C:\\Users\\jzk20\\Desktop\\科技冒险大陆\\mods]\n[path: C:\\Program Files (x86)\\Common Files\\Oracle\\Java\\javapath;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Windows\\System32\\OpenSSH\\;C:\\Program Files\\dotnet\\;C:\\Program Files\\Microsoft SQL Server\\130\\Tools\\Binn\\;C:\\Program Files\\Microsoft SQL Server\\Client SDK\\ODBC\\170\\Tools\\Binn\\;C:\\Users\\jzk20\\AppData\\Local\\Programs\\Python\\Python38-32\\Scripts\\;C:\\Users\\jzk20\\AppData\\Local\\Programs\\Python\\Python38-32\\;C:\\Users\\jzk20\\AppData\\Local\\Microsoft\\WindowsApps;]复制代码\n\n\n\n\n目的是取mcmod中的modid，然后进行模组去重处理。\n如果不知道怎么改，推荐一个模组去重的软件都行啊awa\n",
    "replies": [
        {
            "author": "蕾米洛伊",
            "timestamp": 1593010680,
            "txt_content": " 本帖最后由 蕾米洛伊 于 2020-6-24 22:59 编辑 \n\n是 JSON 本身格式有问题, 在 \"dependencies\": [jei] 那里, JSON 是不允许这种写法的, 必须带上双引号。\n我用了一个比较硬核的正则解决这个问题, 加上直接硬拼接字符串, 只敢保证你的这个用例不会报错, 其它的我不敢保证233\n\nimport re\n# 这里 json_string 是你的 JSON 字符串\njson_string = \"xxxx\"\n\njson_inner = json_string.split(\"[{\")[1].split(\"}]\")[0]\npattern_string = r'\"dependencies\"\\: \\[.*?]'\npatt = re.compile(pattern_string)\nnew_json = re.sub(patt, \"\\\"dependencies\\\": []\", json_inner)\nnew_json = \"[{\"+new_json+\"}]\"\n\n实际作用是它会把所有 \"dependencies\": [xxxxx] 替换成 \"dependencies\": [], 这种方法 会导致你读不到mod依赖。但是因为你是要去重嘛, 估计这个字段在你的用例里没啥用。\n最后输出的标准JSON是 new_json\n\n用刚刚的 JSON 进行测试:\n-> [{\"modid\": \"jecalculation\",\"name\": \"Just Enough Calculation\",\"description\": \"A simple mod to help you with recipe calculation.\",\"version\": \"1.12.2-3.2.3\",\"mcversion\": \"1.12.2\",\"url\": \"https://github.com/Towdium/JustEnoughCalculation\",\"updateUrl\": \"http://minecratft.curseforge.com/projects/just-enough-calculation\",\"authorList\": [\"Towdium\"],\"logoFile\": \"\",\"screenshots\": [],\"dependencies\": [jei],\"credits\":Thanks to the MCP, Forge and FML guys; along with sesess, Pahimar, MrCrayfish and BedrockMiner for their tutorial.\"}]\n\n<- [{\"modid\": \"jecalculation\",\"name\": \"Just Enough Calculation\",\"description\": \"A simple mod to help you with recipe calculation.\",\"version\": \"1.12.2-3.2.3\",\"mcversion\": \"1.12.2\",\"url\": \"https://github.com/Towdium/JustEnoughCalculation\",\"updateUrl\": \"http://minecratft.curseforge.com/projects/just-enough-calculation\",\"authorList\": [\"Towdium\"],\"logoFile\": \"\",\"screenshots\": [], \"dependencies\": [],\"credits\":Thanks to the MCP, Forge and FML guys; along with sesess, Pahimar, MrCrayfish and BedrockMiner for their tutorial.\"}]\n\n"
        },
        {
            "author": "金陵王",
            "timestamp": 1593324600,
            "txt_content": "蕾米洛伊 发表于 2020-6-24 22:58\n是 JSON 本身格式有问题, 在 \"dependencies\": [jei] 那里, JSON 是不允许这种写法的, 必须带上双引号。\n我 ...\n加油,大佬"
        }
    ]
}