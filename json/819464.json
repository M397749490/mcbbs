{
    "title": "[综合]MiniGameServerMatch 一一 服务器匹配,一端一图小游戏服务器必备~[1.8.x]",
    "author": "tudoutudou123",
    "replyCount": 12,
    "timestamp": 1536389640,
    "txt_content": " 本帖最后由 tudoutudou123 于 2018-9-9 08:34 编辑 \n\nMiniGameServerMatch -- 服务器匹配\n前言\n这个插件本来是要我自己服务器用的,现在分享出来~\n\n本来今天在弄服务器的时候想到没有小游戏传送的插件\n就打算来BBS找下\n结果没有\n但是找到了列队插件和ServerJoiner,但是我不会用(手动滑稽)\n就写了这个(下面有代码)\n\n这个插件和Spigot上的RandomServer和ServerJoiner可能有相似的地方\n插件截图/开启证明\n\n\n配置文件\nMatchServerMessage: '&7&l[&a&lMiniGameServerMatch&7&l] &c&l以随机匹配至服务器&7(这是条默认消息,在plugin-MiniGameServerMatch-config.yml中修改)'\nUseMatchServer:\n  Text:\n    - \"测试-1\"\n    - \"测试-2\"复制代码格式有点像RandomServer指令/MiniGameServerMatch <服务器>\n咸鱼代码\npackage MiniGame;\n\nimport com.google.common.io.ByteArrayDataOutput;\nimport com.google.common.io.ByteStreams;\nimport java.io.PrintStream;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Random;\nimport java.util.Set;\nimport org.bukkit.Bukkit;\nimport org.bukkit.ChatColor;\nimport org.bukkit.Server;\nimport org.bukkit.command.Command;\nimport org.bukkit.command.CommandSender;\nimport org.bukkit.command.PluginCommand;\nimport org.bukkit.configuration.ConfigurationSection;\nimport org.bukkit.configuration.file.FileConfiguration;\nimport org.bukkit.entity.Player;\nimport org.bukkit.plugin.java.JavaPlugin;\nimport org.bukkit.plugin.messaging.Messenger;\n\npublic class Main extends JavaPlugin\n{\n  private static Map<String, List<String>> pair = new HashMap();\n  private String thisServerName = null;\n  \n  public void onEnable()\n  {\n            Bukkit.getConsoleSender().sendMessage(\"§a§l==================================\");\n            Bukkit.getConsoleSender().sendMessage(\" \");\n            Bukkit.getConsoleSender().sendMessage(\"§c§lMiniGameServerMatch\");\n            Bukkit.getConsoleSender().sendMessage(\"§e§l迷你小游戏服务器匹配 §f§l- §a§l插件已启用\");\n            Bukkit.getConsoleSender().sendMessage(\" \");\n            Bukkit.getConsoleSender().sendMessage(\"§a§l==================================\");\n    saveDefaultConfig();\n    BungeeMsg bungeePipe = new BungeeMsg(this);\n    getServer().getMessenger().registerOutgoingPluginChannel(this, \"BungeeCord\");\n    getServer().getMessenger().registerIncomingPluginChannel(this, \"BungeeCord\", bungeePipe);\n    ConfigurationSection section = getConfig().getConfigurationSection(\"UseMatchServer\");\n    Set<String> cmdList = section.getKeys(false);\n    for (String cmd : cmdList)\n    {\n      System.out.println(cmd);\n      pair.put(cmd, section.getStringList(cmd));\n    }\n    getCommand(\"MiniGameServerMatch\").setExecutor(this);\n  }\n  \n  public void onDisable() {\n            Bukkit.getConsoleSender().sendMessage(\"§a§l==================================\");\n            Bukkit.getConsoleSender().sendMessage(\" \");\n            Bukkit.getConsoleSender().sendMessage(\"§c§lMiniGameServerMatch\");\n            Bukkit.getConsoleSender().sendMessage(\"§e§l迷你小游戏服务器匹配 §f§l- §c§l插件已关闭\");\n            Bukkit.getConsoleSender().sendMessage(\" \");\n            Bukkit.getConsoleSender().sendMessage(\"§a§l==================================\");\n  }\n  \n  public void sendBungeeCommand(Player p, String... msg)\n  {\n    ByteArrayDataOutput out = ByteStreams.newDataOutput();\n    for (String s : msg) {\n      out.writeUTF(s);\n    }\n    p.sendPluginMessage(this, \"BungeeCord\", out.toByteArray());\n  }\n  public boolean onCommand(CommandSender sender, Command cmd, String label, String[] args)\n  {\n    if (!cmd.getName().equalsIgnoreCase(\"MiniGameServerMatch\")) {\n      return false;\n    }\n    if (args.length < 1) {\n      return false;\n    }\n    String RunCommandPerMission = args[0];\n    if (!pair.containsKey(RunCommandPerMission)) {\n      return false;\n    }\n    if (!(sender instanceof Player)) {\n      return false;\n    }\n    Player player = (Player)sender;\n    Random random = new Random();\n    String serverName = (String)serverList.get(random.nextInt(serverList.size()));\n    player.sendMessage(ChatColor.translateAlternateColorCodes('&', getConfig().getString(\"MatchServerMessage\").replace(\"{server}\", serverName)));\n    teleportPlayerTo(player, serverName);\n    return true;\n  }\n  \n  public void teleportPlayerTo(Player p, String server)\n  {\n    sendBungeeCommand(p, new String[] { \"Connect\", server });\n  }\n  \n  public void setThisServerName(String thisServerName)\n  {\n    this.thisServerName = thisServerName;\n  }\n}\n复制代码\n新手第一次发帖，给点金粒呗~\n下载我要统计下载人数~\n\n\n\n[匹配]MiniGameServerMatch.jar\n(7.88 KB, 下载次数: 188)\n\n\n\n2018-9-9 08:34 上传\n点击文件名下载附件\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "NeverC",
            "timestamp": 1536390600,
            "txt_content": "建议title提示 owo"
        },
        {
            "author": "酷乐工作室",
            "timestamp": 1536395400,
            "txt_content": "看起来好腻害的样子[←完全不懂]"
        },
        {
            "author": "xmdhs",
            "timestamp": 1536401820,
            "txt_content": "所以匹配的机制是什么，人数吗\n"
        },
        {
            "author": "tudoutudou123",
            "timestamp": 1536403200,
            "txt_content": "xmdhs 发表于 2018-9-8 18:17\n所以匹配的机制是什么，人数吗\n对，如果1服的人数满了，直接切换到2服,循环下去，如果都满了，就暂停匹配,直到有多出来的服务器"
        },
        {
            "author": "404565377",
            "timestamp": 1537168320,
            "txt_content": "还是没长记性啊，格式都是反编译格式"
        },
        {
            "author": "X836696023",
            "timestamp": 1541591160,
            "txt_content": "      我记得，完整的队列插件都是MOTD检测的，现在的小游戏服的MOTD都会随着游戏的状态而改变。例如BedwarsRel，游戏处于等待中，那么，MOTD也为等待中（直接在多人游戏可以ping到）。这里我举个 ①号房间 为例子，如果 ①号房间 为等待中，那么队列插件将指向 ①号房间 （MOTD：等待中），所有玩家在 ①号房间 为等待中时，通过队列加入的房间将永远为 ①号房间 ，直到房间变为其它MOTD。如果这个房间的MOTD变成了其他MOTD，那么就换下一个空闲房间，如果没有空闲房间以后，提示玩家无法加入。      队列插件的思路就如上所述，如果还有疑问可以去看看BungeeTeleportSigns，虽然是付费插件，但是也值得学习！"
        },
        {
            "author": "夏逆大大",
            "timestamp": 1541591460,
            "txt_content": "赶快加上啊"
        },
        {
            "author": "_幻_",
            "timestamp": 1541600100,
            "txt_content": "很好的小游戏服务器插件诶 找了很久"
        },
        {
            "author": "EKT",
            "timestamp": 1580543160,
            "txt_content": "嫖了嫖了"
        },
        {
            "author": "hy_xiaoz",
            "timestamp": 1588439520,
            "txt_content": "hjtguhASJGKADCAIODFK"
        },
        {
            "author": "BlianBB",
            "timestamp": 1592391540,
            "txt_content": "教程呢？？？....emmmmm"
        },
        {
            "author": "STemirhan",
            "timestamp": 1612718340,
            "txt_content": "有一个问题 他甚至能加入我开局的游戏中\n"
        }
    ]
}