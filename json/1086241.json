{
    "title": "mod开发如何获取全部玩家及其UUID（包括不在线的玩家）",
    "author": "sulinly",
    "replyCount": 9,
    "timestamp": 1595694360,
    "txt_content": " 本帖最后由 sulinly 于 2020-7-26 00:26 编辑 \n\n想获取非在线玩家及uuid。貌似只有获取在线玩家的方法：event.getServer().getPlayerList()百度没找到获取全部玩家的方法。问题如下：\n\nforge 1.13.2（没有1.13.2的，其他版本也行） 如何获取全部玩家及其UUID（包括不在线的玩家）\n\n",
    "replies": [
        {
            "author": "天辉胡萝卜",
            "timestamp": 1595698260,
            "txt_content": "直接取playerdata目录下文件列表？"
        },
        {
            "author": "3TUSK",
            "timestamp": 1595703000,
            "txt_content": "MinecraftServer.getPlayerProfileCache() (func_152358_ax)"
        },
        {
            "author": "sulinly",
            "timestamp": 1595766300,
            "txt_content": "3TUSK 发表于 2020-7-26 02:50\nMinecraftServer.getPlayerProfileCache() (func_152358_ax)\n谢谢！这个可以用。"
        },
        {
            "author": "sulinly",
            "timestamp": 1595766300,
            "txt_content": "疾风暗影 发表于 2020-7-26 01:31\n直接取playerdata目录下文件列表？\n谢谢 这个思路可以的"
        },
        {
            "author": "sulinly",
            "timestamp": 1595766600,
            "txt_content": " 本帖最后由 sulinly 于 2020-7-26 20:32 编辑 \n            PlayerProfileCache cache =event.getServer().getPlayerProfileCache();\n            cache.load();\n            File[] files = new File(\"world\", \"playerdata\").listFiles(); // 该文件目录下文件全部放入数组\n            String[] names = new String[files.length];\n            for (int i = 0; i < files.length; i++) {\n                GameProfile profile = cache.getProfileByUUID(UUID.fromString(files[i].getName().replaceAll(\".dat\",\"\")));\n                names[i] = (profile != null)\n                        ? profile.getName()\n                        : \"<unknown:\" + files[i].toString() + \">\";\n                event.getServer().sendMessage(new TextComponentString(names[i]));\n            }复制代码\n没找到获取profile列表的方法，只有一个是私有的方法private List<PlayerProfileCache.ProfileEntry> getEntriesWithLimit(int limitSize)；\n于是只有用笨方法先在playerdata下获取uuid列表，然后从getPlayerProfileCache()中取得玩家名，如上面代码所示。如果有更好的方法请指教。"
        },
        {
            "author": "3TUSK",
            "timestamp": 1595816580,
            "txt_content": " 本帖最后由 3TUSK 于 2020-7-27 10:28 编辑 \nsulinly 发表于 2020-7-26 20:30\n没找到获取profile列表的方法，只有一个是私有的方法private List getEntriesWithLimit(int limitSize)；\n ...\n预先知道 UUID 的话可以用 PlayerProfileCache.getProfileByUUID(UUID) (func_152652_a)。\n\n如果一定要拿到全部已知玩家（私有字段 PlayerProfileCache.uuidToProfileEntryMap (field_152662_d)）的话，建议反射或使用 AT。其中 PlayerProfileCache.ProfileEntry 也不是 public 的，所以这个类也得 AT……\n\npublic net.minecraft.server.management.PlayerProfileCache field_152662_d #uuidToProfileEntryMap\npublic net.minecraft.server.management.PlayerProfileCache$ProfileEntry # PlayerProfileCache.ProfileEntry 复制代码"
        },
        {
            "author": "sulinly",
            "timestamp": 1595923140,
            "txt_content": "3TUSK 发表于 2020-7-27 10:23\n预先知道 UUID 的话可以用 PlayerProfileCache.getProfileByUUID(UUID) (func_152652_a)。\n\n如果一定要拿 ...\n谢谢，很有用呢。请教下，想自定义一个属性能，以前都是存在自己定义的json文件中，能直接存入PlayerProfileCache里的玩家的profile里吗?会不会引起系统混乱？"
        },
        {
            "author": "3TUSK",
            "timestamp": 1595927820,
            "txt_content": "sulinly 发表于 2020-7-28 15:59\n谢谢，很有用呢。请教下，想自定义一个属性能，以前都是存在自己定义的json文件中，能直接存入PlayerProf ...\n对于这种和玩家实体直接挂钩的数据，我建议使用 Forge 的 Capability 系统。\nhttps://harbinger.covertdragon.team/chapter-10/\nhttps://fmltutor.ustc-zzzz.net/3 ... B1%9E%E6%80%A7.html"
        },
        {
            "author": "sulinly",
            "timestamp": 1595984100,
            "txt_content": "3TUSK 发表于 2020-7-28 17:17\n对于这种和玩家实体直接挂钩的数据，我建议使用 Forge 的 Capability 系统。\nhttps://harbinger.covertdr ...\n好的，谢谢研究下Capability 系统。"
        }
    ]
}