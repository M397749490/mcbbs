{
    "title": "多个spigot插件如何互相通讯，在不同的BC子服下面，如何互相传递数据",
    "author": "长生道长",
    "replyCount": 17,
    "timestamp": 1594995600,
    "txt_content": "如题，需要写一个经济插件，BC子服下获得金钱所有子服同步，\n需要用到BC所有子服下插件传递消息的代码不太会写\n",
    "replies": [
        {
            "author": "lliiooll",
            "timestamp": 1594995720,
            "txt_content": " 本帖最后由 lliiooll 于 2020-7-17 22:40 编辑 \n\n发PluginMessage，代码如下: \n\n先注册出频道 Bukkit.getServer().registerOutgoingPluginChannel(插件主类的实例,频道名称);\nBukkit.getServer().sendPluginMessage(插件主类的实例,频道名称,数据);\n\n例: \nBukkit.getServer().registerOutgoingPluginChannel(HelpMe.getInstance(),\"HelpMe\");\nBukkit.getServer().sendPluginMessage(HelpMe.getInstance(),\"HelpMe\",\"H-E-L-L-O\".getBytes());复制代码监听请用\nBukkit.getServer().getMessenger().registerIncomingPluginChannel(插件实例, 频道名称, (channelName, player, data) -> {\n            // 处理你的数据\n        });\n\n例: Bukkit.getServer().getMessenger().registerIncomingPluginChannel(HelpMe.getInstance(), \"HelpMe\", (channelName, player, data) -> {\nSystem.out.println(new String(data));// 会输出上面发送的H-E-L-L-O\n});\n复制代码\n同步金钱的话emmm\n还是用数据库吧\n\n\n\n"
        },
        {
            "author": "RINNDA",
            "timestamp": 1594996680,
            "txt_content": "用mysql？"
        },
        {
            "author": "搅腋潭",
            "timestamp": 1594996800,
            "txt_content": "用数据库吧"
        },
        {
            "author": "redfish",
            "timestamp": 1594998180,
            "txt_content": "多个应用的数据最好还是用数据库吧，还要注意数据的同步和锁的问题，建议用事务处理"
        },
        {
            "author": "长生道长",
            "timestamp": 1595000100,
            "txt_content": "redfish 发表于 2020-7-17 23:03\n多个应用的数据最好还是用数据库吧，还要注意数据的同步和锁的问题，建议用事务处理 ...\n相对于经济来讲，sql同步差很多，需要用到轮查，做不到实时到账"
        },
        {
            "author": "长生道长",
            "timestamp": 1595000160,
            "txt_content": "搅腋潭 发表于 2020-7-17 22:40\n用数据库吧\n相对于经济来讲，sql同步差很多，需要用到轮查，做不到实时到账\n\n而且极大耗费服务器资源，不推荐数据库同步"
        },
        {
            "author": "长生道长",
            "timestamp": 1595000160,
            "txt_content": "RINNDA 发表于 2020-7-17 22:38\n用mysql？\n相对于经济来讲，sql同步差很多，需要用到轮查，做不到实时到账\n\n而且极大耗费服务器资源，不推荐数据库同步"
        },
        {
            "author": "长生道长",
            "timestamp": 1595000280,
            "txt_content": "lliiooll 发表于 2020-7-17 22:22\n发PluginMessage，代码如下: \n\n监听请用\n如果单用mysql,就有一个问题，我把玩家数据上传后，没有办法实时去各个子服同步更新，需要轮查，如果需要用到papi这种高频查询数据的插件 服务器会不会卡死 0.001秒查一次数据库挺尴尬的"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595001120,
            "txt_content": "长生道长 发表于 2020-7-17 23:38\n如果单用mysql,就有一个问题，我把玩家数据上传后，没有办法实时去各个子服同步更新，需要轮查，如果需要 ...\n一个账户不可能存在两个服同时操作\n\n所以1秒同步一次就够了\n\n至于你要做papi变量查询\n\n可以新建一个类来存放玩家的经济数据\n这样操作的时候直接在内存上操作 \n然后可以1秒或者一定时间向mysql写一次数据\n每次开服的时候读一下就行了\n我觉得一两秒的经济数据滞后不算什么事吧"
        },
        {
            "author": "长生道长",
            "timestamp": 1595002140,
            "txt_content": " 本帖最后由 长生道长 于 2020-7-18 00:11 编辑 \n南柯郡守 发表于 2020-7-17 23:52\n一个账户不可能存在两个服同时操作\n\n所以1秒同步一次就够了\n这就是轮查我写过了有问题非常耗费服务器性能 尤其是玩家基数庞大，轮查带来的不便种种，数据无法实时同步，对于萌新腐竹得不友好，一个账户存在多服汇款得问题然后本服也会轮查经济会出现未知BUG，会导致经济出现一些错乱多给玩家打款，比如A服A玩家给B服B玩家打款1000 C服玩家C服给A服玩家打款2000或者同时操作有时候同步会把经济同不错至于原因不太清楚可能是代码问题 放弃了sql不太便捷 我觉得可以用芒果DB等等做一个缓存最后提交mysql会避免出现问题，那么开发起来就不是很简单了需要高并发我觉得可以用芒果DB加mysql 或者用其他非关系型数据库用来做缓存来防止高并发得问题\n不卡服，无滞后，要精致"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595002320,
            "txt_content": "长生道长 发表于 2020-7-18 00:09\n这就是轮查我写过了有问题非常耗费服务器性能 尤其是玩家基数庞大，轮查带来的不便种种，数据无法实时同 ...\n如果需求量真的这么大的话\n\n可以写一个单独的程序在后台单独运行\n\n类似bc   也类似mysql  \n每个子服在查询是只要向这个程序提交查询申请就行\n\n数据只存在这个单独的程序上  \n\n说白了就是一个有针对性的mysql"
        },
        {
            "author": "lliiooll",
            "timestamp": 1595074560,
            "txt_content": "长生道长 发表于 2020-7-17 23:38\n如果单用mysql,就有一个问题，我把玩家数据上传后，没有办法实时去各个子服同步更新，需要轮查，如果需要 ...\n为什么要实时同步呢？\n不能在需要的时候同步吗，就比如进行涉及到玩家金钱操作的时候在进行同步，或者直接读写mysql"
        },
        {
            "author": "123456azxcvbnm",
            "timestamp": 1595143800,
            "txt_content": "这个看起来好复杂呀额"
        },
        {
            "author": "长生道长",
            "timestamp": 1595238420,
            "txt_content": " 本帖最后由 长生道长 于 2020-7-20 17:48 编辑 \nlliiooll 发表于 2020-7-18 20:16\n为什么要实时同步呢？\n不能在需要的时候同步吗，就比如进行涉及到玩家金钱操作的时候在进行同步，或者直 ...\n如果不是实时同步，那么B服的玩家怎么知道自己东西在A服卖出去了？单用MySql不轮查不做其他操作能触发B服的插件吗？个人写到这里发现不同步，用了轮查发现 跨服转账不会实时到账，无奈只能想，A服东西卖出去了A服经济插件给其他子服发送一个消息，让他们同步一下mysql"
        },
        {
            "author": "蕾米洛伊",
            "timestamp": 1595239440,
            "txt_content": "长生道长 发表于 2020-7-20 17:47\n如果不是实时同步，那么B服的玩家怎么知道自己东西在A服卖出去了？单用MySql不轮查不做其他操作能触发B服 ...\n跨服通知的话，用中间件吧，单搭建一个服务器或者把任意一个子服或主服作为 WebSocket 服务器，然后多个子服去连 WebSocket 获取/发送玩家经济更新的消息就行。\n或者想玩点更高级的，试试 RabbitMQ 消息队列"
        },
        {
            "author": "长生道长",
            "timestamp": 1595249820,
            "txt_content": "蕾米洛伊 发表于 2020-7-20 18:04\n跨服通知的话，用中间件吧，单搭建一个服务器或者把任意一个子服或主服作为 WebSocket 服务器，然后多个 ...\n有没有学习文档或者插件反编译看看 我不会"
        },
        {
            "author": "利姆露酱",
            "timestamp": 1596908040,
            "txt_content": "通信可参考 https://www.spigotmc.org/wiki/bu ... -messaging-channel/"
        }
    ]
}