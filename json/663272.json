{
    "title": "MCmod制作 1.11(6.动态物品贴图)",
    "author": "zkm00323",
    "replyCount": 6,
    "timestamp": 1484557380,
    "txt_content": "加特效,加特技Duang!Duang!Duang!\n记得原版了有2个物品的贴图会不断改变\n钟和指南针,今天就是参考这两个物品的代码写的\n\n1.给proxy新的功能\n我们先来了解一下有哪些方法可以只让单边读取\n\n\n\n\n\naaa.jpg (283.63 KB, 下载次数: 3)\n\n下载附件\n\n2017-1-16 15:32 上传\n\n\n\n\n\n\n点击图片查看原网址\n\n但如果有要写在物品的构造函数里的单边函数,以上的方法都行不通\n所以我们要自己创造一个方法\n在CommonProxy里新建一个方法\npublic interface CommonProxy {\n        public void init();\n        \n        abstract public boolean isServerSider();\n}\n\nabstract表示必须要重写这个方法\n\n之后再ClientProxy里添加这个方法\n        @Override\n        public boolean isServerSider() {\n                return false;\n        }\n\nServerProxy里也要\n        @Override\n        public boolean isServerSider() {\n                return true;\n        }\n\n\n\n\n\n2.研究动态贴图\n好接下来我们看一下ItemClock和ItemCompass\n有什么共同的东西\n\n\n\n\nfffffff.jpg (17.64 KB, 下载次数: 1)\n\n下载附件\n\n2017-1-16 15:55 上传\n\n\n\n\n\n\n\n\n\naaaaaaaa.jpg (20.43 KB, 下载次数: 2)\n\n下载附件\n\n2017-1-16 15:55 上传\n\n\n\n\n\n\n他们都有this.addPropertyOverride(new ResourceLocation(\"xxxx\"), new IItemPropertyGetter(){\n         ...\n         public float apply(ItemStack stack, @Nullable World worldIn, @Nullable EntityLivingBase entityIn){\n                  ...\n         }\n}\n注意new ResourceLocation(\"angle\")里面的参数名\n呢我们看一下 IItemPropertyGetter()里是什么\n\n\n\n\nsdsd.jpg (15.53 KB, 下载次数: 1)\n\n下载附件\n\n2017-1-16 16:01 上传\n\n\n\n\n\n\n所以 IItemPropertyGetter(){后面的 public float apply()应该就是直接实现了这个方法,注意到这个方法的回传是一个float\n\n然后我们去看看ItemCompass的json文件\n\n\n\n\nssssss.jpg (21.04 KB, 下载次数: 2)\n\n下载附件\n\n2017-1-16 16:06 上传\n\n\n\n\n\n\n\n\n\nsdsdsdsds.jpg (46.61 KB, 下载次数: 2)\n\n下载附件\n\n2017-1-16 16:06 上传\n\n\n\n\n\n我们打开 compass.json\n{\n    \"parent\": \"item/generated\",\n    \"textures\": {\n        \"layer0\": \"items/compass_16\"\n    },\n    \"overrides\": [\n        { \"predicate\": { \"angle\": 0.000000 }, \"model\": \"item/compass\" },\n        { \"predicate\": { \"angle\": 0.015625 }, \"model\": \"item/compass_17\" },\n        { \"predicate\": { \"angle\": 0.046875 }, \"model\": \"item/compass_18\" },\n        { \"predicate\": { \"angle\": 0.078125 }, \"model\": \"item/compass_19\" },\n        { \"predicate\": { \"angle\": 0.109375 }, \"model\": \"item/compass_20\" },\n        { \"predicate\": { \"angle\": 0.140625 }, \"model\": \"item/compass_21\" },\n        { \"predicate\": { \"angle\": 0.171875 }, \"model\": \"item/compass_22\" },\n        { \"predicate\": { \"angle\": 0.203125 }, \"model\": \"item/compass_23\" },\n        { \"predicate\": { \"angle\": 0.234375 }, \"model\": \"item/compass_24\" },\n        { \"predicate\": { \"angle\": 0.265625 }, \"model\": \"item/compass_25\" },\n        { \"predicate\": { \"angle\": 0.296875 }, \"model\": \"item/compass_26\" },\n        { \"predicate\": { \"angle\": 0.328125 }, \"model\": \"item/compass_27\" },\n        { \"predicate\": { \"angle\": 0.359375 }, \"model\": \"item/compass_28\" },\n        { \"predicate\": { \"angle\": 0.390625 }, \"model\": \"item/compass_29\" },\n        { \"predicate\": { \"angle\": 0.421875 }, \"model\": \"item/compass_30\" },\n        { \"predicate\": { \"angle\": 0.453125 }, \"model\": \"item/compass_31\" },\n        { \"predicate\": { \"angle\": 0.484375 }, \"model\": \"item/compass_00\" },\n        { \"predicate\": { \"angle\": 0.515625 }, \"model\": \"item/compass_01\" },\n        { \"predicate\": { \"angle\": 0.546875 }, \"model\": \"item/compass_02\" },\n        { \"predicate\": { \"angle\": 0.578125 }, \"model\": \"item/compass_03\" },\n        { \"predicate\": { \"angle\": 0.609375 }, \"model\": \"item/compass_04\" },\n        { \"predicate\": { \"angle\": 0.640625 }, \"model\": \"item/compass_05\" },\n        { \"predicate\": { \"angle\": 0.671875 }, \"model\": \"item/compass_06\" },\n        { \"predicate\": { \"angle\": 0.703125 }, \"model\": \"item/compass_07\" },\n        { \"predicate\": { \"angle\": 0.734375 }, \"model\": \"item/compass_08\" },\n        { \"predicate\": { \"angle\": 0.765625 }, \"model\": \"item/compass_09\" },\n        { \"predicate\": { \"angle\": 0.796875 }, \"model\": \"item/compass_10\" },\n        { \"predicate\": { \"angle\": 0.828125 }, \"model\": \"item/compass_11\" },\n        { \"predicate\": { \"angle\": 0.859375 }, \"model\": \"item/compass_12\" },\n        { \"predicate\": { \"angle\": 0.890625 }, \"model\": \"item/compass_13\" },\n        { \"predicate\": { \"angle\": 0.921875 }, \"model\": \"item/compass_14\" },\n        { \"predicate\": { \"angle\": 0.953125 }, \"model\": \"item/compass_15\" },\n        { \"predicate\": { \"angle\": 0.984375 }, \"model\": \"item/compass\" }\n    ]\n}\n\n\n不难发现\"angle\"就是上面打在this.addPropertyOverride()里面的参数\n而这些0.625526的数字就是apply的回传值,用此值判断所在区间\n 0.000000~0.015624就跑去读取 \"model\": \"item/compass\"\n 0.015625~0.046874就派去读取 \"model\": \"item/compass_17\"\n...\n\n\n\n\n\n3.自制动态贴图\n好既然我们已经知道动态贴图的秘密了我们就自己做一个吧\n在compass里的apply方法,官方在每一个变数和和方法上面加上\n@SideOnly(Side.CLIENT)注解来实现单边读取,而我们可以用之前做的proxy判断法来实现\n\n现在我们回到ItemBloodsave的构造函数里添加一句\n        public ItemBloodsave(){\n                setUnlocalizedName(\"itembloodsave\");\n                setRegistryName(\"itembloodsave\");\n                setCreativeTab(CreativeTabs.MATERIALS);\n                setMaxStackSize(1);\n                \n                if(!Main.proxy.isServerSider())this.addPropertyOverride(new ResourceLocation(\"bloodsave\"), new ItemBloodsaveTextures());\n        }\n\n\n这样只有客户端会执行此句话\n我们设定参数名为\"bloodsave\"\nnew 一个 ItemBloodsaveTextures()这里我们还没创建会报错\n\n我们现在来创建ItemBloodsaveTextures()\n\n\n\n\nasdfgh.jpg (16.99 KB, 下载次数: 2)\n\n下载附件\n\n2017-1-16 16:08 上传\n\n\n\n\n\n\n\n在ItemBloodsaveTextures里输入\npublic class ItemBloodsaveTextures implements IItemPropertyGetter{\n        @Override\n        public float apply(ItemStack stack, World worldIn, EntityLivingBase entityIn) {\n                if(worldIn == null && entityIn != null)\n                        worldIn = entityIn.getEntityWorld();//玩家背包內的物品沒有世界\n            if (worldIn != null && stack.getTagCompound() != null && stack.getTagCompound().hasKey(\"blood\")){//阻擋創造模式物品欄\n                       return stack.getTagCompound().getInteger(\"bloodsave\");\n        }\n                return 0;\n        }\n}\n\n\n这里我来解释一下,apply是每一个ItemBloodsave,不管在地上,手里,箱子里,玩家物品栏里,创造模式物品栏里,\n每一tick都会执行一次(20tick=1sec)\n经过我的测试,在不同地方的物品的输入值也不一样\n玩家物品栏 worldIn == null,entityIn != null\n地上 worldIn != null,entityIn == null\n手里 worldIn != null,entityIn != null\n创造模式物品栏 worldIn == null,entityIn == null\n\n我们的物品必须被玩家右击以后才有nbt资料\n而创造模式物品栏里的item是不可能有nbt资料的,如果硬要去读取则会崩溃\n所以以上代码让还没有nbt的血瓶以及创造模式物品栏内的血瓶回传值为0\n其他则读取nbt资料来回传1~20\n\n接下来就剩下json文件和把贴图放进去了\n我们回到models.item.itembloodsave.json里改写\n{\n    \"parent\": \"item/generated\",\n    \"textures\": {\n        \"layer0\": \"soa:items/itembloodsave\"\n    },\n  \"overrides\": [\n    { \"predicate\": { \"bloodsave\": 0 },  \"model\": \"soa:item/itembloodsave\"    },\n    { \"predicate\": { \"bloodsave\": 1 },  \"model\": \"soa:item/itembloodsave_1\"  },\n    { \"predicate\": { \"bloodsave\": 8 }, \"model\": \"soa:item/itembloodsave_2\" },\n    { \"predicate\": { \"bloodsave\": 13 }, \"model\": \"soa:item/itembloodsave_3\" },\n    { \"predicate\": { \"bloodsave\": 20 }, \"model\": \"soa:item/itembloodsave_4\" }\n  ]\n}\n\n\napply回传值↓\n0→\"model\": \"soa:item/itembloodsave\"\n1~7→\"model\": \"soa:item/itembloodsave_1\"\n8~12→\"model\": \"soa:item/itembloodsave_2\"\n13~19→ \"model\": \"soa:item/itembloodsave_3\"\n20→\"model\": \"soa:item/itembloodsave_4\"\n\n再来把1,2,3,4models补上\n\n\n\n\naaahy.jpg (15.06 KB, 下载次数: 2)\n\n下载附件\n\n2017-1-16 16:59 上传\n\n\n\n\n\n\n\n我就写itembloodsave_1.json的内容吧\n{\n    \"parent\": \"item/generated\",\n    \"textures\": {\n        \"layer0\": \"soa:items/itembloodsave_1\"\n    }\n}\n\n\n\"layer0\": \"soa:items/itembloodsave_1\"就是导向的贴图文件路径我之前也说过了\n其他的json只是导向不同的贴图文件路径而已我就不写出来了\n\n附上贴图文件,应该知道要丢哪里了吧(textures.items里)\n\n\n\n\nitembloodsave_1.png (350 Bytes, 下载次数: 16)\n\n下载附件\n\n2017-1-16 16:45 上传\n\n\n\n\nitembloodsave_1\n\n\n\n\nitembloodsave_2.png (384 Bytes, 下载次数: 17)\n\n下载附件\n\n2017-1-16 16:45 上传\n\n\n\n\nitembloodsave_2\n\n\n\n\nitembloodsave_3.png (415 Bytes, 下载次数: 15)\n\n下载附件\n\n2017-1-16 16:45 上传\n\n\n\n\nitembloodsave_3\n\n\n\n\nitembloodsave_4.png (435 Bytes, 下载次数: 15)\n\n下载附件\n\n2017-1-16 16:45 上传\n\n\n\n\nitembloodsave_4\n\n\n\n\n\n\n好我们进游戏看看\n\n\n\n\nooo.jpg (83.26 KB, 下载次数: 2)\n\n下载附件\n\n2017-1-16 17:00 上传\n\n\n\n\n\n\n\n\n\n\nssss.jpg (305.54 KB, 下载次数: 2)\n\n下载附件\n\n2017-1-16 17:00 上传\n\n\n\n\n\n\n\n\n\n\nsad.jpg (135.32 KB, 下载次数: 2)\n\n下载附件\n\n2017-1-16 17:00 上传\n\n\n\n\n\n\n\n好,物品的高级玩法似乎就剩多态没讲了我\n也是尽量希望做一个实用,并且可以把教程融合在一起的物品\n不知道这个血瓶你喜不喜欢呢~\n\n源代码\n\n\n\nsrc_教程6.rar\n(10.5 KB, 下载次数: 29)\n\n\n\n2017-1-16 17:03 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "yycpy",
            "timestamp": 1484607120,
            "txt_content": "666666顶顶顶"
        },
        {
            "author": "cjrsacred",
            "timestamp": 1547386380,
            "txt_content": "楼主忽略了一种情况：展示框"
        },
        {
            "author": "cjrsacred",
            "timestamp": 1547387880,
            "txt_content": "我试了一下，不知道对不对，创造物品栏是无世界有实体的（知道打开物品栏时是这样），展示框是无世界无实体，所以第二个 if 那里不用判断 worldln 就行了"
        },
        {
            "author": "尬兹GZ",
            "timestamp": 1550642940,
            "txt_content": "顶顶顶！！！"
        },
        {
            "author": "egod",
            "timestamp": 1555685640,
            "txt_content": "没有报错，存血取血功能正常，但就是不回根据血液存储量更新贴图，伤心\n物品代码：\npublic class PandaBlood extends Item{\n        private static final String name = \"panda_blood\";\n        \n        public PandaBlood() {\n                super();\n                setRegistryName(name);\n                setUnlocalizedName(INFO.MODID+\":\"+name+\"_item\");\n                setCreativeTab(CreativeTabs.MATERIALS);\n                setMaxStackSize(1);\n                this.addPropertyOverride(new ResourceLocation(\"blood_save\"),\n                                        new IItemPropertyGetter() {\n                                                @SideOnly(Side.CLIENT)\n                                                public float apply(ItemStack stack, World worldIn, EntityLivingBase entityIn) {\n                                                        boolean flag = entityIn != null;\n                                                        entityIn.sendMessage(new TextComponentString(\"YOU ARE \"+entityIn.getName()+\n                                                                        \"your panda blood is \"+stack.getTagCompound().getInteger(\"blood_save\")));\n                                                        Entity entity = (Entity)(flag ? entityIn : stack.getItemFrame());\n                                                        if(worldIn == null && entityIn != null) {\n                                                                worldIn = entity.world;\n                                                        }\n                                                        if(worldIn != null && stack.getTagCompound() != null && stack.getTagCompound().hasKey(\"blood\")) {\n                                                                return (float)stack.getTagCompound().getInteger(\"blood_save\");\n                                                        }\n                                                        return 0F;\n                                                }\n                                        });\n        }\n        \n        @Override\n        public void addInformation(ItemStack stack, World worldIn, List<String> tooltip,ITooltipFlag flagIn) {\n                if(flagIn.isAdvanced()) {\n                        tooltip.add(\"This is \");\n                        tooltip.add(\"a Panda Blood\");\n                }\n                else {\n                        tooltip.add(I18n.format(this.getUnlocalizedName()+\".1.\"+\"desc\"));\n                }\n                if(org.lwjgl.input.Keyboard.isKeyDown(org.lwjgl.input.Keyboard.KEY_LSHIFT)) {\n                        tooltip.add(I18n.format(this.getUnlocalizedName()+\".shift.1.\"+\"desc\"));\n                }\n                NBTTagCompound nbt = stack.getTagCompound();\n                if(nbt!=null && nbt.hasKey(\"blood_save\")) {\n                        tooltip.add(\"blood:\"+nbt.getInteger(\"blood_save\"));\n                }\n        }\n        \n        @Override\n        public int getMaxItemUseDuration(ItemStack stack) {\n                return 32;\n        }\n        \n        @Override\n        public EnumAction getItemUseAction(ItemStack stack) {\n                return EnumAction.DRINK;\n        }\n        \n        // 血瓶功能\n        @Override\n        public ActionResult<ItemStack> onItemRightClick(World worldIn,EntityPlayer player,EnumHand hand){\n                player.setActiveHand(hand);\n                if(!worldIn.isRemote) {\n                        ItemStack item = player.getHeldItem(hand);\n                        // 如果第一次使用，初始化一个内部nbt\n                        if(item.getTagCompound()==null) {\n                                player.sendMessage(new TextComponentString(\"Seems the first time to use...activated!\"));\n                                item.setTagCompound(new NBTTagCompound());\n                                \n                                NBTTagCompound nbt = new NBTTagCompound();\n                                nbt.setInteger(\"blood_save\", 0);\n                                \n                                item.getTagCompound().setTag(\"blood\", nbt);\n                        }\n                        \n                        int bloodSave = item.getTagCompound().getInteger(\"blood_save\");\n                        if(player.isSneaking() && bloodSave<20) {\n                                int damage = new Random().nextInt(10)+1;\n                                player.sendMessage(new TextComponentString(\"health take: \"+damage));\n                                player.setHealth(player.isCreative()?player.getHealth()-0:player.getHealth()-damage);\n                                if(bloodSave+damage > 20) {\n                                        item.getTagCompound().setInteger(\"blood_save\", 20);\n                                        player.sendMessage(new TextComponentString(\"Panda Blood seems full...\"));\n                                }else {\n                                        item.getTagCompound().setInteger(\"blood_save\", bloodSave+damage);\n                                        player.sendMessage(new TextComponentString(\"Now it's \"+item.getTagCompound().getInteger(\"blood_save\")+\"/20\"));\n                                }\n                                player.stopActiveHand();\n                        }else if(player.isSneaking() && bloodSave == 20) {\n                                player.sendMessage(new TextComponentString(\"hey! your panda blood is already full!\"));\n                        }\n                }\n                return super.onItemRightClick(worldIn, player, hand);\n        }\n        \n        @Override\n        public ItemStack onItemUseFinish(ItemStack item, World world, EntityLivingBase player) {\n                if(!world.isRemote) {\n                        int bloodSave = item.getTagCompound().getInteger(\"blood_save\");\n                        float health = player.getHealth();\n                        float maxHealth = player.getMaxHealth();\n                        float heal = Math.min(maxHealth-health, bloodSave);\n                        player.heal(heal);\n                        item.getTagCompound().setInteger(\"blood_save\", bloodSave-(int)heal);\n                        player.sendMessage(new TextComponentString(\"Panda Blood heals you \"+(int)heal+\" health\"));\n                        player.sendMessage(new TextComponentString(\"Now it's \"+item.getTagCompound().getInteger(\"blood_save\")+\"/20\"));\n                }\n                return super.onItemUseFinish(item, world, player);\n        }\n}复制代码\nitem 的json 文件\n{\n    \"parent\":\"item/generated\",\n    \"textures\":{\n        \"layer0\":\"panda_mod:panda_blood_texture\"    \n    },\n    \"Overrides\":[\n    {\"predicate\":{\"blood_save\":0.0},\"model\":\"panda_mod:item/panda_blood_item\"},\n    {\"predicate\":{\"blood_save\":1.0},\"model\":\"panda_mod:item/panda_blood_item_1\"},\n    {\"predicate\":{\"blood_save\":5.0},\"model\":\"panda_mod:item/panda_blood_item_2\"},\n    {\"predicate\":{\"blood_save\":13.0},\"model\":\"panda_mod:item/panda_blood_item_3\"},\n    {\"predicate\":{\"blood_save\":20.0},\"model\":\"panda_mod:item/panda_blood_item_4\"}\n    ]\n}复制代码\npanda_blood_item_1.json\n{\n    \"parent\":\"item/generated\",\n    \"textures\":{\n        \"layer0\":\"panda_mod:panda_blood_texture_1\"\n    }\n复制代码\n"
        },
        {
            "author": "egod",
            "timestamp": 1555685700,
            "txt_content": "egod 发表于 2019-4-19 22:54\n没有报错，存血取血功能正常，但就是不回根据血液存储量更新贴图，伤心\n物品代码：\nforge 版本 1.12.2"
        }
    ]
}