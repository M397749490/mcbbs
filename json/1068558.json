{
    "title": "PVPINæ•™ç¨‹RL--Bukkitçš„äº‹ä»¶ç›‘å¬å¾ªç¯ç†è®ºåˆ†æï¼ˆæåº¦åŠé€€",
    "author": "William_Shi",
    "replyCount": 4,
    "timestamp": 1593224760,
    "txt_content": " æœ¬å¸–æœ€åç”± William_Shi äº 2020-6-28 22:26 ç¼–è¾‘ \n\næœ¬æ–‡çº¯å±Bukkitæºç ç ”ç©¶\nèµ·å› æ˜¯æœ‰ä¸€ä¸ªæ–°äººé—®äº†Bukkitæ€ä¹ˆçŸ¥é“æŸæ–¹æ³•æ˜¯äº‹ä»¶ç›‘å¬å¤„ç†æ–¹æ³•çš„\næœ¬æ–‡å…¶å®å°±æ˜¯ä¸€ä¸ªæ€è·¯çš„æ¢³ç†\n\nè¯¥ä»å“ªé‡Œå…¥æ‰‹ï¼Ÿ\næˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ³¨å†Œäº‹ä»¶ç›‘å¬çš„è¿‡ç¨‹æ˜¯PluginManager#registerEventï¼ˆæˆ–è€…æ˜¯eventsï¼‰\nhttps://bukkit.windit.net/javado ... kkit.plugin.Plugin-\n\né‚£ä¹ˆæˆ‘ä»¬å°±ä»PluginManagerçš„å®ç°ç±»å…¥æ‰‹\n\npackage org.bukkit.plugin;\npublic final class SimplePluginManager implements PluginManager \n\nå…¶ä¸­çš„æ³¨å†Œç›‘å¬çš„ä¸€ä¸ªæ–¹æ³•å¦‚ä¸‹\n\nÂ Â public void registerEvents(@NotNull Listener listener, @NotNull Plugin plugin) {\nÂ  Â  if (!plugin.isEnabled())\nÂ  Â Â  Â throw new IllegalPluginAccessException(\"Plugin attempted to register \" + listener + \" while not enabled\"); \nÂ  Â  for (Map.Entry<Class<? extends Event>, Set<RegisteredListener>> entry : plugin.getPluginLoader().createRegisteredListeners(listener, plugin).entrySet())\nÂ  Â Â  Â getEventListeners(getRegistrationClass(entry.getKey())).registerAll(entry.getValue()); \nÂ Â }\n\né¦–å…ˆæ˜¯æ£€æŸ¥æ’ä»¶æœ‰æ²¡æœ‰è¢«å¯ç”¨ï¼Œå¦‚æœæ˜¯è¢«disableçš„æ’ä»¶é‚£å°±æ²¡å¿…è¦æ³¨å†Œäº‹ä»¶ç›‘å¬äº†\nä¹‹åå‘¢ï¼Ÿ\nMap.Entry<Class<? extends Event>, Set<RegisteredListener>>\nè¿™æ˜¯Map.Entry<K,V>\nä¹Ÿå°±æ˜¯éå†Mapçš„æ“ä½œ\néå†äº†plugin.getPluginLoader().createRegisteredListeners(listener, plugin).entrySet()\nè¿™åˆæ˜¯ä¸€ä¸ªä»€ä¹ˆMapå‘¢\n\næˆ‘ä»¬æ¥ä¸‹æ¥çœ‹org.bukkit.plugin.java.JavaPluginLoader\nè¿™æ˜¯PluginLoaderçš„å…·ä½“å®ç°ç±»\n\n\nÂ Â @NotNull\nÂ Â public Map<Class<? extends Event>, Set<RegisteredListener>> createRegisteredListeners(@NotNull Listener listener, @NotNull Plugin plugin) {\nÂ  Â  Set<Method> methods;\nÂ  Â  Validate.notNull(plugin, \"Plugin can not be null\");\nÂ  Â  Validate.notNull(listener, \"Listener can not be null\");\nÂ  Â  boolean useTimings = this.server.getPluginManager().useTimings();\nÂ  Â  Map<Class<? extends Event>, Set<RegisteredListener>> ret = new HashMap<>();\nÂ  Â  try {\nÂ  Â Â  Â Method[] publicMethods = listener.getClass().getMethods();\nÂ  Â Â  Â Method[] privateMethods = listener.getClass().getDeclaredMethods();\nÂ  Â Â  Â methods = new HashSet<>(publicMethods.length + privateMethods.length, 1.0F);\nÂ  Â Â  Â byte b;\nÂ  Â Â  Â int i;\nÂ  Â Â  Â Method[] arrayOfMethod1;\nÂ  Â Â  Â for (i = (arrayOfMethod1 = publicMethods).length, b = 0; b < i; ) {\nÂ  Â Â  Â Â Â final Method method = arrayOfMethod1;\nÂ  Â Â  Â Â Â methods.add(method);\nÂ  Â Â  Â Â Â b++;\nÂ  Â Â  Â } \nÂ  Â Â  Â for (i = (arrayOfMethod1 = privateMethods).length, b = 0; b < i; ) {\nÂ  Â Â  Â Â Â final Method method = arrayOfMethod1;\nÂ  Â Â  Â Â Â methods.add(method);\nÂ  Â Â  Â Â Â b++;\nÂ  Â Â  Â } \nÂ  Â  } catch (NoClassDefFoundError e) {\nÂ  Â Â  Â plugin.getLogger().severe(\"Plugin \" + plugin.getDescription().getFullName() + \" has failed to register events for \" + listener.getClass() + \" because \" + e.getMessage() + \" does not exist.\");\nÂ  Â Â  Â return ret;\nÂ  Â  } \nÂ  Â  for (Method method : methods) {\nÂ  Â Â  Â EventHandler eh = method.<EventHandler>getAnnotation(EventHandler.class);\nÂ  Â Â  Â if (eh == null)\nÂ  Â Â  Â Â Â continue; \nÂ  Â Â  Â if (method.isBridge() || method.isSynthetic())\nÂ  Â Â  Â Â Â continue; \nÂ  Â Â  Â Class<?> checkClass;\nÂ  Â Â  Â if ((method.getParameterTypes()).length != 1 || !Event.class.isAssignableFrom(checkClass = method.getParameterTypes()[0])) {\nÂ  Â Â  Â Â Â plugin.getLogger().severe(String.valueOf(plugin.getDescription().getFullName()) + \" attempted to register an invalid EventHandler method signature \\\"\" + method.toGenericString() + \"\\\" in \" + listener.getClass());\nÂ  Â Â  Â Â Â continue;\nÂ  Â Â  Â } \nÂ  Â Â  Â final Class<? extends Event> eventClass = checkClass.asSubclass(Event.class);\nÂ  Â Â  Â method.setAccessible(true);\nÂ  Â Â  Â Set<RegisteredListener> eventSet = ret.get(eventClass);\nÂ  Â Â  Â if (eventSet == null) {\nÂ  Â Â  Â Â Â eventSet = new HashSet<>();\nÂ  Â Â  Â Â Â ret.put(eventClass, eventSet);\nÂ  Â Â  Â } \nÂ  Â Â  Â for (Class<?> clazz = eventClass; Event.class.isAssignableFrom(clazz); clazz = clazz.getSuperclass()) {\nÂ  Â Â  Â Â Â if (clazz.getAnnotation(Deprecated.class) != null) {\nÂ  Â Â  Â Â  Â  Warning warning = clazz.<Warning>getAnnotation(Warning.class);\nÂ  Â Â  Â Â  Â  Warning.WarningState warningState = this.server.getWarningState();\nÂ  Â Â  Â Â  Â  if (!warningState.printFor(warning))\nÂ  Â Â  Â Â  Â Â  Â break; \nÂ  Â Â  Â Â  Â  plugin.getLogger().log(\nÂ  Â Â  Â Â  Â Â  Â Â Â Level.WARNING, \nÂ  Â Â  Â Â  Â Â  Â Â Â String.format(\nÂ  Â Â  Â Â  Â Â  Â Â  Â  \"\\\"%s\\\" has registered a listener for %s on method \\\"%s\\\", but the event is Deprecated. \\\"%s\\\"; please notify the authors %s.\", new Object[] { plugin.getDescription().getFullName(), \nÂ  Â Â  Â Â  Â Â  Â Â  Â Â  Â clazz.getName(), \nÂ  Â Â  Â Â  Â Â  Â Â  Â Â  Â method.toGenericString(), (\nÂ  Â Â  Â Â  Â Â  Â Â  Â Â  Â warning != null && warning.reason().length() != 0) ? warning.reason() : \"Server performance will be affected\", \nÂ  Â Â  Â Â  Â Â  Â Â  Â Â  Â Arrays.toString(plugin.getDescription().getAuthors().toArray()) }), (warningState == Warning.WarningState.ON) ? (Throwable)new AuthorNagException(null) : null);\nÂ  Â Â  Â Â  Â  break;\nÂ  Â Â  Â Â Â } \nÂ  Â Â  Â } \nÂ  Â Â  Â final CustomTimingsHandler timings = new CustomTimingsHandler(\"Plugin: \" + plugin.getDescription().getFullName() + \" Event: \" + listener.getClass().getName() + \"::\" + method.getName() + \"(\" + eventClass.getSimpleName() + \")\", pluginParentTimer);\nÂ  Â Â  Â EventExecutor executor = new EventExecutor() {\nÂ  Â Â  Â Â  Â  public void execute(@NotNull Listener listener, @NotNull Event event) throws EventException {\nÂ  Â Â  Â Â  Â Â  Â try {\nÂ  Â Â  Â Â  Â Â  Â Â Â if (!eventClass.isAssignableFrom(event.getClass()))\nÂ  Â Â  Â Â  Â Â  Â Â  Â  return; \nÂ  Â Â  Â Â  Â Â  Â Â Â boolean isAsync = event.isAsynchronous();\nÂ  Â Â  Â Â  Â Â  Â Â Â if (!isAsync)\nÂ  Â Â  Â Â  Â Â  Â Â  Â  timings.startTiming(); \nÂ  Â Â  Â Â  Â Â  Â Â Â method.invoke(listener, new Object[] { event });\nÂ  Â Â  Â Â  Â Â  Â Â Â if (!isAsync)\nÂ  Â Â  Â Â  Â Â  Â Â  Â  timings.stopTiming(); \nÂ  Â Â  Â Â  Â Â  Â } catch (InvocationTargetException ex) {\nÂ  Â Â  Â Â  Â Â  Â Â Â throw new EventException(ex.getCause());\nÂ  Â Â  Â Â  Â Â  Â } catch (Throwable t) {\nÂ  Â Â  Â Â  Â Â  Â Â Â throw new EventException(t);\nÂ  Â Â  Â Â  Â Â  Â } \nÂ  Â Â  Â Â  Â  }\nÂ  Â Â  Â Â Â };\nÂ  Â Â  Â eventSet.add(new RegisteredListener(listener, executor, eh.priority(), plugin, eh.ignoreCancelled()));\nÂ  Â  } \nÂ  Â  return ret;\nÂ Â }\nÂ Â \n\nåˆ«æ€¥ï¼Œä»”ç»†çœ‹\nÂ  Â  Map<Class<? extends Event>, Set<RegisteredListener>> ret = new HashMap<>();\nç®€å†™returnä¸ºretï¼Œè¿™æ˜¯åˆ›å»ºmapçš„æ“ä½œ\n\nÂ  Â Â  Â Method[] publicMethods = listener.getClass().getMethods();\nÂ  Â Â  Â Method[] privateMethods = listener.getClass().getDeclaredMethods();\nÂ  Â Â  Â methods = new HashSet<>(publicMethods.length + privateMethods.length, 1.0F);\n\nè¯´ç™½äº†å°±æ˜¯æŠŠä½ æ•´ä¸ªå®ç°Listenerç±»çš„æ‰€æœ‰æ–¹æ³•ç»™å­˜èµ·æ¥äº†ï¼ˆå…·ä½“å­˜å‚¨çš„ï¼Œç›´æ¥çœ‹ä¸Šé¢ï¼‰\næ¥ä¸‹æ¥æœ€æœ€æœ€æœ€é‡è¦çš„ï¼Œ@Interfaceï¼Œç»™æ–¹æ³•çš„æ³¨è§£\n\nÂ  Â  for (Method method : methods) {\nÂ  Â Â  Â EventHandler eh = method.<EventHandler>getAnnotation(EventHandler.class);\nÂ  Â Â  Â if (eh == null)\nÂ  Â Â  Â Â Â continue; \n\nè¿™é‡Œå°±æ£€æŸ¥äº†ï¼Œæ–¹æ³•æœ‰æ²¡æœ‰@EventHandlerè¿™ä¸ªæ³¨è§£\nå¦‚æœæœ‰ï¼Œé‚£ä¹ˆå†è¿›è¡Œä¸‹ä¸€æ­¥æ·»åŠ äº‹ä»¶ç›‘å¬çš„æ“ä½œï¼Œå¦åˆ™å°±å¿½ç•¥\n\n if ((method.getParameterTypes()).length != 1 || !Event.class.isAssignableFrom(checkClass = method.getParameterTypes()[0])) {\nÂ  Â Â  Â Â Â plugin.getLogger().severe(String.valueOf(plugin.getDescription().getFullName()) + \" attempted to register an invalid EventHandler method signature \\\"\" + method.toGenericString() + \"\\\" in \" + listener.getClass());\nÂ  Â Â  Â Â Â continue;\nÂ  Â Â  Â } \n\nè¿™ä¸ªæ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯æ£€æŸ¥å‚æ•°çš„é•¿åº¦\né‚£å°±å¯ä»¥å›ç­”ä¸€ä¸ªé—®é¢˜https://www.mcbbs.net/forum.php? ... 067519&pid=18709678\nè¿™ä¸ªå¸–å­çš„ç¬¬äºŒä¸ªäº‹ä»¶ç›‘å¬\n\nÂ  Â Â  Â Â Â @EventHandler\nÂ  Â Â  Â Â Â void onBreakPickaxe(PlayerItemBreakEvent e,Plugin plugin) {\n\nä¼šåœ¨registerçš„æ—¶å€™è¢«è¿‡æ»¤æ‰ï¼Œå› ä¸ºå‚æ•°åˆ—è¡¨é•¿åº¦ä¸æ˜¯1\nï¼ˆBukkitä¸å¯èƒ½çŸ¥é“ä½ çš„å¥‡å¥‡æ€ªæ€ªçš„å‚æ•°ï¼Œä»–åªèƒ½ç»™ä½ Eventå¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»è¿‡æ»¤\n\nä¸è¦ä¹±ï¼Œæˆ‘ä»¬å›åˆ°èµ·ç‚¹\n for (Map.Entry<Class<? extends Event>, Set<RegisteredListener>> entry : plugin.getPluginLoader().createRegisteredListeners(listener, plugin).entrySet())\nÂ  Â Â  Â getEventListeners(getRegistrationClass(entry.getKey())).registerAll(entry.getValue()); \n\nå†æ¥çœ‹\n\nÂ Â @NotNull\nÂ Â private HandlerList getEventListeners(@NotNull Class<? extends Event> type) {\nÂ  Â  try {\nÂ  Â Â  Â Method method = getRegistrationClass(type).getDeclaredMethod(\"getHandlerList\", new Class[0]);\nÂ  Â Â  Â method.setAccessible(true);\nÂ  Â Â  Â return (HandlerList)method.invoke(null, new Object[0]);\nÂ  Â  } catch (Exception e) {\nÂ  Â Â  Â throw new IllegalPluginAccessException(e.toString());\nÂ  Â  } \nÂ Â }\nÂ Â \n\n\nÂ Â @NotNull\nÂ Â private Class<? extends Event> getRegistrationClass(@NotNull Class<? extends Event> clazz) {\nÂ  Â  try {\nÂ  Â Â  Â clazz.getDeclaredMethod(\"getHandlerList\", new Class[0]);\nÂ  Â Â  Â return clazz;\nÂ  Â  } catch (NoSuchMethodException e) {\nÂ  Â Â  Â if (clazz.getSuperclass() != null && \nÂ  Â Â  Â Â Â !clazz.getSuperclass().equals(Event.class) && \nÂ  Â Â  Â Â Â Event.class.isAssignableFrom(clazz.getSuperclass()))\nÂ  Â Â  Â Â Â return getRegistrationClass(clazz.getSuperclass().asSubclass(Event.class)); \nÂ  Â Â  Â throw new IllegalPluginAccessException(\"Unable to find handler list for event \" + clazz.getName() + \". Static getHandlerList method required!\");\nÂ  Â  } \nÂ Â }\n\næˆ‘ä»¬æ¥è§¦åˆ°äº†https://bukkit.windit.net/javado ... nt/HandlerList.html\n\nprivate HandlerList getEventListeners(@NotNull Class<? extends Event> type) \næ³¨æ„å˜é‡åType\nä»€ä¹ˆæ„æ€ï¼Ÿæ¯ä¸€ä¸ªäº‹ä»¶çš„ç±»å‹ï¼Œéƒ½æœ‰è‡ªå·±çš„å¯¹åº”çš„Handlerï¼Œ\nè¿™äº›Handlerï¼ŒæŒ‰ç…§äº‹ä»¶ç›‘å¬çš„ä¼˜å…ˆçº§ï¼Œå­˜å‚¨äº†äº‹ä»¶ç›‘å¬çš„å¤„ç†å™¨\nå½“callEventæ—¶ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ï¼Œä¸€æ‰¹ä¸€æ‰¹è§¦å‘\n\npublic class HandlerList {\n\nÂ Â private final EnumMap<EventPriority, ArrayList<RegisteredListener>> handlerslots;\n\næ‰€ä»¥ï¼Œä¸Šé¢åœ¨éå†äº†Mapä¹‹åï¼ˆä¸è¦ä¹±æ‰ï¼Œä»”ç»†æ€è€ƒï¼‰\nå…¶å®å°±æ˜¯è·å–äº†å¯¹åº”çš„EventHandleræ³¨è§£çš„æ–¹æ³•çš„ç›¸å…³å‚æ•°\nå¾—åˆ°äº†äº‹ä»¶æœ¬èº«çš„Classï¼Œä¹Ÿå°±æ˜¯äº‹ä»¶çš„ç±»å‹\nç„¶åè·å–è¿™ä¸ªäº‹ä»¶çš„Handler\næœ€ååœ¨è¿™ä¸ªHandleré‡Œé¢åŠ å…¥äº‹ä»¶ç›‘å¬å™¨\nå½“callEventçš„æ—¶å€™ï¼Œå°±æŒ‰ç…§ä¼˜å…ˆçº§å»è°ƒç”¨\nè‡³äº@Interfaceçš„ç›¸å…³é—®é¢˜ å¯ä»¥çœ‹çœ‹@è•¾ç±³æ´›ä¼Š çš„è¯¦å°½å›å¤\nhttps://www.mcbbs.net/forum.php? ... 067519&pid=18709785\né‚£ä¹ˆç°åœ¨å¯èƒ½è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šåˆ°åº•å“ªé‡Œè§¦å‘äº†äº‹ä»¶ç›‘å¬ï¼Ÿï¼Ÿï¼Ÿ\nè¿™éƒ½æ˜¯OBCçš„CraftEventFactoryä»¥åŠå…·ä½“çš„NMSç±»çš„å®ç°äº†\nä¸¾ä¸ªä¾‹å­ï¼ˆSpigot1.15.2æ ¸å¿ƒï¼‰\nEntityItemç±»ï¼ˆç‰©å“å †æ‰è½ç‰©å®ä½“ï¼‰128è¡Œå¼€å§‹\n\nÂ  Â Â  Â if (!this.world.isClientSide && this.age >= this.world.spigotConfig.itemDespawnRate) {\nÂ  Â Â  Â Â Â if (CraftEventFactory.callItemDespawnEvent(this).isCancelled()) {\nÂ  Â Â  Â Â  Â  this.age = 0;\nÂ  Â Â  Â Â  Â  return;\nÂ  Â Â  Â Â Â } \nÂ  Â Â  Â Â Â die();\nÂ  Â Â  Â } \n",
    "replies": [
        {
            "author": "å¤æ˜åœ°å…”",
            "timestamp": 1593229080,
            "txt_content": "åŠ å€‹[codeå§]ï¼Œçœ‹è‘—å¯¦åœ¨ä¸èˆ’æœ"
        },
        {
            "author": "William_Shi",
            "timestamp": 1593231660,
            "txt_content": "ğŸšâ™¥ å‘è¡¨äº 2020-6-27 11:38\nåŠ å€‹[codeå§]ï¼Œçœ‹è‘—å¯¦åœ¨ä¸èˆ’æœ\nè®ºå›çš„ [codeæ’ä»¶] åä»£ç çš„ç°è±¡å¤ªä¸¥é‡äº†ã€‚ã€‚ã€‚å¾ˆä¹…ä»¥å‰è´ºå…°å†™äº†åŠä¸ªå°æ—¶çš„bungee configçš„è¯¦è§£å…¨åäº†ï¼Œæˆ‘å†™è¿‡çš„ä¸€ä¸ªpapiæ•™ç¨‹ä¹Ÿåè¿‡ï¼Œæ€»ä¹‹codeå°±ä¸é è°±\n\nåæ­£è¿™äº›éƒ½æ˜¯åç¼–è¯‘SDKæ‹¿åˆ°çš„æºç ï¼Œåœ¨jdguiã€fernfloweræ ¸å¿ƒçš„ideaç­‰ç­‰åœ°æ–¹éƒ½å¯ä»¥çœ‹"
        },
        {
            "author": "ç»“åŸå¸Œäºš",
            "timestamp": 1593265380,
            "txt_content": "William_Shi å‘è¡¨äº 2020-6-27 12:21\nè®ºå›çš„ [codeæ’ä»¶] åä»£ç çš„ç°è±¡å¤ªä¸¥é‡äº†ã€‚ã€‚ã€‚å¾ˆä¹…ä»¥å‰è´ºå…°å†™äº†åŠä¸ªå°æ—¶çš„bungee configçš„è¯¦è§£å…¨åäº†ï¼Œ ...\nåªè¦ç²˜è´´è¿‡å»ç”¨å°±æ²¡äº‹\nä¸è¦ç›´æ¥æ”¹å·²ç»æ•´å¥½çš„ä»£ç ï¼ˆçº¯æ–‡æœ¬ä¹Ÿæ²¡äº‹ï¼‰"
        },
        {
            "author": "LinKart",
            "timestamp": 1593363660,
            "txt_content": "ç§ƒå¤´è­¦å‘Šqwq å†æ‰å°±æ²¡äº†ï¼ï¼"
        }
    ]
}