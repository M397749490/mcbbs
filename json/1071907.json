{
    "title": "Replay延时摄影渲染满怎么办？",
    "author": "B站千里寻枫",
    "replyCount": 19,
    "timestamp": 1593832680,
    "txt_content": "我16核32线程的电脑 然后MC调了25G的内存，就是吃单核 CPU占用率才6\n渲染个几十米的都要半年",
    "replies": [
        {
            "author": "。—。",
            "timestamp": 1593832680,
            "txt_content": "HOPEMC 发表于 2020-7-6 22:20\n是个科技党，是在这里调吗？应该输入什么呢，核心数16c32t 4.0ghz 228G运行内存(32物理+196pcie4.0虚拟固 ...\n\n\n\n\nfile_1594049408000.jpg (207.95 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-6 23:30 上传\n\n\n\n\n-y -f rawvideo -pix_fmt bgra -s %WIDTH%x%HEIGHT% -r %FPS% -i - %FILTERS%-an -c:v libx264 -b:v %BITRATE% -pix_fmt yuv420p \"%FILENAME%\"\n先把默认参数复制下来，开个记事本存一下方便编辑（虽说切换一下编码预设也会重置），照着上面的例子和参数添加方法先直接1：1试一下-y -f rawvideo -pix_fmt bgra -s %WIDTH%x%HEIGHT% -r %FPS% -i - %FILTERS%-an -c:v libx264 -b:v %BITRATE% -pix_fmt yuv420p -threads 16 \"%FILENAME%\"，截图的话，因为轻薄本我不管咋整都基本跑满，图就不上了……\n话说看截图背景是纯原版录制的话，也可以考虑加个optfine，不过在处理器算力过剩的情况下一般也会有等显卡出图的情况发生……\n反正我是什么都不加是最快的，看情况吧"
        },
        {
            "author": "。—。",
            "timestamp": 1593843120,
            "txt_content": "hmcl可以生成bat启动客户端，内存先试试看最少能给多少，然后不停开同一个bat可以多开，replaymod的回放文件可以多复制出来几份避免弄乱，按照场景分镜把任务散开来吧"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1593843420,
            "txt_content": "。—。 发表于 2020-7-4 14:12\nhmcl可以生成bat启动客户端，内存先试试看最少能给多少，然后不停开同一个bat可以多开，replaymod的回放文 ...\n 我32G内存，渲染的时候要给调了30G占用15G，cpu才百分之五，哭了，不知道有没有懂FFmpeg路过的帮忙一下"
        },
        {
            "author": "。—。",
            "timestamp": 1593865200,
            "txt_content": "HOPEMC 发表于 2020-7-4 14:17\n我32G内存，渲染的时候要给调了30G占用15G，cpu才百分之五，哭了，不知道有没有懂FFmpeg路过的 ...\n\n\n\n\n\nimage.png (11.89 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-4 20:19 上传\n\n\n\n\n现在win10任务管理器里有3个指标可以粗略判断问题，第一行cpu，要是没满的话可以多开，开发插件的时候为了模拟多人模式经常挂上好几个客户端，第二个内存看整合包mod数量，适合就行，最后一行显卡，家用消费级显卡要是跑满了也没太多优化方法，如果是服务器上跑渲染有可能因为核显跑满拖慢速度，可以考虑在虚拟机里部署mesa驱动用处理器模拟显卡，至于ffmpeg方面，现在最新版replaymod默认好像已经是纯cpu压制，另外渲染速度也看游戏帧率设置为无限制的时候有多少帧，如果这个光影帧率太低的话可以考虑换个快点的\n"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1593865860,
            "txt_content": "我的意思呢就是网上有Replay中FFmpeg渲染器多核优化的教程，但是我看不明白，就是想如果懂FFmpeg多核优化有大佬可以帮到我，你的意思是叫我多看，但是懂渲染的都知道，一个是吃CPU GPU 内存，现在我电脑渲染视频的话大概得用20G-30G，总共内存才32G，如果再开一个渲染，显然不够的，内存超了设置的内存直接崩，但是他就是CPU吃不起来，所以满..."
        },
        {
            "author": "。—。",
            "timestamp": 1593866640,
            "txt_content": " 本帖最后由 。—。 于 2020-7-4 20:57 编辑 \nHOPEMC 发表于 2020-7-4 20:31\n我的意思呢就是网上有Replay中FFmpeg渲染器多核优化的教程，但是我看不明白，就是想如果懂FFmpeg多核优化有 ...\n回复点左下角回复按钮，不然我摸鱼的时候看不到提醒，ffmpeg多核渲染是有个threads的功能，但是内存占用目测降不下来，单个replaymod渲染端的内存占用是不是多了个0啊，大部分有点优化的整合包都能做到8G以内流畅运行，除非加了魔鬼级别的全3D模型材质包，那样显存会炸，要真是这样我只能推荐加内存……\nedit: 既然提到多核，ffmpeg的参数里可以手动加上-threads 某个数字 来指定要用多少颗核心压制视频，大部分新版里不加默认全用，有些特殊的处理器识别不到核心数的也可以加上，但是据说h264编码默认在不同压制阶段有不同的核心数要求，比如一段时间需要全核一起压制，一段时间需要超过核心数的线程压制，这个选项可以先压一个10秒左右的视频看看效果再决定加还是不加，另外ffmpeg几乎日更的开发版也可以试试看"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1593872460,
            "txt_content": "。—。 发表于 2020-7-4 20:44\n回复点左下角回复按钮，不然我摸鱼的时候看不到提醒，ffmpeg多核渲染是有个threads的功能，但是内存占用目 ...\n啊，你知道怎么操作嘛"
        },
        {
            "author": "。—。",
            "timestamp": 1593950100,
            "txt_content": "在ffmpeg的官方文档（https://ffmpeg.org/ffmpeg-all.html）里，可以查到，同时直接命令行启动ffmpeg可以知道参数的添加格式是在每一个输入输出文件之前添加\n\n\n\n\nimage.png (40.21 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-5 19:45 上传\n\n\n\n\n\n\n\n\nimage.png (55.97 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-5 19:47 上传\n\n\n\n\n\n我拿手机演示吧，首先是默认的什么参数都不加，8核处理器会直接跑满，同理加上-threads 0\n\n\n\n\nimage.png (162.12 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-5 19:40 上传\n\n\n\n\n\n\n\n\nimage.png (173.16 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-5 19:49 上传\n\n\n\n\n\n然后给输入输出都限制单线程，处理器利用率立马下降变成200%左右，视频编码的核心直接跑满，输入1核心，输出2核心的时候处理器利用率提升到300%左右，输入1输出3的利用率在400%，\n\n\n\n\nimage.png (47.81 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-5 19:51 上传\n\n\n\n\n\n\n\n\nimage.png (70.69 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-5 19:52 上传\n\n\n\n\n\n\n\n\nimage.png (85.51 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-5 19:53 上传\n\n\n\n\n\n整个过程差不多就是看情况调整输入和输出要用多少核心，但是一般默认不加的时候会自动按照跑满的情况分配"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1593955320,
            "txt_content": "我我我。。。我这是我的世界里面replayMOD的FFmpeg.\n\n\n\n\nFURBNW@[1HB2QCNS992~NJY.png (31.47 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-5 21:21 上传\n\n\n\n\n\n\nhttps://www.mcbbs.net/forum.php?mod=viewthread&tid=952909\n\n"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1594045200,
            "txt_content": "。—。 发表于 2020-7-5 19:55\n在ffmpeg的官方文档（https://ffmpeg.org/ffmpeg-all.html）里，可以查到，同时直接命令行启动ffmpeg可以知 ...\n是个科技党，是在这里调吗？应该输入什么呢，核心数16c32t 4.0ghz 228G运行内存(32物理+196pcie4.0虚拟固态作运内)\n\n\n\n\nNFB7QGHYPLGC9{MW%]Y22NE.png (116.45 KB, 下载次数: 0)\n\n下载附件\n\n2020-7-6 22:18 上传\n\n\n\n\n\n\n\n"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1594096320,
            "txt_content": "。—。 发表于 2020-7-7 00:00\n-y -f rawvideo -pix_fmt bgra -s %WIDTH%x%HEIGHT% -r %FPS% -i - %FILTERS%-an -c:v libx264 -b:v %BITR ...\n我用的是超级光追材质以及超级光追光影，几乎材质最大化，4K 120帧 7W码率"
        },
        {
            "author": "。—。",
            "timestamp": 1594096980,
            "txt_content": "HOPEMC 发表于 2020-7-7 12:32\n我用的是超级光追材质以及超级光追光影，几乎材质最大化，4K 120帧 7W码率 ...\n想整这种视频就应该买一堆TITAN显卡机柜组阵列，一张卡负责几十秒渲染的……\n再者ytb上目前类似的视频普遍都是一个场景一两秒gif，然后放个原版过场做对比，全称几十分钟都是这种画面的就挺可怕……"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1594114800,
            "txt_content": "。—。 发表于 2020-7-7 12:43\n想整这种视频就应该买一堆TITAN显卡机柜组阵列，一张卡负责几十秒渲染的……\n再者ytb上目前类似的视频普 ...\nhhh只有2080ti"
        },
        {
            "author": "。—。",
            "timestamp": 1594115520,
            "txt_content": "HOPEMC 发表于 2020-7-7 17:40\nhhh只有2080ti\n那replaymod和ffmpeg大概率不背锅……光影参数方面可以考虑调一下？"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1594117680,
            "txt_content": "。—。 发表于 2020-7-7 17:52\n那replaymod和ffmpeg大概率不背锅……光影参数方面可以考虑调一下？\n抗锯齿4X 精细度1.5X 其他两个2X 分辨率4k 材质包2048X 全高品质"
        },
        {
            "author": "。—。",
            "timestamp": 1594125540,
            "txt_content": "HOPEMC 发表于 2020-7-7 18:28\n抗锯齿4X 精细度1.5X 其他两个2X 分辨率4k 材质包2048X 全高品质\n我知识盲区外的知识是，挺多高端光影自带抗锯齿，让optifine再抗一遍提升不会太大，然后其他选项如果不是光影作者强烈要求一般保留1x不需要动，根据室内室外自动调整光影特效开关的功能有望在基岩版的RTX实现，不过JE版可以手动根据场景分镜调一调，方块普遍离自己很远，展示没有近景的风景的时候高分材质不一定看得出来，没有水面的地方相关特效可以临时关一下，总之现在做材质的发出来之前都至少优化到高端平台流畅运行的水平，几十分钟的视频全默认跑下来不至于要半年……"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1594131660,
            "txt_content": "。—。 发表于 2020-7-7 20:39\n我知识盲区外的知识是，挺多高端光影自带抗锯齿，让optifine再抗一遍提升不会太大，然后其他选项如果不是 ...\n现在我运行内存加到200G之后就快很多了，但是就是不吃多线程， 显卡吃不起来."
        },
        {
            "author": "。—。",
            "timestamp": 1594135800,
            "txt_content": "HOPEMC 发表于 2020-7-7 22:21\n现在我运行内存加到200G之后就快很多了，但是就是不吃多线程， 显卡吃不起来. ...\n现在主流的光影只是为了让普通玩家能至少20帧流畅，要做动画还是导出到C4D之类的比较正规点……\n或者看replaymod作者啥时候把导出到blender的坑填上，现在预设里最后一项就是了，专业的渲染软件也是几乎不需要怎么调就能跑满。现阶段能用的听说有mineways"
        },
        {
            "author": "B站千里寻枫",
            "timestamp": 1594139220,
            "txt_content": "。—。 发表于 2020-7-7 23:30\n现在主流的光影只是为了让普通玩家能至少20帧流畅，要做动画还是导出到C4D之类的比较正规点……\n或者看re ...\nC4D太繁琐烧脑了"
        }
    ]
}