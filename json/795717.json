{
    "title": "制作的第一个插件，特此分享源码----消费飞行",
    "author": "gjmeng",
    "replyCount": 8,
    "timestamp": 1526734680,
    "txt_content": "本插件是一个消费飞行插件，主要就是让玩家消费vault的金钱或者消费经验来飞行，源码是使用maven来构建的\n思路：\n    由主类onEnable()方法初始化，1.保存默认配置 2.将配置类保存到ConfigUtil中 3.注册command 4.加载vault插件 5.注册玩家的事件监听\n\npackage xin.rainyn.consumefly;\n\n//import省略\n\n/**\n * 消费飞行\n * [url=home.php?mod=space&uid=1231151]@author[/url] Rainyner\n *\n */\npublic class ConsumeFly extends JavaPlugin{\n        \n        @Override\n        public void onDisable() {\n                super.onDisable();\n                Logger.debug(\"消费飞行插件已卸载！！！  作者：Rainyner\");\n        }\n\n        @Override\n        public void onEnable() {\n                super.onEnable();\n                //保存默认配置文件，并获取到配置文件\n                saveDefaultConfig();\n                ConfigUtil.getConfig().setFileConfiguration(getConfig());\n                //设置命令对象\n                getCommand(\"consumefly\").setExecutor(new ConsumflyCommandExecutor());\n                //加载vault插件\n                if(ConfigUtil.getConfig().isVaultEnable() && !loadVault()) {\n                        Logger.consoleError(\"初始化Vault支持失败,请检测是否已经安装Vault插件，已禁用消费飞行插件！！！\");\n                }\n                //注册玩家的事件监听\n                Bukkit.getPluginManager().registerEvents(new PlayerListener(), this);\n                \n                //保存当前主类\n                Logger.CONSUMEFLY = this;\n                Logger.info(\"消费飞行插件已启用！！！  作者：Rainyner\",\"调试输出：\"+(ConfigUtil.getConfig().isDebug()?\"是\":\"否\"));\n                \n                //配置文件调试输出\n                Logger.consoleDebug(ColorUtil.GREEN_DAN_A + \"玩家加入显示提示信息：\"+(ConfigUtil.getConfig().isPlayerJoinMessageEnable()?\"是\":\"否\"));\n                Logger.consoleDebug(ColorUtil.GREEN_DAN_A + \"玩家加入提示消息：\");\n                for(String str : ConfigUtil.getConfig().getPlayerJoinMessage()) {\n                        Logger.consoleDebug(ColorUtil.GREEN_DAN_A + str);\n                }\n                Logger.consoleDebug(ColorUtil.GREEN_DAN_A + \"消费经验飞行：\"+(ConfigUtil.getConfig().isLevelEnable()?\"是\":\"否\"));\n                Logger.consoleDebug(ColorUtil.GREEN_DAN_A + \"未启用消费经验飞行的提示语：\"+(ConfigUtil.getConfig().getLevelMessage()));\n                Logger.consoleDebug(ColorUtil.GREEN_DAN_A + \"1级经验可飞行时间(秒)：\"+(ConfigUtil.getConfig().getLevelTime()));\n                Logger.consoleDebug(ColorUtil.GREEN_DAN_A + \"消费金币飞行：\"+(ConfigUtil.getConfig().isVaultEnable()?\"是\":\"否\"));\n                Logger.consoleDebug(ColorUtil.GREEN_DAN_A + \"未启用消费金币飞行的提示语：\"+(ConfigUtil.getConfig().getVaultMessage()));\n                Logger.consoleDebug(ColorUtil.GREEN_DAN_A + \"1金币可飞行时间(秒)：\"+(ConfigUtil.getConfig().getVaultTime()));\n                \n        }\n        \n        private boolean loadVault() {\n                boolean hasNull = false;\n                //初始化经济系统实例\n        RegisteredServiceProvider<Economy> economyProvider = getServer().getServicesManager().getRegistration(net.milkbowl.vault.economy.Economy.class);\n        if (economyProvider != null) {\n            if ((EconomyUtil.economy = economyProvider.getProvider()) == null) hasNull = true;\n        }\n        return !hasNull;\n        }\n\n        @Override\n        public void onLoad() {\n                super.onLoad();\n                Logger.setLogger(getLogger());\n                Logger.info(\"消费飞行插件已加载！！！  作者：Rainyner\");\n        }\n        \n}\n复制代码\n    当玩家输入命令时，通过ConsumflyCommandExecutor类来实例化对应的消费类，并调用对应消费类fly()方法，在消费接口的实现类中去设置飞行并扣除等级或金钱\npackage xin.rainyn.consumefly.command;\n\n//import省略\n\npublic class ConsumflyCommandExecutor implements CommandExecutor{\n        public boolean onCommand(CommandSender sender, Command cmd, String label, String[] args) {\n                if(!cmd.getName().equalsIgnoreCase(\"consumefly\")) {\n                        return false;\n                }\n                //判断是否是玩家，不是玩家提示信息\n                if(!(sender instanceof Player)) {\n                        sender.sendMessage(Logger.addPrefix(\"请在游戏内使用此命令，谢谢！！！\"));\n                        return true;\n                }\n                //强转为玩家类\n                Player player = (Player)sender;\n                \n                //没有参数，显示帮助信息\n                if(args.length == 0) {\n                        sendHelp(player);\n                        return true;\n                }\n                //帮助信息显示\n                if(args.length >= 1 && (\"help\".equals(args[0]) || \"?\".equals(\"args[0]\"))) {\n                        sendHelp(player);\n                        return true;\n                }\n                //根据第一个参数设置消费的类型\n                if(args.length >= 1 && (\"info\".equals(args[0]))) {\n                        info(player);\n                        return true;\n                }\n                Consume consume = null;\n                if(args.length >= 1 && (\"level\".equals(args[0]))) {\n                        consume = new LevelConsumeImpl();\n                }\n                if(args.length >= 1 && (\"vault\".equals(args[0]))) {\n                        consume = new VaultConsumeImpl();\n                }\n                if(consume != null) {\n                        consume.fly(player, args);\n                }else {\n                        player.sendMessage(ColorUtil.RED_4 + \"请输入正确的参数！！！\");\n                }\n                return true;\n        }\n        \n        \n        private void info(Player player) {\n                Map<String,String> map = new HashMap<String,String>();\n                map.put(\"消费经验飞行：\", ConfigUtil.getConfig().isLevelEnable()?\"是\":\"否\");\n                map.put(\"1级经验可飞行时间(秒)：\", ConfigUtil.getConfig().getLevelTime()+\"\");\n                map.put(\"消费金币飞行：\", ConfigUtil.getConfig().isVaultEnable()?\"是\":\"否\");\n                map.put(\"1金币可飞行时间(秒)：\", ConfigUtil.getConfig().getVaultTime()+\"\");\n                sendMap(player,map);\n        }\n        /**\n         * 给玩家发送帮助信息\n         * @param player\n         */\n        private void sendHelp(Player player) {\n                Map<String,String> map = new HashMap<String,String>();\n                map.put(\"/costfly info\", \"查询能够使用的消费方式\");\n                map.put(\"/costfly level num <num>\", \"使用等级飞行\");\n                map.put(\"/costfly level time <num>\", \"使用多少等级飞行多少秒\");\n                map.put(\"/costfly vault num <num>\", \"使用多少金币飞行\");\n                map.put(\"/costfly vault time <num>\", \"使用金币飞行多少秒\");\n                sendMap(player,map);\n        }\n        \n        private void sendMap(Player player, Map<String, String> map) {\n                player.sendMessage(ColorUtil.appendString(ColorUtil.LAN_1, \"======================== \",ColorUtil.QING_DAN_3,\"消费飞行\",ColorUtil.LAN_1, \" ========================\"));\n                for( Entry<String, String> entry : map.entrySet()) {\n                        player.sendMessage(ColorUtil.appendString(ColorUtil.PINK_DAN_5,entry.getKey(),\"  \",ColorUtil.GREEN_2,entry.getValue()));\n                }\n                player.sendMessage(ColorUtil.appendString(ColorUtil.LAN_1, \"===========================================================\"));\n        }\n\n}\n复制代码\n\nconsume接口：\npackage xin.rainyn.consumefly.consume;\n\nimport org.bukkit.entity.Player;\n\n/**\n * 所有的消费\n * @author Rainyner\n *\n */\npublic interface Consume {\n        /**\n         * 飞行统一对外函数\n         * @param player\n         * @param args\n         */\n        public void fly(Player player, String... args);\n}\n复制代码消费等级飞行的实现类\npackage xin.rainyn.consumefly.consume.impl;\n\n//import 省略\n\npublic class LevelConsumeImpl implements Consume{\n\n        public void fly(Player player, int num) {\n                //判断是否已经开启等级飞行\n                if(ConfigUtil.getConfig().isLevelEnable()) {\n                        //判断等级是否足够\n                        if(player.getLevel() >= num) {\n                                //计算飞行多长时间\n                                Long time = num * ConfigUtil.getConfig().getLevelTime();\n                                //扣除等级\n                                player.setLevel(player.getLevel() - num);\n                                //启动线程计时，到时停止飞行\n                                FlyRunnable runnable = new FlyRunnable(time, player);\n                                runnable.runTask(Logger.CONSUMEFLY);\n                                player.sendMessage(Logger.addPrefix(\"您使用\"+num+\"级来飞行\"+time+\"秒！！！\"));\n                        }else {\n                                player.sendMessage(Logger.addPrefix(\"您当前等级不足，请先升级！！！\"));\n                        }\n                }else {\n                        player.sendMessage(Logger.addPrefix(ConfigUtil.getConfig().getLevelMessage()));\n                }\n        }\n\n        public void flyTime(Player player, Long time) {\n                //判断是否已经开启等级飞行\n                if(ConfigUtil.getConfig().isLevelEnable()) {\n                        //计算需要多少等级\n                        int num = (int) (time / ConfigUtil.getConfig().getLevelTime());\n                        //如果不能整除，要多扣一级\n                        if(time % ConfigUtil.getConfig().getLevelTime() > 0) {\n                                num++;\n                        }\n                        //判断等级是否足够\n                        if(player.getLevel() >= num) {\n                                //扣除等级\n                                player.setLevel(player.getLevel() - num);\n                                //启动线程计时，到时停止飞行\n                                FlyRunnable runnable = new FlyRunnable(time, player);\n                                runnable.runTask(Logger.CONSUMEFLY);\n                                player.sendMessage(Logger.addPrefix(\"您使用\"+num+\"级来飞行\"+time+\"秒！！！\"));\n                        }else {\n                                player.sendMessage(Logger.addPrefix(\"您当前等级不足，请先升级！！！\"));\n                        }\n                }else {\n                        player.sendMessage(Logger.addPrefix(ConfigUtil.getConfig().getLevelMessage()));\n                }\n        }\n        \n        \n\n        public void fly(Player player, String... args) {\n                //先判断是否已经可以飞行\n                if(player.getAllowFlight()) {\n                        player.sendMessage(Logger.addPrefix(\"您已拥有飞行权限，无需再消费飞行！！！\"));\n                }else {\n                        if(args.length == 3) {\n                                if(\"num\".equals(args[1])) {\n                                        if(StringUtil.isInteger(args[2])) {\n                                                this.fly(player, Integer.parseInt(args[2]));\n                                        }else {\n                                                player.sendMessage(Logger.addPrefix(\"请输入正确的参数！！！\"));\n                                        }\n                                }\n                                if(\"time\".equals(args[1])) {\n                                        if(StringUtil.isInteger(args[2])) {\n                                                this.flyTime(player, Long.parseLong(args[2]));\n                                        }else {\n                                                player.sendMessage(Logger.addPrefix(\"请输入正确的参数！！！\"));\n                                        }\n                                }\n                        }else {\n                                player.sendMessage(Logger.addPrefix(\"请输入正确的参数！！！\"));\n                        }\n                }\n        }\n\n\n}\n复制代码消费金钱飞行的实现类\npackage xin.rainyn.consumefly.consume.impl;\n\n//import 省略\n\npublic class VaultConsumeImpl implements Consume{\n\n        public void fly(Player player, int num) {\n                //判断是否已经开启等级飞行\n                if(ConfigUtil.getConfig().isLevelEnable()) {\n                        //判断金钱是否足够\n                        if(EconomyUtil.economy.has(player, num)) {\n                                //计算飞行多长时间\n                                Long time = num * ConfigUtil.getConfig().getVaultTime();\n                                //扣除金币\n                                EconomyResponse response = EconomyUtil.economy.withdrawPlayer(player, num);\n                                if(response.type == ResponseType.SUCCESS) {\n                                        //启动线程计时，到时停止飞行\n                                        FlyRunnable runnable = new FlyRunnable(time, player);\n                                        runnable.runTask(Logger.CONSUMEFLY);\n                                        player.sendMessage(Logger.addPrefix(\"您使用\"+num+\"金币来飞行\"+time+\"秒！！！\"));\n                                }else {\n                                        player.sendMessage(Logger.addPrefix(ColorUtil.RED_4+\"金钱扣除失败：\"+response.errorMessage));\n                                }\n                        }else {\n                                player.sendMessage(Logger.addPrefix(\"您的金币不足\"+num+\"，不能启动飞行！！！\"));\n                        }\n                }else {\n                        player.sendMessage(Logger.addPrefix(ConfigUtil.getConfig().getLevelMessage()));\n                }\n        }\n\n        public void flyTime(Player player, Long time) {\n                //判断是否已经开启等级飞行\n                if(ConfigUtil.getConfig().isLevelEnable()) {\n                        //计算需要多少金币\n                        int num = (int) (time / ConfigUtil.getConfig().getVaultTime());\n                        //如果不能整除，要多扣1金币\n                        if(time % ConfigUtil.getConfig().getLevelTime() > 0) {\n                                num++;\n                        }\n                        //判断金币是否足够\n                        if(EconomyUtil.economy.has(player, num)) {\n                                //扣除金币\n                                EconomyResponse response = EconomyUtil.economy.withdrawPlayer(player, num);\n                                if(response.type == ResponseType.SUCCESS) {\n                                        //启动线程计时，到时停止飞行\n                                        FlyRunnable runnable = new FlyRunnable(time, player);\n                                        runnable.runTask(Logger.CONSUMEFLY);\n                                        player.sendMessage(Logger.addPrefix(\"您使用\"+num+\"金币来飞行\"+time+\"秒！！！\"));\n                                }else {\n                                        player.sendMessage(Logger.addPrefix(ColorUtil.RED_4+\"金钱扣除失败：\"+response.errorMessage));\n                                }\n                        }else {\n                                player.sendMessage(Logger.addPrefix(\"您当前等级不足，请先升级！！！\"));\n                        }\n                }else {\n                        player.sendMessage(Logger.addPrefix(ConfigUtil.getConfig().getLevelMessage()));\n                }\n        }\n\n        public void fly(Player player, String... args) {\n                //先判断是否已经可以飞行\n                if(player.getAllowFlight()) {\n                        player.sendMessage(Logger.addPrefix(\"您已拥有飞行权限，无需再消费飞行！！！\"));\n                }else {\n                        if(args.length == 3) {\n                                if(\"num\".equals(args[1])) {\n                                        if(StringUtil.isInteger(args[2])) {\n                                                this.fly(player, Integer.parseInt(args[2]));\n                                        }else {\n                                                player.sendMessage(Logger.addPrefix(\"请输入正确的参数！！！\"));\n                                        }\n                                }\n                                if(\"time\".equals(args[1])) {\n                                        if(StringUtil.isInteger(args[2])) {\n                                                this.flyTime(player, Long.parseLong(args[2]));\n                                        }else {\n                                                player.sendMessage(Logger.addPrefix(\"请输入正确的参数！！！\"));\n                                        }\n                                }\n                        }else {\n                                player.sendMessage(Logger.addPrefix(\"请输入正确的参数！！！\"));\n                        }\n                }\n        }\n\n\n}\n复制代码源码下载\n链接：https://pan.baidu.com/s/1WkrT_x3ForvcIYhIMPo_vg 密码：kxxc",
    "replies": [
        {
            "author": "gjmeng",
            "timestamp": 1526734740,
            "txt_content": " 本帖最后由 gjmeng 于 2018-5-20 10:11 编辑 \n\n本插件只是用于学习交流，由于有些bug，所以不要放到自己的服里使用下载地址重新附上：链接：https://pan.baidu.com/s/19STX51oV2tJjg3Fx91It7g 密码：ej25\ngithub:https://github.com/gjmeng/ConsumeFly"
        },
        {
            "author": "隔壁老吕",
            "timestamp": 1526737200,
            "txt_content": "大佬大佬，真是个666的插件"
        },
        {
            "author": "耗子",
            "timestamp": 1526746860,
            "txt_content": "分享源码请使用github"
        },
        {
            "author": "Create_Dreams",
            "timestamp": 1526826840,
            "txt_content": "提示: 作者被禁止或删除 内容自动屏蔽"
        },
        {
            "author": "gjmeng",
            "timestamp": 1526892240,
            "txt_content": "Create_Dreams 发表于 2018-5-20 22:34\n你好，在下想和你讨论一个project，请问您的联系方式是？\n可以加Q：913706016"
        },
        {
            "author": "GhostGuJI_Dada",
            "timestamp": 1548646140,
            "txt_content": "感谢分享，支持一下~"
        },
        {
            "author": "345793738",
            "timestamp": 1548706500,
            "txt_content": "支持一下，不过以后分享源码还是建议使用github或者coding"
        },
        {
            "author": "宇亓",
            "timestamp": 1552904220,
            "txt_content": "支持一下。"
        }
    ]
}