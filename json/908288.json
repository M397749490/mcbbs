{
    "title": "经验值从数据库读出，无法同步到玩家身上",
    "author": "二丫骑士",
    "replyCount": 0,
    "timestamp": 1566791760,
    "txt_content": "       从数据库已经把经验值读取出来了，但是在前台同步的时候绿条没有改变。我用的是player.setExperience()和player.setExp()两个方法试了一下都没效果。求大佬指点。\n     下面是我写的代码：\npackage com.github.donna;\nimport Util.ConnectionUtil;\nimport entity.PlayerInfo;\nimport org.bukkit.Bukkit;\nimport org.bukkit.entity.Player;\nimport org.bukkit.event.EventHandler;\nimport org.bukkit.event.Listener;\nimport org.bukkit.event.player.PlayerLoginEvent;\nimport org.bukkit.event.player.PlayerQuitEvent;\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\npublic class PlayerInfoListener implements Listener {\n    private  PlayerPlugin plugin;\n    public PlayerInfoListener(PlayerPlugin plugin) {\n        this.plugin = plugin;\n        Bukkit.getPluginManager().registerEvents(this,plugin);\n    }\n    Connection conn = ConnectionUtil.getConnection();\n    ResultSet rs=null;\n    PreparedStatement pstm=null;\n    PlayerInfo p = null;\n    @EventHandler\n    public void OnLogin(PlayerLoginEvent e){\n        Player player = e.getPlayer();\n        String uniqueId = player.getUniqueId().toString();\n        String name = player.getName();\n        try{\n            //判断是否是新玩家\n            String sql=\"select * from playerInfo where uniqueId=?\";\n            pstm = conn.prepareStatement(sql);\n            pstm.setString(1,uniqueId);\n            rs = pstm.executeQuery();\n            while(rs.next()){\n              p=  new PlayerInfo(rs.getString(\"name\"),\n                        rs.getString(\"uniqueId\")\n                ,rs.getInt(\"totalExperience\"));\n            }\n            //如果是新玩家则插入数据\n            if(p==null){\n                sql=\"insert into playerInfo(name,uniqueId,totalExperience) values(?,?,?)\";\n                pstm = conn.prepareStatement(sql);\n                pstm.setString(1,name);\n                pstm.setString(2,uniqueId);\n                pstm.setInt(3,0);\n                int i = pstm.executeUpdate();\n                if(i>0){\n                    System.out.println(\"添加成功！\");\n                }else{\n                    System.out.println(\"添加失败！\");\n                }\n            }\n            //如果是旧玩家，则把经验值显示出来\n            else{\n                int totalExperience = p.getTotalExperience();\n                player.giveExp(totalExperience);\n                System.out.println(\"gexp\"+player.getExp());\n            }\n        }catch (Exception exc){\n            exc.printStackTrace();\n        }finally {\n\n        }\n    }\n    @EventHandler\n    public void OnExit(PlayerQuitEvent e){\n        //当玩家退出的时候，把玩家经验值更新到数据库\n        Player player = e.getPlayer();\n        String uniqueId = player.getUniqueId().toString();\n        int totalExperience = player.getTotalExperience();\n        String sql=\"update playerInfo set totalExperience=? where uniqueId=?\";\n        try {\n            pstm = conn.prepareStatement(sql);\n            pstm.setInt(1,totalExperience);\n            pstm.setString(2,uniqueId);\n            int i = pstm.executeUpdate();\n            System.out.println(\"更新一条记录\"+i);\n            player.giveExp(totalExperience);\n        } catch (SQLException e1) {\n            e1.printStackTrace();\n        }\n    }\n}\n\n\n\n",
    "replies": []
}