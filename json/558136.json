{
    "title": "[sponge][maven]插件开发教程(慢更)-2-插件主类，Logger以及插件的生命周期",
    "author": "tiannian",
    "replyCount": 4,
    "timestamp": 1455722160,
    "txt_content": " 本帖最后由 tiannian 于 2016-2-17 23:59 编辑 \n\n第二章 插件主类，Logger以及插件的生命周期\n（一）服务器环境部署\n前一张我们已经创建了一个Sponge插件的eclipse工程，用来创建一个Sponge插件。但我们还需要一个Sponge服务器的运行环境。其实也就是一个正常服务器运行的的环境。\n首先我们需要选择一个Sponge的实现，前一章已经说过了，Sponge一共存在两种实现，分别是SpongeForge和SpongeVanilla，无论我们选择那个，都不会影响我们的正常开发，因为我们的开发是基于SpongeAPI进行的，SpongeAPI替我们屏蔽了两种实现的差异。\n而我们开发完成的插件是放在服务器的mods文件夹下进行使用的。\n（二）主类编写\n创建完工程后，我们就可以开始编写我们的主类了，第一步我们需要创建一个包，包名尽量按照oracle推荐的方式进行，使用自己的域名进行命名，假如没有域名的话，可以使用电子邮件或者github账户进行命名(io.github.username.project)(io.github.你的用户名.项目名)\n创建完毕的工程如下：\n\n\n\n\npackage.png (10.49 KB, 下载次数: 4)\n\n下载附件\n\n2016-2-17 23:52 上传\n\n\n\n\n\n之后我们就需要在创建好的包下面创建主类，Sponge的插件跟Bukkit插件不同，Bukkit试用plugin.yml指定插件的主类，而Sponge则将用@Plugin注解修饰的插件作为主类。\n@Plugin注解接受三个参数id，name，version。id参数必须是一个简单的，没有特殊字符与空格的标识符，name是插件的名称，version则是插件的版本。\n！注意！：善用eclipse的自动补全功能，当你自动补全一个类，接口，注解，对象，方法等的时候，eclipse会自动的替你完成包的导入工作，这样一来可以极大地减少你的工作量。\n创建完毕的主类如下所示：\n\n\n\n\n主类.png (7.98 KB, 下载次数: 4)\n\n下载附件\n\n2016-2-17 23:52 上传\n\n\n\n\n\n我们现在希望我们的插件，能够在插件加载时打印出一句“插件加载中。。。”。为了达到这个目的，我们首先需要使用@Inject注解将这个插件的Logger对象注入进来，并且为它设置一个getter方法。\n！注意！：在我们使用eclipse的自动补全时，注意类或接口所属的包，只有指定了正确的包的类或接口，eclipse才能正确的帮你试用import语句导入包。这里的@Inject注解位于com.google.inject包下，Logger类位于org.slf4j包下，下文中所有的类，接口，注解我都会用括号的形式标明它属于的包。\n！注意！：我们在产生getter方法的时候尽量采用eclipse产生的getter和setter方法，操作方法如下：\n\n\n\n\ngetter.png (29.3 KB, 下载次数: 4)\n\n下载附件\n\n2016-2-17 23:51 上传\n\n\n\n\n\n添加完代码的主类形如下：\n\n\n\n\ncode.png (15.52 KB, 下载次数: 4)\n\n下载附件\n\n2016-2-17 23:51 上传\n\n\n\n\n\n接下来我们就可以在主类中使用@Listener(org.spongepowered.api.event)注解注册一个被事件GameStartedServerEvent(org.spongepowered.api.event.game.state)调用的onServerStart()方法，并在这个方法中调用getLogger()的info方法输出一句“插件加载中。。。”，代码如下：\n\n\n\n\nend.png (19.59 KB, 下载次数: 4)\n\n下载附件\n\n2016-2-17 23:54 上传\n\n\n\n\n\n（三）打包jar包，并且运行此插件\n接下来我们就可以在项目上点击右键->Run As ->Maven Install。\n\n\n\n\n\ninstall.png (65.88 KB, 下载次数: 4)\n\n下载附件\n\n2016-2-17 23:53 上传\n\n\n\n\n\n然后再target目录下将会生成我们创造的这个插件，然后将它放置在我们部署好的Sponge服务器的mods目录下，启动服务器，启动过程中就能看到我们插件在日志中的输出了。\n----------------------------------------------------手动分割线---------------------------------------------\n下面的内容不想看可以不看，了解下就好。\n----------------------------------------------------手动分割线---------------------------------------------\n（四）Logger日志记录器\nSponge 使用org.slf4j.Logger，而不是java.utils.logging.Logger，这也是前面强调注意包名的原因。\nSponge的Logger一共有四个等级，分别是：\ngetLogger().info(\"Info...\"); //信息级别\ngetLogger().debug(\"Debug...\");//调试级别\ngetLogger().warn(\"Warn...\"); //警告级别\ngetLogger().error(\"Error\");//错误级别复制代码\n我们直接调用上面的代码中的中的方法就可以记录下不同级别的日志信息。\n\n（五）插件的生命周期(Plugin Lifecycle)\n！注意！：这一章在SpongeDocs中并未被完全汉化，这里我使用了某些自己的说法，假如有什么不正确的地方请大牛们指正。\n我们在主类中使用到了@Listener(org.spongepowered.api.event)注解修饰了一个onServerStart()方法，这个方法会在服务器实例创建完毕，并且世界加载完毕后被Sponge调用。这样的方法对应的状态事件(State Event)一共存在12种，会在服务器处于此状态时调用对应的方法。\n这12类状态事件分别是：\n游戏构造事件 GameConstructionEvent \n预构造事件 GamePreInitializationEvent 在这个状态，插件准备初始化，这个时间logger实例和配置文件的位置保证可用。\n初始化事件 GameInitializationEvent 在这个状态，插件应该结束所有的工作去准备插件的功能，全局事件句柄将会被注册。\n自检初始化事件 GamePostInitializationEvent 在这个状态插件间的内部沟通可以进行，插件支持的API也应该准备接受基础的请求\n加载结束事件 GameLoadCompleteEvent 在这个状态，所有的插件的初始化都应该结束。\n服务器将要启动事件 GameAboutToStartServerEvent 在这个状态，服务器实例存在，但世界未被加载。\n服务器启动中事件 GameStartingServerEvent 在这个状态，服务器实例存在，世界被加载，注册命令句柄。\n服务器启动完毕时间 GameStartedServerEvent 在这个状态，服务器实例存在，世界被加载。\n服务器停止中事件 GameStoppingServerEvent 这个状态在再最后一个tick前，世界保存前被立即引发。\n服务器停止事件 GameStoppedServerEvent 在这个状态，没有玩家的链接，世界被保存。\n游戏停止中事件 GameStoppingEvent 在这个状态，插件提供的API应该保持依旧有能力接收基础的请求\n游戏停止事件 GameStoppedEvent 一旦这个事件结束执行，minecraft将会被关闭。\n我们的开发可以根据不同的需求，在主类中注册不同的状态实现来执行与服务器状态有关的逻辑\n\n\n\n\n",
    "replies": [
        {
            "author": "wodeshijieglq",
            "timestamp": 1455818220,
            "txt_content": "sponge大法好"
        },
        {
            "author": "RecursiveG",
            "timestamp": 1455840240,
            "txt_content": "如果SpongeDoc没有翻译\n为什么不试着贡献点翻译上去呢？"
        },
        {
            "author": "tiannian",
            "timestamp": 1455849060,
            "txt_content": "RecursiveG 发表于 2016-2-19 08:04\n如果SpongeDoc没有翻译\n为什么不试着贡献点翻译上去呢？\n我倒是考虑过这个问题，不过因为我现在英文水平仅在能做到大致看懂而做不到严格翻译。再加上我还没有将整个文档上的内容实验完毕，防止搞错什么地方我才没有去提供翻译。"
        },
        {
            "author": "caizhong3",
            "timestamp": 1460342760,
            "txt_content": "geng xin la"
        }
    ]
}