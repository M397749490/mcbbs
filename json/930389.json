{
    "title": "玩家经验问题",
    "author": "凉凉丶",
    "replyCount": 1,
    "timestamp": 1575436980,
    "txt_content": "游戏中设置玩家经验为100此时经验等级为7\n但使用 player.giveExp(-100)减少经验时 游戏中输入XP 经验值变为0 经验等级依旧为7\n应该如去让经验等级和经验值一致",
    "replies": [
        {
            "author": "Ir.Nep",
            "timestamp": 1575461940,
            "txt_content": "1、玩家总经验值不起作用\n2、giveExp函数没有在浮动经验小于0时的处理\n该问题在1.14.4上测试已修复\n旧版本建议自写函数调用setLevel和setExp\npublic void giveExp(Player player, int exp) {\n                int level = player.getLevel();\n                int toNextLevel = getUpgradeExp(level);\n                int floatExp = (int) (player.getExp() * toNextLevel) + exp;\n                while(floatExp >= toNextLevel) {\n                        floatExp -= toNextLevel;\n                        toNextLevel = getUpgradeExp(++level);\n                }\n                while(floatExp < 0) {\n                        floatExp += (toNextLevel = getUpgradeExp(--level));\n                        if(level < 0) \n                                level = floatExp = 0;\n                }\n                player.setLevel(level);\n                player.setExp( (float) floatExp / toNextLevel);\n                player.setTotalExperience(getTotalExp(level) + floatExp);\n        }\n        \n        public int getUpgradeExp(int level) {\n                return level < 16  ? level * 2 + 7 : level < 30 ? level * 5 - 38 : level * 9 - 158;\n        }\n        \n        public int getTotalExp(int level) {\n                return (int) (level < 17 ? level * (level + 6) : level < 31 ? level * (level * 2.5 - 40.5) + 360 : level * (level * 4.5 - 162.5) + 2220);\n        }复制代码\n"
        }
    ]
}