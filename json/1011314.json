{
    "title": "服务器有时会突然卡一下 / 运行一段时间会卡死线程（后台爆红）",
    "author": "幽冥冥灬",
    "replyCount": 8,
    "timestamp": 1586316120,
    "txt_content": "RT\n\n整了个timings，哪位能帮我看看该如何下手优化：https://timings.aikar.co/?id=14201f5ae35e4b9fbac9584f981bae20",
    "replies": [
        {
            "author": "Salt_lovely",
            "timestamp": 1586318160,
            "txt_content": " 本帖最后由 Salt_lovely 于 2020-4-8 12:01 编辑 \n\n初步判断是LeaderHeadsRevamped获取头颅卡主线程\n\n尝试用这个插件修复一下？\n\n[管理|娱乐]HeadDropsSS —— 修复头颅导致的客户端假死和头颅掉落[1.14-1.15]\nhttps://www.mcbbs.net/thread-925378-1-1.html\n(出处: Minecraft(我的世界)中文论坛)\n\n我的锅，没看到版本是1.12\n\n建议后台挂代理/不用头颅排行榜"
        },
        {
            "author": "幽冥冥灬",
            "timestamp": 1586324280,
            "txt_content": "Salt_lovely 发表于 2020-4-8 11:56\n初步判断是LeaderHeadsRevamped获取头颅卡主线程\n\n尝试用这个插件修复一下？\n\n事实上我先前就试过了emm\n\n和leaderheads貌似没有多大关联，卸了后还是会出现突然卡顿一下\n\n我跑了一份新的timings：https://timings.aikar.co/?id=92ca851cf24042c48b211587ad3e5da9\n\n我目前怀疑的是可能是漏斗运作的问题（）"
        },
        {
            "author": "HYFan_Meng",
            "timestamp": 1586325960,
            "txt_content": "you＿ming 发表于 2020-4-8 13:38\n事实上我先前就试过了emm\n\n和leaderheads貌似没有多大关联，卸了后还是会出现突然卡顿一下\n漏斗相关的优化可参考这个帖子\nMinecraft服务器优化教程 —— 让多带50%的玩家不再是梦\nhttps://www.mcbbs.net/thread-478126-1-1.html\n(出处: Minecraft(我的世界)中文论坛)\nticks-per：内有hopper-transfer、hopper-check控制漏斗的运算周期，如果你的服务器有大量的漏斗红石设备，都设置为8可以显著解决漏斗带来的卡顿问题。"
        },
        {
            "author": "Salt_lovely",
            "timestamp": 1586330580,
            "txt_content": "you＿ming 发表于 2020-4-8 13:38\n事实上我先前就试过了emm\n\n和leaderheads貌似没有多大关联，卸了后还是会出现突然卡顿一下\n有可能是上一个timings报告生成的时候刚好出现了临时性的leaderheads卡服，导致这个插件耗能排名太高。\n说正事：\n\n1、地皮世界的漏斗卡服\n解决方案：\n在spigot.yml中：\nticks-per:\n  hopper-transfer: 8 #漏斗隔多久传输一次\n  hopper-check: 1 #漏斗间隔多久检查一次\nhopper-amount: 1 #漏斗每次传输复制代码改成\nticks-per:\n  hopper-transfer: 24 #漏斗隔24tick传输一次\n  hopper-check: 10 #漏斗间隔10tick检查一次\nhopper-amount: 3 #漏斗每次传输3个物品复制代码（其中传输间隔和传输数量最好按比例增大）\n\n2、MMOB（史诗怪物插件）卡服\n优化方案：\n在bukkit.yml中（对照着改，不要直接复制粘贴）\nspawn-limits: #注意：怪物上限=玩家人数x设置的上限\n  monsters: 25 #怪物上限，建议设置为35以下，人多/卡顿则可以设置为30以下\n  animals: 8 #动物上限，建议10以下\n  water-animals: 1 #水生生物上限，建议5以下\n  ambient: 1 #蝙蝠，建议2以下或者直接设置为没有蝙蝠（0）\nticks-per:\n  monster-spawns: 5 #怪物刷新间隔，建议设置为3以上复制代码\n在spigot.yml中（对照着改，不要直接复制粘贴）\n    merge-radius: #善用掉落物/经验球合并可以大大降低掉落物/经验球卡服的可能\n      item: 3.0 #掉落物合并距离\n      exp: 4.8 #经验球合并距离\n    entity-activation-range: #实体距离玩家多远以后会停止AI\n      animals: 24 #动物，建议24以下\n      monsters: 28 #怪物。建议28以下（服务器好的话可以试试32）\n      raiders: 36 #1.14的灾厄村民，建议36以下（低版本没有）\n      misc: 8 #掉落物、1.13的鱼等等，务必10以下，建议6以下（低版本一般指掉落物之类的物品）\n      tick-inactive-villagers: false #老版本可能没有，如果设置为true，那么即使玩家远离村民，村民依旧保持AI。复制代码\n在paper.yml中（对照着改，不要直接复制粘贴）\n    despawn-ranges: #怪物、鱿鱼、鱼等生物在玩家远离时消失\n      soft: 32 #多少格以外随机删除，建议32格以内\n      hard: 80 #多少格以外强制删除，建议36-80，推荐50以上（狙击手的对决成就需要玩家射杀一个50格开外的骷髅）复制代码"
        },
        {
            "author": "幽冥冥灬",
            "timestamp": 1586336340,
            "txt_content": "Salt_lovely 发表于 2020-4-8 15:23\n有可能是上一个timings报告生成的时候刚好出现了临时性的leaderheads卡服，导致这个插件耗能排 ...\n稍微会好了一点。。但还是会出现"
        },
        {
            "author": "Salt_lovely",
            "timestamp": 1586339220,
            "txt_content": "you＿ming 发表于 2020-4-8 16:59\n稍微会好了一点。。但还是会出现NeverLag::Event: j.l.AntiNetherHopperCheat (InventoryMoveItemEvent)count(1232) total(8.41%\nemmmm，neverlag是几年前的老插件了，这个BUG早就已经修复了（包括下界矿车刷物品的BUG）\n\nAntiNetherHopperCheat和AntiMinecraft这两个设置为false\n\n其他已经修好的BUG：FixPluginBug，AntiCountBug（你有另一个插件防御这个），FixQuickShop（QS早修复了，除非你还在用经典的老版QS）\n\n可以关闭的功能：AntiPMM（粘液块永动机是游戏的一部分），AntiRail（刷铁轨是游戏的一部分）"
        },
        {
            "author": "幽冥冥灬",
            "timestamp": 1586348820,
            "txt_content": "Salt_lovely 发表于 2020-4-8 17:47\nemmmm，neverlag是几年前的老插件了，这个BUG早就已经修复了（包括下界矿车刷物品的BUG）\n\nAntiNetherHo ...\n也不像是neverlag的问题，我隔壁空岛也是有在用nl\n配置基本相同，没有出现卡顿或者运行一段时间后卡死线程等问题\n\n头疼在这"
        },
        {
            "author": "幽冥冥灬",
            "timestamp": 1586505120,
            "txt_content": "稍微顶一下... 别沉了"
        }
    ]
}