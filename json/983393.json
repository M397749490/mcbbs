{
    "title": "[旋律工艺]开服从零起步到万事不求人——最适合什么也不懂的新手的教程|优化|查错",
    "author": "Rhythm",
    "replyCount": 6,
    "timestamp": 1583947140,
    "txt_content": " 本帖最后由 Rhythm 于 2020-3-12 13:58 编辑 \n\n前言:\n在成为许久的面板服务商之后\n我遇到了各式各样的萌新小白\n以及各种各样奇奇怪怪的问题\n为了偷懒 以及提高租客的用户体验\n决定编著一篇从零起步 以举例为主 原理解释为辅的无脑向教程\n\n\n概念 第一部分 了解什么是MC服务端、当大家谈到开服的时候 指的是什么——————————————————————————\n（解释各类常用的名词/概念）\n 一般有服务端/客户端概念\n通俗的讲 服务端本身是一个没有界面的游戏程序\n大家都玩过各种联机游戏/网游\n比如CF/CS/求生之路 想要和朋友一起玩游戏\n一般得新建房间 然后邀请朋友 然后大家就可以一起玩了\n开服指的就是新建房间这个过程 只不过在MC的环境下 通常更为专业化 更为复杂化\n一般开服有两种方式 一种直接通过联机平台 建立虚拟局域网 然后点击游戏内的联机按钮\n朋友只要按照提示连接进来即可 非常简单 非常便捷\n但相信看到此文的人肯定不仅仅满足于联机这么简单的目的\n毕竟想要开服的一般已经花费了金钱 简单的联机是不能满足各位的需求的\n也许要安装插件 也许要更高的流畅度 也许想要修改各种设置 也许想要装模组\n总之各种各样的需求都促使着我们使用第二种开服方式\n专用服务端（dedicated server）\n专用服务端一般和游戏内直接联机的最主要的区别\n就是没有游戏画面 是单独的程序 不是游戏和服务器一起的\n能满足一个最基本的需求 房主不在/不玩的时候其他人也能玩\n同时因为没有游戏画面 不需要显卡 也就可以在租用的无显卡服务器（指专用计算机）\n开服这里一般指使用专用服务端架设可以游玩的服务器\n\n\n概念 第二部分 MC服务端的各种类型——————————————————————————————\n众所周知 MC在2020年 分两个版本 \n基岩版/Java版\n那么首先就有两个大类 基岩版服务端/Java版服务端\n这里先讲Java版服务端 Java版服务端顾名思义 是可以供架设Java版游戏可游玩的服务器的专用程序\nJava版服务端目前主流分为三种（根据主流分类方式 是否有插件API 是哪种插件API划分）\n\n\n1.官方服务端\n2.Bukkit API服务端\n3.Sponge API服务端\n————————————————————————————————————\n先讲官方服务端\n官方服务端 顾名思义 由Mojang官方发布的服务端\n一般文件名为:minecraft_server.jar\n其包含完整的和单人游戏完全没有区别的内容\n可以修改默认难度 村民是否生成 等等设置 具体参考\nhttps://minecraft-zh.gamepedia.com/Server.properties\n但一个完全没有经过修改的官方服务端 是无法安装任何插件/MOD的\n但是MCBBS服务端整合版中 很多标题为官服端的服务端整合包 是带有MOD的\n这是怎么回事呢？ 就像客户端可以打Forge API装MOD一样 官方服务端也可以装MOD\n这里我们把没有安装Sponge 无论安装不安装Forge的官方服务端 都叫做官方服务端\n其优点是随游戏更新而更新 不会出现已经可以玩到新版本游戏却不能玩到新版本服务器的情况\n———————————————————————————————————————————————\n\n\n再讲Bukkit API服务端\nBukkit API服务端是支持Bukkit API插件的服务端\n全部都由第三方开发 因此可能游戏更新了但没有对应的服务端\n讲Bukkit API服务端 就不得不讲大家熟知的概念 插件（Plugin）\n这里我们对本篇教程内的插件这一词汇下个定义\n安装在服务端 不需要安装在客户端的修改内容 不修改客户端内容的 称之为插件（Plugin）\n那么什么是Bukkit API呢\n就像手机会有安卓系统和IOS系统一样\n你想要装APP 如果你用的是IOS 那么装的就是IOS APP\n你用的是安卓 那么装的就是安卓APP\n无论安卓APP还是IOSAPP 都叫APP\n无论Bukkit API插件 还是Sponge API插件 都叫插件\nBukkit API相当于能让你装插件的特殊系统\n常见的服务端 比如 Spigot CraftBukkit PaperSpigot 都属于Bukkit API服务端\nBukkit服务端只能安装Bukkit API的插件 就像苹果手机只能装苹果程序不能装安卓程序一样\n我们常见的 Authme 登录插件 Essentials 基础插件 GroupManager权限插件 都属于Bukkit API插件\n纯粹的Bukkit API服务端是不能安装MOD的 无论是什么MOD都不能安装\n但同时具有Bukkit API和Forge API的服务端 可以同时安装MOD和Bukkit插件\n比如CatServer PFServer Mohist等等\n截止2020 3月 任何Bukkit API服务端都是非官方的\n也就意味着可能有些版本没有 是正常现象\n————————————————————————————————————————————————————\n再讲Sponge服务端\n和上文一样 Sponge服务端是支持Sponge API插件的服务端\n是支持另一种插件系统的服务端\n现在以官服端的MOD形式实现\n说白了 安装有SpongeMod的Forge API官方服务端 就是Sponge服务端\n可以装Sponge API插件的 就是Sponge服务端\n————————————————————————————————————————\n三种服务端 到底选哪种好呢？\n我们这里只对三大类进行阐述\n想要玩最新的快照版本 就选官方服务端 因为其他两种属于第三方服务端 很可能没有快照版本\n不需要加Mod的话 推荐使用Bukkit API服务端\n因为Bukkit API服务端性能更好 插件更多 教程也更多\n能实现的功能更多 BUG更少 更稳定\n————————————————————————————————\n需要加MOD的话  首先取决于游戏版本\n目前 能够同时加Bukkit API插件和Forge API MOD的服务端\n只有1.4.7~1.7.10 1.12.2这几个版本（147之前的很难解释 不讲）\nSponge服务端只有1.10.2及以上的版本基础功能正常 低版本不推荐使用\n\n\n首先应该根据版本选择\n然后取决于你加多少MOD 加什么样的MOD\n如果你加的都是很热门 很常见的MOD 比如工业2 神秘时代 神奇宝贝等等的\n并且你还有装Bukkit API插件的需求 比如做商业服 做VIP 做菜单 做游戏内自助充值\n你应该选择Bukkit API服务端\n如果你加的都是冷门Mod 比如冰与火之歌 或者MOD数量特别多 一两百个\n比如RLCraft 比如各种FTB包 各种国外的多MOD整合包\n由于国外作者基本使用Sponge 所以建议你选择Sponge服务端\n他对模组的兼容性更好 几乎是百分百兼容\n\n\n概念 第三部分 什么是服务端核心 选择什么样的服务端核心——————————————————————————————————\n服务端核心 一般指具体的服务端程序 而不是某一类 \n比如CraftBukkit Spigot PaperSpigot CatServer等\n一般是服务端整合包根目录里后缀为.jar的文件\n什么是根目录 （一般为开服器/开服脚本所在的位置）————————————————————————————————————————\n这里教大家一个简单实用找到自己所用的服务端整合包的服务端核心的方法第一步 找到你的服务端整合包的开服文件比如 开服.bat run.bat\n第二部 右键 编辑该文件第三步 找到其中-jar空格后面的以.jar结尾的文件名如图所示 这个就是你的服务端核心文件名了 图一的对应文件就是你的服务端核心\n——————————————————————————————————————\n那么选择什么样的服务端核心呢 首先介绍常用服务端核心的不同\n\nCraftBukkit/Spigot 最原始的Bukkit API服务端 百分百支持Bukkit API所有插件\nPaperSpigot（Paper）基于Spigot修改的优化版服务端 兼容大部分Bukkit API插件 性能更好\nCatServer服务端 目前最好的1.12.2 可以同时装Forge API MOD和Bukkit API插件的服务端\nCauldron/MCPC-Plus（本质上一样） 1.4.7——1.7.10可以同时装ForgeAPI MOD和Bukkit API插件的服务端\nKCauldron 1.7.10可以同时装ForgeAPI MOD和Bukkit API插件的服务端 Forge版本更新到了 1664\nthermos KCauldron 的修改版本 修复一些Bug Mod兼容性更差 据说是性能更好\nuranium 国人开发的KCauldron修改版 主要目的是兼容高版本特性（十分不稳定）\n（作者自己都承认不稳定 作者自己表示没有修复拔刀）\nForge官服端 打了ForgeAPI的官方服务端 可以装Mod 不能装插件\nSponge服务端 在Forge官服端的基础上安装SpongeMOD 可以装Sponge插件和ForgeMOD\n\n\n那么怎么选择呢 当然是看各位的需求了\n个人建议 不玩模组 不装奇怪插件的 首选PaperSpigot\n个人建议 不玩模组 装奇怪插件的 首选Spigot\n1.4.7~1.6.4 玩主流模组+插件的 选择 Cauldron /MCPC-Plus\n1.7.10 玩主流模组+插件的 可以选择KCauldron / thermos\n1.7.10 玩非主流模组/FTB包+插件的 可以选择KCauldron / Forge官方服务端\n1.7.10 玩非主流模组/FTB包不要插件的 可以选择 Forge官方服务端\n1.10.2~1.12.2 玩模组的 不需要插件的 可以选择Forge官服端/Sponge服务端\n1.12.2 玩模组的 需要装模组和BukkitAPI插件的 选CatServer\n其他版本 需要玩模组的或者需要玩冷门模组的 选择Forge官方服务端\nFarbic/其他MOD api 过于冷门 在此不表 有兴趣的自己研究\n实战 开始开服————————————————————有了以上知识的你 现在可以开始正式学习如何开服了\n1.首先 需要安装Java展开折叠查看Java分大版本号/系统位数的区别32位Java只能分配1GB内存 不适合专业开服 不能利用内存64位Java则可以使用更多内存 适合专业开服\n大版本号这里只讲两个Java7/Java81.7.10及以上版本 使用Java8（Java8推荐使用191版本 191版本使用unsafe操作内存的延迟比后续版本低说人话就是 191版本一般情况下比其他版本开服性能更好）1.7.10/1.6.4以下版本 使用Java7因为这是最简单直接分辨兼容性的办法\n推荐Java8下载地址:https://pc.qq.com/detail/1/detail_21141.html（点击普通下载）Java官网上现在很难下载到离线包 下载速度很慢 而且下载到的是32位的\n\n个人对网上一些用其他版本Java运行服务端的看法：网传OpenJ9可以减少内存占用 性能还会更好我简单讲 这是假的 不可能\n安装完Java后 下载服务端核心/服务端整合包\n2.然后用记事本编辑/新建开服脚本文件（比如开服.bat 建议用英文 run.bat 能避免不必要的问题）\n最基本的开服脚本的内容为java -Xms1G -Xmx1G -jar xxx.jar\n其中xxx.jar为服务端核心文件名 在上文概念篇有提到如何获取-Xms1G 最小内存1G（还可以使用比如5000M这样的）-Xmx1G 最大内存1G （还可以使用比如5000M这样的）一般来讲 我们推荐内存充裕 只开一个服务端的用户 有多少内存 分配多少内存 最小和最大分配成一样的可以避免因为重复回收内存导致的性能损失如果开很多个服务端 而且人数不多 一会这个服务端人数多 一会那个服务端人数多可以设置不同的最小内存 一般最常玩人最多的服务器设置最多的最小内存这样便会动态分配内存 以小内存开更多服务端\n高级优化参数例如Java7的开服参数可以是（大型插件非常多，MaxPermSize可以设置得更高）：java -Xms最小内存 -Xmx最大内存 -XX:MaxPermSize=128M -XX:+AggressiveOpts -jar xxx.jar\nJava8的参数可以是：java -Xms最小内存 -Xmx最大内存 -XX:+AggressiveOpts -jar xxx.jar* 如果分配的内存大于等于4GB，建议使用 -XX:+UseG1GC 使用G1GC，并且把最小和最大内存设置为相同的大小java -Xms最小内存 -Xmx最大内存 -XX:+AggressiveOpts -jar xxx.jar\n\n这里讲一些个人经验 一般情况下 都可以不加任何高级优化参数 本人实测1.15.2原版服务端 不加任何优化参数的效果 比其他情况好建议大家自行对比测试 效果因人而异\n这里强烈建议新手按本文说明 新建开服脚本 而不是使用整合包内自带的原因：很多整合包作者水平很差 甚至使用Java6时代的-xingc参数 十分影响性能\n这里讲一下常见错误:'java' 不是内部或外部命令，也不是可运行的程序或批处理文件。\n该错误的原因是因为java没有安装好\n简单的方法是卸载java重装\n3.现在可以开始修改相关配置文件\n修改相关配置文件\n1. Eula文件\n从1.8开始 Minecraft服务端必须同意Eula才能开启\n将eula.txt里的false修改为true 保存即可\n2.服务端基础配置文件 Server.propertieshttps://minecraft-zh.gamepedia.com/Server.properties\n\n没什么好多说的 参考上文官方维基修改即可\n个人建议 server-ip没有特殊需求 留空 即server-ip=\nserver-port修改为服务商提供给你的外网端口/你自己映射的外网端口\n使用记事本修改！\n\n到此为止 双击你建立的服务端启动脚本 即可开服了\n开好后一般如下图\n\n如何判断服务端开好了没有？最简单最可靠的办法 输入 help tps list有输出 就是开好了 没有输出 就是没开好因为很多整合包插件很多 会报很多错 萌新不懂开好了没有特此备注加MOD/插件 以及常见问题解决方法\n1.加插件\n非常简单 Sponge插件放到服务端的mods文件夹里\nBukkit插件放到服务端的plugins文件夹里\n2.加模组\n把模组放到服务端的mods文件夹里 完事了\n\n\n加插件常见简单问题：\n1.加完插件后卡住动不了\n一般为插件使用主线程自动更新 但连不上更新服务器\n在配置文件里关闭自动更新即可\n2.中文乱码\nWindows平台下 1.8.8及以下版本服务端 使用ANSI编码\n1.8.8以上版本服务端 使用UTF-8无BOM编码\n\n\n加模组常见简单问题\n\n\n1.加完模组后卡住动不了\n一般为模组使用主线程自动更新 但连不上更新服务器\n解决方案：安装禁止更新MOD 非常有效\n下载地址:https://minecraft.curseforge.com/projects/non-update随便下载 全版本通用\n1.删完模组后卡住动不了\n\n一般为FML保护存档机制\n输入/fml confirm （要带/）\n等待服务端备份旧存档即可\n等待时间视存档大小而决定\n\n\n优化 服务器卡怎么办？（前提 服务器性能足够）\n\n\n首先必须了解的：\n\n\n1.不要安装多个优化插件\n多个优化插件可能都拥有区块卸载功能\n频繁卸载/加载区块会消耗大量CPU资源 导致服务器卡顿\n\n\n2.CatServer不要安装任何区块卸载插件\nCatServer的特殊性 导致其会超高频率卸载 吃满你的CPU\n如下图所示\n\n\n\n3.不要使用奇奇怪怪的优化参数 确保带宽没有达到服务商上限\n\n\n其他简单优化方式 推荐按照这个帖子做:\nhttps://www.mcbbs.net/thread-478126-1-1.html如标题一样 让多带50%玩家不是个梦 非常简单好操作\n更进一步 对症处理：\n——————————————————————————————————————\n\nBukkit插件服：\n使用timings查看Bukkit类服务端性能到底被什么占用\nhttps://www.mcbbs.net/forum.php?mod=viewthread&tid=971665\n\n下面对原教程图片做直接指示 更直观 新手更容易看懂\n\n\n\n\n\ntimingsv1.png (294.94 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-12 01:02 上传\n\n\n\n\n\n\n\n\n\n\ntimingsv22.png (280.99 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-12 01:02 上传\n\n\n\n\n\n\n\n\n\n\ntimingsv21.png (183.67 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-12 01:02 上传\n\n\n\n\n\n\n\nMOD服：\n————————————————————————————\n使用Spark来分析\nCPU100%的插件服可以用这个分析具体什么占用了CPU\n是以CPU时间为准的分析器\n下载地址:https://www.mcbbs.net/thread-823209-1-1.html安装方式:mod服装到mods里 插件服装到Plugins里Bukkit/Sponge/BungeeCord/Velocity应该使用spark.jar,而纯Forge/Fabric应该使用spark-forge.jar/spark-fabric.jar安装后输入/spark sampler启动分析分析一段时间后输入/spark sampler --stop停止分析会得到一个链接\n\n\n\n\n\n\n\n\nSpark.png (75.52 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-12 01:15 上传\n\n\n\n\n\n分析方式如图所示 其他的参考Timings 和Timings大同小异\n\n重要提醒:\n英文不是天书 不是外星文 是正常语言\n只要使用翻译器就可以很容易猜出各种逻辑\n翻译不正确的可以将关键词复制粘贴到百度搜索\n比如Player翻译为球员 百度搜索Player一般就会有Player是什么意思\n翻译器翻译不出的一般是短词不当\n比如onPlayerMove翻译不出 只要加空格改成 on Player Move\n基本规律很简单 在大写字母前加空格\n\n\n实战 装MOD蹦服怎么解决 如何查看蹦服报告———————————————————————————————————\n（未完待续 收集各类常见问题中···\n将以图文例子的方式写一篇小白都能看懂的蹦服报告\n只要对照本文抄作业即可）\n\n",
    "replies": [
        {
            "author": "Becod_",
            "timestamp": 1584339720,
            "txt_content": "希望能弄个目录\n单纯分割线方式太硬核也不方便查找"
        },
        {
            "author": "Rhythm",
            "timestamp": 1584344340,
            "txt_content": "Becod_ 发表于 2020-3-16 14:22\n希望能弄个目录\n单纯分割线方式太硬核也不方便查找\n这个教程建议一次性从头看到尾"
        },
        {
            "author": "肆火",
            "timestamp": 1584453120,
            "txt_content": "Rhythm 发表于 2020-3-16 15:39\n这个教程建议一次性从头看到尾\n建议1.12MOD服务端里加个Mohist，这个也很常用"
        },
        {
            "author": "gulangwang",
            "timestamp": 1584460860,
            "txt_content": "大佬 又到学习的时候了"
        },
        {
            "author": "Rhythm",
            "timestamp": 1584517380,
            "txt_content": "肆火 发表于 2020-3-17 21:52\n建议1.12MOD服务端里加个Mohist，这个也很常用\n我个人不推荐这个服务端"
        },
        {
            "author": "肆火",
            "timestamp": 1584522540,
            "txt_content": "Rhythm 发表于 2020-3-18 15:43\n我个人不推荐这个服务端\n我用起来还行，你是说remap问题吗。1.12已经修复了。反正多语言很爽~"
        }
    ]
}