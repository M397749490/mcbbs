{
    "title": "[已解决] foreach中 返回值",
    "author": "Hueihuea",
    "replyCount": 3,
    "timestamp": 1554024120,
    "txt_content": " 本帖最后由 skpsk自己家 于 2019-3-31 18:39 编辑 \n\nhttp://www.mcbbs.net/thread-822754-1-1.html\n该帖有这样一段代码\n\npublic class ChebishevTransformer implements IClassTransformer {\n//IClassTransformer：MC自带的launchwrapper工具所提供的类转换接口\n    @Override\n    public byte[] transform(String name, String transformedName, byte[] basicClass) {\n        FMLLog.log.warn(\"[Transforming...]\");\n        //在这里输出一个告警信息，告诉大家你在做什么，可选项\n        ClassNode classNode=new ClassNode(ASM5);\n        //声明一个ASM5的classNode\n        ClassReader classReader=new ClassReader(basicClass);\n        //声明一个读取basicClass的classReader\n        classReader.accept(classNode,0);\n        //让classReader接收到要修改的classNode/classVisitor，以产生事件\n        List<MethodNode> methodNodeList=new ArrayList<>(classNode.methods);\n        //由于我们的目标是要修改方法，因此要遍历一下MethodNode，将其保存在list中\n        for(MethodNode methodNode:methodNodeList){\n            if (transformedName.equals(\"net.minecraft.util.math.MathHelper\")&&methodNode.name.equals(\"func_76126_a(F)F\")) {\n            //if：transformedName是转换后的类名，因为你看到的代码是根据notch name反混淆出来的，methodName是它的srg name，    （F）F指参数为float，返回float\n                methodNode.instructions.clear();\n                //清除methodNode下的结构\n                methodNode.instructions.add(new InsnNode(FLOAD))\n                //添加你自己的实现，FLOAD代表传入float参数，其在ASM中规定的操作码（Opcode）是23\n                methodNode.instructions.add(new MethodInsnNode\n                        (ACC_PUBLIC + ACC_STATIC, \"Lcom/forestbat/warhammer/asm/ChebishevTransformer\", \"sin\", \"(F)D\", false));\n                //添加上你自己的实现，ACC_PUBLIC，ACC_STATIC是ASM中public和static的操作码（分别是0x0001和0x0008）；\n                //“Lcom/forestbat/warhammer/asm/ChebishevTransformer”是owner参数，表明方法的源头类；\n                //“sin”是name参数，表明我们的方法名；\n                //“(F)D”是“float形参，返回double”的description（描述符）；\n                //false表明了owner类（不是）一个接口，若是，则为true\n                methodNode.instructions.add(new InsnNode(DRETURN));\n                //DRETURN代表返回double值，其操作码是175\n            }\n            ClassWriter classWriter = new ClassWriter(2); \n            //声明一个classWriter写入内容，参数2的意义是COMPUTE_FRAMES，自动计算局部变量与操作数栈\n            //每当方法被调用一次栈上就会生成一个帧，帧又被分为局部变量和操作数栈，COMPUTE_FRAMES会帮你自动计算，但会拖慢性能\n            classNode.accept(classWriter);\n            //classNode接收classWriter做参数，向方法内部生成二进制代码\n            return classWriter.toByteArray();\n        }\n        return basicClass;\n        //返回被修改的basicClass\n}\n\n这里返回的值起到什么作用呢看错了\nforeach里return也是普通的返回\n哭了\n\n\n\n\n\n\n\n\n\nL({5ARP)]R3DLT(V$KD(8SV.png\n(3.07 KB, 下载次数: 0)\n\n\n\n\n下载附件\n\n\n2019-3-31 18:20 上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nUI~4PE)1ZBDUK%D{66SO048.png\n(38.37 KB, 下载次数: 1)\n\n\n\n\n下载附件\n\n\n2019-3-31 18:21 上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "Lucky_fish0w0",
            "timestamp": 1554025860,
            "txt_content": "这里返回的值返回的就是修改后的字节码数据, 将其提交给java进行加载."
        },
        {
            "author": "Hueihuea",
            "timestamp": 1554026460,
            "txt_content": "cx62d 发表于 2019-3-31 17:51\n这里返回的值返回的就是修改后的字节码数据, 将其提交给java进行加载.\nforeach的返回值要怎么接收呢……"
        },
        {
            "author": "森林蝙蝠",
            "timestamp": 1554028860,
            "txt_content": "http://www.mcbbs.net/thread-822754-1-1.html\n原代码有问题，for只会循环一次，已改正。"
        }
    ]
}