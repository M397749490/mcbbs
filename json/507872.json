{
    "title": "特殊用户组过期的严重问题的解决方案",
    "author": "awt2003",
    "replyCount": 2,
    "timestamp": 1443766680,
    "txt_content": " 本帖最后由 awt2003 于 2015-10-2 14:18 编辑 \n\n特殊用户组过期的严重问题的解决方案请注意！如果没有技术人员操作，有可能导致论坛混乱！请谨慎采纳我的意见！\n8月中旬，我被封禁\n封禁期限到后，发现自己一直卡在“购买用户组”的页面无法退出页面也无法访问论坛\n这个问题我在网上找了一下，发现了解决方案http://www.discuz.net/thread-2774613-1-1.html\n原帖内容（可能排版很乱）Discuz! X2用户组到期后不自动切换解决方案。\n\n\n方法一\n\n可以直接下载附件替换文件：\nsource/include/spacecp/spacecp_usergroup.php\n\n spacecp_usergroup.rar (3.92 KB, 下载次数: 1133) \n\n\n方法二\n\n修改文件：source/include/spacecp/spacecp_usergroup.php\n\n找到代码\n                $groupexpirynew = $groupterms['ext'][$groupid];复制代码替换为\n                $groupexpirynew = $groupterms['ext'][$extgroupidsnew];复制代码然后找到代码\n\n                        $expirylist[$group['groupid']]['grouptitle'] = in_array($group['groupid'], $expgrouparray) ? '<s>'.$group['grouptitle'].'</s>' : $group['grouptitle'];\n                }\n        }复制代码在它的下面加上如下代码：\n\n\n        if($expgrouparray) {\n\n                $extgroupidarray = array();\n                foreach(explode(\"\\t\", $_G['forum_extgroupids']) as $extgroupid) {\n                        if(($extgroupid = intval($extgroupid)) && !in_array($extgroupid, $expgrouparray)) {\n                                $extgroupidarray[] = $extgroupid;\n                        }\n                }\n\n                $groupidnew = $_G['groupid'];\n                $adminidnew = $_G['adminid'];\n                foreach($expgrouparray as $expgroupid) {\n                        if($expgroupid == $_G['groupid']) {\n                                if(!empty($groupterms['main']['groupid'])) {\n                                        $groupidnew = $groupterms['main']['groupid'];\n                                        $adminidnew = $groupterms['main']['adminid'];\n                                } else {\n                                        $groupidnew = DB::result_first(\"SELECT groupid FROM \".DB::table('common_usergroup').\" WHERE type='member' AND '\".$_G['member']['credits'].\"'>=creditshigher AND '$credits'<creditslower LIMIT 1\");\n                                        if(in_array($_G['adminid'], array(1, 2, 3))) {\n                                                $query = DB::query(\"SELECT groupid FROM \".DB::table('common_usergroup').\" WHERE groupid IN (\".dimplode($extgroupidarray).\") AND radminid='$_G[adminid]' LIMIT 1\");\n                                                $adminidnew = (DB::num_rows($query)) ? $_G['adminid'] : 0;\n                                        } else {\n                                                $adminidnew = 0;\n                                        }\n                                }\n                                unset($groupterms['main']);\n                        }\n                        unset($groupterms['ext'][$expgroupid]);\n                }\n\n                require_once libfile('function/forum');\n                $groupexpirynew = groupexpiry($groupterms);\n                $extgroupidsnew = implode(\"\\t\", $extgroupidarray);\n                $grouptermsnew = addslashes(serialize($groupterms));\n\n                DB::query(\"UPDATE \".DB::table('common_member').\" SET adminid='$adminidnew', groupid='$groupidnew', extgroupids='$extgroupidsnew', groupexpiry='$groupexpirynew' WHERE uid='$_G[uid]'\");\n                DB::query(\"UPDATE \".DB::table('common_member_field_forum').\" SET groupterms='$grouptermsnew' WHERE uid='$_G[uid]'\");\n\n        }复制代码\n\n\n\n附件：（阅读权限90）\n\n\n\nspacecp_usergroup.rar\n(3.92 KB, 下载次数: 1)\n\n\n\n2015-10-2 14:12 上传\n点击文件名下载附件\n阅读权限: 90\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "lzs1234",
            "timestamp": 1443771240,
            "txt_content": "论坛是x3…这是x2的解决方案…"
        },
        {
            "author": "极光酋长",
            "timestamp": 1443773880,
            "txt_content": "lzs1234 发表于 2015-10-2 15:34\n论坛是x3…这是x2的解决方案…\n论坛还有版本-.-\nhttp://www.discuz.net/thread-3422717-1-1.html"
        }
    ]
}