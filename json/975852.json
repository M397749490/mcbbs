{
    "title": "[原创|管理]TimeToRestart —— 计划关服/重启[全版本]",
    "author": "innc",
    "replyCount": 19,
    "timestamp": 1583259240,
    "txt_content": " 本帖最后由 innc 于 2020-8-1 18:23 编辑 \n\nTimeToRestart是参考了ww龙mc的AutoReload插件的功能做出来的，和AutoReload一样，TimeToRestart也是用于重新启动服务器，当然需要脚本的配合，但额外加入了一些新的功能：\n\n1. 添加了BossBar显示倒计时\n2. 添加了测试模式，打开测试模式的话倒计时结束后不会真的重启服务器，什么都不会发生\n3. 所有语言可配置，包括(广播的首条消息、Boss血条上的文字、重启前一刻被Kick出去的提示消息)\n4. 支持指令重载配置文件和立即触发重启倒计时\n5. 重启消息只会对后台发送两次，针对玩家则使用BossBar显示，不会有过多Log，即使玩家在倒计时期间加入游戏依然能够看到倒计时血条\n\n上图\n\n\n\n\nfile_1583258524000.jpg (121 KB, 下载次数: 0)\n\n下载附件\n\n2020-3-4 02:02 上传\n\n\n\n\n\n\n\n指令：(后台或者OP执行)\n/ttr reload   重新加载配置文件\n/ttr now   立即触发倒计时然后重启\n\n\n\n\n\nQQ截图20200304020345.png (13.77 KB, 下载次数: 3)\n\n下载附件\n\n2020-3-4 02:03 上传\n\n\n\n\n\n\n\n配置文件:\n\nenable: true # 插件总开关，/ttr now指令不受影响\ncountdown: 30 # 重启之前的倒计时时间(单位秒)\ntimes: # 所有时间点，24小时制，13:00和13:0都可以，如果不需要设置任何时间点可以设置唯一一个不存在的时间点比如(26:80)之类的\n  - \"26:80\"\n  - \"25:10\"\n  - \"30:15\"\nbroadcast-message: \"&b服务器重启倒计时: &c&l%time%\" # BossBar上面的消息\nfirst-message: \"&b服务器会在&c&l%time%&r&b秒之后重新启动!\" # 被广播的消息，玩家只会收到一次，后台会收到两次\nkick-message: \"&3&l服务器正在重启(3分钟左右)\" # 重启之前被踢出去的玩家收到的消息\ntest: true # 测试模式，如果打开只有提示而不会真的重启(只是虚张声势而已)，调试好后应该被关闭\n\n\n示例脚本(一分钟后重启)(Linux)#!/bin/bash\nwhile true\ndo\njava  -jar nukkit.jar\necho The server will restart in 1 minute\nsleep 1m\ndone复制代码Windows(一分钟重启)@echo off\n:start\nREM 默认60秒后重新启动\njava -jar nukkit.jar\n@ping 127.0.0.1 -n 60 >nul\ngoto start复制代码\n\n\n已知问题\n配置文件中的enable不会生效，也就是说插件会一直处于运行状态，无法通过配置这个项目进行禁用，如果需要插件停止工作，可以直接删除times及其所有的子节点或者写上唯一一个不可能存在的时间比如超过24小时的24:30之类的\n\n\n下载:\n(源代码一起打包,MIT许可证)\n插件: \n\n\n\nTimeToRestart-1.0.jar\n(11.17 KB, 下载次数: 84)\n\n\n\n2020-3-4 02:10 上传\n点击文件名下载附件\n\n\n\n\n\n\n配置文件模板: \n\n\n\nconfig.yml\n(276 Bytes, 下载次数: 145)\n\n\n\n2020-3-4 02:10 上传\n点击文件名下载附件\n\n\n\n\n\n\nBossBar部分代码参考: https://github.com/wode490390/RollBossBar\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "ilibili-BO泽",
            "timestamp": 1583281560,
            "txt_content": "沙发，好用，好评"
        },
        {
            "author": "Nyan-Cat",
            "timestamp": 1583497440,
            "txt_content": "出现只关闭，不重启的问题"
        },
        {
            "author": "龙魂d残雪",
            "timestamp": 1583506380,
            "txt_content": "支持一下awa"
        },
        {
            "author": "innc",
            "timestamp": 1583518860,
            "txt_content": "Nyan-Cat 发表于 2020-3-6 20:24\n出现只关闭，不重启的问题\n重启需要脚本的配合，关服后插件无法常驻后台来重启\nlinux: (这是我自己用的,关服后一分钟重启,并生成一个关服日志,内容为logs/server.log)#!/bin/bash</div><div>mkdir stopLogs\nwhile true\ndo\njava -jar nukkit#*.jar\necho it will restart in 1 minutes\nsleep 1m\na=$(date +%F_%H-%M-%S)\".txt\"\ncat logs/server.log >> ./stopLogs/$a\ndone</div>复制代码或者简化版本(一分钟后重启,但没有日志记录,如果需要更短的时间吧1m改为10s或者30s即可):\n#!/bin/bash\nwhile true\ndo\njava  -jar nukkit#*.jar\necho it will restart in 1 minutes\nsleep 1m\ndone复制代码windows: (自己开发插件用的,把nukkit#617.jar修改为自己的核心名字就ok)\n:start\njava -jar nukkit#617.jar\ngoto start复制代码\n"
        },
        {
            "author": "Nyan-Cat",
            "timestamp": 1583546700,
            "txt_content": "innc 发表于 2020-3-7 02:21\n重启需要脚本的配合，关服后插件无法常驻后台来重启\nlinux: (这是我自己用的,关服后一分钟重启,并生成一个 ...\n那Windows要怎么做，我服务器是Windows的"
        },
        {
            "author": "innc",
            "timestamp": 1583555460,
            "txt_content": "Nyan-Cat 发表于 2020-3-7 10:05\n那Windows要怎么做，我服务器是Windows的\n用windows脚本，我发给你的，把把nukkit#617.jar修改为自己的核心名字"
        },
        {
            "author": "Nyan-Cat",
            "timestamp": 1583559420,
            "txt_content": "innc 发表于 2020-3-7 12:31\n用windows脚本，我发给你的，把把nukkit#617.jar修改为自己的核心名字\n617版本好低啊，一定要改内核吗？"
        },
        {
            "author": "innc",
            "timestamp": 1583578320,
            "txt_content": "Nyan-Cat 发表于 2020-3-7 13:37\n617版本好低啊，一定要改内核吗？\n不是，617是我用的内核名字，之前一直开发插件用的，就没怎么更新，把这个nukkit#617.jar修改为自己的核心名字好吧，而不是换内核，比如你的内核名字叫nukkit-1.0-SNAPSHOT.jar你就把nukkit#617.jar，这14个文字换成nukkit-1.0-SNAPSHOT.jar就好了，linux同理，是换成自己实际正在用的内核的文件名，而不是更换整个内核。如果仍然不明白我也没办法了，建议参考这个帖子中相应的设置: https://www.mcbbs.net/thread-960329-1-3.html"
        },
        {
            "author": "Nyan-Cat",
            "timestamp": 1583593500,
            "txt_content": "innc 发表于 2020-3-7 18:52\n不是，617是我用的内核名字，之前一直开发插件用的，就没怎么更新，把这个nukkit#617.jar修改为自己的核 ...\n更换掉nukkit-1.0-SNAPSHOT.jar就是在更改内核啊，算了，你先发给我吧，麻烦你了"
        },
        {
            "author": "Nyan-Cat",
            "timestamp": 1583593860,
            "txt_content": "innc 发表于 2020-3-7 18:52\n不是，617是我用的内核名字，之前一直开发插件用的，就没怎么更新，把这个nukkit#617.jar修改为自己的核 ...\n只要在启动bat文件前加一句:start就可以了吧？"
        },
        {
            "author": "innc",
            "timestamp": 1583597280,
            "txt_content": "Nyan-Cat 发表于 2020-3-7 23:05\n更换掉nukkit-1.0-SNAPSHOT.jar就是在更改内核啊，算了，你先发给我吧，麻烦你了 ...\n不用更改内核文件，而是需要更改脚本中的nukkit-1.0-SNAPSHOT.jar或者更脚本中的nukkit#617.jar这段文字，是文字 不是文件，更改为你自己的内核名字，比如你自己的内核名字叫mynuukit.jar改成如下即可\n:start\njava -jar mynuukit.jar\ngoto start\n\n只需要修改上面品红色文字为你自己的核心文件名即可，我的叫nukkit#617.jar，你的不一定叫这个名字，根据你实际的文件进行修改即可\n\n\n关于加上:start，这是只是一个标签，需要配合goto使用，这涉及windows 批处理脚本知识，在此不做讲解，如需深入可以百度搜索教程或者Mcbbs也有相关教程"
        },
        {
            "author": "Nyan-Cat",
            "timestamp": 1583599740,
            "txt_content": "innc 发表于 2020-3-8 00:08\n不用更改内核文件，而是需要更改脚本中的nukkit-1.0-SNAPSHOT.jar或者更脚本中的nukkit#617.jar这段文字 ...\n没那么麻烦啊，我自己加上在开头:start就解决问题了，他就会重启了"
        },
        {
            "author": "Nyan-Cat",
            "timestamp": 1583599920,
            "txt_content": " 本帖最后由 Nyan-Cat 于 2020-3-8 00:55 编辑 \ninnc 发表于 2020-3-8 00:08\n不用更改内核文件，而是需要更改脚本中的nukkit-1.0-SNAPSHOT.jar或者更脚本中的nukkit#617.jar这段文字 ...\n\n:start\njava -jar mynuukit.jar\ngoto start\n这几段代码中的java那段只负责启动核心，重点是:start和goto start这两段代码，这两段代码使批处理执行完毕后会再次重复执行，有了这两段代码，即使输入stop也会变成重启，除非直接关闭窗口\n你一开始就讲的不清楚，和java那段代码根本没关系"
        },
        {
            "author": "innc",
            "timestamp": 1583648460,
            "txt_content": "Nyan-Cat 发表于 2020-3-8 00:52\n:start\njava -jar mynuukit.jar\ngoto start\n\n这跟我没有关系，这是windows批处理相关的知识，我的示例脚本只是提供一个最小的参考，具体的需求需要自己修改，我对win批处理也是不太深入，只能做一个参考，至于关服后立即重启，你可以加入一个延时命令再强制退出"
        },
        {
            "author": "Nyan-Cat",
            "timestamp": 1585902960,
            "txt_content": "你好\nliunx使用你提供的代码\n#!/bin/bash\nwhile true\ndo\njava  -jar nukkit.jar\necho The server will restart in 1 minute\nsleep 1m\ndone\ndone那行会报错，是什么原因"
        },
        {
            "author": "innc",
            "timestamp": 1585905840,
            "txt_content": "Nyan-Cat 发表于 2020-4-3 16:36\n你好\nliunx使用你提供的代码\n#!/bin/bash\n你用的什么发行版的Linux？我这边用Manjaro19、Ubuntu 18.04TLS、debian9.9测试均正常运行(均使用bash 执行脚本：/bash start.sh)\n另外请说明是报的什么错，请上传错误截图，你只说done那行报错我也不知道是什么原因，这个只是个简单的shell脚步循环，不会报错\n\n另附上我自用的脚本，你可以参考一下\n\n\n\n\nssss.png (37.94 KB, 下载次数: 0)\n\n下载附件\n\n2020-4-3 17:23 上传\n\n\n\n\n\n"
        },
        {
            "author": "innc",
            "timestamp": 1585905900,
            "txt_content": "Nyan-Cat 发表于 2020-4-3 16:36\n你好\nliunx使用你提供的代码\n#!/bin/bash\n如果有对Linux Shell不懂的地方还请自己百度，我也不是太懂这个，这个我自用的这个还是找我的朋友帮我做出来的"
        },
        {
            "author": "Nyan-Cat",
            "timestamp": 1585906560,
            "txt_content": " 本帖最后由 Nyan-Cat 于 2020-4-4 01:13 编辑 \ninnc 发表于 2020-4-3 17:25\n如果有对Linux Shell不懂的地方还请自己百度，我也不是太懂这个，这个我自用的这个还是找我的朋友帮我做 ...\n对不起"
        },
        {
            "author": "innc",
            "timestamp": 1585925580,
            "txt_content": "Nyan-Cat 发表于 2020-4-3 17:36\n是编码问题，不能直接用，要用vim转换编码才能用\n你是真的厉害！！！！！！全程英文的脚本还能有编码问题，请自行在Linux平台上测试一下，顶多是CRLF和LF的问题。另外，会用Vim的中阶操作却又看不懂常见的报错(不论是sh还是bash)的英文真的是一件很奇妙的事情，难道不是吗。全程漏洞百出，唉。。"
        }
    ]
}