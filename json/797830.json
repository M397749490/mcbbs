{
    "title": "【VAN】Java插件编程思想，以及为什么要填写这些复杂的包名，性感Coder，在线讲解(2)",
    "author": "kickbot_failed",
    "replyCount": 3,
    "timestamp": 1528189740,
    "txt_content": " 本帖最后由 kickbot_failed 于 2018-6-5 17:24 编辑 \n\n上一章咱成功引用了CraftBukkit的类库，为构建插件铺了一条良好的道路，但到实际做完一个可加载，可演示得插件，还需要一些步骤，本篇就是来说明这些步骤的。\n首先看上一章最后一幅图，我们需要结合项目目录来分析这副图上一些看不懂的东西。\n\n\n\n\n15.PNG (48.77 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 14:21 上传\n\n\n\n\n首先是默认包：这玩意初学者看得懵啊，啥叫默认包？Java还有默认包的概念吗？我教程怎么没有看到过？便顿时怀疑人生。不要慌，我们只要对照目录看一下，便能知道一半，下图为我创建的工程的根目录，如图，nbproject这个文件夹不需要去管他，这是NetBeans IDE生成的，我们只需要看src这个文件夹。\n\n\n\n\n16.PNG (19.61 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 14:34 上传\n\n\n\n\n\n但是当我们进入src里面之后，里面却空空如也，看来，默认包就是“啥都没有”，所以，我们暂且把默认包的观念定义为“啥都没有”。然后我们可以尝试在默认包里面创建一个Java文件，如下图\n\n\n\n\n17.PNG (69.16 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 14:42 上传\n\n\n\n\n\n\n\n\n\n18.PNG (77.24 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 14:43 上传\n\n\n\n\n\n\n\n\n\n19.PNG (73.92 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 14:45 上传\n\n\n\n\n\n\n\n\n\n读者应该注意到了，在创建Java文件的过程中，有一个提示很引人注目，“      警告: 强烈建议您不要将 Java 类放入默认包中。  ”，由此我们可以得到一个信息，项目中不推荐使用默认包，换言之，其实就是项目中不推荐“啥都没有”，那么根据刚才的推断可以得到，在一般开发项目中，哪怕不写Java文件，src文件夹里面肯定有东西，而根据我们日常使用windows的习惯，可以推断：src文件夹里有东西，有东西但是没有文件，那肯定就是目录了，据此我们再做出一个大胆推测：“包其实就是目录”。\n\n\n如何证明包就是目录呢？很简单，我们可以创建一个包，然后在新创建的包里面创建一个Java文件然后来分析目录\n\n\n\n\n20.PNG (86.19 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 15:01 上传\n\n\n\n\n\n\n\n\n\n21.PNG (85.3 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 15:02 上传\n\n\n\n\n\n\n\n\n\n22.PNG (90.39 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 15:04 上传\n\n\n\n\n\n\n\n\n\n23.PNG (84.08 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 15:06 上传\n\n\n\n\n\n\n\n\n\n25.PNG (31.13 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 15:12 上传\n\n\n\n\n\n相信读者也看得很明白了，包的机制就是目录结构，至于默认包，其实就是整个src目录就当成了一个默认包。而包的最大的作用想必就是将一模一样的Java文件隔离开来，形成命名空间的机制（命名空间为C++等语言的概念，Java里就称为包）\n细心的人在生成newpackage包下的NewClass文件时会看到默认包里的NewClass文件是不包含package newpackage;这句话的，关于这个，很多萌新刚开始写插件或者是刚刚接触jar打包方式，都会比较迷惑，然而许多插件教程却忽略了这一点，将package视为理所当然，我在这儿说一下好了，就举个栗子，你是一个人，你有一个家庭住址，当你把家庭住址告诉另外一个人，那个人就可以往你家寄刀片，相同的，这里package newpackage;的意思是告诉jar打包器：“我家在newpackage这个目录里面，如果其他类要调用我，那就到newpackage这个目录里来找我”，话说回来了，难道一定要遵守目录结构去写package语句吗？不，你完全可以写其他的，我就比方写package faker;，改成下面这个样子，然后创建包（包创建过程就不叙述了）。\n\n\n\n\n26.PNG (95.92 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 15:41 上传\n\n\n\n\n\n可以看到，IDE报错，却构建成功了，但这不是重点，我们用winrar软件去打开我们生成的jar文件，可以看到如下内容\n\n\n\n\n27.PNG (66.94 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 15:44 上传\n\n\n\n\n\n如上图，NewClass.class文件就是在默认包里，也就是整个包根目录里面，然后再打开newpackage包，发现里面空空如也，然后我们再打开faker包，发现里面出现了我们想看到的NewClass.class\n\n\n\n\n29.PNG (60.85 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 15:48 上传\n\n\n\n\n\n\n\n\n\n28.PNG (56.94 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 15:48 上传\n\n\n\n\n\n\n做了这么多，总结一下，不管你src里面的包再怎么修改，其实package faker;这条语句才是重点，它告诉jar打包器，faker才是那个class文件的家，然后打包器就把class放进了faker里了。搞明白了默认包的同时也对包有了一定的了解，接下来就可以开始编写插件了，首先清空掉之前所有建立的玩意儿，然后回到项目初始状态（本章第一张图），然后我们可以随心所欲地为我们的插件取上一个好听的名字而不用担心编译失败了，就现代而言，通常都用com作为最底的底包，然后一层一层下去，那么这里我用喜欢的名字搞一个吧，首先我创建一个com包\n\n\n\n\n30.PNG (59.88 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 16:00 上传\n\n\n\n\n\n正在尝试的同学会发现com包创建完，默认包就不见了，这个不要紧，咱们继续，我喜欢van这个名字（当今哲♂学天王之一？），那么我再创建一个van包\n\n\n\n\n31.PNG (61.23 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 16:02 上传\n\n\n\n\n\n\n这里两个包重合了，变成了com.van，读者会发现这很像域名倒过来写，其实这只是习惯，然而好多插件教程没写，导致初学者以为这是必须要写的东西，走了不少弯路\n\n至此我想要的包创建完了，然后可以把Java文件塞进去了，这里我创建了一个MyPlugin.java，完事儿后主界面如下\n\n\n\n\n\n32.PNG (84.16 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 16:09 上传\n\n\n\n\n\n然后就可以开始编写java文件了，因为我这里不讲java语法以及java语言机制，所以我直接略过了，写好以后如下\n\n\n\n\n33.PNG (98.87 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 16:15 上传\n\n\n\n\n\n然后就大功告成啦，然后点击构建，把jar文件放到服务器/plugins目录下，但服务器开启之后出现了万万没想到的内容\n\n\n\n\n34.PNG (45.98 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 16:20 上传\n\n\n\n\n\n奇怪，这个plugin.yml是个什么东西？为什么说无法加载插件，我从上一章开头就已经说明白了，插件一定要可识别、可插入，然而我们做到现在仅仅实现了插件的可插入，也就是通过接口实现了我们自己的插件，但是我们没有告诉服务器我们的插件能被识别啊，可见，当服务器找到jar包里面的yml文件的话并且yml得内容写正确，就可以让服务器加载我们的插件，于是可以查阅英文文档来得到信息，信息如下\n\n\n\n\n\n35.PNG (65.01 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 16:29 上传\n\n\n\n\n\n根据这一句话，和这段代码可以得出，我们需要编写一个plugin.yml文件然后放到项目的根目录，那么我们需要去项目文件夹创建一个plugin.yml好让Jar打包器将我们的plugin.yml打包进根目录：\n\n\n\n\n36.PNG (3.82 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 16:34 上传\n\n\n\n\n\n\n然后编写plugin.yml，注意：该文件格式要求特别特别严格，打错一个地方都会导致加载不了{$PluginName}的名字你可以自己设置{$PackageName}就是想要加载的类，该类所在包（该值不可乱写，否则会影响到服务器加载插件，导致你的插件无法加载）{$VersionNumber}版本号，反正随便设置\n\n这里写的代码如下\n\n\n\n\n37.PNG (8.84 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 16:43 上传\n\n\n\n\n\n上图有些需要注意的地方，因为yml格式特别苛刻，橙色的小点表示一个空格，CRLF表示按Enter换行，这里的yml就这三行，然后我们再次构建，放入服务器/plugins文件夹，运行服务器:\n\n\n\n\n38.PNG (39.95 KB, 下载次数: 0)\n\n下载附件\n\n2018-6-5 16:57 上传\n\n\n\n\n\n插件成功加载并且成功输出Hello World，成功出现这句话的朋友，恭喜你，如果还没有搞懂，再看一遍文章吧~\n\n\n\n\n\n24.PNG\n(80.39 KB, 下载次数: 0)\n\n\n\n\n下载附件\n\n\n2018-6-5 15:07 上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "replies": [
        {
            "author": "森林蝙蝠",
            "timestamp": 1528193340,
            "txt_content": "有几个意见啊：\nNetBeans没多少人用，占有率才百分之几的玩意，推荐用IDEA；\n字号太小，不太美观；\ncraftbukkit已经是过去时了，现在最好使用spigot/sponge进行开发。"
        },
        {
            "author": "kickbot_failed",
            "timestamp": 1528195980,
            "txt_content": "森林蝙蝠 发表于 2018-6-5 18:09\n有几个意见啊：\nNetBeans没多少人用，占有率才百分之几的玩意，推荐用IDEA；\n字号太小，不太美观；\n好的，谢谢"
        },
        {
            "author": "ddyy163",
            "timestamp": 1528267680,
            "txt_content": "性感coder?\n女装照呢"
        }
    ]
}