{
    "title": "1.15.2服务器tps问题",
    "author": "啊大",
    "replyCount": 15,
    "timestamp": 1583834580,
    "txt_content": "Avg tick每进一个人就增加10，5个人tps就18了，但是内存占用只有25%，cpu只有45%是什么原因？怎么才能提高1.15.2服务器的流畅容纳量？",
    "replies": [
        {
            "author": "极光creeper",
            "timestamp": 1583834580,
            "txt_content": " 本帖最后由 极光creeper 于 2020-3-10 19:46 编辑 \n\n哦豁，一提到优化问题，都是熟人面孔\n超棒的！！！\n\n我timings里看你用了cms，你可以考虑换一下g1gc的标志\n\n看你tps还算稳，你timings打出来都是20，所以不考虑从服务端配置上去优化了\n看起来开销大头是entity里的僵尸和村民，但目前不是很要命\n所以换个角度看问题的话\n我认为，至少有3个可能性\n\n1. GC的StopTheWorld过长，所以让你从cms换成g1gc，保证吞吐量，尽可能压低FGC的时间\n    不过，g1gc虽然说stw时间可控，但是也只是尽量压低到可控范围内\n    你可以去试试看\n    因为mc老年代一般不大、且硬件(cpu与内存)不够厉害的时候，cms可能没有我们想象的那么厉害\n2. lagpikes，这个不好救，原因说起来也是那几个开销大头，楼上的各位给出了不错的方法\n3. autosave，风险大，但是风险可控\n    请在测试完1与2均无明显效果后再使用本方案\n\n    这里有一个要指出的，你想提高cpu使用率、禁用autosave却是降低cpu使用率\n    但是其实提高cpu使用率的本意是减缓lagpikes\n    当地图、插件、玩家数据自动保存，写入文件时，这的确有可能导致延迟峰值lagpikes\n    使用定时备份与定时重启，每天重启3-4次，间隔8-6小时，尽可能保证数据不丢失\n    这样做会让你的不少数据塞在cache缓存里\n    请在测试完1与2均无明显效果后再使用本方案\n1与2要是有一些效果就不要用3，这个真的走投无路的选择\n"
        },
        {
            "author": "xmdhs",
            "timestamp": 1583834700,
            "txt_content": "正常现象，mc 的优化并不好。\n\n你可以看看这个教程 https://www.mcbbs.net/thread-916822-1-1.html?cp=8"
        },
        {
            "author": "啊大",
            "timestamp": 1583834760,
            "txt_content": "xmdhs 发表于 2020-3-10 18:05\n正常现象，mc 的优化并不好。\n\n你可以看看这个教程 https://www.mcbbs.net/thread-916822-1-1.html?cp=8 ...\n已经按照这个教程优化过一遍了，没有明显效果..."
        },
        {
            "author": "xmdhs",
            "timestamp": 1583834880,
            "txt_content": "啊大 发表于 2020-3-10 18:06\n已经按照这个教程优化过一遍了，没有明显效果...\n那就生成一个 timings 看下。\n\n而且不是用的 paper 的话，就换成 paper"
        },
        {
            "author": "啊大",
            "timestamp": 1583835120,
            "txt_content": "xmdhs 发表于 2020-3-10 18:08\n那就生成一个 timings 看下。\n\n而且不是用的 paper 的话，就换成 paper\nhttps://timings.aikar.co/?id=b81161cd16a74845bbad21cd7539db5e\n已安装EntityTrakerFixer，但是tps忽高忽低"
        },
        {
            "author": "EmptyLava",
            "timestamp": 1583835120,
            "txt_content": "关于内存\n其实是服务器用不了那么多，除非玩家跑太远\n关于cpu\n在任务管理器中右键javaw.exe,转详细信息后右键javaw.exe将优先级改为实时,这可以增加cpu的占用率从而提升tps(但服务器重启后需要重新配置,建议配合计划任务)"
        },
        {
            "author": "极光creeper",
            "timestamp": 1583835120,
            "txt_content": "补充下，如果有插件原因必须要spigot的话\n可以装PandaWire来优化红石算法\n是spigot开发者写的，和residence与citizen一样都是付费的，但可免费构建\n这贴继续留给xmdhs 我不是来抢爱心的"
        },
        {
            "author": "xmdhs",
            "timestamp": 1583835240,
            "txt_content": "啊大 发表于 2020-3-10 18:12\nhttps://timings.aikar.co/?id=b81161cd16a74845bbad21cd7539db5e\n已安装EntityTrakerFixer，但是tps忽高 ...\n全 20 基本没什么好看的\n\n这个插件装一个试试 https://www.mcbbs.net/thread-874306-1-1.html"
        },
        {
            "author": "EmptyLava",
            "timestamp": 1583835420,
            "txt_content": "服务器tps满的，优化了可能看不到明显的tps提升，但是会增加稳定性\n原因(2)\n1.均匀化的实体占用(各个实体占用都不高，但是加起来就很多)\n2.区块加载\n优化方案(4)\n1.在任务管理器中右键javaw.exe,转详细信息后右键javaw.exe将优先级改为实时,这可以增加cpu的占用率从而提升tps(但服务器重启后需要重新配置,建议配合计划任务)\n2.使用Yasui这个优化插件(站内)优化区块和实体，另外使用villager optimiser降低村民占用\n3.在bukkit.yml中增加monster-spawn的值，这会降低怪物刷新频率但是能降低很多实体占用\n4.在server.properties中设置view-distance为4-5，同时设置chunk-gc为300"
        },
        {
            "author": "炫宙菌",
            "timestamp": 1583836260,
            "txt_content": "啊大 发表于 2020-3-10 18:12\nhttps://timings.aikar.co/?id=b81161cd16a74845bbad21cd7539db5e\n已安装EntityTrakerFixer，但是tps忽高 ...\nSAML插件锁一下实体看看效果如何\nspigot.yml里面有个 这个改错了的话后果很严重 \nmax-tick-time:\n       tile: 1000\n       entity: 1000"
        },
        {
            "author": "离心丶",
            "timestamp": 1583836320,
            "txt_content": "你这个可能是CPU，尝试换更强的CPU吧"
        },
        {
            "author": "啊大",
            "timestamp": 1583839980,
            "txt_content": "极光creeper 发表于 2020-3-10 18:03\n哦豁，一提到优化问题，都是熟人面孔\n超棒的！！！\n哇，这么详细，感谢！"
        },
        {
            "author": "啊大",
            "timestamp": 1583852340,
            "txt_content": "极光creeper 发表于 2020-3-10 18:03\n哦豁，一提到优化问题，都是熟人面孔\n超棒的！！！\ng1gc是这个G1MixedGCLiveThresholdPercent参数吗？"
        },
        {
            "author": "极光creeper",
            "timestamp": 1583890800,
            "txt_content": "啊大 发表于 2020-3-10 22:59\ng1gc是这个G1MixedGCLiveThresholdPercent参数吗？\n可以直接用Aikar调整的参数\nhttps://www.mcbbs.net/thread-867786-1-1.html"
        },
        {
            "author": "啊大",
            "timestamp": 1583910900,
            "txt_content": "极光creeper 发表于 2020-3-11 09:40\n可以直接用Aikar调整的参数\nhttps://www.mcbbs.net/thread-867786-1-1.html\n为什么用了这个参数之后开服变慢了好多？"
        }
    ]
}