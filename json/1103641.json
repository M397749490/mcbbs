{
    "title": "1.12.2 CAT端服务器卡顿，求MOD服大佬进！",
    "author": "小兵gk",
    "replyCount": 15,
    "timestamp": 1597590120,
    "txt_content": " 本帖最后由 小兵gk 于 2021-1-15 08:16 编辑 \n\n目前已自行解决\n卡顿原因：\n樱mod的所有容器会导致莫名其妙的卡顿\n更新最新版本即可\n\n\n\n\n\n\nimage.png (44.71 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-16 22:34 上传\n\n\n\n\n\n如上图所示，服务器极其卡顿（撸个方块可能要撸好几遍的那种）TPS极其不稳定，目前新周目刚开放一周不到(后台被勒索数据丢失)重启后进入20人便会发生卡顿，原因未知我个人认为是MOD引发的卡顿，插件经过测试除报错外无任何问题，仅有部分玩家上线后非常卡顿也有大佬说是植物魔法导致的卡顿，但上周目后期删除植物魔法也是一样巨卡求大佬支招!有偿解决问题!（RMB报酬）QQ1841453417\n目前已尝试过的方案:1.在启动里增加更多的优化参数(已测无用)2.限制区块的产能花、火花等(已测无用)3.删除植物魔法、额外莫法(已测无用)4.添加NoSpawnChunks插件(稍微有点用，可以快速卸载卡顿的区块)\nMOD列表:\n\n\n\n\nimage.png (67.13 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-16 22:40 上传\n\n\n\n\n插件列表:\n\n\n\n\nimage.png (79.1 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-16 22:41 上传\n\n\n\n\ntimings报告(基本无用,看过的人都表示无能为力):https://www.spigotmc.org/go/timings?url=qihabedace\n\n\n\n\nimage.png (10.12 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-16 22:43 上传\n\n\n\n\n没这个插件也爆卡，但加完之后比之前流畅的要多很多\n\n",
    "replies": [
        {
            "author": "EmptyLava",
            "timestamp": 1597590660,
            "txt_content": "你倒是发timings啊(\n看着是方块实体的问题，但是 Catserver端对于方块实体的优化几乎=0，有一项可以大幅限制，但是玩家体验差不多就没了。\n可以考虑换sponge，有几项配置对于方块实体的优化很大\n\n如果你坚信是MOD导致的，Spark采样一次然后发给我链接"
        },
        {
            "author": "renyunzhong",
            "timestamp": 1597592160,
            "txt_content": "可以加一些优化类mod，调低服务器视距，限制实体等基础操作\n\n然后跟踪那些卡服玩家和TPS大户，可以在服务器卡顿时私信某个玩家登出或者t出去，看tps回升情况，然后找到吃tps大户的基地查看有什么共性，再对症下.药。\n\n如果可以安一个spark插件，卡顿时分析一下CPU占用组分，应该能说明不少问题"
        },
        {
            "author": "小兵gk",
            "timestamp": 1597598820,
            "txt_content": " 本帖最后由 小兵gk 于 2020-8-17 01:29 编辑 \nEmptyLava 发表于 2020-8-16 23:11\n你倒是发timings啊(\n看着是方块实体的问题，但是 Catserver端对于方块实体的优化几乎=0，有一项可以大幅限 ...\nwow大佬来了啊，timings在这\nhttps://www.spigotmc.org/go/timings?url=qihabedace\n\n\nSpark采样是指这个吗？需不需要服务器内硬性安装JDK\n\n\n\n\nimage.png (24.82 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-17 01:27 上传\n\n\n\n\n\n\n"
        },
        {
            "author": "小兵gk",
            "timestamp": 1597598880,
            "txt_content": "renyunzhong 发表于 2020-8-16 23:36\n可以加一些优化类mod，调低服务器视距，限制实体等基础操作\n\n然后跟踪那些卡服玩家和TPS大户，可以在服务器 ...\n基本上能优化的我已经尽我最大努力优化了，基本无用\n\n"
        },
        {
            "author": "EmptyLava",
            "timestamp": 1597619100,
            "txt_content": " 本帖最后由 EmptyLava 于 2020-8-17 07:07 编辑 \n小兵gk 发表于 2020-8-17 01:28\n基本上能优化的我已经尽我最大努力优化了，基本无用\n数据包传输占用比较大，先来排除插件问题吧，mod导致这个占用很高的情况不是很多。当然也可能是服务器配置不够高\n\n官方貌似给了方法，我直接引用给你吧，另外你现在尝试删除你觉得发送数据包较多的插件，或者用spark采样然后发个链接\nConnection Handler (previously labeled Player Tick) is a wide wrapper of many things involving processing a players incoming data to the server. This value being high does not represent a bug itself in \"Connection Handler\", but usually will include timings data from plugins too. \n\nIf you are seeing high values here, it could mean you have more players online than your server can support. It is important to remember that Minecraft gets slower every version update, and while you may of been able to support this many players in the past, you might not be able to anymore.\n\nIf you are using the player-shuffle setting (has a value other than 0) then that can cause extra lag here, and you should ensure that setting is 0. \n\nLook for other timings such as PlayerMoveEvent, PlayerInteractEvent, PlayerBlockBreakEvent and PlayerBlockPlaceEvent.\n\nThose having high timings will also be counted in this event, but they will be the problem. \n\nThere is very little other than player-shuffle (and a future setting) to reduce Connection Handler alone. You must simply lower your player count and ensure no plugins are being slow in the events listed above."
        },
        {
            "author": "f_k_h",
            "timestamp": 1597628640,
            "txt_content": "ChunkBlocksLimit\nNoSpawnChunks\n这二个插件删了吧占用太高了"
        },
        {
            "author": "renyunzhong",
            "timestamp": 1597636860,
            "txt_content": "小兵gk 发表于 2020-8-17 01:28\n基本上能优化的我已经尽我最大努力优化了，基本无用\n还有一个办法，就是叫上几个人开个新服务端，把mod删光，然后逐个逐个往里加，看加了什么或加了多少会卡，再根据需要调整mod数量。\n\n如果优化实在没用就只能减少大型mod数量，或者考虑升级服务器CPU主频也行。"
        },
        {
            "author": "小兵gk",
            "timestamp": 1597643220,
            "txt_content": "EmptyLava 发表于 2020-8-17 07:05\n数据包传输占用比较大，先来排除插件问题吧，mod导致这个占用很高的情况不是很多。当然也可能是服务器配置 ...\n如果是数据包问题，该如何查询呀\n服务器目前CPU: I9 9900K\n\n采样结果如下，分别是两个生存区\nhttps://spark.lucko.me/#A2mrHSFM7t\nhttps://spark.lucko.me/#sSIhVGRS6W"
        },
        {
            "author": "小兵gk",
            "timestamp": 1597643280,
            "txt_content": "f_k_h 发表于 2020-8-17 09:44\nChunkBlocksLimit\nNoSpawnChunks\n这二个插件删了吧占用太高了\n一个是区块限制，另一个是回收区块，我觉得没什么问题呀\n不加的时候也照样卡成狗"
        },
        {
            "author": "EmptyLava",
            "timestamp": 1597647360,
            "txt_content": "小兵gk 发表于 2020-8-17 13:47\n如果是数据包问题，该如何查询呀\n服务器目前CPU: I9 9900Knet.minecraft.world.WorldServer.func_72939_s()39.89%23932ms\nnet.minecraft.network.NetworkSystem.func_151269_c()22.35%net.minecraft.world.WorldServer.func_72835_b()13.98%\nnet.minecraft.util.Util.func_181617_a()9.77%加粗部分，一个是Mod的数据包传输，另一个玩家的活动。这里就占了30%挺麻烦的，你先把server.properties中的网络压缩阈值设置为-1吧，\n\n其他的话我看到了实体占用有点高，你发一下bukkit.yml和spigot.yml吧，我帮你改一改"
        },
        {
            "author": "小兵gk",
            "timestamp": 1597649280,
            "txt_content": "EmptyLava 发表于 2020-8-17 14:56\n加粗部分，一个是Mod的数据包传输，另一个玩家的活动。这里就占了30%挺麻烦的，你先把server.properties ...\n能否查询是哪个MOD呢\n还有就是默认阀值已经是-1了\n\n\n\nspigot.yml\n(3.37 KB, 下载次数: 3)\n\n\n\n2020-8-17 15:28 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n\n\n\nbukkit.yml\n(1.04 KB, 下载次数: 3)\n\n\n\n2020-8-17 15:28 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n\n"
        },
        {
            "author": "EmptyLava",
            "timestamp": 1597650060,
            "txt_content": "小兵gk 发表于 2020-8-17 15:28\n能否查询是哪个MOD呢\n还有就是默认阀值已经是-1了\n能看，你展开后看前面黑体字的包名就知道是什么mod了\n\nbukkit.yml内monster-spawns可以设置为40或者80。设置为5没什么意义。chunk-gc的第二个数值恢复默认就行"
        },
        {
            "author": "小兵gk",
            "timestamp": 1597676400,
            "txt_content": "EmptyLava 发表于 2020-8-17 15:41\n能看，你展开后看前面黑体字的包名就知道是什么mod了\n\nbukkit.yml内monster-spawns可以设置为40或者80。 ...\n我删掉了占用最高的林业MOD\n以及测试了有无两个timings占用最高的两个插件的对比(左边没删右边删了)\n我分别用了两个生存子服进行了有无这两个插件的对比，很玄幻明显删除后更卡了\n\n\n\n\n\nimage.png (249.12 KB, 下载次数: 0)\n\n下载附件\n\n2020-8-17 22:50 上传\n\n\n\n\n\n\n并且就在刚刚TPS瞬间降至8~9左右极其卡顿\n但又在10分钟左右后恢复正常了(18~19左右)\n大佬能否留个QQ方便联系(表示有些地方看不懂)\n\n\n\n这是卡顿时的采样请大佬过目:\nhttps://spark.lucko.me/#izfVQkwuS6"
        },
        {
            "author": "EmptyLava",
            "timestamp": 1597712280,
            "txt_content": "小兵gk 发表于 2020-8-17 23:00\n我删掉了占用最高的林业MOD\n以及测试了有无两个timings占用最高的两个插件的对比(左边没删右边删了)\n我分 ...\n受别的影响波动比较大，比如玩家数量之类的\n\n粗略看是在跑图¿\n\n\nQQ 2919223152"
        },
        {
            "author": "小兵gk",
            "timestamp": 1610669520,
            "txt_content": " 本帖最后由 小兵gk 于 2021-1-15 08:13 编辑 \n\n目前已自行解决\n卡顿原因：\n樱mod的所有容器会导致莫名其妙的卡顿\n更新最新版本即可"
        }
    ]
}