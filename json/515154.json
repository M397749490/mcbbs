{
    "title": "【紧急修复】关于1.6.2或1.6.4的低版本被恶意NBT漏洞攻击的解决方案",
    "author": "rhyme",
    "replyCount": 30,
    "timestamp": 1445585520,
    "txt_content": " 本帖最后由 rhyme 于 2015-10-23 15:37 编辑 \n\n大家好，我是龙猫服管理员（现叫HIM服）。我服务器已停留在1.6.2这个版本很久了，相信也会有很多服务器的管理员迫于无奈滞留在这个较老的版本。由于之前我的服务器一直是离线登陆，所以很少遭受到162的版本BUG攻击，但由于近期我开放了游戏内登陆的渠道，越来越多的BUG出现了，某些熊孩子喜欢利用现成的工具、漏洞来进行攻击其他人的服。首先我对这种行为感觉到无聊、可耻。minecraft这个游戏如果一直沉迷于见人服人数多就眼红的状态，迟早这个游戏也会在国内慢慢湮灭。抛弃正版、盗版不谈，盈利非盈利不说，我觉得首先这些人的心术不正，觉得自己在伸张正义，干着一些鸡鸣狗盗的事。\n\n于是我服务器在昨晚被某个我的世界熊孩子吧的小吧主利用NBT漏洞攻击。这是此人的帖子：http://tieba.baidu.com/p/4117136414 我之前曾经研究过这个BUG的原理，但由于暂时未受到攻击我没有修复，但这次我决定修复这个BUG。于是昨凌晨1点我修复了此BUG，（该名熊孩子小吧主今早9点37又再次尝试利用漏洞攻击，发现无果，放弃），此行为验证了我这个修复补丁的有效性，在此我感谢此小吧主，如果不是你，我不会决定修复这个BUG，可能有更多的162的腐竹会受到殃及，可能会被某些人勒索、敲诈、各种威逼利诱。\n\n此BUG攻击的表现：\n1.首先你的CPU和内存会爆满（占用100%）\n2.你的服务端会直接失去响应，并卡死。\n3.从游戏的防火墙封包上看无任何特殊征兆（因为攻击者是利用了普通的封包来触发MC底层的漏洞）\n\n\n如果你出现了这些状况，并且版本是1.6.2（1.6.4暂未测试，但我感觉也应该能用）。请按以下教程去进行修复。\n\n修复步骤：\n1.用winrar压缩软件打开你的服务端\n\n\n\n\nQQ截图20151023152906.jpg (111.19 KB, 下载次数: 23)\n\n下载附件\n\n2015-10-23 15:29 上传\n\n\n\n\n\n\n\n2.找到如图所示的路径和文件\n\n\n\n\nQQ截图20151023152955.jpg (178.61 KB, 下载次数: 22)\n\n下载附件\n\n2015-10-23 15:30 上传\n\n\n\n\n\n\n\n3.将下载的文件解压后获得NBTTagList.class替换进去\n\n\n\n\nQQ截图20151023153020.jpg (2.99 KB, 下载次数: 22)\n\n下载附件\n\n2015-10-23 15:30 上传\n\n\n\n\n\n\n\n下载地址：(\n\n\n\nNBTTagList.rar\n(1.62 KB, 下载次数: 105)\n\n\n\n2015-10-23 15:31 上传\n点击文件名下载附件\n\n\n\n\n\n\n\n\n最后希望版主给个制定，让更多的1.6.2的服务器不再被这些人所侵害！！！\n",
    "replies": [
        {
            "author": "力挽狂澜99v",
            "timestamp": 1445599080,
            "txt_content": "感谢感谢"
        },
        {
            "author": "MC_SiLu",
            "timestamp": 1445605020,
            "txt_content": "提示: 该帖被管理员或版主屏蔽"
        },
        {
            "author": "andylizi",
            "timestamp": 1445610900,
            "txt_content": " 本帖最后由 andylizi 于 2015-10-23 23:35 编辑 \n\n首先感谢楼主无私分享自己服务器的补丁程序，使更多服务器免除侵害。\n\n但是经反编译发现，这个补丁修复的原理就是限制NBTList的大小不能超过1024，这样可以防住一般的NBT压测（因为反馈的bug里面就是使用多个镶套List），但这并不代表不可以使用其他的方式进行压测！，经测试，NBTTagCompound、NBTTagList、NBTTagIntArray这3个跟list\"有点关系\"的NBT类型都可以触发这个bug！因为它们都有一个共同点：\n\n（其实那个NBTTagCompound是最可怕的，因为它使用的是while无限循环，只要readByte还有返回结果，那就会一直读取下去……）\n并且从源码中可以看见，它们用来判断需要for/while多少次的参数就是从经过GZIP解压的数据包中的一个int。如果把那个int writeInt成最大值2147483647，那么服务器就会老老实实的读取2147483647次……\n所以说，只修复NBTTagList是没啥用的……不过似乎针对Compound和IntArray的攻击工具似乎还没有出现，按照我之前曾经研究过这个BUG的原理，但由于暂时未受到攻击我没有修复不知道楼主会不会再等到被攻击了才修复……(希望不会)\n\n另：其实只要把这个补丁内的package声明的包名改一下就可以兼容所有版本的服务端，因为在1.8.4之前，它们的底层NBT实现都是一致的。\n再另：我曾经也是HIM服的忠实玩家，虽然现在HIM服有点变样了……但还是祝HIM服越办越好！\n再再另：大家别理楼上，自己用来崩服的bug修复了，看着不爽，还反咬一口\n\n\n\n好吧反正我也闲的无聊干脆把3个可能引起崩服的NBT类都修复了\n\n\n\n修复NBT崩服补丁_v1_6_R2.zip\n(7.57 KB, 下载次数: 67)\n\n\n\n2015-10-23 23:33 上传\n点击文件名下载附件\n\n\n\n\n\n\n能不能用？抱歉我没1.6服务器没法测试\n安装方法同LZ，对应NMS版本为v1_6_R2"
        },
        {
            "author": "ookone",
            "timestamp": 1445622600,
            "txt_content": "楼上的都是大神，前排膜拜"
        },
        {
            "author": "HuaiYang",
            "timestamp": 1445646060,
            "txt_content": "感谢楼主无私的贡献！\n不过针对这种情况，一般服务器都已升到了1.8了吧？\n低版本的情况或许比较少，不过还是感谢您为低版本的服务器指引了道路。"
        },
        {
            "author": "MC_SiLu",
            "timestamp": 1445651580,
            "txt_content": "andylizi 发表于 2015-10-23 22:35\n首先感谢楼主无私分享自己服务器的补丁程序，使更多服务器免除侵害。\n\n但是经反编译发现，这个补丁修复的原 ...\n这是假的,我就下载了然后我的服务器全部配置没了妈的"
        },
        {
            "author": "andylizi",
            "timestamp": 1445662620,
            "txt_content": "MC_SiLu 发表于 2015-10-24 09:53\n这是假的,我就下载了然后我的服务器全部配置没了妈的\n说你什么好呢。。。"
        },
        {
            "author": "WAR科技",
            "timestamp": 1446347220,
            "txt_content": "andylizi 发表于 2015-10-24 12:57\n说你什么好呢。。。\n1710可以用？"
        },
        {
            "author": "andylizi",
            "timestamp": 1446347760,
            "txt_content": "WAR科技 发表于 2015-11-1 11:07\n1710可以用？\n你没看见1.6.2字样吗"
        },
        {
            "author": "WAR科技",
            "timestamp": 1446352080,
            "txt_content": "1710如何修复？，我会JAVA"
        },
        {
            "author": "1269019976",
            "timestamp": 1446476460,
            "txt_content": "我的服刚刚被压测，估计就是bug搞得鬼，还好各位大触及时修复，要不我的服该遭殃了。  b并且祝愿HIM服的pp"
        },
        {
            "author": "1269019976",
            "timestamp": 1446476580,
            "txt_content": "1269019976 发表于 2015-11-2 23:01\n我的服刚刚被压测，估计就是bug搞得鬼，还好各位大触及时修复，要不我的服该遭殃了。  b并且祝愿HIM服的pp ...\n并且祝愿HIM服的op们想开点，早点把服弄好，以后我会多研究bug，之后找解决办法"
        },
        {
            "author": "ProperSAMA",
            "timestamp": 1447323000,
            "txt_content": "感谢修复！解决了一些服务器的燃眉之急！\n我的服务器是1.6.4MCPC+，按照以上路径未找到该文件夹\n(net\\minecraft\\server内未找到v1.6.2_R2或类似的文件夹)\n请问这种情况应如何处理？或者说该情况说明此修复方法不支持1.6.4MCPC+？\n"
        },
        {
            "author": "苏雅人",
            "timestamp": 1447392420,
            "txt_content": "表示持续关注此帖更新"
        },
        {
            "author": "ganba",
            "timestamp": 1447471080,
            "txt_content": "1esaaaaaaaaaaaaaaaaaa"
        },
        {
            "author": "ganba",
            "timestamp": 1447549560,
            "txt_content": "力挽狂澜99v 发表于 2015-10-23 19:18\n感谢感谢\n阿斯蒂芬"
        },
        {
            "author": "Craftwolves",
            "timestamp": 1447550340,
            "txt_content": "楼主分享的好，虽然我是1.7.2但是我看到那个贴吧里的那个人，我抑郁不住我的冲动，骂他几句，打他几拳，踢他几脚。"
        },
        {
            "author": "1269019976",
            "timestamp": 1450448280,
            "txt_content": "andylizi 发表于 2015-10-23 22:35\n首先感谢楼主无私分享自己服务器的补丁程序，使更多服务器免除侵害。\n\n但是经反编译发现，这个补丁修复的原 ...\n我的服修复之后比以前卡了很多，这是为什么"
        },
        {
            "author": "andylizi",
            "timestamp": 1450448340,
            "txt_content": "1269019976 发表于 2015-12-18 22:18\n我的服修复之后比以前卡了很多，这是为什么\n你怎么敢肯定一定是修复后发生的呢"
        },
        {
            "author": "1269019976",
            "timestamp": 1450448640,
            "txt_content": " 本帖最后由 1269019976 于 2015-12-18 22:28 编辑 \nandylizi 发表于 2015-12-18 22:19\n你怎么敢肯定一定是修复后发生的呢\n因为修复之后才卡的，以前都没卡过，并且我刚刚把修复的jar删掉换成了以前的就不卡了，R2时指的是spigot-1.6.2-R2.0-SNAPSHOT这个吗\n\n\n\n\n修复前的Spigot.png (95.68 KB, 下载次数: 4)\n\n下载附件\n\n2015-12-18 22:28 上传\n\n\n\n\n\n\n"
        },
        {
            "author": "andylizi",
            "timestamp": 1450448820,
            "txt_content": "1269019976 发表于 2015-12-18 22:24\n因为修复之后才卡的，以前都没卡过，并且我刚刚把修复的jar删掉换成了以前的就不卡了，R2时指的是spigot- ...\n我不清楚"
        },
        {
            "author": "1269019976",
            "timestamp": 1450448940,
            "txt_content": "andylizi 发表于 2015-12-18 22:27\n我不清楚\n好吧，反正也可以解决攻击，算是谢谢您两位大神了{:10_512:}"
        },
        {
            "author": "FLY_bailin",
            "timestamp": 1450501200,
            "txt_content": "升级版本可以解决么."
        },
        {
            "author": "1269019976",
            "timestamp": 1450539960,
            "txt_content": "andylizi 发表于 2015-10-23 22:35\n首先感谢楼主无私分享自己服务器的补丁程序，使更多服务器免除侵害。\n\n但是经反编译发现，这个补丁修复的原 ...\n赶快叫版主把联机教程版块里的一个nbt漏洞mod的帖子删了，那个mod一去别人服就崩"
        },
        {
            "author": "我不是天空",
            "timestamp": 1450677960,
            "txt_content": "然而到现在只有966查看"
        },
        {
            "author": "1269019976",
            "timestamp": 1451550900,
            "txt_content": "andylizi 发表于 2015-10-23 22:35\n首先感谢楼主无私分享自己服务器的补丁程序，使更多服务器免除侵害。\n\n但是经反编译发现，这个补丁修复的原 ...\n1.6.2R2是这里面的这个spigot-1.6.2-R2.0-SNAPSHOT吗，，http://pan.baidu.com/s/1mg87N1e#path=%252Fspigot"
        },
        {
            "author": "ttc_V",
            "timestamp": 1451797500,
            "txt_content": "楼主 162的mcpc用修复吗"
        },
        {
            "author": "ttc_V",
            "timestamp": 1451797620,
            "txt_content": "andylizi 发表于 2015-10-23 22:35\n首先感谢楼主无私分享自己服务器的补丁程序，使更多服务器免除侵害。\n\n但是经反编译发现，这个补丁修复的原 ...\n请问 162的mcpc用修复吗?"
        },
        {
            "author": "1269019976",
            "timestamp": 1451797920,
            "txt_content": "java.lang.NullPointerException\n        at net.minecraft.server.v1_6_R2.NBTBase.b(SourceFile:101)\n        at net.minecraft.server.v1_6_R2.NBTTagCompound.load(SourceFile:38)\n        at net.minecraft.server.v1_6_R2.NBTBase.b(SourceFile:101)\n        at net.minecraft.server.v1_6_R2.NBTTagCompound.load(SourceFile:38)\n        at net.minecraft.server.v1_6_R2.NBTBase.b(SourceFile:101)\n        at net.minecraft.server.v1_6_R2.NBTBase.a(SourceFile:89)\n        at net.minecraft.server.v1_6_R2.NBTCompressedStreamTools.a(SourceFile:75)\n        at net.minecraft.server.v1_6_R2.ChunkRegionLoader.loadChunk(ChunkRegionLoader.java:75)\n        at org.bukkit.craftbukkit.v1_6_R2.chunkio.ChunkIOProvider.callStage1(ChunkIOProvider.java:19)\n        at org.bukkit.craftbukkit.v1_6_R2.chunkio.ChunkIOProvider.callStage1(ChunkIOProvider.java:13)\n        at org.bukkit.craftbukkit.v1_6_R2.util.AsynchronousExecutor$Task.init(AsynchronousExecutor.java:150)\n        at org.bukkit.craftbukkit.v1_6_R2.util.AsynchronousExecutor$Task.initAsync(AsynchronousExecutor.java:95)\n        at org.bukkit.craftbukkit.v1_6_R2.util.AsynchronousExecutor$Task.run(AsynchronousExecutor.java:85)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\n\n这是NBT攻击吗，，我按照楼主的方法修复完之后还是崩，，崩了之后就出来了上面的报错"
        },
        {
            "author": "q211316907",
            "timestamp": 1471013520,
            "txt_content": "你点燃了我的兴趣"
        }
    ]
}