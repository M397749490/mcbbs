{
    "title": "[1.16][Fabric Mod开发进阶教程#1]如何添加自定义的投掷物(Like 雪球)？",
    "author": "Mocoder",
    "replyCount": 0,
    "timestamp": 1596296880,
    "txt_content": "该坑未填完！！！\n\n\n本文所有Minecraft代码均使用Yarn反混淆，所有模组代码部分来源于Minecraft相关类，部分作者自己编写\n\n开发采用1.16.1版本，Fabric Loader 0.88+build.202，参考资料 https://github.com/ye-yu/fabric-teleporter-mod\n来自Mojang的特性\n追踪SnowballEntity的渲染路径，可以在类 net.minecraft.client.render.entity.EntityDispatcher 里面找到函数 registerRenderers ，有这样一句：\n\nthis.register(EntityType.SNOWBALL, new FlyingItemEntityRenderer(this, itemRenderer));复制代码这句话导致了继承雪球的渲染类的想法破产，因为雪球没有相关的渲染类。\n\n通过解包Minecraft本体文件，关于Snowball的图片也只有assets/minecraft/texture/item/snowball.png一张雪球物品的图片。可以看出，雪球实体是没有自己的模型的。\n\n怎么办？\n通过对上述语句的追踪，我们可以发现雪球实体类SnowballEntity继承了ThrownItemEntity类。在游戏中对雪球实体的观察，可以发现实体的模型类似于雪球物品的图片。结合网络上查找到的资料，可以推测雪球物品图片就是雪球实体的渲染模型，而关键就在类中的函数 getDefaultItem\n\n\n客户端与服务端的通信\n投掷物的渲染需要在Mod里面加入通信，来使得投掷物正确地在客户端被渲染。\n首先需要在BasketballEntity里面加入发包函数，用于篮球生成的时候通知客户端\n@Override\n    public Packet<?> createSpawnPacket() {\n        super.createSpawnPacket();\n        PacketByteBuf buf = new PacketByteBuf(Unpooled.buffer());\n        buf.writeInt(this.getEntityId());\n        buf.writeUuid(this.getUuid());\n        buf.writeDouble(this.getX());\n        buf.writeDouble(this.getY());\n        buf.writeDouble(this.getZ());\n        return new CustomPayloadS2CPacket(new Identifier(\"chicken\", \"basketball\"), buf);\n    }复制代码\n在客户端主类中加入实体生成函数，用于解析包并生成实体\nprivate static void spawnEntity(PacketContext context, PacketByteBuf buffer) {\n        int entityId = buffer.readInt();\n        UUID uuid = buffer.readUuid();\n        double x = buffer.readDouble();\n        double y = buffer.readDouble();\n        double z = buffer.readDouble();\n        context.getTaskQueue().execute(() -> {\n            BasketballEntity entity = new BasketballEntity(BasketballEntityInstance,context.getPlayer().world);\n            entity.setPos(x, y, z);\n            entity.setEntityId(entityId);\n            entity.setUuid(uuid);\n            entity.updateTrackedPosition(x, y, z);\n            ((ClientWorld) context.getPlayer().world).addEntity(entityId, entity);\n        });\n    }复制代码\n并在onInitializeClient函数中加入渲染器注册以及实体生成函数的注册\n@Override\n    public void onInitializeClient() {\n        EntityRendererRegistry.INSTANCE.register(Basketballentity, (entityRenderDispatcher, context) -> new FlyingItemEntityRenderer<BasketballEntity>(entityRenderDispatcher,context.getItemRenderer()));\n        ClientSidePacketRegistry.INSTANCE.register(new Identifier(\"chicken\",\"basketball\"),CxkChickenClient::spawnEntity);\n    }复制代码此时进入游戏，实体就可以被正确地渲染了\n\n\n\n",
    "replies": []
}