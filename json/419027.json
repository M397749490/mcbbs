{
    "title": "MC1.7.2客户端源代码学习2 主界面",
    "author": "cisumer",
    "replyCount": 3,
    "timestamp": 1425635400,
    "txt_content": "上一篇帖子（MC1.7.2客户端启动源代码学习）我们找到了MC启动过程执行的代码，今天我们来看看接下来又做了些什么。Minecraft类中定义很多方法，不过从上一次我们看到的情况，启动其实执行的是run()，在看run的代码前我们必须先看Minecraft类的构造方法最后一行：\nBootstrap.func_151354_b();//init复制代码编写mod比较关心的一个问题是自己写的代码怎么注册到MC当中。答案就在Bootstrap里，在这个方法中，有注册Block的方法Block.registerBlocks();复制代码当然还有注册Item的方法，具体怎么加载我们学习到这一部分再来看。\n好，我们回到Minecraft类。接下来就是重点了，运行run()以后做的事情。\nthis.running = true;复制代码首先就是设置标记，running=true表示启动，如果停止则把它设为false，就像shutdown方法里做的。\npublic void shutdown()\n    {\n        this.running = false;\n    }复制代码接下来调用\nthis.startGame();复制代码这个方法先加载了游戏的设置信息，然后对Display类的一些属性进行设置并最终调用\nDisplay.create((new PixelFormat()).withDepthBits(24));复制代码这行代码创建了一个窗口，Display是lwjgl提供的接口，lwjgl是一个opengl的封装类库，提供了用于创建2/3D游戏的API。\n接下来是对资源、存档、语言、opengl等进行设置和初始化。\n然后是游戏的GUI接口设置，也就是界面，在刚打开游戏时进入主界面\nthis.displayGuiScreen(new GuiMainMenu());//游戏主界面复制代码创建的GuiMainMenu对象就是主界面，我们可以先进GuiMainMenu类的构造方法看看\nvar1 = new BufferedReader(new InputStreamReader(Minecraft.getMinecraft().getResourceManager().getResource(splashTexts).getInputStream(), Charsets.UTF_8));复制代码首先就是加载了splashText，它就是我们在主界面上看到的倾斜的闪烁副标题，在assets.minecraft.texts.splashes.txt里存放着这些内容，初始化时会把这些文本都加载然后随机显示其中一个。不过我们往后看在initGui()里\nCalendar var1 = Calendar.getInstance();\n        var1.setTime(new Date());\nif (var1.get(2) + 1 == 10 && var1.get(5) == 1)\n{\nthis.splashText = \"今天是你的生日，我的祖国!\";\n}\n        if (var1.get(2) + 1 == 11 && var1.get(5) == 9)\n        {\n            this.splashText = \"Happy birthday, ez!\";\n        }\n        else if (var1.get(2) + 1 == 6 && var1.get(5) == 1)\n        {\n            this.splashText = \"Happy birthday, Notch!\";\n        }\n        else if (var1.get(2) + 1 == 12 && var1.get(5) == 24)\n        {\n            this.splashText = \"Merry X-mas!\";\n        }\n        else if (var1.get(2) + 1 == 1 && var1.get(5) == 1)\n        {\n            this.splashText = \"Happy new year!\";\n        }\n        else if (var1.get(2) + 1 == 10 && var1.get(5) == 31)\n        {\n            this.splashText = \"OOoooOOOoooo! Spooky!\";\n        }复制代码这是个彩蛋，在一些特殊的日子（作者生日、圣诞节、万圣节等等）会显示不一样的内容（Notch的生日是儿童节{:10_493:}），我们可以在这里修改一下，比如加上元宵节。\n\n下面来看看具体是怎么把界面绘制出来的，秘密就在drawScreen方法里,下面节选了三行有代表意义的代码。\nthis.mc.getTextureManager().bindTexture(minecraftTitleTextures);//添加标题复制代码父类的drawScreen方法是用来加载按钮和标签。所有的类似的界面(主界面、设置界面等等)的父类都是GuiScreen，在具体的界面中只需要设置好按钮和标签，父类会自动绘制\nthis.buttonList.add(new GuiButton(1, this.width / 2 - 100, par1, I18n.format(\"menu.singleplayer\", new Object[0])));//单人游戏按钮\n        复制代码另外一个比较重要的代码是响应按钮的点击，在GuiScreen里定义了\nprotected void actionPerformed(GuiButton p_146284_1_) {}复制代码在具体的界面类中只需要重写此方法，比如GuiMainMenu类里\nif (p_146284_1_.id == 1)\n{\n            this.mc.displayGuiScreen(new GuiSelectWorld(this));//单人游戏\n}复制代码判断按钮id为1，则转到GuiSelectWorld，id是我们在刚才创建按钮是传的第一个参数。\n重新回到run方法中，接下来是一个死循环，而这个循环里又嵌套了另外一个循环<blockquote><blockquote>                while (this.running)复制代码重点来了，runGameLoop这个才是真正的核心方法，它用于渲染界面、绑定鼠标和按键事件等。而另外一个方法\n public void launchIntegratedServer(String par1Str, String par2Str, WorldSettings par3WorldSettings)复制代码则用于启动服务（其实单机游戏也是创建一个服务器，服务器是用于计算等消耗资源的，而客户端用于3d渲染）。\n今天的学习就到这里了，下次我们来看看真正的游戏界面是怎样运行的。{:10_511:}\n\n\n\n",
    "replies": [
        {
            "author": "搅腋潭",
            "timestamp": 1425733320,
            "txt_content": "消灭零回复"
        },
        {
            "author": "selectyjc",
            "timestamp": 1425733740,
            "txt_content": "赞一个！！！！"
        },
        {
            "author": "zbz167",
            "timestamp": 1430631180,
            "txt_content": "楼主你好，我也正在看mc代码，但是我这个代码包是配置了forge的版本的，有些难。能教教我怎样下原版的代码吗？或者发给我也行。\n（最好是java源文件，可以随时修改那种的）"
        }
    ]
}