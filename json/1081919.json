{
    "title": "【已解决】1.12.2强化插件一级级强化该如何实现？",
    "author": "GhostSkyV9",
    "replyCount": 22,
    "timestamp": 1595160900,
    "txt_content": " 本帖最后由 sky295 于 2020-7-29 16:30 编辑 \nelse if (strings.length==1 && strings[0].equalsIgnoreCase(\"start\")){\n                String LevelKey = Qianghua.EquipmentLevel(player);\n                    if (LevelKey == null)\n                    {\n                        player.sendMessage(\"§a当前强化已达到上限!\");\n                    }else {\n                        Qianghua.EquipmentLevel(player);\n                    }\n                return true;\n            }复制代码    public static String EquipmentLevel(Player player) {\n        Set<String> keys = Qianghua.instance.getConfig().getConfigurationSection(\"Qianghua.Plan\").getKeys(false);\n        Random random = new Random();\n        for (int i = 0; i < keys.size(); i++) {\n            List<String> lores = Qianghua.instance.getConfig().getStringList(\"Qianghua.Plan.\" + i + \".lore\");\n            int rand = random.nextInt(101);\n            ItemStack stack = player.getInventory().getItemInMainHand();\n            ItemMeta meta = stack.getItemMeta();\n            if (rand >= 0 && rand < Qianghua.instance.getConfig().getInt(\"Qianghua.Plan.\" + i + \".rand\")) {\n                meta.setLore(lores);\n                stack.setItemMeta(meta);\n                player.sendMessage(\"§6强化成功！\");\n            } else {\n                player.sendMessage(\"§c强化失败！\");\n            }\n        }\n        return null;\n    }复制代码这是我写的一段代码，执行后的效果是，输入指令，就是一次性强化到满级，不像我们正常那种强化一样，一级级的加上去，想知道这个逻辑具体该怎么写",
    "replies": [
        {
            "author": "南柯郡守",
            "timestamp": 1595162400,
            "txt_content": "害 你在那个贴的回复我没注意到\n\n那你既然又发一个贴问了我就在这说吧\n\n你应该给被强化的物品添加一条lore记录该物品的强化等级\n\n然后强化的时候获取这个等级 如果有就读i+1这个配置节\n\n而不是遍历所有强化等级"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595164260,
            "txt_content": " 本帖最后由 sky295 于 2020-7-19 21:24 编辑 \n南柯郡守 发表于 2020-7-19 20:40\n害 你在那个贴的回复我没注意到\n\n那你既然又发一个贴问了我就在这说吧\n那循环是用不到么，现在我该从哪里开始改，这代码写在这里卡这了\nList<String> lores = Qianghua.instance.getConfig().getStringList(\"Qianghua.Plan.\" + i + \".lore\");复制代码 if (rand >= 0 && rand < Qianghua.instance.getConfig().getInt(\"Qianghua.Plan.\" + i + \".rand\")) 复制代码如果不用循环的话，那这两个读取配置文件的，该怎么办\n\nConfig：\nQianghua:\n  Plan:\n    0:\n      rand: 30\n      lore:\n        - '1'\n        - '2'\n    1:\n      rand: 50\n      lore:\n        - '3'\n        - '4'\n    2:\n      rand: 70\n      lore:\n        - '5'\n        - '6'\n    3:\n      rand: 100\n      lore:\n        - '7'\n        - '8'\n复制代码"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595165100,
            "txt_content": " 本帖最后由 南柯郡守 于 2020-7-19 21:28 编辑 \n    List<String> lore = item.hasLore()?item.getLore():new ArrayList<>();\n    int level = 0;\n    if(!lore.isEmpty()){\n        for(String line : lore){\n            if(line.contains(\"强化等级：\")){\n                try{\n                    level = Integer.valueOf(line.subString(5));\n                }catch (Exception e){}\n            }\n        }\n    }\n    //do something\n复制代码\n\n变量level就是目前武器的强化等级\n\n\n\n写错了value  尬"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595166540,
            "txt_content": " 本帖最后由 sky295 于 2020-7-19 21:52 编辑 \n南柯郡守 发表于 2020-7-19 21:25\n变量level就是目前武器的强化等级\n\n    public static String EquipmentLevel(Player player) {\n        Random random = new Random();\n        int rand = random.nextInt(101);\n        ItemStack stack = player.getInventory().getItemInMainHand();\n        ItemMeta meta = stack.getItemMeta();\n        List<String> lore = meta.hasLore()?meta.getLore():new ArrayList<>();\n        int level = 0;\n        if(!lore.isEmpty()){\n            for(String line : lore){\n                if(line.contains(\"强化等级：\")){\n                    try{\n                        level = Integer.valueOf(line.substring(5));\n                    }catch (Exception e){\n                        e.printStackTrace();\n                    }\n                }\n            }\n        }\n        List<String> lores = Qianghua.instance.getConfig().getStringList(\"Qianghua.Plan.\" + level + \".lore\");\n        if (rand >= 0 && rand < Qianghua.instance.getConfig().getInt(\"Qianghua.Plan.\" + level + \".rand\")) {\n            meta.setLore(lores);\n\n            stack.setItemMeta(meta);\n            player.sendMessage(\"§6强化成功！\");\n        } else {\n            player.sendMessage(\"§c强化失败！\");\n        }\n        return null;\n    }复制代码\n这样？这样写的话，我再次调用这个方法，level这个变量就又被初始化了，就一直是零"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595166780,
            "txt_content": "sky295 发表于 2020-7-19 21:49\n这样？\nlevel是当前等级\n\n你要获取得应该是level的下一级\n\n所以要先level++;\n然后判断获取到的等级的配置节是否为null\nnull表示目前等级已经是最高级了"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595167260,
            "txt_content": " 本帖最后由 sky295 于 2020-7-19 22:07 编辑 \n南柯郡守 发表于 2020-7-19 21:53\nlevel是当前等级\n\n你要获取得应该是level的下一级else if (strings.length==1 && strings[0].equalsIgnoreCase(\"start\")){\n                String LevelKey = Qianghua.EquipmentLevel(player);\n                    if (LevelKey == null)\n                    {\n                        player.sendMessage(\"§a当前强化已达到上限!\");\n                    }else {\n                        Qianghua.EquipmentLevel(player);\n                    }\n                return true;\n            }复制代码\n判断配置节点是否为null，我写在了指令类这里，你刚写的代码和level++也要换到这里？\n不对，我.EquipmentLevel这个方法每次调用level这个变量都会被初始化为零，level++写.EquipmentLevel这个方法里的话，还是没用呀"
        },
        {
            "author": "William_Shi",
            "timestamp": 1595167680,
            "txt_content": "第一：是你写插件，不觉得自己真的一直在伸手么。。。我建议你先学好Java，根据你上次提问“用Map还是HashMap”这样的问题，你显然不会Java。\n第二：lore修改遍历麻烦的话，可以直接使用NBT进行读写，这玩意就像是个Map一样，直接取你自己要用的键值对就行了"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595167740,
            "txt_content": "sky295 发表于 2020-7-19 22:01\n判断配置节点是否为null，我写在了指令类这里，你刚写的代码和level++也要换到这里？ ...Qianghua.EquipmentLevel(player);复制代码\n这个方法被你调用了两次\n错误的做法\n\n应该把获取等级专门做一个方法\n然后返回一个level+1的int\n\n再去判断level+1的配置节是否存在\n\n如果存在 再执行强化部分"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595168220,
            "txt_content": "南柯郡守 发表于 2020-7-19 22:09\n这个方法被你调用了两次\n错误的做法  public static String EquipmentLevel(ItemStack EquItem, String EquType)\n  {\n    Set<String> keys = getInst().getConfig().getConfigurationSection(\"HMStrengthen.Plan\").getKeys(false);\n    List<String> EquLores = EquItem.getItemMeta().getLore();\n    for (int l = 0; l < EquItem.getItemMeta().getLore().size(); l++) {\n      for (int i = 1; i < keys.size(); i++)\n      {\n        String Level = String.valueOf(i);\n        String LevelString = getInst().getConfig().getString(\"HMStrengthen.Plan.\" + Level + \".\" + EquType + \".KeyLore\");\n        String EquLore = (String)EquLores.get(l);\n        if (EquLore.equals(LevelString)) {\n          return String.valueOf(i);\n        }\n      }\n    }\n    return null;\n  }复制代码\n像这个？"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595168580,
            "txt_content": "sky295 发表于 2020-7-19 22:17\n像这个？\n\nEquipmentLevel如果是用来获取装备的等级 应该返回的是int 同时不需要那么多循环\n\n我都没看明白你的循环干嘛用的\n\n直接获取到level+1 然后\nString LevelString = getInst().getConfig().getString(\"HMStrengthen.Plan.\" + Level + \".\" + EquType + \".KeyLore\");复制代码\n如果LevelString为null就是最高等级\n\n最后讲一遍思路\n\n玩家执行指令后\n先判断该物品是否可以被强化 \n再通过我刚才那段代码获取手上物品的等级\n最后执行强化部分 就是给物品添加lore"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595169120,
            "txt_content": "南柯郡守 发表于 2020-7-19 22:23\nEquipmentLevel如果是用来获取装备的等级 应该返回的是int 同时不需要那么多循环\n\n我都没看明白你的循环 ...\n我刚发的那段代码不是我写的，是我反编译一个强化插件找到的一个"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595169540,
            "txt_content": "sky295 发表于 2020-7-19 22:32\n我刚发的那段代码不是我写的，是我反编译一个强化插件找到的一个\n建议找一个用的人多的 成熟的插件反编译看思路\n\n那段代码太绕了 没用"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595170800,
            "txt_content": "南柯郡守 发表于 2020-7-19 22:39\n建议找一个用的人多的 成熟的插件反编译看思路\n\n那段代码太绕了 没用else if (strings.length==1 && strings[0].equalsIgnoreCase(\"start\")){\n                ItemStack itemStack=player.getInventory().getItemInMainHand();\n                ItemMeta meta=itemStack.getItemMeta();\n                List<String> lore = meta.hasLore()?meta.getLore():new ArrayList<>();\n                int level = 0;\n                List<String> LevelString = Qianghua.instance.getConfig().getStringList(\"Qianghua.Plan.\" + level + \".lore\");\n                if(!lore.isEmpty()){\n                    for(String line : lore){\n                        if(line.contains(\"强化等级：\")){\n                            try{\n                                level = Integer.valueOf(line.substring(5));\n                                level++;\n                                if (LevelString==null){\n                                    player.sendMessage(\"§a当前强化已达到最高等级！\");\n                                }else{\n                                    meta.setLore(LevelString);\n                                    itemStack.setItemMeta(meta);\n                                    player.sendMessage(\"§e强化成功！\");\n                                }\n                            }catch (Exception e){\n                                e.printStackTrace();\n                            }\n                        }\n                    }\n                }\n                return true;复制代码\n重新写了一下，指令执行后没反应"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595171100,
            "txt_content": "sky295 发表于 2020-7-19 23:00\n重新写了一下，指令执行后没反应                                level++;\n                                if (LevelString==null){\n                                    player.sendMessage(\"§a当前强化已达到最高等级！\");\n                                }else{\n                                    meta.setLore(LevelString);\n                                    itemStack.setItemMeta(meta);\n                                    player.sendMessage(\"§e强化成功！\");\n                                }复制代码\n这一段要放在if(!lore.isEmpty())这个结构的外面\n至于为什么你自己参考下"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595171400,
            "txt_content": " 本帖最后由 sky295 于 2020-7-19 23:28 编辑 \n南柯郡守 发表于 2020-7-19 23:05\n这一段要放在if(!lore.isEmpty())这个结构的外面\n至于为什么你自己参考下else if (strings.length==1 && strings[0].equalsIgnoreCase(\"start\")){\n                ItemStack itemStack=player.getInventory().getItemInMainHand();\n                ItemMeta meta=itemStack.getItemMeta();\n                try{\n                    List<String> lore = meta.hasLore()?meta.getLore():new ArrayList<>();\n                    int level = 0;\n                    if(!lore.isEmpty()){\n                        for(String line : lore){\n                            Qianghua.instance.getLogger().info(line);\n                            if(line.contains(\"强化等级：\")){\n                                level = Integer.valueOf(line.substring(5));\n                            }\n                        }\n                    }\n                    level++;\n                    List<String> LevelString = Qianghua.instance.getConfig().getStringList(\"Qianghua.Plan.\" + level + \".lore\");\n                    if (LevelString==null){\n                        player.sendMessage(\"§a当前强化已达到最高等级！\");\n                    }else{\n                        meta.setLore(LevelString);\n                        itemStack.setItemMeta(meta);\n                        player.sendMessage(\"§e强化成功！\");\n                        Qianghua.instance.getLogger().info(\"----------\"+level);\n                    }\n                }catch (NullPointerException e){\n                    player.sendMessage(\"§c手中物品不能为空\");\n                }\n                return true;\n            }复制代码好了，我解出来了，现在还有一个问题就是，这个最高等级的判断一直执行不到"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595173740,
            "txt_content": "sky295 发表于 2020-7-19 23:10\n好了，我解出来了，现在还有一个问题就是，这个最高等级的判断一直执行不到 ...\ngetStringList()方法无论是否获取到 都不会返回null\n当获取不到的时候会返回一个空的list\n\n应该判断LevelString.isEmpty()"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595211120,
            "txt_content": "南柯郡守 发表于 2020-7-19 23:49\ngetStringList()方法无论是否获取到 都不会返回null\n当获取不到的时候会返回一个空的list                    List<String> Displayname = new ArrayList<>();\n                    int level = 0;\n                    if(!Displayname.isEmpty()){\n                        for(String line : Displayname){\n                            if(line.contains(\"+\")){\n                                level = Integer.valueOf(line.substring((line.lastIndexOf(\"+\")+1)));\n                                Qianghua.instance.getLogger().info(\"---\"+level);\n                            }\n                        }\n                    }复制代码\n我想把这个改成判断武器的名字的，通过getDisplayName获取武器名字，获取到的是null，然后这里判断也没进来"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595211780,
            "txt_content": "sky295 发表于 2020-7-20 10:12\n我想把这个改成判断武器的名字的，通过getDisplayName获取武器名字，获取到的是null，然后这里判断也没 ...\n物品不一定有displayname！\nList<String> Displayname = new ArrayList<>(); 你这里只是初始化了list 所以他就是empty"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595212260,
            "txt_content": "南柯郡守 发表于 2020-7-20 10:23\n物品不一定有displayname！\nList Displayname = new ArrayList(); 你这里只是初始化了list 所以他就是emp ...\n为什么会没有displayname，它不是每件物品的名字么"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595212440,
            "txt_content": "sky295 发表于 2020-7-20 10:31\n为什么会没有displayname，它不是每件物品的名字么\n自己看api文档"
        },
        {
            "author": "GhostSkyV9",
            "timestamp": 1595212920,
            "txt_content": "南柯郡守 发表于 2020-7-20 10:34\n自己看api文档\n那这个meta.setDisplayName(name+\"+\"+level);呢\n\n有点奇怪，set后的名字是null+1+1+2+3+4这样的，它不像setLore一样可以直接替换"
        },
        {
            "author": "南柯郡守",
            "timestamp": 1595214480,
            "txt_content": "sky295 发表于 2020-7-20 10:42\n那这个meta.setDisplayName(name+\"+\"+level);呢\n\n有点奇怪，set后的名字是null+1+1+2+3+4这样的，它不像se ...\nname 是null\nlevel自己看是不是int\n言尽于此\n\n想办法提升自己解决问题的能力才是首要"
        }
    ]
}