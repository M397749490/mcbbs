{
    "title": "求找错",
    "author": "langyo_v3",
    "replyCount": 34,
    "timestamp": 1492828200,
    "txt_content": "序的正确来源为http://mcbbs.tvt.im/thread-686845-1-1.html",
    "replies": [
        {
            "author": "langyo_v3",
            "timestamp": 1492829100,
            "txt_content": "标题: 求找错#include <cmath>\n#include <iostream>\n#define PI 3.1415926535\n\nusing namespace std;\n\ndouble* armorstand(double A,double B,double C,double t)\n{\n        double Az,Bz,Cz,a,b,c,d,f,l,thx,thy,thz,x,y,z;\n        a=C*C+A*A;\n        b=C*C+B*B;\n        c=A*B;\n        l=sqrt(A*A+B*B+C*C);\n        if(C==0){\n                if(A==0){\n                        x=cos(t);\n                        y=0;\n                        z=sin(t)*((B<0?1:0)*2-1);\n                }else{\n                        x=-sin(t)*A*B*sqrt((B*B)/(A*A)+1);\n                        y=sin(t)/sqrt((B*B)/(A*A)+1);\n                        z=sqrt((1-x*x-y*y)>0?1-x*x-y*y:0)*(((-A*cos(t))>0?1:0)*2-1);\n                }\n        }else{\n                x=C*cos(t)/sqrt(a)-(c/2)*C*sin(t)/sqrt(b-c*c/a);\n                y=C*sin(t)/sqrt(b-c*c/a);\n                z=(A*x+B*y)/(-C);\n        }\n        thz=(x==0)?PI/2:-atan(y/x);\n        Az=(A*cos(thz)-B*sin(thz))/C;\n        Bz=(B*cos(thz)+A*sin(thz))/C;\n        Cz=C/l;\n        d=x*cos(thz)-y*sin(thz);\n        f=z;\n        thx=-acos(Bz)*(2*((Az*f-((z*d)>0?1:0))-1));\n        thy=acos(d)*2*((f>0)?1:0)-1;\n        double *returned=new double[3];\n        returned[0]=180*thx/PI;\n        returned[1]=180*thy/PI;\n        returned[2]=180*thz/PI;\n        return returned;\n}\nint main()\n{\n        double A,B,C,t;\n        cin>>A>>B>>C>>t;\n        double *returned=armorstand(A,B,C,t);\n        \n        cout<<endl<<endl;\n        cout<<\"/summon Armor_Stand ~0 ~1 ~0 \";\n        cout<<\"{Pose:Head:[\"<<returned[0]<<\",\";\n        cout<<returned[1]<<\",\"<<returned[2]<<\"]}}\";\n        cout<<endl<<endl;\n        \n        return 0;\n}复制代码\n"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1492829100,
            "txt_content": "啥玩意？你的算法和chyx不一样还是什么意思？没学过C艹……\n\n初始朝向是(0,0,1)，假设指定一个切向（1,0,0）\n然后分别绕轴旋转thx,thy,thz(顺时针还是逆时针不太清楚，可能差负号)\n然后线性变换，将矩阵\n[cos thx  -sin thx 0]\n[sin thx   cos thx 0]\n[0   0            1]\n\n[cos thy  0 -sin thy]\n[0          1  0]\n[sin thx  0   cos thx]\n\n[1  0           0]\n[0  cos thx  -sin thx]\n[0  sin thx   cos thx]\n相乘，然后作用在(0,0,1)和(1,0,0)得到\n目标方向(x,y,z)和切向(-y cost +x sint,x cost + y sint,0)\n这里的向量弄成长度为1的。\n如果xy全为0，就换一个切向，例如(0, -z cost +y sint, y cost+z sint)\n最后反解出thx, thy, thz\n\n(我瞎说的，我也不知道能不能反解出来)"
        },
        {
            "author": "Ant繁星飞跃",
            "timestamp": 1492831380,
            "txt_content": "def armorstandcommand(a,b,c,d):\n        return \"/summon Armor_Stand ~0 ~1 ~0 {Pose:{Head:[%.8fF,%.8fF,%.8fF]}}\\n\" % armorstand(a,b,c,d)\n还有这个"
        },
        {
            "author": "浅念哥",
            "timestamp": 1492866240,
            "txt_content": "#include <cmath>\n#include <iostream>\n#define PI 3.1415926535\n\nusing namespace std;\n\ndouble* armorstand(double Q,double B,double C,double t)\n{\n        double Az,Bz,Cz,a,b,c,d,f,l,thx,thy,thz,x,y,z;\n        a=C*C+Q*Q;\n        b=C*C+B*B;\n        c=Q*B;\n        l=sqrt(Q*Q+B*B+C*C);\n         if(C==0){\n                if(Q==0){\n                        x=cos(t);\n                        y=0;\n                        z=sin(t)*((B<0)*2-1);\n                }else{\n                        x=-sin(t)*Q*B*sqrt(B*B/(Q*Q)+1)/(Q*Q+B*B);\n                        y=sin(t)/sqrt(1+B*B/(Q*Q));\n                        z=sqrt((1-x*x-y*y)>0?1-x*x-y*y:0)*(((-Q*cos(t))>0?1:0)*2-1);\n                }\n        }else{\n                x=C*cos(t)/sqrt(a) - (c/a)*C*sin(t)/sqrt(b-c*c/a);\n                y=C*sin(t)/sqrt(b-c*c/a);\n                z=(Q*x+B*y)/(-C);\n        }\n        thz=(x==0)?PI/2:-atan(y/x);\n        Az=(Q*cos(thz)-B*sin(thz))/l;\n        Bz=(B*cos(thz)+Q*sin(thz))/l;\n        Cz=C/l;\n        d=x*cos(thz)-y*sin(thz);\n        f=z;\n        thy=acos(d)*(2*(f>0)-1);\n        thx=-acos(Bz)*(2*((Az*f-Cz*d)>0)-1);\n        double *returned=new double[3];\n        returned[0]=180*thx/PI;\n        returned[1]=180*thy/PI;\n        returned[2]=180*thz/PI;\n        return returned;\n}\nint main()\n{\n        double A=-1,B=-1,C=-1,t=0;\n        double *returned=armorstand(A,B,C,t);\n        cout<<\"/summon Armor_Stand ~0 ~1 ~0 \";\n        cout<<\"{Pose:Head:[\"<<returned[0]<<\",\";\n        cout<<returned[1]<<\",\"<<returned[2]<<\"]}}\";\n        return 0;\n}复制代码\n第46行是多余的，以及输出的时候少些了一个\"{\""
        },
        {
            "author": "Yaossg",
            "timestamp": 1492867380,
            "txt_content": "langyo_v3 发表于 2017-4-22 21:33\nchyx说,这里出的问题是在数学模型上\n\n我开这么高悬赏不是没有道理,因为我希望的是给个数学模型,可惜我还 ...\ndelete哭晕在厕所真的没人想起它吗\n还有我不是说了用容器用容器吗。。。"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1492867440,
            "txt_content": "浅念哥 发表于 2017-4-22 21:04\n第46行是多余的，以及输出的时候少些了一个\"{\"\n= =你给我解释一下,为什么cin是多余的……\n\n以及NBT里没少花括号啊?"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1492867740,
            "txt_content": "姚氏帅哥 发表于 2017-4-22 21:43\n咳咳，我来正经的回答一下\n首先原来的代码里面的max全部被你换走了，换成了三元运算符\n一句话:危险且低效。 ...\n好主意,但chyx说,问题出在数学模型上\n\n我只能做转换,但代码…我画了很长时间的图,还是没解决,他可能是做了一定的混淆…也不解释下各个中间变量是干什么的…"
        },
        {
            "author": "浅念哥",
            "timestamp": 1492867740,
            "txt_content": "langyo_v3 发表于 2017-4-22 21:24\n= =你给我解释一下,为什么cin是多余的……\n\n以及NBT里没少花括号啊?#include <cmath>\n#include <iostream>\n#define PI 3.1415926535\n\nusing namespace std;\n\ndouble* armorstand(double A,double B,double C,double t)\n{\n        double Az,Bz,Cz,a,b,c,d,f,l,thx,thy,thz,x,y,z;\n        a=C*C+A*A;\n        b=C*C+B*B;\n        c=A*B;\n        l=sqrt(A*A+B*B+C*C);\n         if(C==0){\n                if(A==0){\n                        x=cos(t);\n                        y=0;\n                        z=sin(t)*((B<0)*2-1);\n                }else{\n                        x=-sin(t)*A*B*sqrt(B*B/(A*A)+1)/(A*A+B*B);\n                        y=sin(t)/sqrt(1+B*B/(A*A));\n                        z=sqrt((1-x*x-y*y)>0?1-x*x-y*y:0)*(((-A*cos(t))>0?1:0)*2-1);\n                }\n        }else{\n                x=C*cos(t)/sqrt(a) - (c/a)*C*sin(t)/sqrt(b-c*c/a);\n                y=C*sin(t)/sqrt(b-c*c/a);\n                z=(A*x+B*y)/(-C);\n        }\n        thz=(x==0)?PI/2:-atan(y/x);\n        Az=(A*cos(thz)-B*sin(thz))/l;\n        Bz=(B*cos(thz)+A*sin(thz))/l;\n        Cz=C/l;\n        d=x*cos(thz)-y*sin(thz);\n        f=z;\n        thy=acos(d)*(2*(f>0)-1);\n        thx=-acos(Bz)*(2*((Az*f-Cz*d)>0)-1);\n        double *returned=new double[3];\n        returned[0]=180*thx/PI;\n        returned[1]=180*thy/PI;\n        returned[2]=180*thz/PI;\n        return returned;\n}\nint main()\n{\n        double A,B,C,t;\n        cin>>A>>B>>C>>t;\n        double *returned=armorstand(A,B,C,t);\n        cout<<\"/summon Armor_Stand ~0 ~1 ~0 \";\n        cout<<\"{Pose:{Head:[\"<<returned[0]<<\",\";\n        cout<<returned[1]<<\",\"<<returned[2]<<\"]}}\";\n        return 0;\n}复制代码\n抱歉发错了\nHead前面少一个{\n输入没有问题，我刚才测试环境的问题"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1492867980,
            "txt_content": "浅念哥 发表于 2017-4-22 21:29\n抱歉发错了\nHead前面少一个{\n输入没有问题，我刚才测试环境的问题\nchyx说,这里出的问题是在数学模型上\n\n我开这么高悬赏不是没有道理,因为我希望的是给个数学模型,可惜我还没学导数只能求助\n\nchyx打死不说在那里赌气,但他却清楚为什么这么写错了= ="
        },
        {
            "author": "Yaossg",
            "timestamp": 1492868580,
            "txt_content": "咳咳，我来正经的回答一下\n首先原来的代码里面的max全部被你换走了，换成了三元运算符\n一句话:危险且低效。\n应该自己写一个max反正又不复杂不你现在这个强一万倍"
        },
        {
            "author": "Yaossg",
            "timestamp": 1492868580,
            "txt_content": "最关键的问题是\nthz=pi/2 if x==0 else -atan(y/x)\n是什么意思？一直没看懂"
        },
        {
            "author": "浅念哥",
            "timestamp": 1492868940,
            "txt_content": "langyo_v3 发表于 2017-4-22 21:29\n好主意,但chyx说,问题出在数学模型上\n\n我只能做转换,但代码…我画了很长时间的图,还是没解决,他可能是做 ...\n你问我要数学模型，然而我并不知道什么数学模型\n我只是将Python转成了C而已\n而且没发现什么\"混淆\""
        },
        {
            "author": "Yaossg",
            "timestamp": 1492869000,
            "txt_content": "langyo_v3 发表于 2017-4-22 21:29\n好主意,但chyx说,问题出在数学模型上\n\n我只能做转换,但代码…我画了很长时间的图,还是没解决,他可能是做 ...\n可惜明天我要去军训，否则我肯定会仔细找找，\n现在只能草率看看。。。"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1492869180,
            "txt_content": "浅念哥 发表于 2017-4-22 21:49\n你问我要数学模型，然而我并不知道什么数学模型\n我只是将Python转成了C而已\n而且没发现什么\"混淆\" ...\n如果不把真实变量名写成一堆数学符号对应的字母,我用得着悬赏么= ="
        },
        {
            "author": "Yaossg",
            "timestamp": 1492869180,
            "txt_content": "姚氏帅哥 发表于 2017-4-22 21:43\n最关键的问题是\nthz=pi/2 if x==0 else -atan(y/x)\n是什么意思？一直没看懂\n我去查了下资料，大概懂了，今天没时间了，下周再说吧"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1492872120,
            "txt_content": "langyo_v3 发表于 2017-4-22 21:33\nchyx说,这里出的问题是在数学模型上\n\n我开这么高悬赏不是没有道理,因为我希望的是给个数学模型,可惜我还 ...\n另外,反驳你对三元运算符的片面看法。\n\n众所周知,三元运算符是专为汇编语言的一些特性量身定做的。\n举个例子,m=a>b?233:666,编译后大概长这样:m=(a>b?a:b)\nm in eax,a in ecx,b in edx\ncode:\n  cmpq %edx %ecx\n  jg .L1\n  movq %edx %eax\n.L1:\n  mouq %ecx %eax复制代码(我打死不用Intel的写法XD)\n\n那int max(int a,int b)呢?m=max(a,b)\nm in eax,a in ecx,b in edx\ncode:\n  pushq $0xA2\n  pushq $0xA1\n  call .MAX\n\n.MAX:\n  popq %ecx\n  popq %edx\n  cmpq %edx %ecx\n  jg .L1\n  movq %edx %eax\n  .L1:\n    movq %ecx %eax\n  ret复制代码\n你想反驳都差不多是么?\n但你忘记了,现代处理器都有超标量流水线的啊。你不断地call不断地ret,总是打断流水线,搞得处理器只能往线里放nop,很尴尬。但三元运算符就不一样了,由于三个数据都不一样,互不干涉,所以可以像淌水一样流畅地执行下去,不用放nop来浪费时间。\n\n\n\n@chyx = =求打脸"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1492960260,
            "txt_content": "补充:\n问题在算法上,而不是所谓的语法错误\n如果能在指出错误的基础上,把chyx的数学模型复原,我会将奖励翻倍(重发新悬赏,用于回答数学模型,爱心两帖算作一个)\n\n@ustc_zzzz @gamerteam @ruhuasiyu"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1492965960,
            "txt_content": "ruhuasiyu 发表于 2017-4-24 00:55\n啥玩意？你的算法和chyx不一样还是什么意思？没学过C艹……\n\n初始朝向是(0,0,1)，假设指定一个切向（1,0,0 ...\nm.blog.csdn.net/article/details?id=51728818\nwww.cnblogs.com/graphics/archive/2012/08/02/2616017.html\n这些是我老早之前为了用Android的Graphis而收的资料，后半部分是矩阵变换对点带来位置变换的说明。\n\n另外，我发觉chyx的算法似乎能优化。可惜我线代学的不精，没到高中没办法突破理解能力。\n\n\n\n我再想想，看看你的矩阵，稍等采纳。"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1492966860,
            "txt_content": "你用浅念的代码试了吗？\n你原有代码有点问题啊\nL20 x=-sin(t)*A*B*sqrt(B*B/(A*A)+1)/(A*A+B*B)\nL25 x=C*cos(t)/sqrt(a)-(c/a)*C*sin(t)/sqrt(b-c*c/a);\nL35 thx=-acos(Bz)*(((Az*f-Cz*d)>0)?1:-1)\n复制代码"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1492967280,
            "txt_content": "ruhuasiyu 发表于 2017-4-24 01:01\n你用浅念的代码试了吗？\n你原有代码有点问题啊\n具体出什么问题了?\n这两句是根据chyx的来写的"
        },
        {
            "author": "ruhuasiyu",
            "timestamp": 1493006700,
            "txt_content": "langyo_v3 发表于 2017-4-24 01:08\n具体出什么问题了?\n这两句是根据chyx的来写的\n我是说你代码和chyx有3处不同，不知道你是不是已经修改过了。就是这三行"
        },
        {
            "author": "Yaossg",
            "timestamp": 1493378580,
            "txt_content": "langyo_v3 发表于 2017-4-22 22:42\n另外,反驳你对三元运算符的片面看法。\n\n众所周知,三元运算符是专为汇编语言的一些特性量身定做的。\n举个例子 ...\n我不是这个意思。。。\n我说的效率，是写代码的效率，就是说要实现max每次都要复制一遍(a>b?a:b,lz就是把a和b换成了表达式)\n我说的危险，是你改了前面的a,后面的a没改，不就完蛋了吗\n然后我发现你才是大神啊"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1493379780,
            "txt_content": "姚氏帅哥 发表于 2017-4-28 19:58\n最后，我要强调一件事\n在中已经定义了泛型max\n无需再次定义，或者写成你那个样子\n最后一句话,你看看这个吧\nwww.cnblogs.com/pkuoliver/archiv ... try-about-sqrt.html\n\n标准库也是人写的"
        },
        {
            "author": "Yaossg",
            "timestamp": 1493380140,
            "txt_content": "langyo_v3 发表于 2017-4-22 22:42\n另外,反驳你对三元运算符的片面看法。\n\n众所周知,三元运算符是专为汇编语言的一些特性量身定做的。\n举个例子 ...\n还有你显然不知道我的意思是写成这样\nint max(int a,int b)\n{\nreturn a>b?a:b;\n}\n错不在三元运算符，错在把三元运算符频繁、重复地使用\n以及可以使用inline关键字，效率会更高"
        },
        {
            "author": "Yaossg",
            "timestamp": 1493380680,
            "txt_content": "langyo_v3 发表于 2017-4-22 22:42\n另外,反驳你对三元运算符的片面看法。\n\n众所周知,三元运算符是专为汇编语言的一些特性量身定做的。\n举个例子 ...\n最后，我要强调一件事\n在<algorithm>中已经定义了泛型max\n无需再次定义，或者写成你那个样子\n此外标准库效率一定比你写的高\n而且编译器会优化，所以\n只要可以用标准库，就千方百计的去用，而不是“自己来”"
        },
        {
            "author": "Yaossg",
            "timestamp": 1493381340,
            "txt_content": "langyo_v3 发表于 2017-4-28 19:43\n最后一句话,你看看这个吧\nwww.cnblogs.com/pkuoliver/archive/2010/10/06/sotry-about-sqrt.html\n\n\n你这个属于极端栗子，我之前看过\n但是你想过“神奇数字”真的那么“总是有效”\n还是用真正的数学方法更好？\n标准库确实是人写的，也曾经出过差错(比方说...算了不在这说，不是很好)\n但是所有人的代码中都用标准库写好的\n是绝对值得推崇的\n你完完全全可以自己写个标准库\n尤其是c/c++标准库，它比其他语言的标准库好写\n但是，写出来有用吗？顶多练习下编程，难道还真的投入使用吗\n当然我再次强调你提到的是是极端栗子"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1493381640,
            "txt_content": "姚氏帅哥 发表于 2017-4-28 20:09\n你这个属于极端栗子，我之前看过\n但是你想过“神奇数字”真的那么“总是有效”\n还是用真正的数学方法更好 ...\n这个极端栗子足够推翻你所谓标准库最好的说法\n\n我喜欢和平,语气不要太浓"
        },
        {
            "author": "Yaossg",
            "timestamp": 1493381820,
            "txt_content": "langyo_v3 发表于 2017-4-28 19:43\n最后一句话,你看看这个吧\nwww.cnblogs.com/pkuoliver/archive/2010/10/06/sotry-about-sqrt.html\n我去复习了一遍你提到的sqrt算法，我觉得还有几点需要考虑\n1.那个函数求的是1/sqrt()而不是sqrt()//其实这个问题不是问题，拿1除一下就好了\n2.那个函数只接受并返回float可见精度不高，如果我要发射火箭，用那个算法直接在空中爆炸了好吗\n//其实标准库有没有泛型sqrt我不清楚，但是起码精读有保障"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1493382180,
            "txt_content": "姚氏帅哥 发表于 2017-4-28 20:17\n我去复习了一遍你提到的sqrt算法，我觉得还有几点需要考虑\n1.那个函数求的是1/sqrt()而不是sqrt()//其实 ...\n1.是啊除以1不就行?再说了你算三维顶点时其实更常用的是1/√x\n2.你不能改成double么?要是还担心火箭爆炸,你难道不能自己写个超精浮点的object?"
        },
        {
            "author": "Yaossg",
            "timestamp": 1493382300,
            "txt_content": "langyo_v3 发表于 2017-4-28 20:23\n1.是啊除以1不就行?再说了你算三维顶点时其实更常用的是1/√x\n2.你不能改成double么?要是还担心火箭爆炸, ...\n你不知道那个算法只适用于float吗？\n超精度浮点数。。。还是算了。。。"
        },
        {
            "author": "Yaossg",
            "timestamp": 1493382360,
            "txt_content": "langyo_v3 发表于 2017-4-28 20:14\n这个极端栗子足够推翻你所谓标准库最好的说法\n\n我喜欢和平,语气不要太浓 ...\n我说话就这点毛病，如有冒犯实在抱歉。。。"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1493382660,
            "txt_content": "姚氏帅哥 发表于 2017-4-28 20:25\n你不知道那个算法只适用于float吗？\n超精度浮点数。。。还是算了。。。\n你可以也像那位数学家一样,在额定的精度下,暴力求最佳数字,我保证和float的那个不差多少\n\n超精度其实就是大数与浮点的结合"
        },
        {
            "author": "Yaossg",
            "timestamp": 1493382780,
            "txt_content": "langyo_v3 发表于 2017-4-28 20:23\n1.是啊除以1不就行?再说了你算三维顶点时其实更常用的是1/√x\n2.你不能改成double么?要是还担心火箭爆炸, ...\n最后经过我研究得出:\n1.这个方法换一个浮点数实现方法就可能瞬间爆炸\n2.它把float当作int处理，完了再弄回float,非常显然\n如果要用double必须使用longlong配合并且必须另找“神奇数字”"
        },
        {
            "author": "langyo_v3",
            "timestamp": 1493382900,
            "txt_content": "姚氏帅哥 发表于 2017-4-28 20:33\n最后经过我研究得出:\n1.这个方法换一个浮点数实现方法就可能瞬间爆炸\n2.它把float当作int处理，完了再弄 ...\n但总而言之我们找到了更好的sqrt,不是么?XD"
        }
    ]
}