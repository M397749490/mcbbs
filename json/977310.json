{
    "title": "[公告]关于部分NukkitX插件存在刷OP权限漏洞的提醒/建议开发者注意NK2.0最新动态",
    "author": "PQguanfang",
    "replyCount": 14,
    "timestamp": 1583389320,
    "txt_content": " 本帖最后由 PQguanfang 于 2020-8-31 17:47 编辑 \n\n给各位使用NukkitX服务端核心开服的服主们：\n    \n      现已查实，NukkitX服务端核心中，对于插件的以OP身份执行命令判断机制存在问题。如果您安装了涉及以OP身份执行命令的插件，请立即关注本贴，因为这将可能导致您所开启的NukkitX服务器有玩家刷取OP的风险！\n      现已在本版中的Nukkit插件专区发现以下插件含有问题，请服主们自行考虑是否需要继续使用下述插件：\n\n\n\n●Knickers——菜单插件——其中的玩家点击按钮执行命令中会触发此问题，请修改为以控制台身份执行命令即可\n●DogSign——签到插件——其中的玩家签到执行命令功能会触发此问题\n●更多插件等待补充，如果您发现哪个插件也会触发此问题，请在本贴回复。本贴禁水。\n      也请上述插件的作者尽快更新，将您插件中的以OP身份执行命令改为以控制台身份执行命令。同时我们也向各位服主推荐下面的一个插件：\n●插件地址：https://www.mcbbs.net/thread-888078-1-1.html\n",
    "replies": [
        {
            "author": "innc",
            "timestamp": 1583476620,
            "txt_content": "我靠，我是说前段时间怎么op.txt多了一个我不认识的名字，而且翻阅了开服一来所有的日志都没有发现异常，原来是因为这个原因，那天吓死我了，还好那个玩家什么都不知道"
        },
        {
            "author": "一只鸽纸",
            "timestamp": 1583485260,
            "txt_content": "innc 发表于 2020-3-6 14:37\n我靠，我是说前段时间怎么op.txt多了一个我不认识的名字，而且翻阅了开服一来所有的日志都没有发现异常，原 ...\n我服务器一个玩家用Dogsign不小心卡出来OP，还好是内测元老没搞破坏，还帮忙排查问题"
        },
        {
            "author": "一只炙寒",
            "timestamp": 1583485560,
            "txt_content": "Kinckers只要是以op执行命令的均会可能获得op权限\n目前的解决方法是，修改为玩家方式或者控制台方式执行命令即可\n其他的默认以op权限执行命令的插件都有可能吧\n解决方法就是安装个op管理插件，比如Amentia（个人推荐）\n（可能对此问题理解不当，大佬勿喷）"
        },
        {
            "author": "innc",
            "timestamp": 1583491140,
            "txt_content": "端典程序猿 发表于 2020-3-6 17:01\n我服务器一个玩家用Dogsign不小心卡出来OP，还好是内测元老没搞破坏，还帮忙排查问题 ...\n看来不止我一个人遇到这个问题呐，莫非这些插件都是进行的临时提权然后再执行特权命令？随后在撤销OP权限？要是真的是这样那的确是很危险，想想就害怕"
        },
        {
            "author": "innc",
            "timestamp": 1583491320,
            "txt_content": "一只炙寒 发表于 2020-3-6 17:06\nKinckers只要是以op执行命令的均会可能获得op权限\n目前的解决方法是，修改为玩家方式或者控制台方式执行命 ...\n哎，可能是插件对这种情况处理的不够吧，个人觉得应该在临时提权后把还没来得及撤销权限的名字写到配置文件里，下次服务器启动的时候进行检查并处理，不然要是还没来得撤权就关服就不好了"
        },
        {
            "author": "Kenneth_z",
            "timestamp": 1583567040,
            "txt_content": " 本帖最后由 Kenneth_z 于 2020-3-7 15:45 编辑 \n\n两个插件都是给玩家OP，执行完命令在去掉OP，我觉得是很危险的\n可以从权限方面入手，不需要非得执行命令都要OP\nNK2.0现在还在快速迭代，api都还没定下来，各种蜜汁bug，这个时候推荐开发者使用2.0\n"
        },
        {
            "author": "皓月凌空888",
            "timestamp": 1583588760,
            "txt_content": " 本帖最后由 皓月凌空888 于 2020-3-7 21:47 编辑 \n\n2.0正式用可能还有点久远\n用一些权限管理插件就好了吧\nLuckPerms无所畏惧"
        },
        {
            "author": "catrinbow",
            "timestamp": 1583634180,
            "txt_content": "所以说是核心的问题啦？"
        },
        {
            "author": "吕易天",
            "timestamp": 1592143380,
            "txt_content": " 本帖最后由 吕易天 于 2020-6-15 07:15 编辑 \n\n其实只要用Proxy代替setOp就行了举个例子：\nCommandSender pro=(CommandSender)Proxy.newProxyInstance(this.getClass().getClassLoader(),new Class<?>[]{CommandSender.class, InventoryHolder.class, ChunkLoader.class, IPlayer.class},(proxy,method,args)->{\nif(method.getName().equals(\"isOp\"))\n  return true;\nreturn method.invoke(originalPlayer,args);\n});\nServer.getInstance().dispatchCommand(pro,cmd);\n实在不行就用cglib，毕竟nukkit的Player和bukkit的CraftPlayer不一样，没加final(我怀疑bukkit开发团队用了SonarLint，到处给我加final)\n如果不嫌麻烦也可以手写静态代理"
        },
        {
            "author": "吕易天",
            "timestamp": 1592145240,
            "txt_content": "innc 发表于 2020-3-6 18:42\n哎，可能是插件对这种情况处理的不够吧，个人觉得应该在临时提权后把还没来得及撤销权限的名字写到配置文 ...\n所以应该用Proxy或cglib而不是直接setOp，直接设置实际op是非常不安全的操作"
        },
        {
            "author": "烈阳XWIN",
            "timestamp": 1593059940,
            "txt_content": " 本帖最后由 烈阳XWIN 于 2020-6-25 12:41 编辑 \n\n看了这文确实很危险，都不敢下载菜单签到系统之类的了，不过如果是可以获得op，是不是添加op管理那些白名单就可以了，比如:AuthorizedOP，或者是后台管理那些(纯属建议大佬不喜勿喷，如果有错十分抱歉"
        },
        {
            "author": "驻魂圣使",
            "timestamp": 1608646800,
            "txt_content": "请问一下，nukkit地狱传送门卡顿是怎么回事？进入传送门后两个地图会重叠，然后等大概一分钟后才会分离开来。"
        },
        {
            "author": "驻魂圣使",
            "timestamp": 1608646920,
            "txt_content": "请问一下，nukkit地狱传送门卡顿是怎么回事？进入传送门后两个地图会重叠，然后等大概一分钟后才会分离开来。"
        },
        {
            "author": "齿轮-gear",
            "timestamp": 1612791360,
            "txt_content": "innc 发表于 2020-3-5 22:39\n看来不止我一个人遇到这个问题呐，莫非这些插件都是进行的临时提权然后再执行特权命令？随后在撤销OP权限 ...\n一般来说都是采取这种措施，先提升OP，然后写入/读取完数据后deop"
        }
    ]
}