{
    "title": "我无法在 Main Class 以外的 Class 读取 Config.yml",
    "author": "az860325",
    "replyCount": 5,
    "timestamp": 1472664540,
    "txt_content": " 本帖最后由 az860325 于 2016-9-1 01:57 编辑 \n\n最近正在练习开发一个 Plugin，其中我需要读取 Config.yml 中的一个 String 到程式里面，并且对这个 String 做一个处理的程序之后在显示给发送指令的玩家看，前面几个步骤我都已经正常的完成了，但是就卡在我要读取 Config.yml  的部。\n正常来说在 Main Class 中读取 Config.yml中的 String 并且发送给玩家的代码是这样sender.sendMessage(getConfig().getString(\"Message.SearchPlayer.DoesNotExist\"));复制代码但是因为我读取进来的 String 要另外做处理所以我把它放置在与 Main Class 不同套件的位置像是这样Plugin Project\n    └ src\n        ├ com.main\n        │      └ Main.java (主類別)\n        └ com.readConfig\n                └ SearchPlayer.java (讀取 Config.yml 的類別)复制代码\n其中很奇怪的是我在 Main Class 中使用 getConfig().getString(\"Message.SearchPlayer.Exist\") 是可以的，而在 SearchPlayer.java 使用同一段程式码读取 Config.yml 时是读不到字串的public class Main extends JavaPlugin implements Listener {\n(程式码掠过)\n    @Override\n    public boolean onCommand(CommandSender sender, Command cmd, String label, String[] args) {\n        (程式码掠过)\n\n        //可以正常使用\n        sender.sendMessage(getConfig().getString(\"Message.SearchPlayer.DoesNotExist\"));\n\n        //无法正常使用\n        sender.sendMessage(new SearchPlayer().getSearchPlayerDoesNotExistMessage());\n        (程式码掠过)\n    }\n(程式码掠过)\n}复制代码public class SearchPlayer extends JavaPlugin {\n\n    public String getSearchPlayerDoesNotExistMessage() {\n        String configString = getConfig().getString(\"Message.SearchPlayer.DoesNotExist\");\n        return configString;\n    }\n\n}复制代码\n[01:20:50 INFO]: King_May issued server command: /ds SearchPlayer 0 #这是我打的指令#\n[01:20:50 ERROR]: null #我也不知道为什么这边会有一个 Null#\norg.bukkit.command.CommandException: Unhandled exception executing command 'ds' in plugin DsPlugin v1.0\n        at org.bukkit.command.PluginCommand.execute(PluginCommand.java:46) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.command.SimpleCommandMap.dispatch(SimpleCommandMap.java:141) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.craftbukkit.v1_8_R1.CraftServer.dispatchCommand(CraftServer.java:646) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.PlayerConnection.handleCommand(PlayerConnection.java:1115) [spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.PlayerConnection.a(PlayerConnection.java:950) [spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.PacketPlayInChat.a(PacketPlayInChat.java:26) [spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.PacketPlayInChat.a(PacketPlayInChat.java:53) [spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.PacketHandleTask.run(SourceFile:13) [spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source) [?:1.8.0_101]\n        at java.util.concurrent.FutureTask.run(Unknown Source) [?:1.8.0_101]\n        at net.minecraft.server.v1_8_R1.MinecraftServer.z(MinecraftServer.java:696) [spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.DedicatedServer.z(DedicatedServer.java:316) [spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.MinecraftServer.y(MinecraftServer.java:634) [spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.MinecraftServer.run(MinecraftServer.java:537) [spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at java.lang.Thread.run(Unknown Source) [?:1.8.0_101]\nCaused by: java.lang.IllegalArgumentException: Plugin already initialized!\n        at org.bukkit.plugin.java.PluginClassLoader.initialize(PluginClassLoader.java:122) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.plugin.java.JavaPlugin.<init>(JavaPlugin.java:66) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at tw.com.readConfig.Test.<init>(Test.java:5) ~[?:?]\n        at tw.com.main.Main.onCommand(Main.java:69) ~[?:?]\n        at org.bukkit.command.PluginCommand.execute(PluginCommand.java:44) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        ... 14 more\nCaused by: java.lang.IllegalStateException: Initial initialization\n        at org.bukkit.plugin.java.PluginClassLoader.initialize(PluginClassLoader.java:125) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.plugin.java.JavaPlugin.<init>(JavaPlugin.java:66) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at tw.com.main.Main.<init>(Main.java:15) ~[?:?]\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[?:1.8.0_101]\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(Unknown Source) ~[?:1.8.0_101]\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(Unknown Source) ~[?:1.8.0_101]\n        at java.lang.reflect.Constructor.newInstance(Unknown Source) ~[?:1.8.0_101]\n        at java.lang.Class.newInstance(Unknown Source) ~[?:1.8.0_101]\n        at org.bukkit.plugin.java.PluginClassLoader.<init>(PluginClassLoader.java:76) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.plugin.java.JavaPluginLoader.loadPlugin(JavaPluginLoader.java:131) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.plugin.SimplePluginManager.loadPlugin(SimplePluginManager.java:329) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.plugin.SimplePluginManager.loadPlugins(SimplePluginManager.java:251) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.craftbukkit.v1_8_R1.CraftServer.loadPlugins(CraftServer.java:291) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.craftbukkit.v1_8_R1.CraftServer.reload(CraftServer.java:744) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.Bukkit.reload(Bukkit.java:534) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.command.defaults.ReloadCommand.execute(ReloadCommand.java:25) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.command.SimpleCommandMap.dispatch(SimpleCommandMap.java:141) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.craftbukkit.v1_8_R1.CraftServer.dispatchCommand(CraftServer.java:646) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at org.bukkit.craftbukkit.v1_8_R1.CraftServer.dispatchServerCommand(CraftServer.java:632) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.DedicatedServer.aM(DedicatedServer.java:353) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        at net.minecraft.server.v1_8_R1.DedicatedServer.z(DedicatedServer.java:317) ~[spigot-1.8.jar:git-Spigot-550ebac-7019900]\n        ... 3 more复制代码这个问题已经困扰我 2 天了，这种爬文还是一样无解...，希望可以在这找到答案，感谢\n",
    "replies": [
        {
            "author": "q513902026",
            "timestamp": 1472680560,
            "txt_content": "这个问题就在于你没有理解JavaPlugin这个类 他是只作为你插件的主类父类存在 理论上一个插件只可以存在一个继承了JavaPlugin的主类\n就算你在其他类中继承了JavaPlugin也会因为没有在plugin.yml导致没有进行初始化 返回null\n所以正确的做法是\n把你的MainClass的主类实例引用在其他上\n\nprivate staticMain instance= null;\npublic void onLoad(){super.onLoad();\ninstance=this;}\npublic static Main getInstance(){return instance}复制代码\n\n在其他类调用的例子\nString configString = Main.getInstance().getConfig().getString(\"Message,SearchPlayer.DoesNotExist\");dui复制代码\n对于你代码上的错误 请把SearchPlayer的继承JavaPlugin删除 同时在Main使用单例模式"
        },
        {
            "author": "az860325",
            "timestamp": 1472698980,
            "txt_content": " 本帖最后由 az860325 于 2016-9-1 13:34 编辑 \n\n感谢大大的教学，容许我在问一些问题，谢谢。\n\n请问位什么要呼叫 父类 的 onLoad() 方法？\n( 刚刚测试了一下，好像没有调用父类的 onLoad() 方法好像也可以使用，还是大大的意思是希望我複写父类的 onLoad() 方法？ )\n\n是不是要在 onEnable() 里也呼叫一次我所写的 onLoad() 方法？\n\n如果我直接把 onLoad() 的内容写在 onEnable() 里面是不是也是可以行的呢？\n( 刚刚测试了一下是可行的，只是为什么要另外开一个 onLoad() 方法呢？ )\n\npublic class Main extends JavaPlugin implements Listener {\n(程式码掠过)\n    // 静态的 Main Class 物件\n    private static Main instance = null;\n\n    // 这个方法我有点看不懂\n    public void onLoad() {\n        // 为什么是调用父类别的 onLoad() 方法?\n        super.onLoad();\n        // instance 指向这个 Main Class\n        instance = this;\n    }\n\n    // 取的 Main Class 物件的方法\n    public static Main getInstance() {\n        // 回传 Main Class 物件\n        return instance;\n    }\n    (程式码掠过)\n\n    @Override\n    public void onEnable() {\n        (程式码掠过)\n        \n        // 请问是不是要在这边呼叫这个方法？\n        onLoad();\n        \n        (程式码掠过)\n    }\n\n    (程式码掠过)\n    @Override\n    public boolean onCommand(CommandSender sender, Command cmd, String label, String[] args) {\n        (程式码掠过)\n        sender.sendMessage(new SearchPlayer().getSearchPlayerDoesNotExistMessage());\n        (程式码掠过)\n    }\n(程式码掠过)\n}复制代码    @Override\n    public void onEnable() {\n        (程式码掠过)\n        \n        // 请问是不是要在这边呼叫这个方法？\n        // onLoad(); 不要呼叫方法\n        \n        // 直接撰写内容\n        super.onLoad();\n        instance = this;\n        \n        (程式码掠过)\n    }复制代码\n\n\n\n\n\n\n\n\n"
        },
        {
            "author": "andylizi",
            "timestamp": 1472726340,
            "txt_content": "az860325 发表于 2016-9-1 11:03\n感谢大大的教学，容许我在问一些问题，谢谢。\n\n请问位什么要呼叫 父类 的 onLoad() 方法？\n您可以直接把onLoad理解为构造方法，效果也一样，不过“不推荐在构造函数中泄漏this，因为构造函数中类未初始化完成，泄漏的对象可能处于不一致的状态”。如果您听不懂这句话那么说明目前这句话对您还不会影响，可以无视。\n\n另外，onLoad，onEnable以及所有从JavaPlugin类中继承的“on”开头的方法都是bukkit自动调用，您不要手动调用它们。"
        },
        {
            "author": "az860325",
            "timestamp": 1472733780,
            "txt_content": "所以说这边我复写了父类别 JavaPlugin 的 onLoad()方法，而 super.onLoad() 是为了ˊ确保原本父类别已经定义好的代码有正确执行是这样吗？\n\n我知道您说的不要手动调用那些 Bukkit 会自动调用的方法！之所以我会手动调用 onLoad() 是因为我还不是很清楚是要复写父类别 JavaPlugin 的 onLoad()方法而忘记加上 @Override 。\n\n感谢两位大神的回答。"
        },
        {
            "author": "914554688wyt",
            "timestamp": 1472904000,
            "txt_content": "az860325 发表于 2016-9-1 20:43\n所以说这边我复写了父类别 JavaPlugin 的 onLoad()方法，而 super.onLoad() 是为了ˊ确保原本父类别已经定 ...\n@Override加不加无所谓，加了可读性更强\n\n单例的话我觉得没有太大必要，在初始化其他实例的时候把this传过去就可以了~"
        }
    ]
}