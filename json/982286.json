{
    "title": "求助，关于Inventory的一系列问题",
    "author": "Meteor___",
    "replyCount": 2,
    "timestamp": 1583850720,
    "txt_content": "自我隔离这段时间学了一点Java 想实战一下，碰到这些个问题。新人代码写的烂，大佬轻喷。\n\n这是写的一个方法，想实现创建一个背包，读取yml文件添加物品的效果。\n出现了第二个循环那里只有第二次发送物品才能实现ItemStack中的setname方法,以及lore\ngetConfig那个循环倒是照设想的运行。\n\n public static void openGui(Player p) {\n                \n                File dates2 = new File(ArtMail.plugin.getDataFolder() + \"\\\\Mailbook.yml\"); //读取邮件列表文件\n                YamlConfiguration ed2 = YamlConfiguration.loadConfiguration(dates2);\n                File dates = new File(ArtMail.plugin.getDataFolder() + \"\\\\playerdata\\\" + p.getName() + \".yml\"); //读取玩家数据\n                YamlConfiguration ed = YamlConfiguration.loadConfiguration(dates);\n                \n                String title = ArtMail.plugin.getConfig().getString(\"info.title\").replace(\"%p%\", p.getName());\n                \n                \n                Inventory inv = Bukkit.createInventory(null, 54,title.replace(\"&\",\"§\"));                //创建GUI界面 （邮箱)\n                \n                        for(int i =0;i<54;i++) {\n                                ItemStack item = new ItemStack(Material.WHITE_STAINED_GLASS_PANE);\n                                ItemMeta im = item.getItemMeta();\n                                im.setDisplayName(ArtMail.plugin.getConfig().getString(\"item.fenge.name\"));\n                                ArrayList<String> lore = new ArrayList<>();\n                                for(String line : ArtMail.plugin.getConfig().getStringList(\"item.fenge.lore\")) {\n                                        lore.add(line);\n                                }\n                                im.setLore(lore);\n                                item.setItemMeta(im);\n                                inv.setItem(i, item);\n                        }\n                        \n                        \n                if(ed.getInt(\"mailamount\")>0) {\n                        for(int i=0;i<ed.getInt(\"mailamount\");i++) {\n                                String name = ed.getString(\"Mailbook\"+i+\".name\");\n                                String Dname = ed2.getString(\"Maillist.\"+name+\".name\");\n                                ArrayList<String> lore = new ArrayList<>();\n                                for(String line : ed.getStringList(\"Mailbook\"+name+\".lore\")) {\n                                        lore.add(line);\n                                }        \n                                ItemStack item = new ItemStack(Material.BOOK);\n                                ItemMeta im = item.getItemMeta();\n                                \n//                                String Dname = ed2.getString(\"Maillist.\"+name+\".name\");\n                                im.setDisplayName(Dname);\n                                im.setLore(lore);\n                                im.setUnbreakable(true);\n                                item.setItemMeta(im);\n                                inv.setItem(i, item);\n\n                }\n                }\n                \n\n                p.closeInventory();\n                p.openInventory(inv);\n        }复制代码\n这是重写的onCommand方法部分的代码\n（实在抱歉，代码太辣眼睛了呜呜呜呜）\n\npublic class Command implements CommandExecutor{\n\n        @Override\n        public boolean onCommand(CommandSender sender, org.bukkit.command.Command cmd, String arg, String[] args) {\n                Player p = (Player) sender;\n                if(args.length==0) {\n                                if(sender.isOp()) {\n                                        for(String help : ArtMail.plugin.getConfig().getStringList(\"message.adminhelp\")) {\n                                                help = help.replace(\"&\",\"§\");\n                                                sender.sendMessage(help);\n                                        }\n                                        return true;\n                                }else {\n                                        for(String help : ArtMail.plugin.getConfig().getStringList(\"message.playerhelp\")) {\n                                                help = help.replace(\"&\",\"§\");\n                                                sender.sendMessage(help);\n                                        }\n                                        return true;\n                                }\n                        \n\n                }\n                        if(args[0].equalsIgnoreCase(\"open\")) {\n                                Gui.openGui(p);\n                                return true;\n                        }\n                        if(args[0].equalsIgnoreCase(\"sendmail\")) {\n                                if(args.length<3) {\n                                        p.sendMessage(ArtMail.plugin.getConfig().getString(\"message.noargs\"));\n                                        return true;\n                                }\n                                Player p2 = Bukkit.getPlayer(args[1]);\n                                String pn = p2.getName();\n                                File file2 = new File(ArtMail.plugin.getDataFolder()+ \"\\\\playerdata\\\"+pn+\".yml\");\n                                YamlConfiguration ed = YamlConfiguration.loadConfiguration(file2);\n                                int i = ed.getInt(\"mailamount\");\n                                i = i+1;\n                                ed.set(\"mailamount\", i);\n                                ed.set(\"Mailbook\"+i+\".name\", args[2]);\n                                try {\n                                        ed.save(file2);\n                                } catch (IOException e) {\n                                        // TODO Auto-generated catch block\n                                        e.printStackTrace();\n                                }\n                                return true;\n                        }\n                \n                \n                \n                return true;\n        }\n        \n}复制代码\n附上图\n\nhttps://sm.ms/image/27yCMI4xdGO3tEB",
    "replies": [
        {
            "author": "Karlatemp",
            "timestamp": 1583852700,
            "txt_content": "0: 你以为你用的数据库吗, 不要每次都从磁盘读, 解析yaml数据大了CPU和内存占用都很大的\n1:\n\nint i = ed.getInt(\"mailamount\"); // i = 0\n                                i = i+1; // i = 1\n                                ed.set(\"mailamount\", i); // i = 1\n                                ed.set(\"Mailbook\"+i+\".name\", args[2]); // i = 1\n\n String name = ed.getString(\"Mailbook\"+i+\".name\"); // i = 0\n                                String Dname = ed2.getString(\"Maillist.\"+name+\".name\"); // name = null, Dname= null\n                                ArrayList<String> lore = new ArrayList<>();\n                                for(String line : ed.getStringList(\"Mailbook\"+name+\".lore\")) { // ed.getStringList() = new ArrayList<>();\n                                        lore.add(line);\n                                }"
        },
        {
            "author": "Meteor___",
            "timestamp": 1583853300,
            "txt_content": " 本帖最后由 1594425141 于 2020-3-10 23:30 编辑 \nKarlatemp 发表于 2020-3-10 23:05\n0: 你以为你用的数据库吗, 不要每次都从磁盘读, 解析yaml数据大了CPU和内存占用都很大的\n1:\n好的，十分感谢"
        }
    ]
}