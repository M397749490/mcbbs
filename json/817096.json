{
    "title": "[1.7.10][CNPC]用NPC脚本做一个合成系统吧!(干货)",
    "author": "Hueihuea",
    "replyCount": 6,
    "timestamp": 1535172600,
    "txt_content": " 本帖最后由 skpsk自己家 于 2018-8-25 18:08 编辑 \n合成系统:加工台-正式版\n[学会了就评分下 不会就回复问我 被做伸手党好吗qwq 如果觉得学了没有 那就啥也别做吧]\n你有想过 用NPC做一个新的合成系统吗？\n这是干货啦awa 所以直接上代码awa\nBGM:\nhttp://music.163.com/style/swf/widget.swf?sid=35447728&type=2&auto=1&width=320&height=66\nfunction sound(sound,volume,tone){\nsound=(sound!=null) ? sound:[\"random.anvil_use\"]\nvolume=(volume>=0) ? volume:1\ntone=(tone>=0) ? tone:1\ntry{\nfor(var x=0 in sound)\nnpc.executeCommand(\"/playsound \"+sound[x]+\" @a[r=5] 0 0 0 \"+volume+\" \"+tone+\" 1\")\n}catch(err){}\n/*\nsound=音效 选填(默认铁砧使用)\nvolume=音量 选填(默认:1)\ntone=音调 选填(默认:1)\n*/\n}\nfunction particle(particle,count){\nif(particle==null){return \"§4请填写粒子名如:§2[\"villagerhappy\"]\"}\ncount=(count>=0) ? count:100\ntry{\nfor(var x=0 in particle)\nworld.spawnParticle(particle,npc.x,npc.y,npc.z,1,1,1,1,count)\n}catch(err){}\n/*\nparticle=粒子名 必填\ncount=数量 选填(默认:100)\n*/\n}\nfunction variable(str){\nmyDate=new Date\nstr=str.replace(/{p}/g, player.getName()).replace(/{n}/g, npc.getName()).replace(/{x}/g, npc.x).replace(/{y}/g, npc.y).replace(/{z}/g, npc.z).replace(/{c}/g, \"§\").replace(/{t}/g, myDate.toLocaleTimeString()).replace(/{!}/g, \",\").replace(/{<}/g, \"[\").replace(/{>}/g, \"]\")\nreturn str;\n/*\n{n}=NPC名\n{p}=玩家名\n{x}{y}{z}=XYZ坐标\n{c}=颜色代码\n{t}=当前时间\n{!}=,符号\n{<}=[符号\n{>}=]符号\n*/\n}\nfunction command(arg){\ntry{\nfor(var x=0 in arg)\nnpc.executeCommand(variable(arg[x]))\n}catch(err){}\n/*\narg=指令\n可以使用变量\n*/\n}\nfunction RN(num){\nif(Math.floor(Math.random()*100+1)<=num){return true;}else{return false}\n/*\n100/num的几率输出true （如：num=1 100/1）\n*/\n}\nfunction hasItemData(MS){\nms=MS.substring(0,MS.length-1).split(\";\")\nfor(var x=0 in ms){\nif(ms[x].split(\",\")[3]*1<ms[x].split(\",\")[2]*1)return false\n}\nreturn true;\n}\nfunction removeItemData(MS){\nms=MS.substring(0,MS.length-1)\nms=ms.split(\";\")\nfor(var x=0 in ms){\nstr=ms[x]\nstr=str.split(\",\")\nstr[3]=Number(str[3])-Number(str[2])\nms[x]=str\nMS=MS.replace(MS.split(\";\")[x],ms[x])\n}\nreturn MS;\n}\nfunction getData(value,type){\nstr=value.substring(value.indexOf(\"[\")+1,value.indexOf(\"]\"))\na=str.split(\",\")\nstr=value.replace(\"[\"+a+\"],\",\"\")\nstr=str.split(\",\")\nb=(str[0]>0) ? str[0]:\"null\"\nc=(str[1]>0) ? str[1]:\"null\"//这里使用“null”而不是null的原因是“null”会被sound particle等方法自动修复\nswitch(type){\ncase 1:\nreturn a;\ncase 2:\nreturn b;\ncase 3:\nreturn c;\n}\n}\nfunction Main1(){\ntry{\nif(player.getInventory()[8]!=null&&player.getHeldItem()!=null){\nif(player.getInventory()[8].hasTag(\"MS\")==true){\nif(player.getInventory()[8].getStackSize()==1){\nvar MS=player.getInventory()[8].getTag(\"MS\")\nif(MS.indexOf(player.getHeldItem().getDisplayName())!=-1){\na=MS.indexOf(\",\",MS.indexOf(player.getHeldItem().getDisplayName()))\nb=MS.indexOf(\",\",a+1)\nc=MS.indexOf(\",\",b+1)\nd=MS.indexOf(\";\",c+1)\nRPGitem=MS.substring((MS.indexOf(player.getHeldItem().getDisplayName())+player.getHeldItem().getDisplayName().length)+1,a)\nUUID=MS.substring(a+1,b)\ncount=MS.substring(b+1,c)\nhavecount=MS.substring(c+1,d)\n//npc.say(UUID+\"|\"+count+\"|\"+havecount)\nif(UUID==\"null\"||player.getHeldItem().getTag(\"UUID\")==UUID){\nplayer.sendMessage(\"&2成功导入\"+(player.getHeldItem().getDisplayName()+\"x\"+player.getHeldItem().getStackSize()))\nmoney=Number(havecount)+player.getHeldItem().getStackSize()\nnewStr=player.getHeldItem().getDisplayName()+\":\"+RPGitem+\",\"+UUID+\",\"+count+\",\"+money+\";\"\noldStr=player.getHeldItem().getDisplayName()+\":\"+RPGitem+\",\"+UUID+\",\"+count+\",\"+havecount+\";\"\n//npc.say(\"木棍:null,2,0;\".replace(oldStr, newStr))\nplayer.getInventory()[8].setTag(\"MS\",(MS.replace(oldStr, newStr)))\nplayer.setHeldItem(null)\nreturn UUID+\" \"+count+\" \"+havecount;\n}else{player.sendMessage(\"&4这不是这个配方需要的材料\");return false}\n}else{player.sendMessage(\"&4这不是这个配方需要的材料\");return false}\n}else{player.sendMessage(\"&4请不要叠加配方\");return false}\n}else{player.sendMessage(\"&4请把配方放在快捷栏最后一格并手持要提交的材料\");return false}\n}else{player.sendMessage(\"&4请把配方放在快捷栏最后一格并手持要提交的材料\");return false}\n}catch(err){}\n}\nfunction Main2(){\ntry{\nif(player.getInventory()[8]!=null&&player.getHeldItem()!=null){\nif(player.getInventory()[8].hasTag(\"MS\")==true){\nvar MS=player.getInventory()[8].getTag(\"MS\")\nif(MS.indexOf(player.getHeldItem().getDisplayName())!=-1){\na=MS.indexOf(\",\",MS.indexOf(player.getHeldItem().getDisplayName()))\nb=MS.indexOf(\",\",a+1)\nc=MS.indexOf(\",\",b+1)\nd=MS.indexOf(\";\",c+1)\ncount=MS.substring(b+1,c)\nhavecount=MS.substring(c+1,d)\nplayer.sendMessage(\"&2\"+player.getHeldItem().getDisplayName()+\":\"+havecount+\"/\"+count)\n}else{player.sendMessage(\"&4这不是这个配方需要的材料\");return false}\n}else{player.sendMessage(\"&4请把配方放在快捷栏最后一格并手持要查看的物品\");return false}\n}else{player.sendMessage(\"&4请把配方放在快捷栏最后一格并手持要查看的物品\");return false}\n}catch(err){}\n}\nfunction Main3(){\ntry{\nif(player.getInventory()[8]!=null){\nif(player.getInventory()[8].hasTag(\"RT\")==true){\nvar MS=player.getInventory()[8].getTag(\"MS\")\nvar RT=player.getInventory()[8].getTag(\"RT\").split(\",\")\nvar SN=player.getInventory()[8].getTag(\"sound\")\nvar PE=player.getInventory()[8].getTag(\"particle\")\nvar CM=player.getInventory()[8].getTag(\"command\")\nif(player.getInventory()[8].getStackSize()==1){\nif(hasItemData(MS)==true){\nplayer.getInventory()[8].setTag(\"MS\",removeItemData(MS))\nif(RN(Number(RT[1]))==true){\nnpc.executeCommand(\"/rpgitem \"+RT[1]+\" give \"+player.getName()+\" \"+RT[3])\nif(SN!=null){sound((getData(SN,1)),(getData(SN,2)),(getData(SN,3)))}\nif(PE!=null){particle((getData(PE,1)),(getData(PE,2)))}\nif(CM!=null){command((getData(CM,1)))}\nplayer.sendMessage(\"&2加工成功！\");\nreturn;\n}else{player.sendMessage(\"&4加工失败！\");return false}\n}else{player.sendMessage(\"&4材料不足\");return false}\n}else{player.sendMessage(\"&4请不要叠加配方\");return false}\n}else{player.sendMessage(\"&4请把配方放在快捷栏最后一格\");return false}\n}else{player.sendMessage(\"&4请把配方放在快捷栏最后一格\");return false}\n}catch(err){}\n}\n//§4以上为方法===============================\nswitch(option){\ncase 1:\nMain1();\nbreak;\ncase 2:\nMain2();\nbreak;\ncase 3:\nMain3()\nbreak;\n}\n/*\nBY:mchhui\n该版本为正式版\n我们来说概念版 正式版 进阶版的区别\n概念版:操作繁琐 安全性低 可自定义差\n正式版:优化操作 安全增强 可自定义:音效 粒子 指令\n进阶版:在正式版的基础上增加:强化 分解 更好的查询 bukkit权限 OP面板 (开发ing 完工后送给有缘人)\n更好的查询是什么？\n我们对比一下就知道了\n正式版:\n操作:把配方放在物品栏最后一格 手持要查看的物品\n返回:物品名 拥有数量/需要数量\n进阶版：\n操作:把配方放在物品栏最后一格\n返回:\n物品名 拥有数量/需要数量\n物品名 拥有数量/需要数量\n物品名 拥有数量/需要数量\n(正式版只会显示手上的 进阶版会一次性显示全部)\n*/\n\n复制代码这个是我之前写的加工台的正式版awa\n这个代码不需要你们去修改\n只要你们安装好引擎 打开脚本 把这个放到NPC的关闭对话框钩子就行\n\n1.安装与启动引擎\n请查看 http://www.mcbbs.net/thread-816677-1-1.html 1~2章\n2.设置对话框与脚本\n新建一个对话项目\n\n其他选项随便你怎么填\n这个加工台只会判定\"对话框选项\"\n\n三个选项 选项类型全部用\"关闭\"\n（注：部分NPCmod会有2个”关闭“我们用”命令方块“后面的”关闭“）\n\n选项的内容随便你们\n但是顺序一定是\n1.导入材料\n2.查询材料剩余数\n3.合成\n\n然后让一个NPC选着这个对话项目\n\n拿出脚本魔杖 右键NPC 启动脚本引擎\n启动方法见: http://www.mcbbs.net/thread-816677-1-1.html\n\n启动后 打开左上角”脚本“ 切换到”关闭对话框钩子“ 复制上面的代码 点击粘贴按钮(不能用Ctrl+V不然颜色会失效)\n\n\n3.设置配方和材料\n我这里使用nbtEdit 方便演示 也可以使用命令方块等方式上NBT\n随便什么物品都可以当配方\n只要上NBT就可以\n我用”纸“演示\n\n基础选项:\nMS就是合成需要的材料 格式是 名字:编号,识别码,一次合成需要数量,现有数量;\nMS可以按照这个格式 无限延长\n注: 一个MS里面”名字“不能重复\n注:名字是物品自定义名字 比如我把木棍改名叫 龙剑 那么名字就要改成 龙剑\n注:如果材料没有识别码 填null即可\n\nRT就是合成的物品 格式是 RPGitemID,合成成功率,一次合成返回数量\nRPGitemID和一次返回数量 需要RPGitem插件兼容\n如果你是单机 ID填null 数量填1即可()\n 几率不管有没有RPGitem支持 都生效\n我们来讲讲其他三个选项\n\n高级选项:\nparticle=释放粒子 格式: [粒子名],数量(选填)\nsound=释放音效 格式: [音效名](选填),音量(选填),音高(选填)\ncommand=使用指令 格式:[指令]\n注:以上三个选项的[]里面可以多参数 如: command:[say 1,say 2] 每个参数用\",\"隔开\n注:以上三个选项的[]里不能出现\"[\" \"]\" \",\" 否则出错\n注:原版粒子名: https://minecraft.gamepedia.com/Particles\n注:原版音效名: http://www.mcbbs.net/thread-146334-1-1.html\n注:sound如果为空默认锻造声\n在command 我还提供了变量\n{n}=NPC名\n{p}=玩家名\n{x}{y}{z}=XYZ坐标\n{c}=颜色代码\n{t}=当前时间\n{!}=,符号\n{<}=[符号\n{>}=]符号复制代码\n不能用的\"[\" \"]\" \",\"也可以用变量代替\n\n\n材料选项:\n物品只有一个\nUUID\n强烈建议使用UUID 因为导入材料是判定名字和UUID 因为名字可以通过铁砧更改(进阶版会添加判定物品注册名的方法)\n格式：\n随便写(保证独一无二)\n如:487643218754534\n\n物品的UUID要与配方”识别码“相同\n\n4.效果图\n\n\n\n\n\n\n如果发现什么BUG可以下面回复告知我\n单机给予物品请使用配方的command\n进阶版写出来给有缘人 意思就是 随便送人\n注:本脚本需要服务器开启命令方块功能\n\n\n\n",
    "replies": [
        {
            "author": "飞翼ID",
            "timestamp": 1535388540,
            "txt_content": "教程很棒,我是CV佬"
        },
        {
            "author": "Hueihuea",
            "timestamp": 1535418420,
            "txt_content": "飞翼ID 发表于 2018-8-28 00:49\n教程很棒,我是CV佬\nCV佬是？ 原谅我的无知……"
        },
        {
            "author": "iverson119",
            "timestamp": 1535451180,
            "txt_content": "太厉害了！！！膜拜一下"
        },
        {
            "author": "Hueihuea",
            "timestamp": 1535451780,
            "txt_content": "iverson119 发表于 2018-8-28 18:13\n太厉害了！！！膜拜一下\n进阶版还有一排的新功能 写好了也给你一个吧\n（随便我的代码不是很好）"
        },
        {
            "author": "iverson119",
            "timestamp": 1535453220,
            "txt_content": "iverson119 发表于 2018-8-28 18:13\n太厉害了！！！膜拜一下\n能有毅力用npc脚本实现这么复杂的功能，还要不断调试，真的超级厉害。要不就是代码大佬，一气呵成。要不就是思路和毅力非凡啊"
        },
        {
            "author": "pookcock",
            "timestamp": 1540129860,
            "txt_content": "大佬啊，教程我一个新手都看懂了"
        }
    ]
}